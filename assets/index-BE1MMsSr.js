import{R as gt}from"./kaplay-DTLyooHV.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function i(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=i(r);fetch(r.href,n)}})();const b=t=>typeof t=="string",ee=()=>{let t,e;const i=new Promise((s,r)=>{t=s,e=r});return i.resolve=t,i.reject=e,i},Be=t=>t==null?"":""+t,mt=(t,e,i)=>{t.forEach(s=>{e[s]&&(i[s]=e[s])})},yt=/###/g,Ue=t=>t&&t.indexOf("###")>-1?t.replace(yt,"."):t,Ke=t=>!t||b(t),te=(t,e,i)=>{const s=b(e)?e.split("."):e;let r=0;for(;r<s.length-1;){if(Ke(t))return{};const n=Ue(s[r]);!t[n]&&i&&(t[n]=new i),Object.prototype.hasOwnProperty.call(t,n)?t=t[n]:t={},++r}return Ke(t)?{}:{obj:t,k:Ue(s[r])}},He=(t,e,i)=>{const{obj:s,k:r}=te(t,e,Object);if(s!==void 0||e.length===1){s[r]=i;return}let n=e[e.length-1],a=e.slice(0,e.length-1),o=te(t,a,Object);for(;o.obj===void 0&&a.length;)n=`${a[a.length-1]}.${n}`,a=a.slice(0,a.length-1),o=te(t,a,Object),o?.obj&&typeof o.obj[`${o.k}.${n}`]<"u"&&(o.obj=void 0);o.obj[`${o.k}.${n}`]=i},bt=(t,e,i,s)=>{const{obj:r,k:n}=te(t,e,Object);r[n]=r[n]||[],r[n].push(i)},le=(t,e)=>{const{obj:i,k:s}=te(t,e);if(i&&Object.prototype.hasOwnProperty.call(i,s))return i[s]},wt=(t,e,i)=>{const s=le(t,i);return s!==void 0?s:le(e,i)},at=(t,e,i)=>{for(const s in e)s!=="__proto__"&&s!=="constructor"&&(s in t?b(t[s])||t[s]instanceof String||b(e[s])||e[s]instanceof String?i&&(t[s]=e[s]):at(t[s],e[s],i):t[s]=e[s]);return t},W=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var St={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const xt=t=>b(t)?t.replace(/[&<>"'\/]/g,e=>St[e]):t;class vt{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const i=this.regExpMap.get(e);if(i!==void 0)return i;const s=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,s),this.regExpQueue.push(e),s}}const Ot=[" ",",","?","!",";"],Lt=new vt(20),Pt=(t,e,i)=>{e=e||"",i=i||"";const s=Ot.filter(a=>e.indexOf(a)<0&&i.indexOf(a)<0);if(s.length===0)return!0;const r=Lt.getRegExp(`(${s.map(a=>a==="?"?"\\?":a).join("|")})`);let n=!r.test(t);if(!n){const a=t.indexOf(i);a>0&&!r.test(t.substring(0,a))&&(n=!0)}return n},xe=(t,e,i=".")=>{if(!t)return;if(t[e])return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0;const s=e.split(i);let r=t;for(let n=0;n<s.length;){if(!r||typeof r!="object")return;let a,o="";for(let l=n;l<s.length;++l)if(l!==n&&(o+=i),o+=s[l],a=r[o],a!==void 0){if(["string","number","boolean"].indexOf(typeof a)>-1&&l<s.length-1)continue;n+=l-n+1;break}r=a}return r},ie=t=>t?.replace("_","-"),It={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){console?.[t]?.apply?.(console,e)}};class ce{constructor(e,i={}){this.init(e,i)}init(e,i={}){this.prefix=i.prefix||"i18next:",this.logger=e||It,this.options=i,this.debug=i.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,i,s,r){return r&&!this.debug?null:(b(e[0])&&(e[0]=`${s}${this.prefix} ${e[0]}`),this.logger[i](e))}create(e){return new ce(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new ce(this.logger,e)}}var F=new ce;class pe{constructor(){this.observers={}}on(e,i){return e.split(" ").forEach(s=>{this.observers[s]||(this.observers[s]=new Map);const r=this.observers[s].get(i)||0;this.observers[s].set(i,r+1)}),this}off(e,i){if(this.observers[e]){if(!i){delete this.observers[e];return}this.observers[e].delete(i)}}emit(e,...i){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([r,n])=>{for(let a=0;a<n;a++)r(...i)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([r,n])=>{for(let a=0;a<n;a++)r.apply(r,[e,...i])})}}class _e extends pe{constructor(e,i={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=i,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const i=this.options.ns.indexOf(e);i>-1&&this.options.ns.splice(i,1)}getResource(e,i,s,r={}){const n=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,a=r.ignoreJSONStructure!==void 0?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let o;e.indexOf(".")>-1?o=e.split("."):(o=[e,i],s&&(Array.isArray(s)?o.push(...s):b(s)&&n?o.push(...s.split(n)):o.push(s)));const l=le(this.data,o);return!l&&!i&&!s&&e.indexOf(".")>-1&&(e=o[0],i=o[1],s=o.slice(2).join(".")),l||!a||!b(s)?l:xe(this.data?.[e]?.[i],s,n)}addResource(e,i,s,r,n={silent:!1}){const a=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator;let o=[e,i];s&&(o=o.concat(a?s.split(a):s)),e.indexOf(".")>-1&&(o=e.split("."),r=i,i=o[1]),this.addNamespaces(i),He(this.data,o,r),n.silent||this.emit("added",e,i,s,r)}addResources(e,i,s,r={silent:!1}){for(const n in s)(b(s[n])||Array.isArray(s[n]))&&this.addResource(e,i,n,s[n],{silent:!0});r.silent||this.emit("added",e,i,s)}addResourceBundle(e,i,s,r,n,a={silent:!1,skipCopy:!1}){let o=[e,i];e.indexOf(".")>-1&&(o=e.split("."),r=s,s=i,i=o[1]),this.addNamespaces(i);let l=le(this.data,o)||{};a.skipCopy||(s=JSON.parse(JSON.stringify(s))),r?at(l,s,n):l={...l,...s},He(this.data,o,l),a.silent||this.emit("added",e,i,s)}removeResourceBundle(e,i){this.hasResourceBundle(e,i)&&delete this.data[e][i],this.removeNamespaces(i),this.emit("removed",e,i)}hasResourceBundle(e,i){return this.getResource(e,i)!==void 0}getResourceBundle(e,i){return i||(i=this.options.defaultNS),this.getResource(e,i)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const i=this.getDataByLanguage(e);return!!(i&&Object.keys(i)||[]).find(r=>i[r]&&Object.keys(i[r]).length>0)}toJSON(){return this.data}}var ot={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,i,s,r){return t.forEach(n=>{e=this.processors[n]?.process(e,i,s,r)??e}),e}};const Ve={},Ge=t=>!b(t)&&typeof t!="boolean"&&typeof t!="number";class ue extends pe{constructor(e,i={}){super(),mt(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=i,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=F.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,i={interpolation:{}}){const s={...i};return e==null?!1:this.resolve(e,s)?.res!==void 0}extractFromKey(e,i){let s=i.nsSeparator!==void 0?i.nsSeparator:this.options.nsSeparator;s===void 0&&(s=":");const r=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let n=i.ns||this.options.defaultNS||[];const a=s&&e.indexOf(s)>-1,o=!this.options.userDefinedKeySeparator&&!i.keySeparator&&!this.options.userDefinedNsSeparator&&!i.nsSeparator&&!Pt(e,s,r);if(a&&!o){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:b(n)?[n]:n};const c=e.split(s);(s!==r||s===r&&this.options.ns.indexOf(c[0])>-1)&&(n=c.shift()),e=c.join(r)}return{key:e,namespaces:b(n)?[n]:n}}translate(e,i,s){let r=typeof i=="object"?{...i}:i;if(typeof r!="object"&&this.options.overloadTranslationOptionHandler&&(r=this.options.overloadTranslationOptionHandler(arguments)),typeof options=="object"&&(r={...r}),r||(r={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const n=r.returnDetails!==void 0?r.returnDetails:this.options.returnDetails,a=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,{key:o,namespaces:l}=this.extractFromKey(e[e.length-1],r),c=l[l.length-1];let u=r.nsSeparator!==void 0?r.nsSeparator:this.options.nsSeparator;u===void 0&&(u=":");const d=r.lng||this.language,m=r.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(d?.toLowerCase()==="cimode")return m?n?{res:`${c}${u}${o}`,usedKey:o,exactUsedKey:o,usedLng:d,usedNS:c,usedParams:this.getUsedParamsDetails(r)}:`${c}${u}${o}`:n?{res:o,usedKey:o,exactUsedKey:o,usedLng:d,usedNS:c,usedParams:this.getUsedParamsDetails(r)}:o;const p=this.resolve(e,r);let f=p?.res;const w=p?.usedKey||o,x=p?.exactUsedKey||o,g=["[object Number]","[object Function]","[object RegExp]"],y=r.joinArrays!==void 0?r.joinArrays:this.options.joinArrays,S=!this.i18nFormat||this.i18nFormat.handleAsObject,L=r.count!==void 0&&!b(r.count),O=ue.hasDefaultValue(r),A=L?this.pluralResolver.getSuffix(d,r.count,r):"",K=r.ordinal&&L?this.pluralResolver.getSuffix(d,r.count,{ordinal:!1}):"",ne=L&&!r.ordinal&&r.count===0,M=ne&&r[`defaultValue${this.options.pluralSeparator}zero`]||r[`defaultValue${A}`]||r[`defaultValue${K}`]||r.defaultValue;let E=f;S&&!f&&O&&(E=M);const ye=Ge(E),ft=Object.prototype.toString.apply(E);if(S&&E&&ye&&g.indexOf(ft)<0&&!(b(y)&&Array.isArray(E))){if(!r.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const N=this.options.returnedObjectHandler?this.options.returnedObjectHandler(w,E,{...r,ns:l}):`key '${o} (${this.language})' returned an object instead of string.`;return n?(p.res=N,p.usedParams=this.getUsedParamsDetails(r),p):N}if(a){const N=Array.isArray(E),T=N?[]:{},Fe=N?x:w;for(const D in E)if(Object.prototype.hasOwnProperty.call(E,D)){const j=`${Fe}${a}${D}`;O&&!f?T[D]=this.translate(j,{...r,defaultValue:Ge(M)?M[D]:void 0,joinArrays:!1,ns:l}):T[D]=this.translate(j,{...r,joinArrays:!1,ns:l}),T[D]===j&&(T[D]=E[D])}f=T}}else if(S&&b(y)&&Array.isArray(f))f=f.join(y),f&&(f=this.extendTranslation(f,e,r,s));else{let N=!1,T=!1;!this.isValidLookup(f)&&O&&(N=!0,f=M),this.isValidLookup(f)||(T=!0,f=o);const D=(r.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&T?void 0:f,j=O&&M!==f&&this.options.updateMissing;if(T||N||j){if(this.logger.log(j?"updateKey":"missingKey",d,c,o,j?M:f),a){const C=this.resolve(o,{...r,keySeparator:!1});C&&C.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let Z=[];const ae=this.languageUtils.getFallbackCodes(this.options.fallbackLng,r.lng||this.language);if(this.options.saveMissingTo==="fallback"&&ae&&ae[0])for(let C=0;C<ae.length;C++)Z.push(ae[C]);else this.options.saveMissingTo==="all"?Z=this.languageUtils.toResolveHierarchy(r.lng||this.language):Z.push(r.lng||this.language);const $e=(C,H,k)=>{const je=O&&k!==f?k:D;this.options.missingKeyHandler?this.options.missingKeyHandler(C,c,H,je,j,r):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(C,c,H,je,j,r),this.emit("missingKey",C,c,H,f)};this.options.saveMissing&&(this.options.saveMissingPlurals&&L?Z.forEach(C=>{const H=this.pluralResolver.getSuffixes(C,r);ne&&r[`defaultValue${this.options.pluralSeparator}zero`]&&H.indexOf(`${this.options.pluralSeparator}zero`)<0&&H.push(`${this.options.pluralSeparator}zero`),H.forEach(k=>{$e([C],o+k,r[`defaultValue${k}`]||M)})}):$e(Z,o,M))}f=this.extendTranslation(f,e,r,p,s),T&&f===o&&this.options.appendNamespaceToMissingKey&&(f=`${c}${u}${o}`),(T||N)&&this.options.parseMissingKeyHandler&&(f=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${c}${u}${o}`:o,N?f:void 0,r))}return n?(p.res=f,p.usedParams=this.getUsedParamsDetails(r),p):f}extendTranslation(e,i,s,r,n){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...s},s.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!s.skipInterpolation){s.interpolation&&this.interpolator.init({...s,interpolation:{...this.options.interpolation,...s.interpolation}});const l=b(e)&&(s?.interpolation?.skipOnVariables!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let c;if(l){const d=e.match(this.interpolator.nestingRegexp);c=d&&d.length}let u=s.replace&&!b(s.replace)?s.replace:s;if(this.options.interpolation.defaultVariables&&(u={...this.options.interpolation.defaultVariables,...u}),e=this.interpolator.interpolate(e,u,s.lng||this.language||r.usedLng,s),l){const d=e.match(this.interpolator.nestingRegexp),m=d&&d.length;c<m&&(s.nest=!1)}!s.lng&&r&&r.res&&(s.lng=this.language||r.usedLng),s.nest!==!1&&(e=this.interpolator.nest(e,(...d)=>n?.[0]===d[0]&&!s.context?(this.logger.warn(`It seems you are nesting recursively key: ${d[0]} in key: ${i[0]}`),null):this.translate(...d,i),s)),s.interpolation&&this.interpolator.reset()}const a=s.postProcess||this.options.postProcess,o=b(a)?[a]:a;return e!=null&&o?.length&&s.applyPostProcessor!==!1&&(e=ot.handle(o,e,i,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(s)},...s}:s,this)),e}resolve(e,i={}){let s,r,n,a,o;return b(e)&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(s))return;const c=this.extractFromKey(l,i),u=c.key;r=u;let d=c.namespaces;this.options.fallbackNS&&(d=d.concat(this.options.fallbackNS));const m=i.count!==void 0&&!b(i.count),p=m&&!i.ordinal&&i.count===0,f=i.context!==void 0&&(b(i.context)||typeof i.context=="number")&&i.context!=="",w=i.lngs?i.lngs:this.languageUtils.toResolveHierarchy(i.lng||this.language,i.fallbackLng);d.forEach(x=>{this.isValidLookup(s)||(o=x,!Ve[`${w[0]}-${x}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(o)&&(Ve[`${w[0]}-${x}`]=!0,this.logger.warn(`key "${r}" for languages "${w.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),w.forEach(g=>{if(this.isValidLookup(s))return;a=g;const y=[u];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(y,u,g,x,i);else{let L;m&&(L=this.pluralResolver.getSuffix(g,i.count,i));const O=`${this.options.pluralSeparator}zero`,A=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(m&&(y.push(u+L),i.ordinal&&L.indexOf(A)===0&&y.push(u+L.replace(A,this.options.pluralSeparator)),p&&y.push(u+O)),f){const K=`${u}${this.options.contextSeparator}${i.context}`;y.push(K),m&&(y.push(K+L),i.ordinal&&L.indexOf(A)===0&&y.push(K+L.replace(A,this.options.pluralSeparator)),p&&y.push(K+O))}}let S;for(;S=y.pop();)this.isValidLookup(s)||(n=S,s=this.getResource(g,x,S,i))}))})}),{res:s,usedKey:r,exactUsedKey:n,usedLng:a,usedNS:o}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,i,s,r={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,i,s,r):this.resourceStore.getResource(e,i,s,r)}getUsedParamsDetails(e={}){const i=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],s=e.replace&&!b(e.replace);let r=s?e.replace:e;if(s&&typeof e.count<"u"&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!s){r={...r};for(const n of i)delete r[n]}return r}static hasDefaultValue(e){const i="defaultValue";for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&i===s.substring(0,i.length)&&e[s]!==void 0)return!0;return!1}}class We{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=F.create("languageUtils")}getScriptPartFromCode(e){if(e=ie(e),!e||e.indexOf("-")<0)return null;const i=e.split("-");return i.length===2||(i.pop(),i[i.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(i.join("-"))}getLanguagePartFromCode(e){if(e=ie(e),!e||e.indexOf("-")<0)return e;const i=e.split("-");return this.formatLanguageCode(i[0])}formatLanguageCode(e){if(b(e)&&e.indexOf("-")>-1){let i;try{i=Intl.getCanonicalLocales(e)[0]}catch{}return i&&this.options.lowerCaseLng&&(i=i.toLowerCase()),i||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let i;return e.forEach(s=>{if(i)return;const r=this.formatLanguageCode(s);(!this.options.supportedLngs||this.isSupportedCode(r))&&(i=r)}),!i&&this.options.supportedLngs&&e.forEach(s=>{if(i)return;const r=this.getScriptPartFromCode(s);if(this.isSupportedCode(r))return i=r;const n=this.getLanguagePartFromCode(s);if(this.isSupportedCode(n))return i=n;i=this.options.supportedLngs.find(a=>{if(a===n)return a;if(!(a.indexOf("-")<0&&n.indexOf("-")<0)&&(a.indexOf("-")>0&&n.indexOf("-")<0&&a.substring(0,a.indexOf("-"))===n||a.indexOf(n)===0&&n.length>1))return a})}),i||(i=this.getFallbackCodes(this.options.fallbackLng)[0]),i}getFallbackCodes(e,i){if(!e)return[];if(typeof e=="function"&&(e=e(i)),b(e)&&(e=[e]),Array.isArray(e))return e;if(!i)return e.default||[];let s=e[i];return s||(s=e[this.getScriptPartFromCode(i)]),s||(s=e[this.formatLanguageCode(i)]),s||(s=e[this.getLanguagePartFromCode(i)]),s||(s=e.default),s||[]}toResolveHierarchy(e,i){const s=this.getFallbackCodes((i===!1?[]:i)||this.options.fallbackLng||[],e),r=[],n=a=>{a&&(this.isSupportedCode(a)?r.push(a):this.logger.warn(`rejecting language code not found in supportedLngs: ${a}`))};return b(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&n(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&n(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&n(this.getLanguagePartFromCode(e))):b(e)&&n(this.formatLanguageCode(e)),s.forEach(a=>{r.indexOf(a)<0&&n(this.formatLanguageCode(a))}),r}}const ze={zero:0,one:1,two:2,few:3,many:4,other:5},Xe={select:t=>t===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class Ct{constructor(e,i={}){this.languageUtils=e,this.options=i,this.logger=F.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,i){this.rules[e]=i}clearCache(){this.pluralRulesCache={}}getRule(e,i={}){const s=ie(e==="dev"?"en":e),r=i.ordinal?"ordinal":"cardinal",n=JSON.stringify({cleanedCode:s,type:r});if(n in this.pluralRulesCache)return this.pluralRulesCache[n];let a;try{a=new Intl.PluralRules(s,{type:r})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),Xe;if(!e.match(/-|_/))return Xe;const l=this.languageUtils.getLanguagePartFromCode(e);a=this.getRule(l,i)}return this.pluralRulesCache[n]=a,a}needsPlural(e,i={}){let s=this.getRule(e,i);return s||(s=this.getRule("dev",i)),s?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,i,s={}){return this.getSuffixes(e,s).map(r=>`${i}${r}`)}getSuffixes(e,i={}){let s=this.getRule(e,i);return s||(s=this.getRule("dev",i)),s?s.resolvedOptions().pluralCategories.sort((r,n)=>ze[r]-ze[n]).map(r=>`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${r}`):[]}getSuffix(e,i,s={}){const r=this.getRule(e,s);return r?`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${r.select(i)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",i,s))}}const Ye=(t,e,i,s=".",r=!0)=>{let n=wt(t,e,i);return!n&&r&&b(i)&&(n=xe(t,i,s),n===void 0&&(n=xe(e,i,s))),n},be=t=>t.replace(/\$/g,"$$$$");class Rt{constructor(e={}){this.logger=F.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(i=>i),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:i,escapeValue:s,useRawValueToEscape:r,prefix:n,prefixEscaped:a,suffix:o,suffixEscaped:l,formatSeparator:c,unescapeSuffix:u,unescapePrefix:d,nestingPrefix:m,nestingPrefixEscaped:p,nestingSuffix:f,nestingSuffixEscaped:w,nestingOptionsSeparator:x,maxReplaces:g,alwaysFormat:y}=e.interpolation;this.escape=i!==void 0?i:xt,this.escapeValue=s!==void 0?s:!0,this.useRawValueToEscape=r!==void 0?r:!1,this.prefix=n?W(n):a||"{{",this.suffix=o?W(o):l||"}}",this.formatSeparator=c||",",this.unescapePrefix=u?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":u||"",this.nestingPrefix=m?W(m):p||W("$t("),this.nestingSuffix=f?W(f):w||W(")"),this.nestingOptionsSeparator=x||",",this.maxReplaces=g||1e3,this.alwaysFormat=y!==void 0?y:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(i,s)=>i?.source===s?(i.lastIndex=0,i):new RegExp(s,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,i,s,r){let n,a,o;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},c=p=>{if(p.indexOf(this.formatSeparator)<0){const g=Ye(i,l,p,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(g,void 0,s,{...r,...i,interpolationkey:p}):g}const f=p.split(this.formatSeparator),w=f.shift().trim(),x=f.join(this.formatSeparator).trim();return this.format(Ye(i,l,w,this.options.keySeparator,this.options.ignoreJSONStructure),x,s,{...r,...i,interpolationkey:w})};this.resetRegExp();const u=r?.missingInterpolationHandler||this.options.missingInterpolationHandler,d=r?.interpolation?.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:p=>be(p)},{regex:this.regexp,safeValue:p=>this.escapeValue?be(this.escape(p)):be(p)}].forEach(p=>{for(o=0;n=p.regex.exec(e);){const f=n[1].trim();if(a=c(f),a===void 0)if(typeof u=="function"){const x=u(e,n,r);a=b(x)?x:""}else if(r&&Object.prototype.hasOwnProperty.call(r,f))a="";else if(d){a=n[0];continue}else this.logger.warn(`missed to pass in variable ${f} for interpolating ${e}`),a="";else!b(a)&&!this.useRawValueToEscape&&(a=Be(a));const w=p.safeValue(a);if(e=e.replace(n[0],w),d?(p.regex.lastIndex+=a.length,p.regex.lastIndex-=n[0].length):p.regex.lastIndex=0,o++,o>=this.maxReplaces)break}}),e}nest(e,i,s={}){let r,n,a;const o=(l,c)=>{const u=this.nestingOptionsSeparator;if(l.indexOf(u)<0)return l;const d=l.split(new RegExp(`${u}[ ]*{`));let m=`{${d[1]}`;l=d[0],m=this.interpolate(m,a);const p=m.match(/'/g),f=m.match(/"/g);((p?.length??0)%2===0&&!f||f.length%2!==0)&&(m=m.replace(/'/g,'"'));try{a=JSON.parse(m),c&&(a={...c,...a})}catch(w){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,w),`${l}${u}${m}`}return a.defaultValue&&a.defaultValue.indexOf(this.prefix)>-1&&delete a.defaultValue,l};for(;r=this.nestingRegexp.exec(e);){let l=[];a={...s},a=a.replace&&!b(a.replace)?a.replace:a,a.applyPostProcessor=!1,delete a.defaultValue;const c=/{.*}/.test(r[1])?r[1].lastIndexOf("}")+1:r[1].indexOf(this.formatSeparator);if(c!==-1&&(l=r[1].slice(c).split(this.formatSeparator).map(u=>u.trim()).filter(Boolean),r[1]=r[1].slice(0,c)),n=i(o.call(this,r[1].trim(),a),a),n&&r[0]===e&&!b(n))return n;b(n)||(n=Be(n)),n||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),n=""),l.length&&(n=l.reduce((u,d)=>this.format(u,d,s.lng,{...s,interpolationkey:r[1].trim()}),n.trim())),e=e.replace(r[0],n),this.regexp.lastIndex=0}return e}}const Et=t=>{let e=t.toLowerCase().trim();const i={};if(t.indexOf("(")>-1){const s=t.split("(");e=s[0].toLowerCase().trim();const r=s[1].substring(0,s[1].length-1);e==="currency"&&r.indexOf(":")<0?i.currency||(i.currency=r.trim()):e==="relativetime"&&r.indexOf(":")<0?i.range||(i.range=r.trim()):r.split(";").forEach(a=>{if(a){const[o,...l]=a.split(":"),c=l.join(":").trim().replace(/^'+|'+$/g,""),u=o.trim();i[u]||(i[u]=c),c==="false"&&(i[u]=!1),c==="true"&&(i[u]=!0),isNaN(c)||(i[u]=parseInt(c,10))}})}return{formatName:e,formatOptions:i}},Je=t=>{const e={};return(i,s,r)=>{let n=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(n={...n,[r.interpolationkey]:void 0});const a=s+JSON.stringify(n);let o=e[a];return o||(o=t(ie(s),r),e[a]=o),o(i)}},Tt=t=>(e,i,s)=>t(ie(i),s)(e);class At{constructor(e={}){this.logger=F.create("formatter"),this.options=e,this.init(e)}init(e,i={interpolation:{}}){this.formatSeparator=i.interpolation.formatSeparator||",";const s=i.cacheInBuiltFormats?Je:Tt;this.formats={number:s((r,n)=>{const a=new Intl.NumberFormat(r,{...n});return o=>a.format(o)}),currency:s((r,n)=>{const a=new Intl.NumberFormat(r,{...n,style:"currency"});return o=>a.format(o)}),datetime:s((r,n)=>{const a=new Intl.DateTimeFormat(r,{...n});return o=>a.format(o)}),relativetime:s((r,n)=>{const a=new Intl.RelativeTimeFormat(r,{...n});return o=>a.format(o,n.range||"day")}),list:s((r,n)=>{const a=new Intl.ListFormat(r,{...n});return o=>a.format(o)})}}add(e,i){this.formats[e.toLowerCase().trim()]=i}addCached(e,i){this.formats[e.toLowerCase().trim()]=Je(i)}format(e,i,s,r={}){const n=i.split(this.formatSeparator);if(n.length>1&&n[0].indexOf("(")>1&&n[0].indexOf(")")<0&&n.find(o=>o.indexOf(")")>-1)){const o=n.findIndex(l=>l.indexOf(")")>-1);n[0]=[n[0],...n.splice(1,o)].join(this.formatSeparator)}return n.reduce((o,l)=>{const{formatName:c,formatOptions:u}=Et(l);if(this.formats[c]){let d=o;try{const m=r?.formatParams?.[r.interpolationkey]||{},p=m.locale||m.lng||r.locale||r.lng||s;d=this.formats[c](o,p,{...u,...r,...m})}catch(m){this.logger.warn(m)}return d}else this.logger.warn(`there was no format function for ${c}`);return o},e)}}const Mt=(t,e)=>{t.pending[e]!==void 0&&(delete t.pending[e],t.pendingCount--)};class Nt extends pe{constructor(e,i,s,r={}){super(),this.backend=e,this.store=i,this.services=s,this.languageUtils=s.languageUtils,this.options=r,this.logger=F.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(s,r.backend,r)}queueLoad(e,i,s,r){const n={},a={},o={},l={};return e.forEach(c=>{let u=!0;i.forEach(d=>{const m=`${c}|${d}`;!s.reload&&this.store.hasResourceBundle(c,d)?this.state[m]=2:this.state[m]<0||(this.state[m]===1?a[m]===void 0&&(a[m]=!0):(this.state[m]=1,u=!1,a[m]===void 0&&(a[m]=!0),n[m]===void 0&&(n[m]=!0),l[d]===void 0&&(l[d]=!0)))}),u||(o[c]=!0)}),(Object.keys(n).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(n),pending:Object.keys(a),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(l)}}loaded(e,i,s){const r=e.split("|"),n=r[0],a=r[1];i&&this.emit("failedLoading",n,a,i),!i&&s&&this.store.addResourceBundle(n,a,s,void 0,void 0,{skipCopy:!0}),this.state[e]=i?-1:2,i&&s&&(this.state[e]=0);const o={};this.queue.forEach(l=>{bt(l.loaded,[n],a),Mt(l,e),i&&l.errors.push(i),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(c=>{o[c]||(o[c]={});const u=l.loaded[c];u.length&&u.forEach(d=>{o[c][d]===void 0&&(o[c][d]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(l=>!l.done)}read(e,i,s,r=0,n=this.retryTimeout,a){if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:i,fcName:s,tried:r,wait:n,callback:a});return}this.readingCalls++;const o=(c,u)=>{if(this.readingCalls--,this.waitingReads.length>0){const d=this.waitingReads.shift();this.read(d.lng,d.ns,d.fcName,d.tried,d.wait,d.callback)}if(c&&u&&r<this.maxRetries){setTimeout(()=>{this.read.call(this,e,i,s,r+1,n*2,a)},n);return}a(c,u)},l=this.backend[s].bind(this.backend);if(l.length===2){try{const c=l(e,i);c&&typeof c.then=="function"?c.then(u=>o(null,u)).catch(o):o(null,c)}catch(c){o(c)}return}return l(e,i,o)}prepareLoading(e,i,s={},r){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();b(e)&&(e=this.languageUtils.toResolveHierarchy(e)),b(i)&&(i=[i]);const n=this.queueLoad(e,i,s,r);if(!n.toLoad.length)return n.pending.length||r(),null;n.toLoad.forEach(a=>{this.loadOne(a)})}load(e,i,s){this.prepareLoading(e,i,{},s)}reload(e,i,s){this.prepareLoading(e,i,{reload:!0},s)}loadOne(e,i=""){const s=e.split("|"),r=s[0],n=s[1];this.read(r,n,"read",void 0,void 0,(a,o)=>{a&&this.logger.warn(`${i}loading namespace ${n} for language ${r} failed`,a),!a&&o&&this.logger.log(`${i}loaded namespace ${n} for language ${r}`,o),this.loaded(e,a,o)})}saveMissing(e,i,s,r,n,a={},o=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(i)){this.logger.warn(`did not save key "${s}" as the namespace "${i}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(s==null||s==="")){if(this.backend?.create){const l={...a,isUpdate:n},c=this.backend.create.bind(this.backend);if(c.length<6)try{let u;c.length===5?u=c(e,i,s,r,l):u=c(e,i,s,r),u&&typeof u.then=="function"?u.then(d=>o(null,d)).catch(o):o(null,u)}catch(u){o(u)}else c(e,i,s,r,o,l)}!e||!e[0]||this.store.addResource(e[0],i,s,r)}}}const qe=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if(typeof t[1]=="object"&&(e=t[1]),b(t[1])&&(e.defaultValue=t[1]),b(t[2])&&(e.tDescription=t[2]),typeof t[2]=="object"||typeof t[3]=="object"){const i=t[3]||t[2];Object.keys(i).forEach(s=>{e[s]=i[s]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),Qe=t=>(b(t.ns)&&(t.ns=[t.ns]),b(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),b(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs?.indexOf?.("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),typeof t.initImmediate=="boolean"&&(t.initAsync=t.initImmediate),t),oe=()=>{},Dt=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(i=>{typeof t[i]=="function"&&(t[i]=t[i].bind(t))})};class se extends pe{constructor(e={},i){if(super(),this.options=Qe(e),this.services={},this.logger=F,this.modules={external:[]},Dt(this),i&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,i),this;setTimeout(()=>{this.init(e,i)},0)}}init(e={},i){this.isInitializing=!0,typeof e=="function"&&(i=e,e={}),e.defaultNS==null&&e.ns&&(b(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const s=qe();this.options={...s,...this.options,...Qe(e)},this.options.interpolation={...s.interpolation,...this.options.interpolation},e.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=e.keySeparator),e.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=e.nsSeparator);const r=c=>c?typeof c=="function"?new c:c:null;if(!this.options.isClone){this.modules.logger?F.init(r(this.modules.logger),this.options):F.init(null,this.options);let c;this.modules.formatter?c=this.modules.formatter:c=At;const u=new We(this.options);this.store=new _e(this.options.resources,this.options);const d=this.services;d.logger=F,d.resourceStore=this.store,d.languageUtils=u,d.pluralResolver=new Ct(u,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==s.interpolation.format&&this.logger.warn("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),c&&(!this.options.interpolation.format||this.options.interpolation.format===s.interpolation.format)&&(d.formatter=r(c),d.formatter.init&&d.formatter.init(d,this.options),this.options.interpolation.format=d.formatter.format.bind(d.formatter)),d.interpolator=new Rt(this.options),d.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},d.backendConnector=new Nt(r(this.modules.backend),d.resourceStore,d,this.options),d.backendConnector.on("*",(p,...f)=>{this.emit(p,...f)}),this.modules.languageDetector&&(d.languageDetector=r(this.modules.languageDetector),d.languageDetector.init&&d.languageDetector.init(d,this.options.detection,this.options)),this.modules.i18nFormat&&(d.i18nFormat=r(this.modules.i18nFormat),d.i18nFormat.init&&d.i18nFormat.init(this)),this.translator=new ue(this.services,this.options),this.translator.on("*",(p,...f)=>{this.emit(p,...f)}),this.modules.external.forEach(p=>{p.init&&p.init(this)})}if(this.format=this.options.interpolation.format,i||(i=oe),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const c=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);c.length>0&&c[0]!=="dev"&&(this.options.lng=c[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(c=>{this[c]=(...u)=>this.store[c](...u)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(c=>{this[c]=(...u)=>(this.store[c](...u),this)});const o=ee(),l=()=>{const c=(u,d)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),o.resolve(d),i(u,d)};if(this.languages&&!this.isInitialized)return c(null,this.t.bind(this));this.changeLanguage(this.options.lng,c)};return this.options.resources||!this.options.initAsync?l():setTimeout(l,0),o}loadResources(e,i=oe){let s=i;const r=b(e)?e:this.language;if(typeof e=="function"&&(s=e),!this.options.resources||this.options.partialBundledLanguages){if(r?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return s();const n=[],a=o=>{if(!o||o==="cimode")return;this.services.languageUtils.toResolveHierarchy(o).forEach(c=>{c!=="cimode"&&n.indexOf(c)<0&&n.push(c)})};r?a(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>a(l)),this.options.preload?.forEach?.(o=>a(o)),this.services.backendConnector.load(n,this.options.ns,o=>{!o&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),s(o)})}else s(null)}reloadResources(e,i,s){const r=ee();return typeof e=="function"&&(s=e,e=void 0),typeof i=="function"&&(s=i,i=void 0),e||(e=this.languages),i||(i=this.options.ns),s||(s=oe),this.services.backendConnector.reload(e,i,n=>{r.resolve(),s(n)}),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&ot.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1)){for(let i=0;i<this.languages.length;i++){const s=this.languages[i];if(!(["cimode","dev"].indexOf(s)>-1)&&this.store.hasLanguageSomeTranslations(s)){this.resolvedLanguage=s;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,i){this.isLanguageChangingTo=e;const s=ee();this.emit("languageChanging",e);const r=o=>{this.language=o,this.languages=this.services.languageUtils.toResolveHierarchy(o),this.resolvedLanguage=void 0,this.setResolvedLanguage(o)},n=(o,l)=>{l?this.isLanguageChangingTo===e&&(r(l),this.translator.changeLanguage(l),this.isLanguageChangingTo=void 0,this.emit("languageChanged",l),this.logger.log("languageChanged",l)):this.isLanguageChangingTo=void 0,s.resolve((...c)=>this.t(...c)),i&&i(o,(...c)=>this.t(...c))},a=o=>{!e&&!o&&this.services.languageDetector&&(o=[]);const l=b(o)?o:o&&o[0],c=this.store.hasLanguageSomeTranslations(l)?l:this.services.languageUtils.getBestMatchFromCodes(b(o)?[o]:o);c&&(this.language||r(c),this.translator.language||this.translator.changeLanguage(c),this.services.languageDetector?.cacheUserLanguage?.(c)),this.loadResources(c,u=>{n(u,c)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?a(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(a):this.services.languageDetector.detect(a):a(e),s}getFixedT(e,i,s){const r=(n,a,...o)=>{let l;typeof a!="object"?l=this.options.overloadTranslationOptionHandler([n,a].concat(o)):l={...a},l.lng=l.lng||r.lng,l.lngs=l.lngs||r.lngs,l.ns=l.ns||r.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||s||r.keyPrefix);const c=this.options.keySeparator||".";let u;return l.keyPrefix&&Array.isArray(n)?u=n.map(d=>`${l.keyPrefix}${c}${d}`):u=l.keyPrefix?`${l.keyPrefix}${c}${n}`:n,this.t(u,l)};return b(e)?r.lng=e:r.lngs=e,r.ns=i,r.keyPrefix=s,r}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,i={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const s=i.lng||this.resolvedLanguage||this.languages[0],r=this.options?this.options.fallbackLng:!1,n=this.languages[this.languages.length-1];if(s.toLowerCase()==="cimode")return!0;const a=(o,l)=>{const c=this.services.backendConnector.state[`${o}|${l}`];return c===-1||c===0||c===2};if(i.precheck){const o=i.precheck(this,a);if(o!==void 0)return o}return!!(this.hasResourceBundle(s,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||a(s,e)&&(!r||a(n,e)))}loadNamespaces(e,i){const s=ee();return this.options.ns?(b(e)&&(e=[e]),e.forEach(r=>{this.options.ns.indexOf(r)<0&&this.options.ns.push(r)}),this.loadResources(r=>{s.resolve(),i&&i(r)}),s):(i&&i(),Promise.resolve())}loadLanguages(e,i){const s=ee();b(e)&&(e=[e]);const r=this.options.preload||[],n=e.filter(a=>r.indexOf(a)<0&&this.services.languageUtils.isSupportedCode(a));return n.length?(this.options.preload=r.concat(n),this.loadResources(a=>{s.resolve(),i&&i(a)}),s):(i&&i(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";try{const r=new Intl.Locale(e);if(r&&r.getTextInfo){const n=r.getTextInfo();if(n&&n.direction)return n.direction}}catch{}const i=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],s=this.services?.languageUtils||new We(qe());return e.toLowerCase().indexOf("-latn")>1?"ltr":i.indexOf(s.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},i){return new se(e,i)}cloneInstance(e={},i=oe){const s=e.forkResourceStore;s&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},n=new se(r);if((e.debug!==void 0||e.prefix!==void 0)&&(n.logger=n.logger.clone(e)),["store","services","language"].forEach(o=>{n[o]=this[o]}),n.services={...this.services},n.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},s){const o=Object.keys(this.store.data).reduce((l,c)=>(l[c]={...this.store.data[c]},l[c]=Object.keys(l[c]).reduce((u,d)=>(u[d]={...l[c][d]},u),l[c]),l),{});n.store=new _e(o,r),n.services.resourceStore=n.store}return n.translator=new ue(n.services,r),n.translator.on("*",(o,...l)=>{n.emit(o,...l)}),n.init(r,i),n.translator.options=r,n.translator.backendConnector.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},n}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const P=se.createInstance();P.createInstance=se.createInstance;P.createInstance;P.dir;P.init;P.loadResources;P.reloadResources;P.use;P.changeLanguage;P.getFixedT;const R=P.t;P.exists;P.setDefaultNamespace;P.hasLoadedNamespace;P.loadNamespaces;P.loadLanguages;const{slice:Ft,forEach:$t}=[];function jt(t){return $t.call(Ft.call(arguments,1),e=>{if(e)for(const i in e)t[i]===void 0&&(t[i]=e[i])}),t}function Bt(t){return typeof t!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(i=>i.test(t))}const Ze=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,Ut=function(t,e){const s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},r=encodeURIComponent(e);let n=`${t}=${r}`;if(s.maxAge>0){const a=s.maxAge-0;if(Number.isNaN(a))throw new Error("maxAge should be a Number");n+=`; Max-Age=${Math.floor(a)}`}if(s.domain){if(!Ze.test(s.domain))throw new TypeError("option domain is invalid");n+=`; Domain=${s.domain}`}if(s.path){if(!Ze.test(s.path))throw new TypeError("option path is invalid");n+=`; Path=${s.path}`}if(s.expires){if(typeof s.expires.toUTCString!="function")throw new TypeError("option expires is invalid");n+=`; Expires=${s.expires.toUTCString()}`}if(s.httpOnly&&(n+="; HttpOnly"),s.secure&&(n+="; Secure"),s.sameSite)switch(typeof s.sameSite=="string"?s.sameSite.toLowerCase():s.sameSite){case!0:n+="; SameSite=Strict";break;case"lax":n+="; SameSite=Lax";break;case"strict":n+="; SameSite=Strict";break;case"none":n+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return s.partitioned&&(n+="; Partitioned"),n},ke={create(t,e,i,s){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};i&&(r.expires=new Date,r.expires.setTime(r.expires.getTime()+i*60*1e3)),s&&(r.domain=s),document.cookie=Ut(t,e,r)},read(t){const e=`${t}=`,i=document.cookie.split(";");for(let s=0;s<i.length;s++){let r=i[s];for(;r.charAt(0)===" ";)r=r.substring(1,r.length);if(r.indexOf(e)===0)return r.substring(e.length,r.length)}return null},remove(t,e){this.create(t,"",-1,e)}};var Kt={name:"cookie",lookup(t){let{lookupCookie:e}=t;if(e&&typeof document<"u")return ke.read(e)||void 0},cacheUserLanguage(t,e){let{lookupCookie:i,cookieMinutes:s,cookieDomain:r,cookieOptions:n}=e;i&&typeof document<"u"&&ke.create(i,t,s,r,n)}},Ht={name:"querystring",lookup(t){let{lookupQuerystring:e}=t,i;if(typeof window<"u"){let{search:s}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(s=window.location.hash.substring(window.location.hash.indexOf("?")));const n=s.substring(1).split("&");for(let a=0;a<n.length;a++){const o=n[a].indexOf("=");o>0&&n[a].substring(0,o)===e&&(i=n[a].substring(o+1))}}return i}},_t={name:"hash",lookup(t){let{lookupHash:e,lookupFromHashIndex:i}=t,s;if(typeof window<"u"){const{hash:r}=window.location;if(r&&r.length>2){const n=r.substring(1);if(e){const a=n.split("&");for(let o=0;o<a.length;o++){const l=a[o].indexOf("=");l>0&&a[o].substring(0,l)===e&&(s=a[o].substring(l+1))}}if(s)return s;if(!s&&i>-1){const a=r.match(/\/([a-zA-Z-]*)/g);return Array.isArray(a)?a[typeof i=="number"?i:0]?.replace("/",""):void 0}}}return s}};let z=null;const et=()=>{if(z!==null)return z;try{if(z=typeof window<"u"&&window.localStorage!==null,!z)return!1;const t="i18next.translate.boo";window.localStorage.setItem(t,"foo"),window.localStorage.removeItem(t)}catch{z=!1}return z};var Vt={name:"localStorage",lookup(t){let{lookupLocalStorage:e}=t;if(e&&et())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupLocalStorage:i}=e;i&&et()&&window.localStorage.setItem(i,t)}};let X=null;const tt=()=>{if(X!==null)return X;try{if(X=typeof window<"u"&&window.sessionStorage!==null,!X)return!1;const t="i18next.translate.boo";window.sessionStorage.setItem(t,"foo"),window.sessionStorage.removeItem(t)}catch{X=!1}return X};var Gt={name:"sessionStorage",lookup(t){let{lookupSessionStorage:e}=t;if(e&&tt())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupSessionStorage:i}=e;i&&tt()&&window.sessionStorage.setItem(i,t)}},Wt={name:"navigator",lookup(t){const e=[];if(typeof navigator<"u"){const{languages:i,userLanguage:s,language:r}=navigator;if(i)for(let n=0;n<i.length;n++)e.push(i[n]);s&&e.push(s),r&&e.push(r)}return e.length>0?e:void 0}},zt={name:"htmlTag",lookup(t){let{htmlTag:e}=t,i;const s=e||(typeof document<"u"?document.documentElement:null);return s&&typeof s.getAttribute=="function"&&(i=s.getAttribute("lang")),i}},Xt={name:"path",lookup(t){let{lookupFromPathIndex:e}=t;if(typeof window>"u")return;const i=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(i)?i[typeof e=="number"?e:0]?.replace("/",""):void 0}},Yt={name:"subdomain",lookup(t){let{lookupFromSubdomainIndex:e}=t;const i=typeof e=="number"?e+1:1,s=typeof window<"u"&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(s)return s[i]}};let lt=!1;try{document.cookie,lt=!0}catch{}const ct=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];lt||ct.splice(1,1);const Jt=()=>({order:ct,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:t=>t});class ut{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,i)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e,this.options=jt(i,this.options||{},Jt()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=r=>r.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=s,this.addDetector(Kt),this.addDetector(Ht),this.addDetector(Vt),this.addDetector(Gt),this.addDetector(Wt),this.addDetector(zt),this.addDetector(Xt),this.addDetector(Yt),this.addDetector(_t)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,i=[];return e.forEach(s=>{if(this.detectors[s]){let r=this.detectors[s].lookup(this.options);r&&typeof r=="string"&&(r=[r]),r&&(i=i.concat(r))}}),i=i.filter(s=>s!=null&&!Bt(s)).map(s=>this.options.convertDetectedLanguage(s)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?i:i.length>0?i[0]:null}cacheUserLanguage(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;i&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||i.forEach(s=>{this.detectors[s]&&this.detectors[s].cacheUserLanguage(e,this.options)}))}}ut.type="languageDetector";function qt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var we,it;function Qt(){if(it)return we;it=1;var t=function(y){return e(y)&&!i(y)};function e(g){return!!g&&typeof g=="object"}function i(g){var y=Object.prototype.toString.call(g);return y==="[object RegExp]"||y==="[object Date]"||n(g)}var s=typeof Symbol=="function"&&Symbol.for,r=s?Symbol.for("react.element"):60103;function n(g){return g.$$typeof===r}function a(g){return Array.isArray(g)?[]:{}}function o(g,y){return y.clone!==!1&&y.isMergeableObject(g)?w(a(g),g,y):g}function l(g,y,S){return g.concat(y).map(function(L){return o(L,S)})}function c(g,y){if(!y.customMerge)return w;var S=y.customMerge(g);return typeof S=="function"?S:w}function u(g){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(g).filter(function(y){return Object.propertyIsEnumerable.call(g,y)}):[]}function d(g){return Object.keys(g).concat(u(g))}function m(g,y){try{return y in g}catch{return!1}}function p(g,y){return m(g,y)&&!(Object.hasOwnProperty.call(g,y)&&Object.propertyIsEnumerable.call(g,y))}function f(g,y,S){var L={};return S.isMergeableObject(g)&&d(g).forEach(function(O){L[O]=o(g[O],S)}),d(y).forEach(function(O){p(g,O)||(m(g,O)&&S.isMergeableObject(y[O])?L[O]=c(O,S)(g[O],y[O],S):L[O]=o(y[O],S))}),L}function w(g,y,S){S=S||{},S.arrayMerge=S.arrayMerge||l,S.isMergeableObject=S.isMergeableObject||t,S.cloneUnlessOtherwiseSpecified=o;var L=Array.isArray(y),O=Array.isArray(g),A=L===O;return A?L?S.arrayMerge(g,y,S):f(g,y,S):o(y,S)}w.all=function(y,S){if(!Array.isArray(y))throw new Error("first argument should be an array");return y.reduce(function(L,O){return w(L,O,S)},{})};var x=w;return we=x,we}var Zt=Qt();const kt=qt(Zt);class U{static isTouchDevice(e){return e=e||window.navigator.userAgent,"ontouchstart"in window||navigator.maxTouchPoints>0||/ios|iphone|ipad|ipod|android|windows phone/gi.test(e)}static isLandscapeMode(){return window.innerWidth>window.innerHeight}static hasNotch(){return!!navigator.userAgent.match(/iPhone/)}static setTimeoutAsync(e){return new Promise(i=>{setTimeout(()=>{i()},e)})}static mergeDeep(e,...i){return kt.all([e,...i],{arrayMerge:(s,r)=>r})}}class ei{constructor(e,i){this.k=e,this.config={volume:1,fadeOutDuration:1.5,...i}}config;currentMusic;currentMusicName;isFirstPlay=!0;loadMusic(e,i){this.k.loadMusic(e,i)}playMusic(e,i){(async()=>this.currentMusic&&!this.currentMusic.paused&&this.currentMusicName===e||(this.isFirstPlay&&(this.isFirstPlay=!1,await U.setTimeoutAsync(100)),await this.fadeOutCurrentMusic(i?.fadeOutDuration),this.currentMusic=this.k.play(e,{loop:!0,volume:this.config.volume,...i}),this.currentMusicName=e))()}setVolume(e){this.config.volume=e,this.currentMusic&&(this.currentMusic.volume=e)}stopMusic(e){this.fadeOutCurrentMusic(e).then(()=>{this.currentMusic=void 0,this.currentMusicName=void 0})}pauseMusic(){this.currentMusic&&(this.currentMusic.paused=!0)}resumeMusic(){this.currentMusic&&(this.currentMusic.paused=!1)}async fadeOutCurrentMusic(e){e=e??this.config.fadeOutDuration+1e-6,this.currentMusic&&!this.currentMusic.paused&&(await this.k.tween(this.currentMusic.volume,0,e,i=>{this.currentMusic&&(this.currentMusic.volume=i)}),this.currentMusic.stop())}}class ti{constructor(e,i="fade",s=.6){this.k=e,this.defaultDuration=s,this.fadeOverlay=e.add(["fade-overlay",e.layer(i),e.rect(e.width(),e.height()),e.color(0,0,0),e.pos(0,0),e.fixed(),e.anchor("topleft"),e.opacity(0),e.stay()])}fadeOverlay;async showOverlay(e=this.defaultDuration){return this.fadeOverlay.opacity=0,this.fadeOverlay.hidden=!1,this.fadeTo(0,1,e)}async hideOverlay(e=this.defaultDuration){await this.fadeTo(1,0,e),this.fadeOverlay.hidden=!1}async fadeTo(e,i,s=1){return new Promise(r=>{let n=0;const a=this.fadeOverlay.onUpdate(()=>{n+=this.k.dt(),this.fadeOverlay.opacity=this.k.lerp(e,i,n/s),n>=s&&(this.fadeOverlay.opacity=i,a.cancel(),r())})})}}class ii{_state;localStorageKey="gameState";isUpdating=!1;subscribersOnUpdate=[];subscribersOnDeath=[];get state(){return this._state}constructor(){const e=localStorage.getItem(this.localStorageKey);try{if(e){const i=this.getClearState(),s=JSON.parse(e);this._state=U.mergeDeep(this.getClearState(),{version:i.version,persistent:s,temp:this.getTempStateFromPersistentState(s)})}}catch{}this._state||this.reset()}update(e,i){let s=!1;if(this.isUpdating)throw new Error("Cannot call update() inside another update() call");this.isUpdating=!0,this._state.temp.player.health&&e.temp?.player?.health===0&&(e=U.mergeDeep(e,{persistent:{player:{deaths:this._state.persistent.player.deaths+1}},temp:{player:{tempInventory:[]}}}),s=!0),this._state=U.mergeDeep(this._state,e),this.subscribersOnUpdate.forEach(r=>r(this._state)),e.persistent&&!i&&this.save(),this.isUpdating=!1,s&&this.subscribersOnDeath.forEach(r=>r())}save(){localStorage.setItem(this.localStorageKey,JSON.stringify(this._state.persistent))}reset(){localStorage.removeItem(this.localStorageKey),this._state=this.getClearState(),this.update({})}prepareForNewScene(){this.update({persistent:{player:{inventory:[...this._state.persistent.player.inventory,...this._state.temp.player.tempInventory.filter(e=>!this._state.persistent.player.inventory.includes(e))]}},temp:{...this.getTempStateFromPersistentState(this._state.persistent)}})}getIsPlayerHasItem(e){return this._state.persistent.player.inventory.includes(e)||this._state.temp.player.tempInventory.includes(e)}addToPersistentInventory(e){this.getIsPlayerHasItem(e)||this.update({persistent:{player:{inventory:[...this._state.persistent.player.inventory,e]}}})}addToTempInventory(e){this.getIsPlayerHasItem(e)||this.update({temp:{player:{tempInventory:[...this._state.temp.player.tempInventory,e]}}})}moveTempItemsToPersistentInventory(){const e=this._state.temp.player.tempInventory.filter(i=>!this._state.persistent.player.inventory.includes(i));e.length!==0&&this.update({persistent:{player:{inventory:[...this._state.persistent.player.inventory,...e]}},temp:{player:{tempInventory:[]}}})}onUpdate(e){return this.subscribersOnUpdate.push(e),{cancel:()=>{this.subscribersOnUpdate=this.subscribersOnUpdate.filter(i=>i!==e)}}}onDeath(e){return this.subscribersOnDeath.push(e),{cancel:()=>{this.subscribersOnDeath=this.subscribersOnDeath.filter(i=>i!==e)}}}getTempStateFromPersistentState(e){return{player:{health:e.player.hasLuckyCharm?2:1,tempInventory:[]}}}getClearState(){const e={currentLevel:void 0,player:{deaths:0,hasLuckyCharm:!1,inventory:[]},oldBobr:{isIntroSaid:!1}};return{version:1,persistent:e,temp:this.getTempStateFromPersistentState(e)}}}let ve=!1;async function fe(t,e,i){ve=i?.quickSwitch||!1,v.update({persistent:{spawnAtExitIndex:i?.spawnAtExitIndex}}),ve||de.hide(),await he.showOverlay(.3),t.go(e)}function Se(t,e){return async()=>{v.prepareForNewScene(),await e(t),await U.setTimeoutAsync(500),ve?(de.show(),await he.hideOverlay(1)):(await he.hideOverlay(1),de.show())}}function Pe(t,e,i,s){const r=t.add([t.sprite(e,{tiled:!0,width:t.width()*10}),t.layer("bg"),t.pos(0,0),t.scale(1.5),t.fixed(),t.anchor("center")]);return r.onUpdate(()=>{r.pos.x=t.width()/2+-t.getCamPos().x/50,r.pos.y=t.height()/2+(s?.offsetY||0)-t.getCamPos().y/25}),r}const dt="interactable-comp";function Y(t){return{id:dt,interact:t,add(){this.tag("interactable")},destroy(){this.untag("interactable")}}}Y.id=dt;const ge={async loadResources(t){t.loadSound("player-take-item","sounds/bobr-take-item.mp3")},spawn(t,e,i){const s=t.add(["map-item",t.pos(e),t.sprite(i.sprite,{flipX:i.flipX||!1}),t.anchor("bot"),t.area(),t.scale(),t.animate(),t.offscreen({hide:!0}),...i?.interact?[Y(async n=>{await i.interact?.(n),i.shouldPickupOnInteract!==!1&&(t.play("player-take-item"),s.animatePickupAndDestroy(n))})]:[],{animatePickupAndDestroy:r}]);i.levitate&&(s.use(t.animate({relative:!0})),s.animate("pos",[t.vec2(0,-2),t.vec2(0,-6)],{duration:1,easings:[t.easings.easeInOutCubic],direction:"ping-pong"}));function r(n){(async()=>{const a=s.pos;s.unanimate("pos"),await t.tween(0,1,.3,o=>{s.scale=t.vec2(t.lerp(1,.5,o));const l=t.vec2((a.x+n.pos.x)/2,Math.min(a.y,n.pos.y)-30),c=t.lerp(a,l,o),u=t.lerp(l,n.pos,o);s.pos=t.lerp(c,u,o)}),s.destroy()})()}return s}};function Oe(t,e){if(!v.getIsPlayerHasItem(e.itemId))return ge.spawn(t,e.worldPos,{sprite:e.sprite,levitate:!0,interact:async i=>{v.addToTempInventory(e.itemId)},shouldPickupOnInteract:!0})}const me={async loadResources(t){},spawn(t,e,i){const s=t.add(["exit",t.pos(e),t.rect(32,64,{fill:!1}),t.anchor("bot"),t.area(),t.offscreen({hide:!0})]);return s.onCollide("player",()=>{fe(t,i.destLevel,{spawnAtExitIndex:i.destLevelExitIndex,quickSwitch:!0}).then()}),s}},I={friction:.2},si={maxRunSpeed:200,accelGround:200,accelAir:150,decelGround:500,decelAir:300,jumpForce:400,minRunAnimSpeed:1,maxRunAnimSpeed:2,attackPower:1},st={async loadResources(t){await t.loadSprite("player","sprites/characters/bobr.gif",{sliceX:5,sliceY:4,anims:{idle:{from:0,to:1,speed:3,loop:!0},walk:{from:5,to:8,speed:10,loop:!0},jump:{from:10,to:10},fall:{from:10,to:10},attack:{from:15,to:19,speed:20,loop:!1}}}),await t.loadSprite("player-hit-wave","sprites/characters/bobr-hit-wave.png"),await t.loadSound("player-attack","sounds/bobr-attack.mp3"),await t.loadSound("player-take-item","sounds/bobr-take-item.mp3"),await t.loadSound("player-take-key","sounds/bobr-take-key.mp3")},spawn(t,e=t.vec2(100,100),i){const s={...si,...i},r=t.add(["player",t.sprite("player",{anim:"idle"}),t.pos(e),t.area({shape:new t.Rect(t.vec2(1,0),20,31),...I}),t.body(),t.anchor("bot"),t.opacity(1),t.state("IDLE",["IDLE","WALK","JUMP","FALL","ATTACK","INTERACT"]),t.timer(),{vx:0,config:s,waitForActionButton:u,setCamFollowPlayer:d}]);let n,a;function o(){r.jump(s.jumpForce),r.enterState("JUMP")}function l(){return!!a}function c(p,f){r.getCurAnim()?.name!==p&&r.play(p,{onEnd:f})}function u(){return new Promise(p=>{r.onButtonPress("action",()=>{p()})})}function d(p,f){const w=p.levelWidth()-p.tileWidth()/2,x=p.levelHeight()-p.tileHeight()/2,g=t.height(),y=(f.leftTilesPadding??0)*p.tileWidth(),S=(f.rightTilesPadding??0)*p.tileWidth(),L=(f.topTilesPadding??0)*p.tileHeight(),O=(f.bottomTilesPadding??0)*p.tileHeight(),A=p.pos.x+y+t.width()/2,K=p.pos.x+w-S-t.width()/2,ne=p.pos.y+L+t.height()/2,M=p.pos.y+x-O-t.height()/2;r.onUpdate(()=>{if(!r)return;const E=t.clamp(r.pos.x,A,K),ye=t.clamp(r.pos.y-g/4,ne,M);t.setCamPos(E,ye)})}r.onButtonPress("jump",()=>{r.state!=="INTERACT"&&r.isGrounded()&&o()}),r.onButtonPress("action",()=>{if(r.state==="ATTACK"||r.state==="INTERACT")return;let p=!0,f=!1;const w=r.add(["player.interaction-hitbox",t.pos(r.flipX?-14:14,0),t.area({shape:new t.Rect(t.vec2(1,0),16,r.height)}),t.rect(20,20,{fill:!1}),t.anchor("bot"),t.opacity(0)]);w.onCollide("interactable",async x=>{f||(f=!0,r.enterState("INTERACT"),await x.interact(r),r.enterState("IDLE"))}),w.onUpdate(()=>{p?p=!1:(f||r.enterState("ATTACK"),r.remove(w))})}),r.onFixedUpdate(()=>{const p=t.dt(),f=r.isGrounded();let w=0;if(r.state!=="INTERACT"&&(t.isButtonDown("left")?w=-1:t.isButtonDown("right")&&(w=1)),r.friction=f?I.friction:0,w!==0){let x=f?s.accelGround:s.accelAir;Math.sign(w)!==Math.sign(r.vx)&&(x+=f?s.decelGround:s.decelAir),r.vx=ri(r.vx,w*s.maxRunSpeed,x*p)}else{const x=f?s.decelGround:s.decelAir,g=Math.max(0,Math.abs(r.vx)-x*p);r.vx=g*Math.sign(r.vx)}r.move(r.vx,0),r.flipX=w<0?!0:w>0?!1:r.flipX,r.area.scale.x=r.flipX?-1:1,r.state==="ATTACK"?r.getCurAnim()?.frameIndex===2&&(n||(n=r.add(["player.hitbox",t.pos(t.vec2(r.flipX?-16:16,0)),t.area(),t.sprite("player-hit-wave",{flipX:r.flipX}),t.anchor("bot"),t.opacity(1),t.lifespan(0,{fade:.15})]),n.onCollide("enemy",x=>{x.registerHit(r),t.play("player-attack")}),n.onDestroy(()=>{n=void 0}))):r.state==="INTERACT"||(f?Math.abs(r.vx)>5?r.enterState("WALK"):r.enterState("IDLE"):r.vel.y<0?r.enterState("JUMP"):r.enterState("FALL")),l()?r.opacity=Math.abs(Math.sin(t.time()*20))*.5+.5:r.opacity=1}),r.onStateEnter("IDLE",()=>{c("idle")}),r.onStateEnter("INTERACT",()=>{c("idle")}),r.onStateUpdate("WALK",()=>{c("walk");const p=t.clamp(Math.abs(r.vx)/s.maxRunSpeed,0,1);r.animSpeed=t.lerp(s.minRunAnimSpeed,s.maxRunAnimSpeed,p)}),r.onStateEnter("JUMP",()=>{c("jump")}),r.onStateEnter("FALL",()=>{c("fall")}),r.onStateEnter("ATTACK",()=>{c("attack",()=>{r.enterState("IDLE")}),r.animSpeed=1}),r.onCollideUpdate("enemy",p=>{!l()&&r.state!=="ATTACK"&&!p.dead&&p.config.attackPower&&(v.update({temp:{player:{health:Math.max(0,v.state.temp.player.health-p.config.attackPower)}}}),r.applyImpulse(t.vec2(Math.sign(r.pos.x-p.pos.x)*150,-230)),t.shake(4),t.play("player-attack"),a?.cancel(),a=r.wait(1),a.onEnd(()=>{a=void 0}))});const m=v.onDeath(()=>{fe(t,v.state.persistent.currentLevel,{spawnAtExitIndex:v.state.persistent.spawnAtExitIndex,quickSwitch:!1}).then()});return r.onDestroy(()=>{a?.cancel(),a=void 0,m.cancel()}),r}};function ri(t,e,i){const s=e-t;return Math.abs(s)<=i?e:t+Math.sign(e)*i}async function Ie(t,e,i){const s=[];let r,n=e.split(`
`);await st.loadResources(t),await i.preloadResources(t),t.setGravity(0);const a=t.addLevel(n,{pos:t.vec2(0,0),tileWidth:i.tileWidth,tileHeight:i.tileHeight,tiles:{},wildcardTile:(u,d)=>{if(u.trim()){if(u==="P"){r=d.scale(t.vec2(i.tileWidth,i.tileHeight));return}if(u==="E"){s.push({worldPos:d.scale(t.vec2(i.tileWidth,i.tileHeight))});return}if(i.tiles[u])return i.tiles[u](d,d.scale(t.vec2(i.tileWidth,i.tileHeight)),()=>c(d.x,d.y),l)||void 0}}});if(s.sort((u,d)=>u.worldPos.x===d.worldPos.x?u.worldPos.y-d.worldPos.y:u.worldPos.x-d.worldPos.x),s.forEach((u,d)=>{me.spawn(t,u.worldPos,i.exitPoints[d])}),v.state.persistent.spawnAtExitIndex!==void 0){const u=v.state.persistent.spawnAtExitIndex;if(!s[u]){t.debug.error("Invalid exit index to spawn at:"+u);return}r=s[u].worldPos.add(i.exitPoints[u].spawnOffsetTiles.scale(t.vec2(i.tileWidth,i.tileHeight)))}else v.update({persistent:{spawnAtExitIndex:void 0}});if(!r){t.debug.error("No player spawn point found on the map!");return}const o=st.spawn(t,r);t.setGravity(1e3);function l(u,d){return d<0||d>=n.length||u<0||u>=n[d].length?" ":n[d][u]}function c(u,d){return{top:l(u,d-1),bottom:l(u,d+1),left:l(u-1,d),right:l(u+1,d),topLeft:l(u-1,d-1),topRight:l(u+1,d-1),bottomLeft:l(u-1,d+1),bottomRight:l(u+1,d+1)}}return{level:a,player:o}}const J={async loadResources(t){await t.loadSprite("bumblebee","sprites/enemies/bumblebee.gif",{sliceX:2,sliceY:1,anims:{idle:{from:0,to:1,speed:20,loop:!0},fly:{from:0,to:1,speed:20,loop:!0}}})},spawn(t,e=t.vec2(200,80),i){const s={health:1,attackPower:1,speedX:70,flyDuration:3,...i};let r=-1,n=0,a=!0;const o=t.add(["bumblebee","enemy",t.sprite("bumblebee",{anim:"idle"}),t.state("FLY",["IDLE","FLY"]),t.health(s.health,s.health),t.timer(),t.pos(e),t.area({...I,collisionIgnore:["obstacle"]}),t.body({gravityScale:0}),t.anchor("center"),t.offscreen({pause:!0,unpause:!0,hide:!0}),{registerHit:c=>{o.applyImpulse(t.vec2(Math.sign(o.pos.x-c.pos.x)*180,-120)),o.hp-=c.config.attackPower},config:s}]);function l(c,u){return Math.sin(u*c)*-30}return o.onStateEnter("FLY",async()=>{o.flipX=r<0,o.play("fly"),await o.wait(s.flyDuration*(a?.5:1)),a=!1,o.enterState("IDLE")}),o.onStateUpdate("FLY",()=>{n+=t.dt(),o.move(s.speedX*r,l(6,n))}),o.onStateEnter("IDLE",async()=>{o.play("idle"),await o.wait(1.5),o.dead||(r*=-1,o.enterState("FLY"))}),o.onStateUpdate("IDLE",()=>{n+=t.dt(),o.move(0,l(12,n))}),o.onDeath(()=>{o.paused=!0,o.gravityScale=1,o.collisionIgnore=["*"],o.use(t.rotate(o.flipX?15:-15))}),o.onExitScreen(()=>{o.dead&&o.destroy()}),o}},q={async loadResources(t){await t.loadSprite("gopher","sprites/enemies/gopher.gif",{sliceX:4,sliceY:1,anims:{idle:{from:0,to:0,loop:!1},walk:{from:0,to:3,speed:10,loop:!0}}})},spawn(t,e=t.vec2(100,100),i){const s={health:2,attackPower:1,speedX:50,...i};let r=-1,n=!0;const a=t.add(["gopher","enemy",t.sprite("gopher",{anim:"idle"}),t.state("WALK",["IDLE","WALK"]),t.health(s.health,s.health),t.timer(),t.pos(e),t.area(I),t.body(),t.anchor("bot"),t.offscreen({pause:!0,unpause:!0,hide:!0}),{registerHit:o=>{a.applyImpulse(t.vec2(Math.sign(a.pos.x-o.pos.x)*100,-200)),a.hp-=o.config.attackPower},config:s}]);return a.onStateEnter("WALK",async()=>{a.flipX=r<0,a.play("walk"),await a.wait(4*(n?.5:1)),n=!1,a.enterState("IDLE")}),a.onStateUpdate("WALK",()=>{a.isGrounded()&&a.move(s.speedX*r,0)}),a.onStateEnter("IDLE",async()=>{a.play("idle"),await a.wait(2),a.dead||(r*=-1,a.enterState("WALK"))}),a.onDeath(()=>{a.paused=!0,a.collisionIgnore=["*"],a.use(t.rotate(a.flipX?10:-10))}),a.onExitScreen(()=>{a.dead&&a.destroy()}),a}};function ni(t,e,i,s){s={speed:.05,...s};const r=U.hasNotch(),n=t.width()/2,a=5;let o="",l=0,c=0,u=!1;const d=t.add([t.rect(n,16,{radius:4}),t.pos(p()),t.color(0,0,0),t.opacity(.6),t.anchor("bot"),t.layer("hud")]),m=d.add([t.pos(t.vec2(0,-a)),t.text("",{size:8,width:n-a*2,font:"pixel",lineSpacing:2}),t.anchor("bot")]);m.onUpdate(()=>{d.height=m.height+a*2,d.pos=p(),u||(c+=t.dt(),c>=s.speed&&(c=0,o+=i[l],m.text=o,l++,l>=i.length&&(u=!0)))});function p(){const f=e.pos.add(0,-e.height),w=t.getCamPos(),x=t.width(),g=t.clamp(f.x,w.x-x/2+n/2+(r?26:0),w.x+x-n/2-(r?26:0)),y=f.y;return t.vec2(g,y)}return d}function _(t,e,i,s,r){return new Promise(n=>{let a=0;async function o(){if(a<s.length){const l=ni(t,e,s[a],r);await i.waitForActionButton(),l.destroy(),a++,o().then()}else n()}o().then()})}const rt={async loadResources(t){await t.loadSprite("home-outside","sprites/home/home-outside.png"),await t.loadSprite("home-inside","sprites/home/home-inside.png"),await t.loadSprite("home-fence","sprites/home/home-fence.png"),await t.loadSprite("home-kitchen-table","sprites/home/home-kitchen-table.png"),await t.loadSprite("home-kitchen-chair-left","sprites/home/home-kitchen-chair-left.png"),await t.loadSprite("home-kitchen-chair-right","sprites/home/home-kitchen-chair-right.png"),$.loadMusic("home","music/home.mp3")},spawn(t,e,i){const s={isEveningTime:!1,...i};let r=!0;const n=t.add(["home-container",t.pos(e),t.anchor("botleft"),t.offscreen({hide:!0,pause:!0,unpause:!0,distance:300}),t.state("OUTSIDE",["INSIDE","OUTSIDE"])]);n.add([t.sprite("home-fence"),t.pos(206,0),t.anchor("botleft")]),n.add(["home-outside",t.sprite("home-inside"),t.anchor("botleft")]);const a=n.add(["home-kitchen-chair-left",t.sprite("home-kitchen-chair-left"),t.anchor("bot"),t.pos(64,0),t.area(),Y(async p=>{await _(t,p,p,[R(t.choose(["home.kitchenChairRepeat1"]))])})]);a.hidden=!0;const o=n.add(["home-kitchen-table",t.sprite("home-kitchen-table"),t.anchor("bot"),t.pos(92,0),t.area(),t.z(1),Y(async p=>{await _(t,p,p,[R(t.choose(["home.kitchenTableRepeat1","home.kitchenTableRepeat2","home.kitchenTableRepeat3"]))])})]);o.hidden=!0;const l=n.add(["home-kitchen-chair-right",t.sprite("home-kitchen-chair-right"),t.anchor("bot"),t.pos(120,0),t.area(),Y(async p=>{await _(t,p,p,[R(t.choose(["home.kitchenChairRepeat1"]))])})]);l.hidden=!0;const c=n.add(["home-outside",t.sprite("home-outside"),t.anchor("botleft"),t.animate({relative:!0}),t.z(2)]);ai(t,n);function u(){const p=v.getIsPlayerHasItem("home-kitchen-table"),f=v.getIsPlayerHasItem("home-kitchen-chair-left"),w=v.getIsPlayerHasItem("home-kitchen-chair-right");o.hidden=!p,a.hidden=!f,l.hidden=!w}return n.onStateEnter("OUTSIDE",()=>{if(r){r=!1;return}c.unanimateAll(),c.animation.seek(0),c.animate("opacity",[0,1],{duration:1,loops:1}),$.playMusic("start-location")}),n.onStateEnter("INSIDE",()=>{v.moveTempItemsToPersistentInventory(),u(),c.unanimateAll(),c.animation.seek(0),c.animate("opacity",[1,0],{duration:1,loops:1}),s.isEveningTime&&$.playMusic("home")}),n.add(["home-entrance",t.rect(20,38,{fill:!1}),t.pos(125,0),t.anchor("botleft"),t.area()]).onCollide("player",()=>{n.state!=="INSIDE"&&n.enterState("INSIDE")}),n.add(["home-exit",t.rect(20,38,{fill:!1}),t.pos(214,0),t.anchor("botleft"),t.area()]).onCollide("player",()=>{n.state!=="OUTSIDE"&&n.enterState("OUTSIDE")}),n}};function ai(t,e){e.add(["obstacle",t.rect(14,200,{fill:!1}),t.pos(193,-42),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add(["obstacle",t.rect(40,12,{fill:!1}),t.pos(156,-42),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add(["obstacle",t.rect(10,220,{fill:!1}),t.pos(-10,0),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add(["obstacle",t.polygon([t.vec2(178,-54),t.vec2(115,-193),t.vec2(125,-193),t.vec2(188,-54)],{fill:!1}),t.pos(-5,0),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add(["obstacle",t.polygon([t.vec2(115,-193),t.vec2(50,-221),t.vec2(50,-230),t.vec2(125,-193)],{fill:!1}),t.pos(-5,0),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add(["obstacle",t.polygon([t.vec2(50,-221),t.vec2(0,-221),t.vec2(0,-230),t.vec2(50,-230)],{fill:!1}),t.pos(-5,0),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add(["obstacle",t.rect(120,7,{fill:!1}),t.pos(57,-58),t.anchor("botleft"),t.area(I),t.body({isStatic:!0})]),e.add(["obstacle",t.rect(95,7,{fill:!1}),t.pos(0,-122),t.anchor("botleft"),t.area(I),t.body({isStatic:!0})])}const nt=oi(),h=gt({global:!1,width:nt.width,height:nt.height,background:"#000000",letterbox:!0,pixelDensity:2,debug:!0,debugKey:"`",buttons:{left:{keyboard:["left","a"],gamepad:["dpad-left"]},right:{keyboard:["right","d"],gamepad:["dpad-right"]},jump:{keyboard:["space","up","w","k"],gamepad:["south"]},action:{keyboard:["j","z"],gamepad:["east"]}}});function oi(){let t=Math.min(window.innerWidth,400);t%2!==0&&(t-=1);let e=Math.floor(t/(window.innerWidth/window.innerHeight));return e%2!==0&&(e-=1),{width:t,height:e}}const ht="info-icon-comp";function Le(t=0){let e;return{id:ht,add(){h.loadSprite("info-icon","sprites/icons/info.png"),e=this.add([h.sprite("info-icon"),h.pos(t,-this.height-2),h.anchor("bot"),h.animate({relative:!0})]),e.animate("pos",[h.vec2(0,0),h.vec2(0,-2),h.vec2(0,0),h.vec2(0,-2),h.vec2(0,0),h.vec2(0,0),h.vec2(0,0)],{duration:1,direction:"forward"})},destroy(){e?.destroy(),e=void 0}}}Le.id=ht;const li=`                                                                                         .
                                                                                         .
                                                                    ,,                   .
                                                              t,,  --- ,   , ,, ,tG,, ,, .
.                           ,tG,,   ,1,F                     ----  ,2F --  ----===========
.           ,t ,r  F       -------  ---             F,,t ,,        ----        ...........
.           -----                                  --====--                    ...........
.                ,,,                ,G,              ....                      ...........
.E ,,B, ,  , ,,//===\\\\G,t,,  ,F ,,//===\\\\,t ,,tG ,,//....\\\\ ,,,r,,t, ,, ,t ,G//...........
.==============.......============.......==========........==================.............
..........................................................................................
..........................................................................................`,Ce=()=>[h.sprite(h.choose(["tile-grass-1","tile-grass-2","tile-grass-3"]),{flipX:h.choose([!0,!1])}),h.z(h.choose([1,-1])),h.anchor("bot"),h.offscreen({hide:!0})],Re=(t,e,i)=>{const s=i();if(s.topRight==="/")return["obstacle",h.sprite("tile-grass-ground-inclined-left-1"),h.anchor("bot"),h.offscreen({hide:!0})];if(s.topLeft==="\\")return["obstacle",h.sprite("tile-grass-ground-inclined-left-1",{flipX:!0}),h.anchor("bot"),h.offscreen({hide:!0})];const r=s.left===" "||s.right===" "||s.bottom===" "||s.left==="";return["obstacle",h.sprite("tile-ground"),...r?[h.area(I),h.body({isStatic:!0})]:[],h.anchor("bot"),h.offscreen({hide:!0})]},Ee=()=>[h.sprite("tile-grass-ground"),h.area(I),h.body({isStatic:!0}),h.anchor("bot"),h.offscreen({hide:!0})],Te=(t,e,i)=>{const s=i();return["obstacle",h.sprite(s.left===" "?"tile-grass-ground-air-left":s.right===" "?"tile-grass-ground-air-right":"tile-grass-ground-air"),h.area({...I,shape:new h.Rect(h.vec2(0,-8),32,24)}),h.body({isStatic:!0}),h.anchor("bot"),h.offscreen({hide:!0})]},Ae=(t,e,i)=>i().left==="/"?["obstacle",h.sprite("tile-grass-ground-inclined-left-3"),h.area({...I,shape:new h.Polygon([h.vec2(-16,0),h.vec2(-16,-16),h.vec2(16,-32),h.vec2(16,0)])}),h.body({isStatic:!0}),h.anchor("bot"),h.offscreen({hide:!0})]:["obstacle",h.sprite("tile-grass-ground-inclined-left-2"),h.area({...I,shape:new h.Polygon([h.vec2(-16,0),h.vec2(16,-16),h.vec2(16,0),h.vec2(-16,16)])}),h.body({isStatic:!0}),h.anchor("bot"),h.offscreen({hide:!0})],Me=(t,e,i)=>i().right==="\\"?["obstacle",h.sprite("tile-grass-ground-inclined-left-3",{flipX:!0}),h.area({...I,shape:new h.Polygon([h.vec2(16,0),h.vec2(16,-16),h.vec2(-16,-32),h.vec2(-16,0)])}),h.body({isStatic:!0}),h.anchor("bot"),h.offscreen({hide:!0})]:["obstacle",h.sprite("tile-grass-ground-inclined-left-2",{flipX:!0}),h.area({...I,shape:new h.Polygon([h.vec2(16,0),h.vec2(-16,-16),h.vec2(-16,0),h.vec2(16,16)])}),h.body({isStatic:!0}),h.anchor("bot"),h.offscreen({hide:!0})],Ne=()=>["obstacle",h.sprite("rock",{flipX:h.choose([!0,!1])}),h.anchor("bot"),h.area(I),h.body({mass:2}),h.offscreen({hide:!0})],De=()=>[h.sprite(h.choose(["tile-tree-1","tile-tree-2"]),{flipX:h.choose([!0,!1])}),h.z(h.choose([1,-1])),h.anchor("bot"),h.offscreen({hide:!0})],re=async t=>{const{player:e,level:i}=await Ie(t,li,{preloadResources:async s=>{await Promise.all([s.loadSprite("tile-ground","sprites/tiles/ground.png"),s.loadSprite("tile-grass-ground","sprites/tiles/grass-ground.png"),s.loadSprite("tile-grass-ground-air","sprites/tiles/grass-ground-air.png"),s.loadSprite("tile-grass-ground-air-left","sprites/tiles/grass-ground-air-left.png"),s.loadSprite("tile-grass-ground-air-right","sprites/tiles/grass-ground-air-right.png"),s.loadSprite("tile-grass-ground-inclined-left-1","sprites/tiles/grass-ground-inclined-left-1.png"),s.loadSprite("tile-grass-ground-inclined-left-2","sprites/tiles/grass-ground-inclined-left-2.png"),s.loadSprite("tile-grass-ground-inclined-left-3","sprites/tiles/grass-ground-inclined-left-3.png"),s.loadSprite("tile-grass-1","sprites/tiles/grass-1.png"),s.loadSprite("tile-grass-2","sprites/tiles/grass-2.png"),s.loadSprite("tile-grass-3","sprites/tiles/grass-3.png"),s.loadSprite("tile-tree-1","sprites/tiles/tree-1.png"),s.loadSprite("tile-tree-2","sprites/tiles/tree-2.png"),s.loadSprite("rock","sprites/tiles/rock.png"),me.loadResources(s),q.loadResources(s),J.loadResources(s),Q.loadResources(s),ge.loadResources(s)]),$.loadMusic("start-location","music/start-location.mp3")},tileWidth:32,tileHeight:32,tiles:{"=":Ee,"-":Te,".":Re,",":Ce,"/":Ae,"\\":Me,t:De,r:Ne,G:(s,r)=>{q.spawn(t,r)},F:(s,r)=>{J.spawn(t,r)},B:(s,r)=>{Q.spawn(t,r,{flipX:!0})}},exitPoints:[{currentMapExitIndex:0,spawnOffsetTiles:t.vec2(2,0),destLevel:V.id,destLevelExitIndex:1}]});await t.loadSprite("bg-home-day","sprites/backgrounds/home-day.png"),Pe(t,"bg-home-day",e,{offsetY:40}),$.playMusic("start-location"),v.update({persistent:{currentLevel:re.id}}),e.setCamFollowPlayer(i,{leftTilesPadding:2,rightTilesPadding:2,topTilesPadding:-5})};re.id="level-1-3";const ci=`                                                                                         .
                                                                                         .
                                                                    ,,                   .
                                                              t,,  --- ,   , ,, ,tG,, ,,E.
.                           ,tG,,   ,1,F                     ----  ,2F --  ----===========
.           ,t ,r  F       -------  ---             F,,t ,,        ----        ...........
.           -----                                  --====--                    ...........
.                ,,,                ,G,              ....                      ...........
.E ,,B, ,  , ,,//===\\\\G,t,,  ,F ,,//===\\\\,t ,,tG ,,//....\\\\ ,,,r,,t, ,, ,t ,G//...........
.==============.......============.......==========........==================.............
..........................................................................................
..........................................................................................`,V=async t=>{const{player:e,level:i}=await Ie(t,ci,{preloadResources:async s=>{await Promise.all([s.loadSprite("tile-ground","sprites/tiles/ground.png"),s.loadSprite("tile-grass-ground","sprites/tiles/grass-ground.png"),s.loadSprite("tile-grass-ground-air","sprites/tiles/grass-ground-air.png"),s.loadSprite("tile-grass-ground-air-left","sprites/tiles/grass-ground-air-left.png"),s.loadSprite("tile-grass-ground-air-right","sprites/tiles/grass-ground-air-right.png"),s.loadSprite("tile-grass-ground-inclined-left-1","sprites/tiles/grass-ground-inclined-left-1.png"),s.loadSprite("tile-grass-ground-inclined-left-2","sprites/tiles/grass-ground-inclined-left-2.png"),s.loadSprite("tile-grass-ground-inclined-left-3","sprites/tiles/grass-ground-inclined-left-3.png"),s.loadSprite("tile-grass-1","sprites/tiles/grass-1.png"),s.loadSprite("tile-grass-2","sprites/tiles/grass-2.png"),s.loadSprite("tile-grass-3","sprites/tiles/grass-3.png"),s.loadSprite("tile-tree-1","sprites/tiles/tree-1.png"),s.loadSprite("tile-tree-2","sprites/tiles/tree-2.png"),s.loadSprite("rock","sprites/tiles/rock.png"),s.loadSprite("home-kitchen-chair-right","sprites/home/home-kitchen-chair-right.png"),me.loadResources(s),q.loadResources(s),J.loadResources(s),Q.loadResources(s),ge.loadResources(s)]),$.loadMusic("start-location","music/start-location.mp3")},tileWidth:32,tileHeight:32,tiles:{"=":Ee,"-":Te,".":Re,",":Ce,"/":Ae,"\\":Me,t:De,r:Ne,G:(s,r)=>{q.spawn(t,r)},F:(s,r)=>{J.spawn(t,r)},B:(s,r)=>{Q.spawn(t,r,{flipX:!0})},1:(s,r)=>{Oe(t,{itemId:"home-kitchen-chair-right",sprite:"home-kitchen-chair-right",worldPos:r})}},exitPoints:[{currentMapExitIndex:0,spawnOffsetTiles:t.vec2(2,0),destLevel:G.id,destLevelExitIndex:0},{currentMapExitIndex:1,spawnOffsetTiles:t.vec2(-2,0),destLevel:re.id,destLevelExitIndex:0}]});await t.loadSprite("bg-home-day","sprites/backgrounds/home-day.png"),Pe(t,"bg-home-day",e,{offsetY:40}),$.playMusic("start-location"),v.update({persistent:{currentLevel:V.id}}),e.setCamFollowPlayer(i,{leftTilesPadding:2,rightTilesPadding:2,topTilesPadding:-5})};V.id="level-1-2";const Q={async loadResources(t){await t.loadSprite("old-bobr","sprites/characters/old-bobr.gif",{sliceX:2,sliceY:1,anims:{idle:{from:0,to:1,speed:1.5,loop:!0}}}),await t.loadSound("old-bobr-kurwa-1","sounds/old-bobr-kurwa-1.mp3"),await t.loadSound("old-bobr-kurwa-2","sounds/old-bobr-kurwa-2.mp3")},spawn(t,e=t.vec2(100,100),i){const s={...i},r=t.add(["old-bobr",t.sprite("old-bobr",{anim:"idle",flipX:s.flipX||!1}),t.state("IDLE",["IDLE","INTERACTING"]),t.timer(),t.pos(e),t.area({...I,collisionIgnore:["player","enemy"]}),t.body(),t.anchor("bot"),t.offscreen({pause:!0,unpause:!0,hide:!0}),Y(n),{config:s,shouldShowInfoIcon:a}]);async function n(u){const d=l();d&&(r.enterState("INTERACTING"),t.play(t.choose(["old-bobr-kurwa-1","old-bobr-kurwa-2"])),r.flipX=r.pos.x>u.pos.x,await c(d,u),r.enterState("IDLE"))}function a(){if(r.state==="INTERACTING")return!1;const u=l();if(!u)return!1;switch(u){case"SAY_INTRO_REPEAT":return!1;default:return!0}}function o(){a()?r.use(Le(6*(r.flipX?-1:1))):r.unuse(Le.id)}function l(){const u=v.state;return u.persistent.oldBobr.isIntroSaid?u.persistent.player.deaths>=1&&!u.persistent.player.hasLuckyCharm?"GIVE_LUCKY_CHARM":u.persistent.currentLevel===V.id&&!u.persistent.oldBobr.isRespawnInfoSaid?"SAY_RESPAWN_INFO":"SAY_INTRO_REPEAT":"SAY_INTRO"}async function c(u,d){switch(v.state,u){case"SAY_INTRO":await _(t,r,d,[R("oldBobr.intro1"),R("oldBobr.intro2")]),v.update({persistent:{oldBobr:{isIntroSaid:!0}}});break;case"SAY_INTRO_REPEAT":await _(t,r,d,[R(t.choose(["oldBobr.introRepeat1","oldBobr.introRepeat2","oldBobr.introRepeat3"]))]);break;case"GIVE_LUCKY_CHARM":await _(t,r,d,[R("oldBobr.giveLuckyCharm1"),R("oldBobr.giveLuckyCharm2"),R("oldBobr.giveLuckyCharm3")]),v.update({persistent:{player:{hasLuckyCharm:!0}},temp:{player:{health:2}}});break;case"SAY_RESPAWN_INFO":await _(t,r,d,[R("oldBobr.respawnInfo1"),R("oldBobr.respawnInfo2")]),v.update({persistent:{oldBobr:{isRespawnInfoSaid:!0}}});break}}return r.onStateEnter("IDLE",async()=>{r.play("idle"),o()}),r.onStateEnter("INTERACTING",async()=>{o()}),r.onEnterScreen(()=>{o()}),r}},ui=`                                                                                        .
                                                                                        .
                                                                                        .
                                                           ,2,               ,, ,tG,, ,E.
                         F 1,,                             ---             ---==========.
                           ---                                  , ,Gt,,,      ...........
                              ,t,F             ,tF,,,r         ---------      ...........
          P     ,,,           -----        F ---------          F             ...........
H      ,B,  ,,//===\\\\,,t,,,   , G , ,,  t   ,  ,,, ,G, ,,, ,, , ,, ,  ,G,,t //...........
==============.......=======================================================.............
.........................................................................................
.........................................................................................`,G=async t=>{const{player:e,level:i}=await Ie(t,ui,{preloadResources:async s=>{await Promise.all([s.loadSprite("tile-ground","sprites/tiles/ground.png"),s.loadSprite("tile-grass-ground","sprites/tiles/grass-ground.png"),s.loadSprite("tile-grass-ground-air","sprites/tiles/grass-ground-air.png"),s.loadSprite("tile-grass-ground-air-left","sprites/tiles/grass-ground-air-left.png"),s.loadSprite("tile-grass-ground-air-right","sprites/tiles/grass-ground-air-right.png"),s.loadSprite("tile-grass-ground-inclined-left-1","sprites/tiles/grass-ground-inclined-left-1.png"),s.loadSprite("tile-grass-ground-inclined-left-2","sprites/tiles/grass-ground-inclined-left-2.png"),s.loadSprite("tile-grass-ground-inclined-left-3","sprites/tiles/grass-ground-inclined-left-3.png"),s.loadSprite("tile-grass-1","sprites/tiles/grass-1.png"),s.loadSprite("tile-grass-2","sprites/tiles/grass-2.png"),s.loadSprite("tile-grass-3","sprites/tiles/grass-3.png"),s.loadSprite("tile-tree-1","sprites/tiles/tree-1.png"),s.loadSprite("tile-tree-2","sprites/tiles/tree-2.png"),s.loadSprite("rock","sprites/tiles/rock.png"),me.loadResources(s),q.loadResources(s),J.loadResources(s),rt.loadResources(s),Q.loadResources(s),ge.loadResources(s)]),$.loadMusic("home","music/home.mp3"),$.loadMusic("start-location","music/start-location.mp3")},tileWidth:32,tileHeight:32,tiles:{"=":Ee,"-":Te,".":Re,",":Ce,"/":Ae,"\\":Me,t:De,r:Ne,G:(s,r)=>{q.spawn(t,r)},F:(s,r)=>{J.spawn(t,r)},H:(s,r)=>{rt.spawn(t,r)},B:(s,r)=>{Q.spawn(t,r)},1:(s,r)=>{Oe(t,{itemId:"home-kitchen-chair-left",sprite:"home-kitchen-chair-left",worldPos:r})},2:(s,r)=>{Oe(t,{itemId:"home-kitchen-table",sprite:"home-kitchen-table",worldPos:r})}},exitPoints:[{currentMapExitIndex:0,spawnOffsetTiles:t.vec2(-2,0),destLevel:V.id,destLevelExitIndex:0}]});await t.loadSprite("bg-home-day","sprites/backgrounds/home-day.png"),Pe(t,"bg-home-day",e,{offsetY:40}),$.playMusic("start-location"),v.update({persistent:{currentLevel:G.id}}),e.setCamFollowPlayer(i,{rightTilesPadding:2,topTilesPadding:-5})};G.id="level-1-1";const pt="hud-comp";function B(t){return{id:pt,shouldBeShown:t.shouldBeShown,targetOpacity:t.targetOpacity||1,add(){this.tag("hud"),this.use(h.layer("hud")),this.use(h.fixed()),this.use(h.stay()),this.use(h.opacity(t.targetOpacity))}}}B.id=pt;function di(t,e){const i=e?.size??100,s=e?.deadZone??.1;t.loadSprite("joystick.jump","sprites/icons/jump.gif"),t.loadSprite("joystick.attack","sprites/icons/attack.gif");let r=!1,n=t.vec2(0,0),a=t.vec2(0,0);const o=t.add(["joystickBase",B({shouldBeShown:!0,targetOpacity:.2}),t.pos(-9999,-9999),t.circle(i/2),t.color(0,0,0),t.anchor("center"),{releaseKnob:d}]),l=t.add(["joystickKnob",B({shouldBeShown:!0,targetOpacity:.7}),t.pos(-9999,-9999),t.circle(i/4),t.color(255,255,255),t.anchor("center")]),c=t.add(["jumpButton",B({shouldBeShown:!0,targetOpacity:.2}),t.pos(t.width()-i*.5,t.height()-i*.5),t.area(),t.circle(i/3),t.color(0,0,0),t.anchor("center")]);t.add([B({shouldBeShown:!0}),t.sprite("joystick.jump"),t.pos(c.pos),t.anchor("center")]),c.onClick(()=>{t.pressButton("jump"),t.releaseButton("jump")});const u=t.add(["attackButton",B({shouldBeShown:!0,targetOpacity:.2}),t.pos(t.width()-i*1.1,t.height()-i*1.1),t.area(),t.circle(i/2.5),t.color(0,0,0),t.anchor("center")]);t.add([B({shouldBeShown:!0}),t.sprite("joystick.attack"),t.pos(u.pos),t.anchor("center"),t.scale(1.2)]),u.onClick(()=>{t.pressButton("action"),t.releaseButton("action")}),o.onTouchStart(m=>{m.x>t.width()*.6||(n=m,r=!0,o.pos=n,l.pos=n,o.hidden=!1,l.hidden=!1)}),o.onTouchMove(m=>{if(!r||m.x>t.width()*.6)return;a=m.sub(n);const p=i/2,f=t.vec2(t.clamp(a.x,-p,p),t.clamp(a.y,-p,p));l.pos=n.add(f)}),o.onTouchEnd(m=>{m.x>t.width()*.6||d()}),o.onUpdate(()=>{if(!r)return;const p=a.scale(1/(i/2)).x;p<-s?(t.pressButton("left"),t.releaseButton("right")):p>s?(t.pressButton("right"),t.releaseButton("left")):(t.releaseButton("left"),t.releaseButton("right"))});function d(){r=!1,a=t.vec2(0,0),o.pos=t.vec2(-9999,-9999),l.pos=t.vec2(-9999,-9999),t.releaseButton("left"),t.releaseButton("right")}return o}class hi{constructor(e){this.k=e,this.dimOverlay=this.k.add([this.k.layer("hud"),this.k.rect(this.k.width(),this.k.height()),this.k.color(0,0,0),this.k.pos(0,0),this.k.anchor("topleft"),this.k.opacity(0),this.k.fixed(),this.k.stay()]),U.isTouchDevice()&&(this.joystick=di(this.k,{size:Math.min(window.innerWidth/15,60)})),this.k.loadSprite("reload-button","sprites/icons/reload.png"),this.reloadButton=this.k.add(["reload-button",B({shouldBeShown:!0}),this.k.sprite("reload-button"),this.k.area(),this.k.pos(10,10),this.k.anchor("topleft")]),this.reloadButton.onClick(()=>{v.reset(),fe(this.k,G.id).then()}),this.k.loadSprite("lucky-charm","sprites/icons/lucky-charm.gif",{sliceX:2,sliceY:1,anims:{health2:{from:0,to:0,loop:!1},health1:{from:1,to:1,loop:!1}}}),this.luckyCharm=this.k.add(["lucky-charm",B({shouldBeShown:v.state.persistent.player.hasLuckyCharm}),this.k.sprite("lucky-charm"),this.k.area(),this.k.pos(this.k.width()-10,10),this.k.anchor("topright"),this.k.scale(1)]),this.hide(),v.onUpdate(i=>this.onStateUpdate(i))}isShown=!1;dimOverlay;joystick;reloadButton;luckyCharm;show(){this.k.get("hud").forEach(e=>{e.shouldBeShown&&(this.k.tween(0,1,1,i=>{e.opacity=i*(e.targetOpacity??1)}),e.paused=!1)}),this.isShown=!0}hide(){this.k.get("hud").forEach(e=>{e.opacity=0,e.paused=!0}),this.isShown=!1,this.joystick?.releaseKnob()}async slightlyDimTheGame(){return this.k.tween(0,.4,.6,e=>{this.dimOverlay.opacity=e})}async slightlyUndimTheGame(){return this.k.tween(.4,0,.6,e=>{this.dimOverlay.opacity=e})}async onStateUpdate(e){if(e.persistent.player.hasLuckyCharm&&!this.luckyCharm.shouldBeShown){this.luckyCharm.shouldBeShown=!0,this.luckyCharm.paused=!1;const i=this.k.vec2(this.k.width()/2+10,this.k.height()/2-10),s=this.luckyCharm.pos.clone();this.luckyCharm.play("health2"),this.luckyCharm.pos=i.clone(),this.luckyCharm.scale=this.k.vec2(2),await this.slightlyDimTheGame(),await this.k.tween(0,1,1,r=>{this.luckyCharm.opacity=r}),await this.k.wait(1),this.k.play("player-take-key"),this.slightlyUndimTheGame().then(),await this.k.tween(0,1,1.5,r=>{this.luckyCharm.pos=this.k.vec2(this.k.lerp(i.x,s.x,r),this.k.lerp(i.y,s.y,r)),this.luckyCharm.scale=this.k.vec2(this.k.lerp(2,1,r))},this.k.easings.easeOutElastic)}!e.persistent.player.hasLuckyCharm&&this.luckyCharm.shouldBeShown&&(this.luckyCharm.shouldBeShown=!1,this.luckyCharm.paused=!0,this.luckyCharm.opacity=0),e.persistent.player.hasLuckyCharm&&e.temp.player.health&&this.luckyCharm.play("health"+e.temp.player.health)}}const pi={loading:"Loading...",rotateDevice:"Rotate your device",howToInstall:"How to install to the home screen?"},fi={intro1:"Hello, grandson! You finally bought your own hut... Even if it's with a mortgage, you're still doing great!",intro2:"It's a bit empty inside... But I saw some furniture nearby while I was walking here. You can look for it.",introRepeat1:"I saw some furniture nearby while I was walking here. You can look for it.",introRepeat2:"It's a nice day for a walk, don't you think?",introRepeat3:"The house won't furnish itself... Time to get to work!",giveLuckyCharm1:"Oh, I barely dragged you here... Are you okay?..",giveLuckyCharm2:"Ou, I almost forgot! Here, take this for good luck...",giveLuckyCharm3:"It's my lucky charm. May it protect you as it once protected me.",respawnInfo1:"If something happens to you, I'll always help you get back home.",respawnInfo2:"And don't worry about your stuff, it won't disappear!"},gi={kitchenTableRepeat1:"Hmm, who would throw away such a gorgeous table?..",kitchenTableRepeat2:"Mmm, it smells so good...",kitchenTableRepeat3:"Mmm, it looks so tasty... but I still need it.",kitchenChairRepeat1:"Why is it so small?.. Oh well, I don't have much choice."},mi={common:pi,oldBobr:fi,home:gi},yi={loading:"Загрузка...",rotateDevice:"Поверните устройство",howToInstall:"Как установить на домашний экран?"},bi={intro1:"Привет, внучек! Наконец-то ты купил свою хатку... Хоть и в ипотеку, но ты всё равно молодец!",intro2:"Внутри пока пустовато... Но я видел некоторую мебель неподалёку, пока сюда шёл. Ты можешь поискать её.",introRepeat1:"Я видел некоторую мебель неподалёку, пока сюда шёл. Ты можешь поискать её.",introRepeat2:"Неплохой день для прогулки, как ты думаешь?",introRepeat3:"Дом сам себя не обставит... Пора за работу!",giveLuckyCharm1:"Ох, еле дотащил тебя до сюда... Ты как?..",giveLuckyCharm2:"О, совсем забыл! Вот, возьми на удачу...",giveLuckyCharm3:"Это мой счастливый талисман. Пусть он защитит тебя как когда-то и меня.",respawnInfo1:"Если с тобой что-то случится, я всегда помогу тебе вернуться домой.",respawnInfo2:"И не беспокойся о своих вещах, они не пропадут!"},wi={kitchenTableRepeat1:"Хм, кто выбросил такой шикарный стол?..",kitchenTableRepeat2:"Ммм, вкусно пахнет деревом...",kitchenTableRepeat3:"Ммм, выглядит так аппетитно... но он мне ещё нужен.",kitchenChairRepeat1:"Почему он такой маленький?.. Ладно, выбирать не приходится."},Si={common:yi,oldBobr:bi,home:wi},xi=t=>{t.loadSprite("button-play","sprites/icons/play.png"),t.add(["button-play",t.layer("menu"),t.sprite("button-play",{width:100}),t.pos(t.width()/2,t.height()/2),t.anchor("center"),t.area(),t.fixed()]).onClick(()=>{fe(t,v.state.persistent.currentLevel||G.id,{spawnAtExitIndex:v.state.persistent.spawnAtExitIndex}).then()})},vi=t=>{t.loadSprite("rotate-device","sprites/icons/rotate-device.gif"),t.add(["rotate-device",t.sprite("rotate-device",{width:100}),t.anchor("bot"),t.pos(t.width()/2,t.height()/2-10),t.scale(t.vec2(-1,1)),t.fixed()]),t.add(["rotate-device-text",t.text(R("common.rotateDevice"),{font:"pixel",size:24,width:t.width()*.8,align:"center",lineSpacing:10}),t.color("white"),t.anchor("top"),t.pos(t.width()/2,t.height()/2+20),t.fixed()]);let e="https://www.cdc.gov/niosh/mining/tools/installpwa.html#cdc_generic_section_2-installing-a-pwa-on-ios";switch(P.language){case"ru":e="https://darkshaurma.com/about/pwa/";break}const i=document.createElement("a");i.href=e,i.target="_blank",i.rel="noopener",i.innerHTML=R("common.howToInstall"),i.style.position="absolute",i.style.width="100%",i.style.boxSizing="border-box",i.style.bottom="10%",i.style.left="0",i.style.display="block",i.style.padding="20px",i.style.color="white",i.style.fontFamily="pixel, monospace",i.style.textAlign="center",i.style.lineHeight="1.5em",document.querySelector("body").appendChild(i),t.onSceneLeave(()=>{document.querySelector("body").removeChild(i)})},v=new ii,$=new ei(h);let de,he;(async()=>{await P.use(ut).init({supportedLngs:["en","ru"],fallbackLng:"ru",detection:{order:["localStorage","navigator"],caches:["localStorage"]},resources:{ru:{translation:Si},en:{translation:mi}}}),h.loadFont("pixel","fonts/Press_Start_2P/PressStart2P-Regular.ttf"),h.setLayers(["bg","game","hud","menu","fade"],"game"),h.add([h.layer("bg"),h.rect(h.width(),h.height()),h.color("#74dcf6"),h.pos(0,0),h.anchor("topleft"),h.fixed(),h.stay()]),h.setVolume(.5),de=new hi(h),he=new ti(h),h.scene("menu",()=>xi(h)),h.scene("rotate-device",()=>vi(h)),h.scene(G.id,Se(h,G)),h.scene(V.id,Se(h,V)),h.scene(re.id,Se(h,re));const t=U.isLandscapeMode();window.addEventListener("resize",()=>{t||U.isLandscapeMode()!==t&&setTimeout(()=>{window.location.reload()},1e3)}),t?h.go("menu"):h.go("rotate-device")})();
