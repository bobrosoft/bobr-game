import{R as v}from"./kaplay-DTLyooHV.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(t){if(t.ep)return;t.ep=!0;const o=r(t);fetch(t.href,o)}})();function b(e,i){const r=i?.size??100,n=i?.deadZone??.1;e.loadSprite("joystick.jump","sprites/icons/jump.gif"),e.loadSprite("joystick.attack","sprites/icons/attack.gif");let t=!1,o=e.vec2(0,0),c=e.vec2(0,0);const d=e.add(["joystickBase",e.layer("hud"),e.stay(),e.pos(-9999,-9999),e.circle(r/2),e.color(0,0,0),e.opacity(.2),e.fixed(),e.anchor("center")]),l=e.add(["joystickKnob",e.layer("hud"),e.stay(),e.pos(-9999,-9999),e.circle(r/4),e.color(255,255,255),e.opacity(.7),e.fixed(),e.anchor("center")]),p=e.add(["jumpButton",e.layer("hud"),e.stay(),e.pos(e.width()-r*.5,e.height()-r*.5),e.area(),e.circle(r/3),e.color(0,0,0),e.opacity(.2),e.fixed(),e.anchor("center")]);p.add([e.sprite("joystick.jump"),e.anchor("center")]),p.onClick(()=>{e.pressButton("jump"),e.releaseButton("jump")});const h=e.add(["attackButton",e.layer("hud"),e.stay(),e.pos(e.width()-r*1.1,e.height()-r*1.1),e.area(),e.circle(r/2.5),e.color(0,0,0),e.opacity(.2),e.fixed(),e.anchor("center")]);h.add([e.sprite("joystick.attack"),e.anchor("center"),e.scale(1.2)]),h.onClick(()=>{e.pressButton("action"),e.releaseButton("action")}),d.onTouchStart(s=>{s.x>e.width()*.6||(o=s,t=!0,d.pos=o,l.pos=o,d.hidden=!1,l.hidden=!1)}),d.onTouchMove(s=>{if(!t||s.x>e.width()*.6)return;c=s.sub(o);const u=r/2,S=e.vec2(e.clamp(c.x,-u,u),e.clamp(c.y,-u,u));l.pos=o.add(S)}),d.onTouchEnd(s=>{s.x>e.width()*.6||(t=!1,c=e.vec2(0,0),d.pos=e.vec2(-9999,-9999),l.pos=e.vec2(-9999,-9999),e.releaseButton("left"),e.releaseButton("right"))}),d.onUpdate(()=>{if(!t)return;const u=c.scale(1/(r/2)).x;u<-n?(e.pressButton("left"),e.releaseButton("right")):u>n?(e.pressButton("right"),e.releaseButton("left")):(e.releaseButton("left"),e.releaseButton("right"))})}const g=w(),a=v({global:!1,width:g.width,height:g.height,background:"#74dcf6",letterbox:!0,pixelDensity:2,debug:!0,debugKey:"`",buttons:{left:{keyboard:["left","a"],gamepad:["dpad-left"]},right:{keyboard:["right","d"],gamepad:["dpad-right"]},jump:{keyboard:["space","up","w","k"],gamepad:["south"]},action:{keyboard:["j","z"],gamepad:["east"]}}});function w(){let e=Math.min(window.innerWidth,400);e%2!==0&&(e-=1);let i=Math.floor(e/(window.innerWidth/window.innerHeight));return i%2!==0&&(i-=1),{width:e,height:i}}class m{static isTouchDevice(i){return i=i||window.navigator.userAgent,"ontouchstart"in window||navigator.maxTouchPoints>0||/ios|iphone|ipad|ipod|android|windows phone/gi.test(i)}static isLandscapeMode(){return window.innerWidth>window.innerHeight}}const f={friction:.2};function y(e,i=e.vec2(100,100),r){const n={health:2,speedX:50,...r};let t=-1;e.loadSprite("gopher","sprites/enemies/gopher.gif",{sliceX:4,sliceY:1,anims:{idle:{from:0,to:0,loop:!1},walk:{from:0,to:3,speed:10,loop:!0}}});const o=e.add(["gopher","enemy",e.sprite("gopher",{anim:"idle"}),e.state("WALK",["IDLE","WALK"]),e.health(n.health,n.health),e.timer(),e.pos(i),e.area(f),e.body(),e.anchor("bot"),e.offscreen({pause:!0,unpause:!0,hide:!0}),{registerHit:c=>{o.applyImpulse(e.vec2(Math.sign(o.pos.x-c.pos.x)*100,-200)),o.hp-=c.attackPower}}]);return o.onStateEnter("WALK",async()=>{o.flipX=t<0,o.play("walk"),await o.wait(4),o.enterState("IDLE")}),o.onStateUpdate("WALK",()=>{o.isGrounded()&&o.move(n.speedX*t,0)}),o.onStateEnter("IDLE",async()=>{o.play("idle"),await o.wait(2),o.dead||(t*=-1,o.enterState("WALK"))}),o.onDeath(()=>{o.paused=!0,o.collisionIgnore=["*"],o.use(e.rotate(o.flipX?10:-10))}),o.onExitScreen(()=>{o.dead&&o.destroy()}),o}function x(e,i){e.loadSprite("home-outside","sprites/home/home-outside.png"),e.loadSprite("home-inside","sprites/home/home-inside.png"),e.loadSprite("home-fence","sprites/home/home-fence.png");const r=e.add(["home-container",e.pos(i),e.anchor("botleft"),e.offscreen({hide:!0,pause:!0,unpause:!0,distance:300}),e.state("OUTSIDE",["INSIDE","OUTSIDE"])]);r.add([e.sprite("home-fence"),e.pos(206,0),e.anchor("botleft")]),r.add(["home-outside",e.sprite("home-inside"),e.anchor("botleft")]);const n=r.add(["home-outside",e.sprite("home-outside"),e.anchor("botleft"),e.animate({relative:!0})]);return A(e,r),r.onStateEnter("OUTSIDE",()=>{n.unanimateAll(),n.animation.seek(0),n.animate("opacity",[0,1],{duration:1,loops:1})}),r.onStateEnter("INSIDE",()=>{n.unanimateAll(),n.animation.seek(0),n.animate("opacity",[1,0],{duration:1,loops:1})}),r.add(["home-entrance",e.rect(20,38,{fill:!1}),e.pos(165,0),e.anchor("botleft"),e.area()]).onCollide("player",()=>{r.state!=="INSIDE"&&r.enterState("INSIDE")}),r.add(["home-exit",e.rect(20,38,{fill:!1}),e.pos(214,0),e.anchor("botleft"),e.area()]).onCollide("player",()=>{r.state!=="OUTSIDE"&&r.enterState("OUTSIDE")}),r}function A(e,i){i.add([e.rect(14,200,{fill:!1}),e.pos(198,-42),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),i.add([e.rect(40,12,{fill:!1}),e.pos(161,-42),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),i.add([e.rect(10,220,{fill:!1}),e.pos(-10,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),i.add([e.polygon([e.vec2(178,-54),e.vec2(115,-193),e.vec2(125,-193),e.vec2(188,-54)],{fill:!1}),e.pos(0,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),i.add([e.polygon([e.vec2(115,-193),e.vec2(50,-221),e.vec2(50,-230),e.vec2(125,-193)],{fill:!1}),e.pos(0,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),i.add([e.polygon([e.vec2(50,-221),e.vec2(0,-221),e.vec2(0,-230),e.vec2(50,-230)],{fill:!1}),e.pos(0,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),i.add([e.rect(120,8,{fill:!1}),e.pos(57,-58),e.anchor("botleft"),e.area(f),e.body({isStatic:!0})]),i.add([e.rect(95,8,{fill:!1}),e.pos(0,-122),e.anchor("botleft"),e.area(f),e.body({isStatic:!0})])}const L={maxRunSpeed:200,accelGround:200,accelAir:150,decelGround:500,decelAir:300,jumpForce:400,minRunAnimSpeed:1,maxRunAnimSpeed:2,attackPower:1};a.loadSprite("player","sprites/characters/bobr.gif",{sliceX:5,sliceY:4,anims:{idle:{from:0,to:1,speed:3,loop:!0},walk:{from:5,to:8,speed:10,loop:!0},jump:{from:10,to:10},fall:{from:10,to:10},attack:{from:15,to:19,speed:20,loop:!1}}});function E(e,i=e.vec2(100,100),r){const n={...L,...r},t=e.add(["player",e.sprite("player",{anim:"idle"}),e.pos(i),e.area({shape:new e.Rect(e.vec2(1,0),20,31),...f}),e.body(),e.anchor("bot"),e.state("IDLE",["IDLE","WALK","JUMP","FALL","ATTACK"]),{vx:0,get moveDirection(){return(e.isButtonDown("right")?1:0)+(e.isButtonDown("left")?-1:0)},get attackPower(){return n.attackPower}}]);let o;function c(){t.jump(n.jumpForce),t.enterState("JUMP")}function d(l,p){t.getCurAnim()?.name!==l&&t.play(l,{onEnd:p})}return t.onButtonPress("jump",()=>{t.isGrounded()&&c()}),t.onButtonPress("action",()=>{t.state!=="ATTACK"&&t.enterState("ATTACK")}),t.onFixedUpdate(()=>{const l=e.dt(),p=t.isGrounded(),h=t.moveDirection;if(t.friction=p?f.friction:0,h!==0){let s=p?n.accelGround:n.accelAir;Math.sign(h)!==Math.sign(t.vx)&&(s+=p?n.decelGround:n.decelAir),t.vx=D(t.vx,h*n.maxRunSpeed,s*l)}else{const s=p?n.decelGround:n.decelAir,u=Math.max(0,Math.abs(t.vx)-s*l);t.vx=u*Math.sign(t.vx)}t.move(t.vx,0),t.flipX=h<0?!0:h>0?!1:t.flipX,t.area.scale.x=t.flipX?-1:1,t.state!=="ATTACK"?p?Math.abs(t.vx)>5?t.enterState("WALK"):t.enterState("IDLE"):t.vel.y<0?t.enterState("JUMP"):t.enterState("FALL"):t.getCurAnim()?.frameIndex===2&&(o||(o=t.add(["player.hitbox",e.pos(e.vec2(t.flipX?-16:16,0)),e.area(),e.rect(20,20),e.opacity(0),e.anchor("bot"),e.lifespan(.1)]),o.onCollide("enemy",s=>{s.registerHit(t)}),o.onDestroy(()=>{o=void 0})))}),t.onStateEnter("IDLE",()=>{d("idle")}),t.onStateUpdate("WALK",()=>{d("walk");const l=e.clamp(Math.abs(t.vx)/n.maxRunSpeed,0,1);t.animSpeed=e.lerp(n.minRunAnimSpeed,n.maxRunAnimSpeed,l)}),t.onStateEnter("JUMP",()=>{d("jump")}),t.onStateEnter("FALL",()=>{d("fall")}),t.onStateEnter("ATTACK",()=>{d("attack",()=>{t.enterState("IDLE")}),t.animSpeed=1}),t}function D(e,i,r){const n=i-e;return Math.abs(n)<=r?i:e+Math.sign(i)*r}const I=e=>{e.setGravity(1e3),e.add([e.rect(1200,20),e.pos(0,e.height()),e.color("#9e9303"),e.area(f),e.anchor("topleft"),e.body({isStatic:!0})]),x(e,e.vec2(0,e.height())),e.add([e.rect(100,20),e.pos(400,e.height()-60),e.color("#9e9303"),e.area(),e.anchor("top"),e.body({isStatic:!0})]),e.add([e.rect(100,20),e.pos(550,e.height()-100),e.color("#9e9303"),e.area(),e.anchor("top"),e.body({isStatic:!0})]),e.add([e.rect(100,20),e.pos(800,e.height()-150),e.color("#9e9303"),e.area(),e.anchor("top"),e.body({isStatic:!0})]),y(e,e.vec2(600,e.height()-100)),y(e,e.vec2(800,e.height()-100));const i=E(e,e.vec2(420,0));e.onUpdate(()=>{e.setCamPos(Math.max(i.pos.x,e.width()/2),i.pos.y-e.height()/4)})};(()=>{a.loadFont("pixel","fonts/Press_Start_2P/PressStart2P-Regular.ttf"),a.setLayers(["game","hud","menu"],"game");const e=m.isLandscapeMode();if(window.addEventListener("resize",()=>{m.isLandscapeMode()!==e&&setTimeout(()=>{window.location.reload()},1e3)}),!e){a.loadSprite("rotate-device","sprites/icons/rotate-device.gif"),a.add(["rotate-device",a.sprite("rotate-device",{width:100}),a.anchor("center"),a.pos(a.width()/2,a.height()/2-50),a.scale(a.vec2(-1,1)),a.fixed(),a.stay()]),a.add(["rotate-warning-text",a.text("Поверните устройство",{font:"pixel",size:24,width:a.width()*.8,align:"center"}),a.color("white"),a.anchor("center"),a.pos(a.width()/2,a.height()/2+50),a.fixed(),a.stay()]);return}a.scene("level-home",()=>I(a)),a.go("level-home"),m.isTouchDevice()&&b(a,{size:Math.min(window.innerWidth/15,60)}),a.loadSprite("reload-button","sprites/icons/reload.png"),a.add(["reload-button",a.layer("hud"),a.sprite("reload-button"),a.area(),a.pos(a.width()-10,10),a.anchor("topright"),a.fixed(),a.stay()]).onClick(()=>{window.location.reload()})})();
