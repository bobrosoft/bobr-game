import{R as et}from"./kaplay-DTLyooHV.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=s(i);fetch(i.href,r)}})();const y=e=>typeof e=="string",J=()=>{let e,t;const s=new Promise((n,i)=>{e=n,t=i});return s.resolve=e,s.reject=t,s},be=e=>e==null?"":""+e,tt=(e,t,s)=>{e.forEach(n=>{t[n]&&(s[n]=t[n])})},it=/###/g,we=e=>e&&e.indexOf("###")>-1?e.replace(it,"."):e,Se=e=>!e||y(e),q=(e,t,s)=>{const n=y(t)?t.split("."):t;let i=0;for(;i<n.length-1;){if(Se(e))return{};const r=we(n[i]);!e[r]&&s&&(e[r]=new s),Object.prototype.hasOwnProperty.call(e,r)?e=e[r]:e={},++i}return Se(e)?{}:{obj:e,k:we(n[i])}},xe=(e,t,s)=>{const{obj:n,k:i}=q(e,t,Object);if(n!==void 0||t.length===1){n[i]=s;return}let r=t[t.length-1],a=t.slice(0,t.length-1),o=q(e,a,Object);for(;o.obj===void 0&&a.length;)r=`${a[a.length-1]}.${r}`,a=a.slice(0,a.length-1),o=q(e,a,Object),o?.obj&&typeof o.obj[`${o.k}.${r}`]<"u"&&(o.obj=void 0);o.obj[`${o.k}.${r}`]=s},st=(e,t,s,n)=>{const{obj:i,k:r}=q(e,t,Object);i[r]=i[r]||[],i[r].push(s)},se=(e,t)=>{const{obj:s,k:n}=q(e,t);if(s&&Object.prototype.hasOwnProperty.call(s,n))return s[n]},nt=(e,t,s)=>{const n=se(e,s);return n!==void 0?n:se(t,s)},ze=(e,t,s)=>{for(const n in t)n!=="__proto__"&&n!=="constructor"&&(n in e?y(e[n])||e[n]instanceof String||y(t[n])||t[n]instanceof String?s&&(e[n]=t[n]):ze(e[n],t[n],s):e[n]=t[n]);return e},H=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var rt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const at=e=>y(e)?e.replace(/[&<>"'\/]/g,t=>rt[t]):e;class ot{constructor(t){this.capacity=t,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(t){const s=this.regExpMap.get(t);if(s!==void 0)return s;const n=new RegExp(t);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(t,n),this.regExpQueue.push(t),n}}const lt=[" ",",","?","!",";"],ct=new ot(20),ut=(e,t,s)=>{t=t||"",s=s||"";const n=lt.filter(a=>t.indexOf(a)<0&&s.indexOf(a)<0);if(n.length===0)return!0;const i=ct.getRegExp(`(${n.map(a=>a==="?"?"\\?":a).join("|")})`);let r=!i.test(e);if(!r){const a=e.indexOf(s);a>0&&!i.test(e.substring(0,a))&&(r=!0)}return r},ue=(e,t,s=".")=>{if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const n=t.split(s);let i=e;for(let r=0;r<n.length;){if(!i||typeof i!="object")return;let a,o="";for(let c=r;c<n.length;++c)if(c!==r&&(o+=s),o+=n[c],a=i[o],a!==void 0){if(["string","number","boolean"].indexOf(typeof a)>-1&&c<n.length-1)continue;r+=c-r+1;break}i=a}return i},Z=e=>e?.replace("_","-"),ht={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){console?.[e]?.apply?.(console,t)}};class ne{constructor(t,s={}){this.init(t,s)}init(t,s={}){this.prefix=s.prefix||"i18next:",this.logger=t||ht,this.options=s,this.debug=s.debug}log(...t){return this.forward(t,"log","",!0)}warn(...t){return this.forward(t,"warn","",!0)}error(...t){return this.forward(t,"error","")}deprecate(...t){return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(t,s,n,i){return i&&!this.debug?null:(y(t[0])&&(t[0]=`${n}${this.prefix} ${t[0]}`),this.logger[s](t))}create(t){return new ne(this.logger,{prefix:`${this.prefix}:${t}:`,...this.options})}clone(t){return t=t||this.options,t.prefix=t.prefix||this.prefix,new ne(this.logger,t)}}var F=new ne;class ae{constructor(){this.observers={}}on(t,s){return t.split(" ").forEach(n=>{this.observers[n]||(this.observers[n]=new Map);const i=this.observers[n].get(s)||0;this.observers[n].set(s,i+1)}),this}off(t,s){if(this.observers[t]){if(!s){delete this.observers[t];return}this.observers[t].delete(s)}}emit(t,...s){this.observers[t]&&Array.from(this.observers[t].entries()).forEach(([i,r])=>{for(let a=0;a<r;a++)i(...s)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([i,r])=>{for(let a=0;a<r;a++)i.apply(i,[t,...s])})}}class ve extends ae{constructor(t,s={ns:["translation"],defaultNS:"translation"}){super(),this.data=t||{},this.options=s,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}removeNamespaces(t){const s=this.options.ns.indexOf(t);s>-1&&this.options.ns.splice(s,1)}getResource(t,s,n,i={}){const r=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,a=i.ignoreJSONStructure!==void 0?i.ignoreJSONStructure:this.options.ignoreJSONStructure;let o;t.indexOf(".")>-1?o=t.split("."):(o=[t,s],n&&(Array.isArray(n)?o.push(...n):y(n)&&r?o.push(...n.split(r)):o.push(n)));const c=se(this.data,o);return!c&&!s&&!n&&t.indexOf(".")>-1&&(t=o[0],s=o[1],n=o.slice(2).join(".")),c||!a||!y(n)?c:ue(this.data?.[t]?.[s],n,r)}addResource(t,s,n,i,r={silent:!1}){const a=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator;let o=[t,s];n&&(o=o.concat(a?n.split(a):n)),t.indexOf(".")>-1&&(o=t.split("."),i=s,s=o[1]),this.addNamespaces(s),xe(this.data,o,i),r.silent||this.emit("added",t,s,n,i)}addResources(t,s,n,i={silent:!1}){for(const r in n)(y(n[r])||Array.isArray(n[r]))&&this.addResource(t,s,r,n[r],{silent:!0});i.silent||this.emit("added",t,s,n)}addResourceBundle(t,s,n,i,r,a={silent:!1,skipCopy:!1}){let o=[t,s];t.indexOf(".")>-1&&(o=t.split("."),i=n,n=s,s=o[1]),this.addNamespaces(s);let c=se(this.data,o)||{};a.skipCopy||(n=JSON.parse(JSON.stringify(n))),i?ze(c,n,r):c={...c,...n},xe(this.data,o,c),a.silent||this.emit("added",t,s,n)}removeResourceBundle(t,s){this.hasResourceBundle(t,s)&&delete this.data[t][s],this.removeNamespaces(s),this.emit("removed",t,s)}hasResourceBundle(t,s){return this.getResource(t,s)!==void 0}getResourceBundle(t,s){return s||(s=this.options.defaultNS),this.getResource(t,s)}getDataByLanguage(t){return this.data[t]}hasLanguageSomeTranslations(t){const s=this.getDataByLanguage(t);return!!(s&&Object.keys(s)||[]).find(i=>s[i]&&Object.keys(s[i]).length>0)}toJSON(){return this.data}}var We={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,s,n,i){return e.forEach(r=>{t=this.processors[r]?.process(t,s,n,i)??t}),t}};const Oe={},Le=e=>!y(e)&&typeof e!="boolean"&&typeof e!="number";class re extends ae{constructor(t,s={}){super(),tt(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,this),this.options=s,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=F.create("translator")}changeLanguage(t){t&&(this.language=t)}exists(t,s={interpolation:{}}){const n={...s};return t==null?!1:this.resolve(t,n)?.res!==void 0}extractFromKey(t,s){let n=s.nsSeparator!==void 0?s.nsSeparator:this.options.nsSeparator;n===void 0&&(n=":");const i=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let r=s.ns||this.options.defaultNS||[];const a=n&&t.indexOf(n)>-1,o=!this.options.userDefinedKeySeparator&&!s.keySeparator&&!this.options.userDefinedNsSeparator&&!s.nsSeparator&&!ut(t,n,i);if(a&&!o){const c=t.match(this.interpolator.nestingRegexp);if(c&&c.length>0)return{key:t,namespaces:y(r)?[r]:r};const l=t.split(n);(n!==i||n===i&&this.options.ns.indexOf(l[0])>-1)&&(r=l.shift()),t=l.join(i)}return{key:t,namespaces:y(r)?[r]:r}}translate(t,s,n){let i=typeof s=="object"?{...s}:s;if(typeof i!="object"&&this.options.overloadTranslationOptionHandler&&(i=this.options.overloadTranslationOptionHandler(arguments)),typeof options=="object"&&(i={...i}),i||(i={}),t==null)return"";Array.isArray(t)||(t=[String(t)]);const r=i.returnDetails!==void 0?i.returnDetails:this.options.returnDetails,a=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,{key:o,namespaces:c}=this.extractFromKey(t[t.length-1],i),l=c[c.length-1];let u=i.nsSeparator!==void 0?i.nsSeparator:this.options.nsSeparator;u===void 0&&(u=":");const h=i.lng||this.language,g=i.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(h?.toLowerCase()==="cimode")return g?r?{res:`${l}${u}${o}`,usedKey:o,exactUsedKey:o,usedLng:h,usedNS:l,usedParams:this.getUsedParamsDetails(i)}:`${l}${u}${o}`:r?{res:o,usedKey:o,exactUsedKey:o,usedLng:h,usedNS:l,usedParams:this.getUsedParamsDetails(i)}:o;const d=this.resolve(t,i);let f=d?.res;const b=d?.usedKey||o,x=d?.exactUsedKey||o,p=["[object Number]","[object Function]","[object RegExp]"],m=i.joinArrays!==void 0?i.joinArrays:this.options.joinArrays,S=!this.i18nFormat||this.i18nFormat.handleAsObject,O=i.count!==void 0&&!y(i.count),v=re.hasDefaultValue(i),E=O?this.pluralResolver.getSuffix(h,i.count,i):"",U=i.ordinal&&O?this.pluralResolver.getSuffix(h,i.count,{ordinal:!1}):"",ee=O&&!i.ordinal&&i.count===0,N=ee&&i[`defaultValue${this.options.pluralSeparator}zero`]||i[`defaultValue${E}`]||i[`defaultValue${U}`]||i.defaultValue;let R=f;S&&!f&&v&&(R=N);const oe=Le(R),ke=Object.prototype.toString.apply(R);if(S&&R&&oe&&p.indexOf(ke)<0&&!(y(m)&&Array.isArray(R))){if(!i.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const A=this.options.returnedObjectHandler?this.options.returnedObjectHandler(b,R,{...i,ns:c}):`key '${o} (${this.language})' returned an object instead of string.`;return r?(d.res=A,d.usedParams=this.getUsedParamsDetails(i),d):A}if(a){const A=Array.isArray(R),T=A?[]:{},ge=A?x:b;for(const M in R)if(Object.prototype.hasOwnProperty.call(R,M)){const $=`${ge}${a}${M}`;v&&!f?T[M]=this.translate($,{...i,defaultValue:Le(N)?N[M]:void 0,joinArrays:!1,ns:c}):T[M]=this.translate($,{...i,joinArrays:!1,ns:c}),T[M]===$&&(T[M]=R[M])}f=T}}else if(S&&y(m)&&Array.isArray(f))f=f.join(m),f&&(f=this.extendTranslation(f,t,i,n));else{let A=!1,T=!1;!this.isValidLookup(f)&&v&&(A=!0,f=N),this.isValidLookup(f)||(T=!0,f=o);const M=(i.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&T?void 0:f,$=v&&N!==f&&this.options.updateMissing;if(T||A||$){if(this.logger.log($?"updateKey":"missingKey",h,l,o,$?N:f),a){const I=this.resolve(o,{...i,keySeparator:!1});I&&I.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let G=[];const te=this.languageUtils.getFallbackCodes(this.options.fallbackLng,i.lng||this.language);if(this.options.saveMissingTo==="fallback"&&te&&te[0])for(let I=0;I<te.length;I++)G.push(te[I]);else this.options.saveMissingTo==="all"?G=this.languageUtils.toResolveHierarchy(i.lng||this.language):G.push(i.lng||this.language);const me=(I,K,Y)=>{const ye=v&&Y!==f?Y:M;this.options.missingKeyHandler?this.options.missingKeyHandler(I,l,K,ye,$,i):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(I,l,K,ye,$,i),this.emit("missingKey",I,l,K,f)};this.options.saveMissing&&(this.options.saveMissingPlurals&&O?G.forEach(I=>{const K=this.pluralResolver.getSuffixes(I,i);ee&&i[`defaultValue${this.options.pluralSeparator}zero`]&&K.indexOf(`${this.options.pluralSeparator}zero`)<0&&K.push(`${this.options.pluralSeparator}zero`),K.forEach(Y=>{me([I],o+Y,i[`defaultValue${Y}`]||N)})}):me(G,o,N))}f=this.extendTranslation(f,t,i,d,n),T&&f===o&&this.options.appendNamespaceToMissingKey&&(f=`${l}${u}${o}`),(T||A)&&this.options.parseMissingKeyHandler&&(f=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}${u}${o}`:o,A?f:void 0,i))}return r?(d.res=f,d.usedParams=this.getUsedParamsDetails(i),d):f}extendTranslation(t,s,n,i,r){if(this.i18nFormat?.parse)t=this.i18nFormat.parse(t,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});const c=y(t)&&(n?.interpolation?.skipOnVariables!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let l;if(c){const h=t.match(this.interpolator.nestingRegexp);l=h&&h.length}let u=n.replace&&!y(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(u={...this.options.interpolation.defaultVariables,...u}),t=this.interpolator.interpolate(t,u,n.lng||this.language||i.usedLng,n),c){const h=t.match(this.interpolator.nestingRegexp),g=h&&h.length;l<g&&(n.nest=!1)}!n.lng&&i&&i.res&&(n.lng=this.language||i.usedLng),n.nest!==!1&&(t=this.interpolator.nest(t,(...h)=>r?.[0]===h[0]&&!n.context?(this.logger.warn(`It seems you are nesting recursively key: ${h[0]} in key: ${s[0]}`),null):this.translate(...h,s),n)),n.interpolation&&this.interpolator.reset()}const a=n.postProcess||this.options.postProcess,o=y(a)?[a]:a;return t!=null&&o?.length&&n.applyPostProcessor!==!1&&(t=We.handle(o,t,s,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...i,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),t}resolve(t,s={}){let n,i,r,a,o;return y(t)&&(t=[t]),t.forEach(c=>{if(this.isValidLookup(n))return;const l=this.extractFromKey(c,s),u=l.key;i=u;let h=l.namespaces;this.options.fallbackNS&&(h=h.concat(this.options.fallbackNS));const g=s.count!==void 0&&!y(s.count),d=g&&!s.ordinal&&s.count===0,f=s.context!==void 0&&(y(s.context)||typeof s.context=="number")&&s.context!=="",b=s.lngs?s.lngs:this.languageUtils.toResolveHierarchy(s.lng||this.language,s.fallbackLng);h.forEach(x=>{this.isValidLookup(n)||(o=x,!Oe[`${b[0]}-${x}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(o)&&(Oe[`${b[0]}-${x}`]=!0,this.logger.warn(`key "${i}" for languages "${b.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),b.forEach(p=>{if(this.isValidLookup(n))return;a=p;const m=[u];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(m,u,p,x,s);else{let O;g&&(O=this.pluralResolver.getSuffix(p,s.count,s));const v=`${this.options.pluralSeparator}zero`,E=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(g&&(m.push(u+O),s.ordinal&&O.indexOf(E)===0&&m.push(u+O.replace(E,this.options.pluralSeparator)),d&&m.push(u+v)),f){const U=`${u}${this.options.contextSeparator}${s.context}`;m.push(U),g&&(m.push(U+O),s.ordinal&&O.indexOf(E)===0&&m.push(U+O.replace(E,this.options.pluralSeparator)),d&&m.push(U+v))}}let S;for(;S=m.pop();)this.isValidLookup(n)||(r=S,n=this.getResource(p,x,S,s))}))})}),{res:n,usedKey:i,exactUsedKey:r,usedLng:a,usedNS:o}}isValidLookup(t){return t!==void 0&&!(!this.options.returnNull&&t===null)&&!(!this.options.returnEmptyString&&t==="")}getResource(t,s,n,i={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(t,s,n,i):this.resourceStore.getResource(t,s,n,i)}getUsedParamsDetails(t={}){const s=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=t.replace&&!y(t.replace);let i=n?t.replace:t;if(n&&typeof t.count<"u"&&(i.count=t.count),this.options.interpolation.defaultVariables&&(i={...this.options.interpolation.defaultVariables,...i}),!n){i={...i};for(const r of s)delete i[r]}return i}static hasDefaultValue(t){const s="defaultValue";for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&s===n.substring(0,s.length)&&t[n]!==void 0)return!0;return!1}}class Ce{constructor(t){this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=F.create("languageUtils")}getScriptPartFromCode(t){if(t=Z(t),!t||t.indexOf("-")<0)return null;const s=t.split("-");return s.length===2||(s.pop(),s[s.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(s.join("-"))}getLanguagePartFromCode(t){if(t=Z(t),!t||t.indexOf("-")<0)return t;const s=t.split("-");return this.formatLanguageCode(s[0])}formatLanguageCode(t){if(y(t)&&t.indexOf("-")>-1){let s;try{s=Intl.getCanonicalLocales(t)[0]}catch{}return s&&this.options.lowerCaseLng&&(s=s.toLowerCase()),s||(this.options.lowerCaseLng?t.toLowerCase():t)}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}isSupportedCode(t){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}getBestMatchFromCodes(t){if(!t)return null;let s;return t.forEach(n=>{if(s)return;const i=this.formatLanguageCode(n);(!this.options.supportedLngs||this.isSupportedCode(i))&&(s=i)}),!s&&this.options.supportedLngs&&t.forEach(n=>{if(s)return;const i=this.getScriptPartFromCode(n);if(this.isSupportedCode(i))return s=i;const r=this.getLanguagePartFromCode(n);if(this.isSupportedCode(r))return s=r;s=this.options.supportedLngs.find(a=>{if(a===r)return a;if(!(a.indexOf("-")<0&&r.indexOf("-")<0)&&(a.indexOf("-")>0&&r.indexOf("-")<0&&a.substring(0,a.indexOf("-"))===r||a.indexOf(r)===0&&r.length>1))return a})}),s||(s=this.getFallbackCodes(this.options.fallbackLng)[0]),s}getFallbackCodes(t,s){if(!t)return[];if(typeof t=="function"&&(t=t(s)),y(t)&&(t=[t]),Array.isArray(t))return t;if(!s)return t.default||[];let n=t[s];return n||(n=t[this.getScriptPartFromCode(s)]),n||(n=t[this.formatLanguageCode(s)]),n||(n=t[this.getLanguagePartFromCode(s)]),n||(n=t.default),n||[]}toResolveHierarchy(t,s){const n=this.getFallbackCodes((s===!1?[]:s)||this.options.fallbackLng||[],t),i=[],r=a=>{a&&(this.isSupportedCode(a)?i.push(a):this.logger.warn(`rejecting language code not found in supportedLngs: ${a}`))};return y(t)&&(t.indexOf("-")>-1||t.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&r(this.formatLanguageCode(t)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&r(this.getScriptPartFromCode(t)),this.options.load!=="currentOnly"&&r(this.getLanguagePartFromCode(t))):y(t)&&r(this.formatLanguageCode(t)),n.forEach(a=>{i.indexOf(a)<0&&r(this.formatLanguageCode(a))}),i}}const Pe={zero:0,one:1,two:2,few:3,many:4,other:5},Ie={select:e=>e===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class dt{constructor(t,s={}){this.languageUtils=t,this.options=s,this.logger=F.create("pluralResolver"),this.pluralRulesCache={}}addRule(t,s){this.rules[t]=s}clearCache(){this.pluralRulesCache={}}getRule(t,s={}){const n=Z(t==="dev"?"en":t),i=s.ordinal?"ordinal":"cardinal",r=JSON.stringify({cleanedCode:n,type:i});if(r in this.pluralRulesCache)return this.pluralRulesCache[r];let a;try{a=new Intl.PluralRules(n,{type:i})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),Ie;if(!t.match(/-|_/))return Ie;const c=this.languageUtils.getLanguagePartFromCode(t);a=this.getRule(c,s)}return this.pluralRulesCache[r]=a,a}needsPlural(t,s={}){let n=this.getRule(t,s);return n||(n=this.getRule("dev",s)),n?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(t,s,n={}){return this.getSuffixes(t,n).map(i=>`${s}${i}`)}getSuffixes(t,s={}){let n=this.getRule(t,s);return n||(n=this.getRule("dev",s)),n?n.resolvedOptions().pluralCategories.sort((i,r)=>Pe[i]-Pe[r]).map(i=>`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${i}`):[]}getSuffix(t,s,n={}){const i=this.getRule(t,n);return i?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${i.select(s)}`:(this.logger.warn(`no plural rule found for: ${t}`),this.getSuffix("dev",s,n))}}const Re=(e,t,s,n=".",i=!0)=>{let r=nt(e,t,s);return!r&&i&&y(s)&&(r=ue(e,s,n),r===void 0&&(r=ue(t,s,n))),r},le=e=>e.replace(/\$/g,"$$$$");class ft{constructor(t={}){this.logger=F.create("interpolator"),this.options=t,this.format=t?.interpolation?.format||(s=>s),this.init(t)}init(t={}){t.interpolation||(t.interpolation={escapeValue:!0});const{escape:s,escapeValue:n,useRawValueToEscape:i,prefix:r,prefixEscaped:a,suffix:o,suffixEscaped:c,formatSeparator:l,unescapeSuffix:u,unescapePrefix:h,nestingPrefix:g,nestingPrefixEscaped:d,nestingSuffix:f,nestingSuffixEscaped:b,nestingOptionsSeparator:x,maxReplaces:p,alwaysFormat:m}=t.interpolation;this.escape=s!==void 0?s:at,this.escapeValue=n!==void 0?n:!0,this.useRawValueToEscape=i!==void 0?i:!1,this.prefix=r?H(r):a||"{{",this.suffix=o?H(o):c||"}}",this.formatSeparator=l||",",this.unescapePrefix=u?"":h||"-",this.unescapeSuffix=this.unescapePrefix?"":u||"",this.nestingPrefix=g?H(g):d||H("$t("),this.nestingSuffix=f?H(f):b||H(")"),this.nestingOptionsSeparator=x||",",this.maxReplaces=p||1e3,this.alwaysFormat=m!==void 0?m:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const t=(s,n)=>s?.source===n?(s.lastIndex=0,s):new RegExp(n,"g");this.regexp=t(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=t(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=t(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(t,s,n,i){let r,a,o;const c=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=d=>{if(d.indexOf(this.formatSeparator)<0){const p=Re(s,c,d,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(p,void 0,n,{...i,...s,interpolationkey:d}):p}const f=d.split(this.formatSeparator),b=f.shift().trim(),x=f.join(this.formatSeparator).trim();return this.format(Re(s,c,b,this.options.keySeparator,this.options.ignoreJSONStructure),x,n,{...i,...s,interpolationkey:b})};this.resetRegExp();const u=i?.missingInterpolationHandler||this.options.missingInterpolationHandler,h=i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:d=>le(d)},{regex:this.regexp,safeValue:d=>this.escapeValue?le(this.escape(d)):le(d)}].forEach(d=>{for(o=0;r=d.regex.exec(t);){const f=r[1].trim();if(a=l(f),a===void 0)if(typeof u=="function"){const x=u(t,r,i);a=y(x)?x:""}else if(i&&Object.prototype.hasOwnProperty.call(i,f))a="";else if(h){a=r[0];continue}else this.logger.warn(`missed to pass in variable ${f} for interpolating ${t}`),a="";else!y(a)&&!this.useRawValueToEscape&&(a=be(a));const b=d.safeValue(a);if(t=t.replace(r[0],b),h?(d.regex.lastIndex+=a.length,d.regex.lastIndex-=r[0].length):d.regex.lastIndex=0,o++,o>=this.maxReplaces)break}}),t}nest(t,s,n={}){let i,r,a;const o=(c,l)=>{const u=this.nestingOptionsSeparator;if(c.indexOf(u)<0)return c;const h=c.split(new RegExp(`${u}[ ]*{`));let g=`{${h[1]}`;c=h[0],g=this.interpolate(g,a);const d=g.match(/'/g),f=g.match(/"/g);((d?.length??0)%2===0&&!f||f.length%2!==0)&&(g=g.replace(/'/g,'"'));try{a=JSON.parse(g),l&&(a={...l,...a})}catch(b){return this.logger.warn(`failed parsing options string in nesting for key ${c}`,b),`${c}${u}${g}`}return a.defaultValue&&a.defaultValue.indexOf(this.prefix)>-1&&delete a.defaultValue,c};for(;i=this.nestingRegexp.exec(t);){let c=[];a={...n},a=a.replace&&!y(a.replace)?a.replace:a,a.applyPostProcessor=!1,delete a.defaultValue;const l=/{.*}/.test(i[1])?i[1].lastIndexOf("}")+1:i[1].indexOf(this.formatSeparator);if(l!==-1&&(c=i[1].slice(l).split(this.formatSeparator).map(u=>u.trim()).filter(Boolean),i[1]=i[1].slice(0,l)),r=s(o.call(this,i[1].trim(),a),a),r&&i[0]===t&&!y(r))return r;y(r)||(r=be(r)),r||(this.logger.warn(`missed to resolve ${i[1]} for nesting ${t}`),r=""),c.length&&(r=c.reduce((u,h)=>this.format(u,h,n.lng,{...n,interpolationkey:i[1].trim()}),r.trim())),t=t.replace(i[0],r),this.regexp.lastIndex=0}return t}}const pt=e=>{let t=e.toLowerCase().trim();const s={};if(e.indexOf("(")>-1){const n=e.split("(");t=n[0].toLowerCase().trim();const i=n[1].substring(0,n[1].length-1);t==="currency"&&i.indexOf(":")<0?s.currency||(s.currency=i.trim()):t==="relativetime"&&i.indexOf(":")<0?s.range||(s.range=i.trim()):i.split(";").forEach(a=>{if(a){const[o,...c]=a.split(":"),l=c.join(":").trim().replace(/^'+|'+$/g,""),u=o.trim();s[u]||(s[u]=l),l==="false"&&(s[u]=!1),l==="true"&&(s[u]=!0),isNaN(l)||(s[u]=parseInt(l,10))}})}return{formatName:t,formatOptions:s}},Te=e=>{const t={};return(s,n,i)=>{let r=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(r={...r,[i.interpolationkey]:void 0});const a=n+JSON.stringify(r);let o=t[a];return o||(o=e(Z(n),i),t[a]=o),o(s)}},gt=e=>(t,s,n)=>e(Z(s),n)(t);class mt{constructor(t={}){this.logger=F.create("formatter"),this.options=t,this.init(t)}init(t,s={interpolation:{}}){this.formatSeparator=s.interpolation.formatSeparator||",";const n=s.cacheInBuiltFormats?Te:gt;this.formats={number:n((i,r)=>{const a=new Intl.NumberFormat(i,{...r});return o=>a.format(o)}),currency:n((i,r)=>{const a=new Intl.NumberFormat(i,{...r,style:"currency"});return o=>a.format(o)}),datetime:n((i,r)=>{const a=new Intl.DateTimeFormat(i,{...r});return o=>a.format(o)}),relativetime:n((i,r)=>{const a=new Intl.RelativeTimeFormat(i,{...r});return o=>a.format(o,r.range||"day")}),list:n((i,r)=>{const a=new Intl.ListFormat(i,{...r});return o=>a.format(o)})}}add(t,s){this.formats[t.toLowerCase().trim()]=s}addCached(t,s){this.formats[t.toLowerCase().trim()]=Te(s)}format(t,s,n,i={}){const r=s.split(this.formatSeparator);if(r.length>1&&r[0].indexOf("(")>1&&r[0].indexOf(")")<0&&r.find(o=>o.indexOf(")")>-1)){const o=r.findIndex(c=>c.indexOf(")")>-1);r[0]=[r[0],...r.splice(1,o)].join(this.formatSeparator)}return r.reduce((o,c)=>{const{formatName:l,formatOptions:u}=pt(c);if(this.formats[l]){let h=o;try{const g=i?.formatParams?.[i.interpolationkey]||{},d=g.locale||g.lng||i.locale||i.lng||n;h=this.formats[l](o,d,{...u,...i,...g})}catch(g){this.logger.warn(g)}return h}else this.logger.warn(`there was no format function for ${l}`);return o},t)}}const yt=(e,t)=>{e.pending[t]!==void 0&&(delete e.pending[t],e.pendingCount--)};class bt extends ae{constructor(t,s,n,i={}){super(),this.backend=t,this.store=s,this.services=n,this.languageUtils=n.languageUtils,this.options=i,this.logger=F.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=i.maxParallelReads||10,this.readingCalls=0,this.maxRetries=i.maxRetries>=0?i.maxRetries:5,this.retryTimeout=i.retryTimeout>=1?i.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(n,i.backend,i)}queueLoad(t,s,n,i){const r={},a={},o={},c={};return t.forEach(l=>{let u=!0;s.forEach(h=>{const g=`${l}|${h}`;!n.reload&&this.store.hasResourceBundle(l,h)?this.state[g]=2:this.state[g]<0||(this.state[g]===1?a[g]===void 0&&(a[g]=!0):(this.state[g]=1,u=!1,a[g]===void 0&&(a[g]=!0),r[g]===void 0&&(r[g]=!0),c[h]===void 0&&(c[h]=!0)))}),u||(o[l]=!0)}),(Object.keys(r).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(r),pending:Object.keys(a),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(c)}}loaded(t,s,n){const i=t.split("|"),r=i[0],a=i[1];s&&this.emit("failedLoading",r,a,s),!s&&n&&this.store.addResourceBundle(r,a,n,void 0,void 0,{skipCopy:!0}),this.state[t]=s?-1:2,s&&n&&(this.state[t]=0);const o={};this.queue.forEach(c=>{st(c.loaded,[r],a),yt(c,t),s&&c.errors.push(s),c.pendingCount===0&&!c.done&&(Object.keys(c.loaded).forEach(l=>{o[l]||(o[l]={});const u=c.loaded[l];u.length&&u.forEach(h=>{o[l][h]===void 0&&(o[l][h]=!0)})}),c.done=!0,c.errors.length?c.callback(c.errors):c.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(c=>!c.done)}read(t,s,n,i=0,r=this.retryTimeout,a){if(!t.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:t,ns:s,fcName:n,tried:i,wait:r,callback:a});return}this.readingCalls++;const o=(l,u)=>{if(this.readingCalls--,this.waitingReads.length>0){const h=this.waitingReads.shift();this.read(h.lng,h.ns,h.fcName,h.tried,h.wait,h.callback)}if(l&&u&&i<this.maxRetries){setTimeout(()=>{this.read.call(this,t,s,n,i+1,r*2,a)},r);return}a(l,u)},c=this.backend[n].bind(this.backend);if(c.length===2){try{const l=c(t,s);l&&typeof l.then=="function"?l.then(u=>o(null,u)).catch(o):o(null,l)}catch(l){o(l)}return}return c(t,s,o)}prepareLoading(t,s,n={},i){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();y(t)&&(t=this.languageUtils.toResolveHierarchy(t)),y(s)&&(s=[s]);const r=this.queueLoad(t,s,n,i);if(!r.toLoad.length)return r.pending.length||i(),null;r.toLoad.forEach(a=>{this.loadOne(a)})}load(t,s,n){this.prepareLoading(t,s,{},n)}reload(t,s,n){this.prepareLoading(t,s,{reload:!0},n)}loadOne(t,s=""){const n=t.split("|"),i=n[0],r=n[1];this.read(i,r,"read",void 0,void 0,(a,o)=>{a&&this.logger.warn(`${s}loading namespace ${r} for language ${i} failed`,a),!a&&o&&this.logger.log(`${s}loaded namespace ${r} for language ${i}`,o),this.loaded(t,a,o)})}saveMissing(t,s,n,i,r,a={},o=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(s)){this.logger.warn(`did not save key "${n}" as the namespace "${s}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(n==null||n==="")){if(this.backend?.create){const c={...a,isUpdate:r},l=this.backend.create.bind(this.backend);if(l.length<6)try{let u;l.length===5?u=l(t,s,n,i,c):u=l(t,s,n,i),u&&typeof u.then=="function"?u.then(h=>o(null,h)).catch(o):o(null,u)}catch(u){o(u)}else l(t,s,n,i,o,c)}!t||!t[0]||this.store.addResource(t[0],s,n,i)}}}const Ee=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if(typeof e[1]=="object"&&(t=e[1]),y(e[1])&&(t.defaultValue=e[1]),y(e[2])&&(t.tDescription=e[2]),typeof e[2]=="object"||typeof e[3]=="object"){const s=e[3]||e[2];Object.keys(s).forEach(n=>{t[n]=s[n]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),Ne=e=>(y(e.ns)&&(e.ns=[e.ns]),y(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),y(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs?.indexOf?.("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),typeof e.initImmediate=="boolean"&&(e.initAsync=e.initImmediate),e),ie=()=>{},wt=e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(s=>{typeof e[s]=="function"&&(e[s]=e[s].bind(e))})};class k extends ae{constructor(t={},s){if(super(),this.options=Ne(t),this.services={},this.logger=F,this.modules={external:[]},wt(this),s&&!this.isInitialized&&!t.isClone){if(!this.options.initAsync)return this.init(t,s),this;setTimeout(()=>{this.init(t,s)},0)}}init(t={},s){this.isInitializing=!0,typeof t=="function"&&(s=t,t={}),t.defaultNS==null&&t.ns&&(y(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const n=Ee();this.options={...n,...this.options,...Ne(t)},this.options.interpolation={...n.interpolation,...this.options.interpolation},t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const i=l=>l?typeof l=="function"?new l:l:null;if(!this.options.isClone){this.modules.logger?F.init(i(this.modules.logger),this.options):F.init(null,this.options);let l;this.modules.formatter?l=this.modules.formatter:l=mt;const u=new Ce(this.options);this.store=new ve(this.options.resources,this.options);const h=this.services;h.logger=F,h.resourceStore=this.store,h.languageUtils=u,h.pluralResolver=new dt(u,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==n.interpolation.format&&this.logger.warn("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),l&&(!this.options.interpolation.format||this.options.interpolation.format===n.interpolation.format)&&(h.formatter=i(l),h.formatter.init&&h.formatter.init(h,this.options),this.options.interpolation.format=h.formatter.format.bind(h.formatter)),h.interpolator=new ft(this.options),h.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},h.backendConnector=new bt(i(this.modules.backend),h.resourceStore,h,this.options),h.backendConnector.on("*",(d,...f)=>{this.emit(d,...f)}),this.modules.languageDetector&&(h.languageDetector=i(this.modules.languageDetector),h.languageDetector.init&&h.languageDetector.init(h,this.options.detection,this.options)),this.modules.i18nFormat&&(h.i18nFormat=i(this.modules.i18nFormat),h.i18nFormat.init&&h.i18nFormat.init(this)),this.translator=new re(this.services,this.options),this.translator.on("*",(d,...f)=>{this.emit(d,...f)}),this.modules.external.forEach(d=>{d.init&&d.init(this)})}if(this.format=this.options.interpolation.format,s||(s=ie),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const l=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);l.length>0&&l[0]!=="dev"&&(this.options.lng=l[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(l=>{this[l]=(...u)=>this.store[l](...u)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(l=>{this[l]=(...u)=>(this.store[l](...u),this)});const o=J(),c=()=>{const l=(u,h)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),o.resolve(h),s(u,h)};if(this.languages&&!this.isInitialized)return l(null,this.t.bind(this));this.changeLanguage(this.options.lng,l)};return this.options.resources||!this.options.initAsync?c():setTimeout(c,0),o}loadResources(t,s=ie){let n=s;const i=y(t)?t:this.language;if(typeof t=="function"&&(n=t),!this.options.resources||this.options.partialBundledLanguages){if(i?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return n();const r=[],a=o=>{if(!o||o==="cimode")return;this.services.languageUtils.toResolveHierarchy(o).forEach(l=>{l!=="cimode"&&r.indexOf(l)<0&&r.push(l)})};i?a(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(c=>a(c)),this.options.preload?.forEach?.(o=>a(o)),this.services.backendConnector.load(r,this.options.ns,o=>{!o&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),n(o)})}else n(null)}reloadResources(t,s,n){const i=J();return typeof t=="function"&&(n=t,t=void 0),typeof s=="function"&&(n=s,s=void 0),t||(t=this.languages),s||(s=this.options.ns),n||(n=ie),this.services.backendConnector.reload(t,s,r=>{i.resolve(),n(r)}),i}use(t){if(!t)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return t.type==="backend"&&(this.modules.backend=t),(t.type==="logger"||t.log&&t.warn&&t.error)&&(this.modules.logger=t),t.type==="languageDetector"&&(this.modules.languageDetector=t),t.type==="i18nFormat"&&(this.modules.i18nFormat=t),t.type==="postProcessor"&&We.addPostProcessor(t),t.type==="formatter"&&(this.modules.formatter=t),t.type==="3rdParty"&&this.modules.external.push(t),this}setResolvedLanguage(t){if(!(!t||!this.languages)&&!(["cimode","dev"].indexOf(t)>-1)){for(let s=0;s<this.languages.length;s++){const n=this.languages[s];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}!this.resolvedLanguage&&this.languages.indexOf(t)<0&&this.store.hasLanguageSomeTranslations(t)&&(this.resolvedLanguage=t,this.languages.unshift(t))}}changeLanguage(t,s){this.isLanguageChangingTo=t;const n=J();this.emit("languageChanging",t);const i=o=>{this.language=o,this.languages=this.services.languageUtils.toResolveHierarchy(o),this.resolvedLanguage=void 0,this.setResolvedLanguage(o)},r=(o,c)=>{c?this.isLanguageChangingTo===t&&(i(c),this.translator.changeLanguage(c),this.isLanguageChangingTo=void 0,this.emit("languageChanged",c),this.logger.log("languageChanged",c)):this.isLanguageChangingTo=void 0,n.resolve((...l)=>this.t(...l)),s&&s(o,(...l)=>this.t(...l))},a=o=>{!t&&!o&&this.services.languageDetector&&(o=[]);const c=y(o)?o:o&&o[0],l=this.store.hasLanguageSomeTranslations(c)?c:this.services.languageUtils.getBestMatchFromCodes(y(o)?[o]:o);l&&(this.language||i(l),this.translator.language||this.translator.changeLanguage(l),this.services.languageDetector?.cacheUserLanguage?.(l)),this.loadResources(l,u=>{r(u,l)})};return!t&&this.services.languageDetector&&!this.services.languageDetector.async?a(this.services.languageDetector.detect()):!t&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(a):this.services.languageDetector.detect(a):a(t),n}getFixedT(t,s,n){const i=(r,a,...o)=>{let c;typeof a!="object"?c=this.options.overloadTranslationOptionHandler([r,a].concat(o)):c={...a},c.lng=c.lng||i.lng,c.lngs=c.lngs||i.lngs,c.ns=c.ns||i.ns,c.keyPrefix!==""&&(c.keyPrefix=c.keyPrefix||n||i.keyPrefix);const l=this.options.keySeparator||".";let u;return c.keyPrefix&&Array.isArray(r)?u=r.map(h=>`${c.keyPrefix}${l}${h}`):u=c.keyPrefix?`${c.keyPrefix}${l}${r}`:r,this.t(u,c)};return y(t)?i.lng=t:i.lngs=t,i.ns=s,i.keyPrefix=n,i}t(...t){return this.translator?.translate(...t)}exists(...t){return this.translator?.exists(...t)}setDefaultNamespace(t){this.options.defaultNS=t}hasLoadedNamespace(t,s={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=s.lng||this.resolvedLanguage||this.languages[0],i=this.options?this.options.fallbackLng:!1,r=this.languages[this.languages.length-1];if(n.toLowerCase()==="cimode")return!0;const a=(o,c)=>{const l=this.services.backendConnector.state[`${o}|${c}`];return l===-1||l===0||l===2};if(s.precheck){const o=s.precheck(this,a);if(o!==void 0)return o}return!!(this.hasResourceBundle(n,t)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||a(n,t)&&(!i||a(r,t)))}loadNamespaces(t,s){const n=J();return this.options.ns?(y(t)&&(t=[t]),t.forEach(i=>{this.options.ns.indexOf(i)<0&&this.options.ns.push(i)}),this.loadResources(i=>{n.resolve(),s&&s(i)}),n):(s&&s(),Promise.resolve())}loadLanguages(t,s){const n=J();y(t)&&(t=[t]);const i=this.options.preload||[],r=t.filter(a=>i.indexOf(a)<0&&this.services.languageUtils.isSupportedCode(a));return r.length?(this.options.preload=i.concat(r),this.loadResources(a=>{n.resolve(),s&&s(a)}),n):(s&&s(),Promise.resolve())}dir(t){if(t||(t=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!t)return"rtl";try{const i=new Intl.Locale(t);if(i&&i.getTextInfo){const r=i.getTextInfo();if(r&&r.direction)return r.direction}}catch{}const s=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],n=this.services?.languageUtils||new Ce(Ee());return t.toLowerCase().indexOf("-latn")>1?"ltr":s.indexOf(n.getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(t={},s){return new k(t,s)}cloneInstance(t={},s=ie){const n=t.forkResourceStore;n&&delete t.forkResourceStore;const i={...this.options,...t,isClone:!0},r=new k(i);if((t.debug!==void 0||t.prefix!==void 0)&&(r.logger=r.logger.clone(t)),["store","services","language"].forEach(o=>{r[o]=this[o]}),r.services={...this.services},r.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},n){const o=Object.keys(this.store.data).reduce((c,l)=>(c[l]={...this.store.data[l]},c[l]=Object.keys(c[l]).reduce((u,h)=>(u[h]={...c[l][h]},u),c[l]),c),{});r.store=new ve(o,i),r.services.resourceStore=r.store}return r.translator=new re(r.services,i),r.translator.on("*",(o,...c)=>{r.emit(o,...c)}),r.init(i,s),r.translator.options=i,r.translator.backendConnector.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},r}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const C=k.createInstance();C.createInstance=k.createInstance;C.createInstance;C.dir;C.init;C.loadResources;C.reloadResources;C.use;C.changeLanguage;C.getFixedT;const D=C.t;C.exists;C.setDefaultNamespace;C.hasLoadedNamespace;C.loadNamespaces;C.loadLanguages;const{slice:St,forEach:xt}=[];function vt(e){return xt.call(St.call(arguments,1),t=>{if(t)for(const s in t)e[s]===void 0&&(e[s]=t[s])}),e}function Ot(e){return typeof e!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(s=>s.test(e))}const Ae=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,Lt=function(e,t){const n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},i=encodeURIComponent(t);let r=`${e}=${i}`;if(n.maxAge>0){const a=n.maxAge-0;if(Number.isNaN(a))throw new Error("maxAge should be a Number");r+=`; Max-Age=${Math.floor(a)}`}if(n.domain){if(!Ae.test(n.domain))throw new TypeError("option domain is invalid");r+=`; Domain=${n.domain}`}if(n.path){if(!Ae.test(n.path))throw new TypeError("option path is invalid");r+=`; Path=${n.path}`}if(n.expires){if(typeof n.expires.toUTCString!="function")throw new TypeError("option expires is invalid");r+=`; Expires=${n.expires.toUTCString()}`}if(n.httpOnly&&(r+="; HttpOnly"),n.secure&&(r+="; Secure"),n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:r+="; SameSite=Strict";break;case"lax":r+="; SameSite=Lax";break;case"strict":r+="; SameSite=Strict";break;case"none":r+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return n.partitioned&&(r+="; Partitioned"),r},Me={create(e,t,s,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};s&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+s*60*1e3)),n&&(i.domain=n),document.cookie=Lt(e,t,i)},read(e){const t=`${e}=`,s=document.cookie.split(";");for(let n=0;n<s.length;n++){let i=s[n];for(;i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(t)===0)return i.substring(t.length,i.length)}return null},remove(e,t){this.create(e,"",-1,t)}};var Ct={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&typeof document<"u")return Me.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:s,cookieMinutes:n,cookieDomain:i,cookieOptions:r}=t;s&&typeof document<"u"&&Me.create(s,e,n,i,r)}},Pt={name:"querystring",lookup(e){let{lookupQuerystring:t}=e,s;if(typeof window<"u"){let{search:n}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(n=window.location.hash.substring(window.location.hash.indexOf("?")));const r=n.substring(1).split("&");for(let a=0;a<r.length;a++){const o=r[a].indexOf("=");o>0&&r[a].substring(0,o)===t&&(s=r[a].substring(o+1))}}return s}},It={name:"hash",lookup(e){let{lookupHash:t,lookupFromHashIndex:s}=e,n;if(typeof window<"u"){const{hash:i}=window.location;if(i&&i.length>2){const r=i.substring(1);if(t){const a=r.split("&");for(let o=0;o<a.length;o++){const c=a[o].indexOf("=");c>0&&a[o].substring(0,c)===t&&(n=a[o].substring(c+1))}}if(n)return n;if(!n&&s>-1){const a=i.match(/\/([a-zA-Z-]*)/g);return Array.isArray(a)?a[typeof s=="number"?s:0]?.replace("/",""):void 0}}}return n}};let V=null;const De=()=>{if(V!==null)return V;try{if(V=typeof window<"u"&&window.localStorage!==null,!V)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch{V=!1}return V};var Rt={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&De())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:s}=t;s&&De()&&window.localStorage.setItem(s,e)}};let _=null;const Fe=()=>{if(_!==null)return _;try{if(_=typeof window<"u"&&window.sessionStorage!==null,!_)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch{_=!1}return _};var Tt={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&Fe())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:s}=t;s&&Fe()&&window.sessionStorage.setItem(s,e)}},Et={name:"navigator",lookup(e){const t=[];if(typeof navigator<"u"){const{languages:s,userLanguage:n,language:i}=navigator;if(s)for(let r=0;r<s.length;r++)t.push(s[r]);n&&t.push(n),i&&t.push(i)}return t.length>0?t:void 0}},Nt={name:"htmlTag",lookup(e){let{htmlTag:t}=e,s;const n=t||(typeof document<"u"?document.documentElement:null);return n&&typeof n.getAttribute=="function"&&(s=n.getAttribute("lang")),s}},At={name:"path",lookup(e){let{lookupFromPathIndex:t}=e;if(typeof window>"u")return;const s=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(s)?s[typeof t=="number"?t:0]?.replace("/",""):void 0}},Mt={name:"subdomain",lookup(e){let{lookupFromSubdomainIndex:t}=e;const s=typeof t=="number"?t+1:1,n=typeof window<"u"&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(n)return n[s]}};let Xe=!1;try{document.cookie,Xe=!0}catch{}const Ge=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];Xe||Ge.splice(1,1);const Dt=()=>({order:Ge,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e});class Ye{constructor(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(t,s)}init(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=t,this.options=vt(s,this.options||{},Dt()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=i=>i.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(Ct),this.addDetector(Pt),this.addDetector(Rt),this.addDetector(Tt),this.addDetector(Et),this.addDetector(Nt),this.addDetector(At),this.addDetector(Mt),this.addDetector(It)}addDetector(t){return this.detectors[t.name]=t,this}detect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,s=[];return t.forEach(n=>{if(this.detectors[n]){let i=this.detectors[n].lookup(this.options);i&&typeof i=="string"&&(i=[i]),i&&(s=s.concat(i))}}),s=s.filter(n=>n!=null&&!Ot(n)).map(n=>this.options.convertDetectedLanguage(n)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?s:s.length>0?s[0]:null}cacheUserLanguage(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;s&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(t)>-1||s.forEach(n=>{this.detectors[n]&&this.detectors[n].cacheUserLanguage(t,this.options)}))}}Ye.type="languageDetector";function Ft(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ce,$e;function $t(){if($e)return ce;$e=1;var e=function(m){return t(m)&&!s(m)};function t(p){return!!p&&typeof p=="object"}function s(p){var m=Object.prototype.toString.call(p);return m==="[object RegExp]"||m==="[object Date]"||r(p)}var n=typeof Symbol=="function"&&Symbol.for,i=n?Symbol.for("react.element"):60103;function r(p){return p.$$typeof===i}function a(p){return Array.isArray(p)?[]:{}}function o(p,m){return m.clone!==!1&&m.isMergeableObject(p)?b(a(p),p,m):p}function c(p,m,S){return p.concat(m).map(function(O){return o(O,S)})}function l(p,m){if(!m.customMerge)return b;var S=m.customMerge(p);return typeof S=="function"?S:b}function u(p){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(p).filter(function(m){return Object.propertyIsEnumerable.call(p,m)}):[]}function h(p){return Object.keys(p).concat(u(p))}function g(p,m){try{return m in p}catch{return!1}}function d(p,m){return g(p,m)&&!(Object.hasOwnProperty.call(p,m)&&Object.propertyIsEnumerable.call(p,m))}function f(p,m,S){var O={};return S.isMergeableObject(p)&&h(p).forEach(function(v){O[v]=o(p[v],S)}),h(m).forEach(function(v){d(p,v)||(g(p,v)&&S.isMergeableObject(m[v])?O[v]=l(v,S)(p[v],m[v],S):O[v]=o(m[v],S))}),O}function b(p,m,S){S=S||{},S.arrayMerge=S.arrayMerge||c,S.isMergeableObject=S.isMergeableObject||e,S.cloneUnlessOtherwiseSpecified=o;var O=Array.isArray(m),v=Array.isArray(p),E=O===v;return E?O?S.arrayMerge(p,m,S):f(p,m,S):o(m,S)}b.all=function(m,S){if(!Array.isArray(m))throw new Error("first argument should be an array");return m.reduce(function(O,v){return b(O,v,S)},{})};var x=b;return ce=x,ce}var jt=$t();const Ut=Ft(jt);class B{static isTouchDevice(t){return t=t||window.navigator.userAgent,"ontouchstart"in window||navigator.maxTouchPoints>0||/ios|iphone|ipad|ipod|android|windows phone/gi.test(t)}static isLandscapeMode(){return window.innerWidth>window.innerHeight}static setTimeoutAsync(t){return new Promise(s=>{setTimeout(()=>{s()},t)})}static mergeDeep(t,...s){return Ut.all([t,...s],{arrayMerge:(n,i)=>i})}}class Bt{constructor(t,s){this.k=t,this.config={volume:1,fadeOutDuration:1.5,...s}}config;currentMusic;currentMusicName;isFirstPlay=!0;loadMusic(t,s){this.k.loadMusic(t,s)}playMusic(t,s){(async()=>this.currentMusic&&!this.currentMusic.paused&&this.currentMusicName===t||(this.isFirstPlay&&(this.isFirstPlay=!1,await B.setTimeoutAsync(100)),await this.fadeOutCurrentMusic(s?.fadeOutDuration),this.currentMusic=this.k.play(t,{loop:!0,volume:this.config.volume,...s}),this.currentMusicName=t))()}setVolume(t){this.config.volume=t,this.currentMusic&&(this.currentMusic.volume=t)}stopMusic(t){this.fadeOutCurrentMusic(t).then(()=>{this.currentMusic=void 0,this.currentMusicName=void 0})}pauseMusic(){this.currentMusic&&(this.currentMusic.paused=!0)}resumeMusic(){this.currentMusic&&(this.currentMusic.paused=!1)}async fadeOutCurrentMusic(t){t=t??this.config.fadeOutDuration+1e-6,this.currentMusic&&!this.currentMusic.paused&&(await this.k.tween(this.currentMusic.volume,0,t,s=>{this.currentMusic&&(this.currentMusic.volume=s)}),this.currentMusic.stop())}}class Kt{constructor(t,s="fade",n=.6){this.k=t,this.defaultDuration=n,this.fadeOverlay=t.add(["fade-overlay",t.layer(s),t.rect(t.width(),t.height()),t.color(0,0,0),t.pos(0,0),t.fixed(),t.anchor("topleft"),t.opacity(0),t.stay()])}fadeOverlay;async showOverlay(t=this.defaultDuration){return this.fadeOverlay.opacity=0,this.fadeOverlay.hidden=!1,this.fadeTo(0,1,t)}async hideOverlay(t=this.defaultDuration){await this.fadeTo(1,0,t),this.fadeOverlay.hidden=!1}async fadeTo(t,s,n=1){return new Promise(i=>{let r=0;const a=this.fadeOverlay.onUpdate(()=>{r+=this.k.dt(),this.fadeOverlay.opacity=this.k.lerp(t,s,r/n),r>=n&&(this.fadeOverlay.opacity=s,a.cancel(),i())})})}}class Ht{_state;localStorageKey="gameState";isUpdating=!1;subscribersOnUpdate=[];get state(){return this._state}constructor(){const t=localStorage.getItem(this.localStorageKey);try{if(t){const s=this.getClearState(),n=JSON.parse(t);this._state=B.mergeDeep(this.getClearState(),{version:s.version,persistent:n,temp:this.getTempStateFromPersistentState(n)})}}catch{}this._state||this.reset()}update(t,s){if(this.isUpdating)throw new Error("Cannot call update() inside another update() call");this.isUpdating=!0,this._state.temp.player.health&&t.temp?.player?.health===0&&(t=B.mergeDeep(t,{persistent:{player:{deaths:this._state.persistent.player.deaths+1}},temp:{player:{tempInventory:[]}}})),this._state=B.mergeDeep(this._state,t),this.subscribersOnUpdate.forEach(n=>n(this._state)),t.persistent&&!s&&this.save(),this.isUpdating=!1}save(){localStorage.setItem(this.localStorageKey,JSON.stringify(this._state.persistent))}reset(){localStorage.removeItem(this.localStorageKey),this._state=this.getClearState(),this.update({})}prepareForNewScene(){this.update({persistent:{player:{inventory:[...this._state.persistent.player.inventory,...this._state.temp.player.tempInventory.filter(t=>!this._state.persistent.player.inventory.includes(t))]}},temp:{...this.getTempStateFromPersistentState(this._state.persistent)}})}getIsPlayerHasItem(t){return this._state.persistent.player.inventory.includes(t)||this._state.temp.player.tempInventory.includes(t)}addToPersistentInventory(t){this.getIsPlayerHasItem(t)||this.update({persistent:{player:{inventory:[...this._state.persistent.player.inventory,t]}}})}addToTempInventory(t){this.getIsPlayerHasItem(t)||this.update({temp:{player:{tempInventory:[...this._state.temp.player.tempInventory,t]}}})}moveTempItemsToPersistentInventory(){const t=this._state.temp.player.tempInventory.filter(s=>!this._state.persistent.player.inventory.includes(s));t.length!==0&&this.update({persistent:{player:{inventory:[...this._state.persistent.player.inventory,...t]}},temp:{player:{tempInventory:[]}}})}onUpdate(t){return this.subscribersOnUpdate.push(t),{cancel:()=>{this.subscribersOnUpdate=this.subscribersOnUpdate.filter(s=>s!==t)}}}getTempStateFromPersistentState(t){return{player:{health:t.player.hasLuckyCharm?2:1,tempInventory:[]}}}getClearState(){const t={currentLevel:void 0,player:{deaths:0,hasLuckyCharm:!1,inventory:[]},oldBobr:{isIntroSaid:!1}};return{version:1,persistent:t,temp:this.getTempStateFromPersistentState(t)}}}async function de(e,t){fe.hide(),await pe.showOverlay(.3),e.go(t)}function Vt(e,t,s,n){const i=e.add([e.sprite(t,{tiled:!0,width:e.width()*10}),e.layer("bg"),e.pos(0,0),e.scale(1.5),e.fixed(),e.anchor("center")]);return i.onUpdate(()=>{i.pos.x=e.width()/2+-e.getCamPos().x/50,i.pos.y=e.height()/2+n?.offsetY-e.getCamPos().y/25}),i}const Je="interactable-comp";function z(e){return{id:Je,interact:e,add(){this.tag("interactable")},destroy(){this.untag("interactable")}}}z.id=Je;const qe={async loadResources(e){e.loadSound("player-take-item","sounds/bobr-take-item.ogg")},spawn(e,t,s){const n=e.add(["map-item",e.pos(t),e.sprite(s.sprite,{flipX:s.flipX||!1}),e.anchor("bot"),e.area(),e.scale(),e.animate(),e.offscreen({hide:!0}),...s?.interact?[z(async r=>{await s.interact?.(r),s.shouldPickupOnInteract!==!1&&(e.play("player-take-item"),n.animatePickupAndDestroy(r))})]:[],{animatePickupAndDestroy:i}]);s.levitate&&(n.use(e.animate({relative:!0})),n.animate("pos",[e.vec2(0,-2),e.vec2(0,-6)],{duration:1,easings:[e.easings.easeInOutCubic],direction:"ping-pong"}));function i(r){(async()=>{const a=n.pos;n.unanimate("pos"),await e.tween(0,1,.3,o=>{n.scale=e.vec2(e.lerp(1,.5,o));const c=e.vec2((a.x+r.pos.x)/2,Math.min(a.y,r.pos.y)-30),l=e.lerp(a,c,o),u=e.lerp(c,r.pos,o);n.pos=e.lerp(l,u,o)}),n.destroy()})()}return n}};function je(e,t){if(!L.getIsPlayerHasItem(t.itemId))return qe.spawn(e,t.worldPos,{sprite:t.sprite,levitate:!0,interact:async s=>{L.addToTempInventory(t.itemId)},shouldPickupOnInteract:!0})}const P={friction:.2},_t={maxRunSpeed:200,accelGround:200,accelAir:150,decelGround:500,decelAir:300,jumpForce:400,minRunAnimSpeed:1,maxRunAnimSpeed:2,attackPower:1},Ue={async loadResources(e){await e.loadSprite("player","sprites/characters/bobr.gif",{sliceX:5,sliceY:4,anims:{idle:{from:0,to:1,speed:3,loop:!0},walk:{from:5,to:8,speed:10,loop:!0},jump:{from:10,to:10},fall:{from:10,to:10},attack:{from:15,to:19,speed:20,loop:!1}}}),await e.loadSprite("player-hit-wave","sprites/characters/bobr-hit-wave.png"),await e.loadSound("player-attack","sounds/bobr-attack.mp3"),await e.loadSound("player-take-item","sounds/bobr-take-item.ogg"),await e.loadSound("player-take-key","sounds/bobr-take-key.ogg")},spawn(e,t=e.vec2(100,100),s){const n={..._t,...s},i=e.add(["player",e.sprite("player",{anim:"idle"}),e.pos(t),e.area({shape:new e.Rect(e.vec2(1,0),20,31),...P}),e.body(),e.anchor("bot"),e.opacity(1),e.state("IDLE",["IDLE","WALK","JUMP","FALL","ATTACK","INTERACT"]),e.timer(),{vx:0,config:n,waitForActionButton:u,setCamFollowPlayer:h}]);let r,a;function o(){i.jump(n.jumpForce),i.enterState("JUMP")}function c(){return!!a}function l(d,f){i.getCurAnim()?.name!==d&&i.play(d,{onEnd:f})}function u(){return new Promise(d=>{i.onButtonPress("action",()=>{d()})})}function h(d,f){const b=d.levelWidth()-d.tileWidth()/2,x=d.levelHeight()-d.tileHeight()/2,p=e.height(),m=(f.leftTilesPadding??0)*d.tileWidth(),S=(f.rightTilesPadding??0)*d.tileWidth(),O=(f.topTilesPadding??0)*d.tileHeight(),v=(f.bottomTilesPadding??0)*d.tileHeight(),E=d.pos.x+m+e.width()/2,U=d.pos.x+b-S-e.width()/2,ee=d.pos.y+O+e.height()/2,N=d.pos.y+x-v-e.height()/2;i.onUpdate(()=>{if(!i)return;const R=e.clamp(i.pos.x,E,U),oe=e.clamp(i.pos.y-p/4,ee,N);e.setCamPos(R,oe)})}i.onButtonPress("jump",()=>{i.state!=="INTERACT"&&i.isGrounded()&&o()}),i.onButtonPress("action",()=>{if(i.state==="ATTACK"||i.state==="INTERACT")return;let d=!0,f=!1;const b=i.add(["player.interaction-hitbox",e.pos(i.flipX?-14:14,0),e.area({shape:new e.Rect(e.vec2(1,0),16,i.height)}),e.rect(20,20,{fill:!1}),e.anchor("bot"),e.opacity(0)]);b.onCollide("interactable",async x=>{f||(f=!0,i.enterState("INTERACT"),await x.interact(i),i.enterState("IDLE"))}),b.onUpdate(()=>{d?d=!1:(f||i.enterState("ATTACK"),i.remove(b))})}),i.onFixedUpdate(()=>{const d=e.dt(),f=i.isGrounded();let b=0;if(i.state!=="INTERACT"&&(e.isButtonDown("left")?b=-1:e.isButtonDown("right")&&(b=1)),i.friction=f?P.friction:0,b!==0){let x=f?n.accelGround:n.accelAir;Math.sign(b)!==Math.sign(i.vx)&&(x+=f?n.decelGround:n.decelAir),i.vx=zt(i.vx,b*n.maxRunSpeed,x*d)}else{const x=f?n.decelGround:n.decelAir,p=Math.max(0,Math.abs(i.vx)-x*d);i.vx=p*Math.sign(i.vx)}i.move(i.vx,0),i.flipX=b<0?!0:b>0?!1:i.flipX,i.area.scale.x=i.flipX?-1:1,i.state==="ATTACK"?i.getCurAnim()?.frameIndex===2&&(r||(r=i.add(["player.hitbox",e.pos(e.vec2(i.flipX?-16:16,0)),e.area(),e.sprite("player-hit-wave",{flipX:i.flipX}),e.anchor("bot"),e.opacity(1),e.lifespan(0,{fade:.15})]),r.onCollide("enemy",x=>{x.registerHit(i),e.play("player-attack")}),r.onDestroy(()=>{r=void 0}))):i.state==="INTERACT"||(f?Math.abs(i.vx)>5?i.enterState("WALK"):i.enterState("IDLE"):i.vel.y<0?i.enterState("JUMP"):i.enterState("FALL")),c()?i.opacity=Math.abs(Math.sin(e.time()*20))*.5+.5:i.opacity=1}),i.onStateEnter("IDLE",()=>{l("idle")}),i.onStateEnter("INTERACT",()=>{l("idle")}),i.onStateUpdate("WALK",()=>{l("walk");const d=e.clamp(Math.abs(i.vx)/n.maxRunSpeed,0,1);i.animSpeed=e.lerp(n.minRunAnimSpeed,n.maxRunAnimSpeed,d)}),i.onStateEnter("JUMP",()=>{l("jump")}),i.onStateEnter("FALL",()=>{l("fall")}),i.onStateEnter("ATTACK",()=>{l("attack",()=>{i.enterState("IDLE")}),i.animSpeed=1}),i.onCollideUpdate("enemy",d=>{!c()&&i.state!=="ATTACK"&&!d.dead&&d.config.attackPower&&(L.update({temp:{player:{health:Math.max(0,L.state.temp.player.health-d.config.attackPower)}}}),i.applyImpulse(e.vec2(Math.sign(i.pos.x-d.pos.x)*150,-230)),e.shake(4),e.play("player-attack"),a?.cancel(),a=i.wait(1),a.onEnd(()=>{a=void 0}))});const g=L.onUpdate(d=>{d.temp.player.health<=0&&de(e,e.getSceneName()).then()});return i.onDestroy(()=>{a?.cancel(),a=void 0,g.cancel()}),i}};function zt(e,t,s){const n=t-e;return Math.abs(n)<=s?t:e+Math.sign(t)*s}async function Wt(e,t,s){let n,i=t.split(`
`);await Ue.loadResources(e),await s.preloadResources(e),e.setGravity(0);const r=e.addLevel(i,{pos:e.vec2(0,0),tileWidth:s.tileWidth,tileHeight:s.tileHeight,tiles:{},wildcardTile:(l,u)=>{if(l.trim()){if(l==="P"){n=u.scale(e.vec2(s.tileWidth,s.tileHeight));return}if(s.tiles[l])return s.tiles[l](u,u.scale(e.vec2(s.tileWidth,s.tileHeight)),()=>c(u.x,u.y),o)||void 0}}}),a=Ue.spawn(e,n);e.setGravity(1e3);function o(l,u){return u<0||u>=i.length||l<0||l>=i[u].length?" ":i[u][l]}function c(l,u){return{top:o(l,u-1),bottom:o(l,u+1),left:o(l-1,u),right:o(l+1,u),topLeft:o(l-1,u-1),topRight:o(l+1,u-1),bottomLeft:o(l-1,u+1),bottomRight:o(l+1,u+1)}}return{level:r,player:a}}const Be={async loadResources(e){await e.loadSprite("bumblebee","sprites/enemies/bumblebee.gif",{sliceX:2,sliceY:1,anims:{idle:{from:0,to:1,speed:20,loop:!0},fly:{from:0,to:1,speed:20,loop:!0}}})},spawn(e,t=e.vec2(200,80),s){const n={health:1,attackPower:1,speedX:70,flyDuration:3,...s};let i=-1,r=0,a=!0;const o=e.add(["bumblebee","enemy",e.sprite("bumblebee",{anim:"idle"}),e.state("FLY",["IDLE","FLY"]),e.health(n.health,n.health),e.timer(),e.pos(t),e.area({...P,collisionIgnore:["obstacle"]}),e.body({gravityScale:0}),e.anchor("center"),e.offscreen({pause:!0,unpause:!0,hide:!0}),{registerHit:l=>{o.applyImpulse(e.vec2(Math.sign(o.pos.x-l.pos.x)*180,-120)),o.hp-=l.config.attackPower},config:n}]);function c(l,u){return Math.sin(u*l)*-30}return o.onStateEnter("FLY",async()=>{o.flipX=i<0,o.play("fly"),await o.wait(n.flyDuration*(a?.5:1)),a=!1,o.enterState("IDLE")}),o.onStateUpdate("FLY",()=>{r+=e.dt(),o.move(n.speedX*i,c(6,r))}),o.onStateEnter("IDLE",async()=>{o.play("idle"),await o.wait(1.5),o.dead||(i*=-1,o.enterState("FLY"))}),o.onStateUpdate("IDLE",()=>{r+=e.dt(),o.move(0,c(12,r))}),o.onDeath(()=>{o.paused=!0,o.gravityScale=1,o.collisionIgnore=["*"],o.use(e.rotate(o.flipX?15:-15))}),o.onExitScreen(()=>{o.dead&&o.destroy()}),o}},Ke={async loadResources(e){await e.loadSprite("gopher","sprites/enemies/gopher.gif",{sliceX:4,sliceY:1,anims:{idle:{from:0,to:0,loop:!1},walk:{from:0,to:3,speed:10,loop:!0}}})},spawn(e,t=e.vec2(100,100),s){const n={health:2,attackPower:1,speedX:50,...s};let i=-1,r=!0;const a=e.add(["gopher","enemy",e.sprite("gopher",{anim:"idle"}),e.state("WALK",["IDLE","WALK"]),e.health(n.health,n.health),e.timer(),e.pos(t),e.area(P),e.body(),e.anchor("bot"),e.offscreen({pause:!0,unpause:!0,hide:!0}),{registerHit:o=>{a.applyImpulse(e.vec2(Math.sign(a.pos.x-o.pos.x)*100,-200)),a.hp-=o.config.attackPower},config:n}]);return a.onStateEnter("WALK",async()=>{a.flipX=i<0,a.play("walk"),await a.wait(4*(r?.5:1)),r=!1,a.enterState("IDLE")}),a.onStateUpdate("WALK",()=>{a.isGrounded()&&a.move(n.speedX*i,0)}),a.onStateEnter("IDLE",async()=>{a.play("idle"),await a.wait(2),a.dead||(i*=-1,a.enterState("WALK"))}),a.onDeath(()=>{a.paused=!0,a.collisionIgnore=["*"],a.use(e.rotate(a.flipX?10:-10))}),a.onExitScreen(()=>{a.dead&&a.destroy()}),a}};function Xt(e,t,s,n){n={speed:.05,...n};const i=e.width()/2,r=5;let a="",o=0,c=0,l=!1;const u=e.add([e.rect(i,16,{radius:4}),e.pos(g()),e.color(0,0,0),e.opacity(.6),e.anchor("bot"),e.layer("hud")]),h=u.add([e.pos(e.vec2(0,-r)),e.text("",{size:8,width:i-r*2,font:"pixel",lineSpacing:2}),e.anchor("bot")]);h.onUpdate(()=>{u.height=h.height+r*2,u.pos=g(),l||(c+=e.dt(),c>=n.speed&&(c=0,a+=s[o],h.text=a,o++,o>=s.length&&(l=!0)))});function g(){const d=t.pos.add(0,-t.height),f=e.getCamPos(),b=e.width(),x=e.clamp(d.x,f.x-b/2+i/2,f.x+b-i/2),p=d.y;return e.vec2(x,p)}return u}function W(e,t,s,n,i){return new Promise(r=>{let a=0;async function o(){if(a<n.length){const c=Xt(e,t,n[a],i);await s.waitForActionButton(),c.destroy(),a++,o().then()}else r()}o().then()})}const He={async loadResources(e){await e.loadSprite("home-outside","sprites/home/home-outside.png"),await e.loadSprite("home-inside","sprites/home/home-inside.png"),await e.loadSprite("home-fence","sprites/home/home-fence.png"),await e.loadSprite("home-kitchen-table","sprites/home/home-kitchen-table.png"),await e.loadSprite("home-kitchen-chair","sprites/home/home-kitchen-chair.png")},spawn(e,t,s){const n={isEveningTime:!1,...s};let i=!0;const r=e.add(["home-container",e.pos(t),e.anchor("botleft"),e.offscreen({hide:!0,pause:!0,unpause:!0,distance:300}),e.state("OUTSIDE",["INSIDE","OUTSIDE"])]);r.add([e.sprite("home-fence"),e.pos(206,0),e.anchor("botleft")]),r.add(["home-outside",e.sprite("home-inside"),e.anchor("botleft")]);const a=r.add(["home-kitchen-chair-left",e.sprite("home-kitchen-chair"),e.anchor("bot"),e.pos(64,0),e.area(),z(async d=>{await W(e,d,d,[D(e.choose(["home.kitchenChairRepeat1"]))])})]);a.hidden=!0;const o=r.add(["home-kitchen-table",e.sprite("home-kitchen-table"),e.anchor("bot"),e.pos(92,0),e.area(),e.z(1),z(async d=>{await W(e,d,d,[D(e.choose(["home.kitchenTableRepeat1","home.kitchenTableRepeat2","home.kitchenTableRepeat3"]))])})]);o.hidden=!0;const c=r.add(["home-kitchen-chair-right",e.sprite("home-kitchen-chair",{flipX:!0}),e.anchor("bot"),e.pos(120,0),e.area(),z(async d=>{await W(e,d,d,[D(e.choose(["home.kitchenChairRepeat1"]))])})]);c.hidden=!0;const l=r.add(["home-outside",e.sprite("home-outside"),e.anchor("botleft"),e.animate({relative:!0}),e.z(2)]);Gt(e,r);function u(){const d=L.getIsPlayerHasItem("home-kitchen-table"),f=L.getIsPlayerHasItem("home-kitchen-chair-left"),b=L.getIsPlayerHasItem("home-kitchen-chair-right");o.hidden=!d,a.hidden=!f,c.hidden=!b}return r.onStateEnter("OUTSIDE",()=>{if(i){i=!1;return}l.unanimateAll(),l.animation.seek(0),l.animate("opacity",[0,1],{duration:1,loops:1}),Q.playMusic("start-location")}),r.onStateEnter("INSIDE",()=>{L.moveTempItemsToPersistentInventory(),u(),l.unanimateAll(),l.animation.seek(0),l.animate("opacity",[1,0],{duration:1,loops:1}),n.isEveningTime&&Q.playMusic("home")}),r.add(["home-entrance",e.rect(20,38,{fill:!1}),e.pos(125,0),e.anchor("botleft"),e.area()]).onCollide("player",()=>{r.state!=="INSIDE"&&r.enterState("INSIDE")}),r.add(["home-exit",e.rect(20,38,{fill:!1}),e.pos(214,0),e.anchor("botleft"),e.area()]).onCollide("player",()=>{r.state!=="OUTSIDE"&&r.enterState("OUTSIDE")}),r}};function Gt(e,t){t.add(["obstacle",e.rect(14,200,{fill:!1}),e.pos(193,-42),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),t.add(["obstacle",e.rect(40,12,{fill:!1}),e.pos(156,-42),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),t.add(["obstacle",e.rect(10,220,{fill:!1}),e.pos(-10,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),t.add(["obstacle",e.polygon([e.vec2(178,-54),e.vec2(115,-193),e.vec2(125,-193),e.vec2(188,-54)],{fill:!1}),e.pos(-5,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),t.add(["obstacle",e.polygon([e.vec2(115,-193),e.vec2(50,-221),e.vec2(50,-230),e.vec2(125,-193)],{fill:!1}),e.pos(-5,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),t.add(["obstacle",e.polygon([e.vec2(50,-221),e.vec2(0,-221),e.vec2(0,-230),e.vec2(50,-230)],{fill:!1}),e.pos(-5,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),t.add(["obstacle",e.rect(120,7,{fill:!1}),e.pos(57,-58),e.anchor("botleft"),e.area(P),e.body({isStatic:!0})]),t.add(["obstacle",e.rect(95,7,{fill:!1}),e.pos(0,-122),e.anchor("botleft"),e.area(P),e.body({isStatic:!0})])}const Ve=Yt(),w=et({global:!1,width:Ve.width,height:Ve.height,background:"#000000",letterbox:!0,pixelDensity:2,debug:!0,debugKey:"`",buttons:{left:{keyboard:["left","a"],gamepad:["dpad-left"]},right:{keyboard:["right","d"],gamepad:["dpad-right"]},jump:{keyboard:["space","up","w","k"],gamepad:["south"]},action:{keyboard:["j","z"],gamepad:["east"]}}});function Yt(){let e=Math.min(window.innerWidth,400);e%2!==0&&(e-=1);let t=Math.floor(e/(window.innerWidth/window.innerHeight));return t%2!==0&&(t-=1),{width:e,height:t}}const Qe="info-icon-comp";function he(e=0){let t;return{id:Qe,add(){w.loadSprite("info-icon","sprites/icons/info.png"),t=this.add([w.sprite("info-icon"),w.pos(e,-this.height-2),w.anchor("bot"),w.animate({relative:!0})]),t.animate("pos",[w.vec2(0,0),w.vec2(0,-2),w.vec2(0,0),w.vec2(0,-2),w.vec2(0,0),w.vec2(0,0),w.vec2(0,0)],{duration:1,direction:"forward"})},destroy(){t?.destroy(),t=void 0}}}he.id=Qe;const _e={async loadResources(e){await e.loadSprite("old-bobr","sprites/characters/old-bobr.gif",{sliceX:2,sliceY:1,anims:{idle:{from:0,to:1,speed:1.5,loop:!0}}}),await e.loadSound("old-bobr-kurwa-1","sounds/old-bobr-kurwa-1.ogg"),await e.loadSound("old-bobr-kurwa-2","sounds/old-bobr-kurwa-2.ogg")},spawn(e,t=e.vec2(100,100),s){const n={...s},i=e.add(["old-bobr",e.sprite("old-bobr",{anim:"idle"}),e.state("IDLE",["IDLE","INTERACTING"]),e.timer(),e.pos(t),e.area({...P,collisionIgnore:["player","enemy"]}),e.body(),e.anchor("bot"),e.offscreen({pause:!0,unpause:!0,hide:!0}),z(r),{config:n,shouldShowInfoIcon:a}]);async function r(u){const h=c();h&&(i.enterState("INTERACTING"),e.play(e.choose(["old-bobr-kurwa-1","old-bobr-kurwa-2"])),i.flipX=i.pos.x>u.pos.x,await l(h,u),i.enterState("IDLE"))}function a(){if(i.state==="INTERACTING")return!1;switch(c()){case"SAY_INTRO_REPEAT":return!1;default:return!0}}function o(){a()?i.use(he(6*(i.flipX?-1:1))):i.unuse(he.id)}function c(){const u=L.state;return u.persistent.oldBobr.isIntroSaid?u.persistent.player.deaths>=1&&!u.persistent.player.hasLuckyCharm?"GIVE_LUCKY_CHARM":"SAY_INTRO_REPEAT":"SAY_INTRO"}async function l(u,h){switch(L.state,u){case"SAY_INTRO":await W(e,i,h,[D("oldBobr.intro1"),D("oldBobr.intro2")]),L.update({persistent:{oldBobr:{isIntroSaid:!0}}});break;case"SAY_INTRO_REPEAT":await W(e,i,h,[D(e.choose(["oldBobr.introRepeat1","oldBobr.introRepeat2","oldBobr.introRepeat3"]))]);break;case"GIVE_LUCKY_CHARM":await W(e,i,h,[D("oldBobr.giveLuckyCharm1"),D("oldBobr.giveLuckyCharm2")]),L.update({persistent:{player:{hasLuckyCharm:!0}},temp:{player:{health:2}}});break}}return i.onStateEnter("IDLE",async()=>{i.play("idle"),o()}),i.onStateEnter("INTERACTING",async()=>{o()}),i.onEnterScreen(()=>{o()}),i}},Jt=`                                                                                        .
                                                                                        .
                                                                                        .
                                                           ,2,               ,, ,tG,, ,E.
                         F 1,,                             ---             ---==========.
                           ---                                  , ,Gt,,,      ...........
                              ,t,F             ,tF,,,r         ---------      ...........
          P     ,,,           -----        F ---------          F             ...........
H      ,B,  ,,//===\\\\,,t,,,   , G , ,,  t   ,  ,,, ,G, ,,, ,, , ,, ,  ,G,,t //...........
==============.......=======================================================.............
.........................................................................................
.........................................................................................`,X=async e=>{const{player:t,level:s}=await Wt(e,Jt,{preloadResources:async n=>{await Promise.all([n.loadSprite("tile-ground","sprites/tiles/ground.png"),n.loadSprite("tile-grass-ground","sprites/tiles/grass-ground.png"),n.loadSprite("tile-grass-ground-air","sprites/tiles/grass-ground-air.png"),n.loadSprite("tile-grass-ground-air-left","sprites/tiles/grass-ground-air-left.png"),n.loadSprite("tile-grass-ground-air-right","sprites/tiles/grass-ground-air-right.png"),n.loadSprite("tile-grass-ground-inclined-left-1","sprites/tiles/grass-ground-inclined-left-1.png"),n.loadSprite("tile-grass-ground-inclined-left-2","sprites/tiles/grass-ground-inclined-left-2.png"),n.loadSprite("tile-grass-ground-inclined-left-3","sprites/tiles/grass-ground-inclined-left-3.png"),n.loadSprite("tile-grass-1","sprites/tiles/grass-1.png"),n.loadSprite("tile-grass-2","sprites/tiles/grass-2.png"),n.loadSprite("tile-grass-3","sprites/tiles/grass-3.png"),n.loadSprite("tile-tree-1","sprites/tiles/tree-1.png"),n.loadSprite("tile-tree-2","sprites/tiles/tree-2.png"),n.loadSprite("rock","sprites/tiles/rock.png"),Ke.loadResources(n),Be.loadResources(n),He.loadResources(n),_e.loadResources(n),qe.loadResources(n)]),Q.loadMusic("home","music/home.mp3"),Q.loadMusic("start-location","music/start-location.mp3")},tileWidth:32,tileHeight:32,tiles:{"=":()=>[e.sprite("tile-grass-ground"),e.area(P),e.body({isStatic:!0}),e.anchor("bot"),e.offscreen({hide:!0})],"-":(n,i,r)=>{const a=r();return["obstacle",e.sprite(a.left===" "?"tile-grass-ground-air-left":a.right===" "?"tile-grass-ground-air-right":"tile-grass-ground-air"),e.area({...P,shape:new e.Rect(e.vec2(0,-8),32,24)}),e.body({isStatic:!0}),e.anchor("bot"),e.offscreen({hide:!0})]},".":(n,i,r)=>{const a=r();if(a.topRight==="/")return["obstacle",e.sprite("tile-grass-ground-inclined-left-1"),e.anchor("bot"),e.offscreen({hide:!0})];if(a.topLeft==="\\")return["obstacle",e.sprite("tile-grass-ground-inclined-left-1",{flipX:!0}),e.anchor("bot"),e.offscreen({hide:!0})];const o=a.left===" "||a.right===" "||a.bottom===" "||a.left==="";return["obstacle",e.sprite("tile-ground"),...o?[e.area(P),e.body({isStatic:!0})]:[],e.anchor("bot"),e.offscreen({hide:!0})]},",":()=>[e.sprite(e.choose(["tile-grass-1","tile-grass-2","tile-grass-3"]),{flipX:e.choose([!0,!1])}),e.z(e.choose([1,-1])),e.anchor("bot"),e.offscreen({hide:!0})],"/":(n,i,r)=>r().left==="/"?["obstacle",e.sprite("tile-grass-ground-inclined-left-3"),e.area({...P,shape:new e.Polygon([e.vec2(-16,0),e.vec2(-16,-16),e.vec2(16,-32),e.vec2(16,0)])}),e.body({isStatic:!0}),e.anchor("bot"),e.offscreen({hide:!0})]:["obstacle",e.sprite("tile-grass-ground-inclined-left-2"),e.area({...P,shape:new e.Polygon([e.vec2(-16,0),e.vec2(16,-16),e.vec2(16,0),e.vec2(-16,16)])}),e.body({isStatic:!0}),e.anchor("bot"),e.offscreen({hide:!0})],"\\":(n,i,r)=>r().right==="\\"?["obstacle",e.sprite("tile-grass-ground-inclined-left-3",{flipX:!0}),e.area({...P,shape:new e.Polygon([e.vec2(16,0),e.vec2(16,-16),e.vec2(-16,-32),e.vec2(-16,0)])}),e.body({isStatic:!0}),e.anchor("bot"),e.offscreen({hide:!0})]:["obstacle",e.sprite("tile-grass-ground-inclined-left-2",{flipX:!0}),e.area({...P,shape:new e.Polygon([e.vec2(16,0),e.vec2(-16,-16),e.vec2(-16,0),e.vec2(16,16)])}),e.body({isStatic:!0}),e.anchor("bot"),e.offscreen({hide:!0})],t:()=>[e.sprite(e.choose(["tile-tree-1","tile-tree-2"]),{flipX:e.choose([!0,!1])}),e.z(e.choose([1,-1])),e.anchor("bot"),e.offscreen({hide:!0})],r:()=>["obstacle",e.sprite("rock",{flipX:e.choose([!0,!1])}),e.anchor("bot"),e.area(P),e.body({mass:2}),e.offscreen({hide:!0})],G:(n,i)=>{Ke.spawn(e,i)},F:(n,i)=>{Be.spawn(e,i)},H:(n,i)=>{He.spawn(e,i)},B:(n,i)=>{_e.spawn(e,i)},1:(n,i)=>{je(e,{itemId:"home-kitchen-chair-left",sprite:"home-kitchen-chair",worldPos:i})},2:(n,i)=>{je(e,{itemId:"home-kitchen-table",sprite:"home-kitchen-table",worldPos:i})}}});await e.loadSprite("bg-home-day","sprites/backgrounds/home-day.png"),Vt(e,"bg-home-day",t,{offsetY:40}),Q.playMusic("start-location"),L.update({persistent:{currentLevel:X.id}}),t.setCamFollowPlayer(s,{rightTilesPadding:2,topTilesPadding:-5})};X.id="level-1-1";const Ze="hud-comp";function j(e){return{id:Ze,shouldBeShown:e.shouldBeShown,targetOpacity:e.targetOpacity||1,add(){this.tag("hud"),this.use(w.layer("hud")),this.use(w.fixed()),this.use(w.stay()),this.use(w.opacity(e.targetOpacity))}}}j.id=Ze;function qt(e,t){const s=t?.size??100,n=t?.deadZone??.1;e.loadSprite("joystick.jump","sprites/icons/jump.gif"),e.loadSprite("joystick.attack","sprites/icons/attack.gif");let i=!1,r=e.vec2(0,0),a=e.vec2(0,0);const o=e.add(["joystickBase",j({shouldBeShown:!0,targetOpacity:.2}),e.pos(-9999,-9999),e.circle(s/2),e.color(0,0,0),e.anchor("center")]),c=e.add(["joystickKnob",j({shouldBeShown:!0,targetOpacity:.7}),e.pos(-9999,-9999),e.circle(s/4),e.color(255,255,255),e.anchor("center")]),l=e.add(["jumpButton",j({shouldBeShown:!0,targetOpacity:.2}),e.pos(e.width()-s*.5,e.height()-s*.5),e.area(),e.circle(s/3),e.color(0,0,0),e.anchor("center")]);e.add([j({shouldBeShown:!0}),e.sprite("joystick.jump"),e.pos(l.pos),e.anchor("center")]),l.onClick(()=>{e.pressButton("jump"),e.releaseButton("jump")});const u=e.add(["attackButton",j({shouldBeShown:!0,targetOpacity:.2}),e.pos(e.width()-s*1.1,e.height()-s*1.1),e.area(),e.circle(s/2.5),e.color(0,0,0),e.anchor("center")]);e.add([j({shouldBeShown:!0}),e.sprite("joystick.attack"),e.pos(u.pos),e.anchor("center"),e.scale(1.2)]),u.onClick(()=>{e.pressButton("action"),e.releaseButton("action")}),o.onTouchStart(h=>{h.x>e.width()*.6||(r=h,i=!0,o.pos=r,c.pos=r,o.hidden=!1,c.hidden=!1)}),o.onTouchMove(h=>{if(!i||h.x>e.width()*.6)return;a=h.sub(r);const g=s/2,d=e.vec2(e.clamp(a.x,-g,g),e.clamp(a.y,-g,g));c.pos=r.add(d)}),o.onTouchEnd(h=>{h.x>e.width()*.6||(i=!1,a=e.vec2(0,0),o.pos=e.vec2(-9999,-9999),c.pos=e.vec2(-9999,-9999),e.releaseButton("left"),e.releaseButton("right"))}),o.onUpdate(()=>{if(!i)return;const g=a.scale(1/(s/2)).x;g<-n?(e.pressButton("left"),e.releaseButton("right")):g>n?(e.pressButton("right"),e.releaseButton("left")):(e.releaseButton("left"),e.releaseButton("right"))})}class Qt{constructor(t){this.k=t,this.dimOverlay=this.k.add([this.k.layer("hud"),this.k.rect(this.k.width(),this.k.height()),this.k.color(0,0,0),this.k.pos(0,0),this.k.anchor("topleft"),this.k.opacity(0),this.k.fixed(),this.k.stay()]),B.isTouchDevice()&&qt(this.k,{size:Math.min(window.innerWidth/15,60)}),this.k.loadSprite("reload-button","sprites/icons/reload.png"),this.reloadButton=this.k.add(["reload-button",j({shouldBeShown:!0}),this.k.sprite("reload-button"),this.k.area(),this.k.pos(10,10),this.k.anchor("topleft")]),this.reloadButton.onClick(()=>{L.reset(),de(this.k,X.id).then()}),this.k.loadSprite("lucky-charm","sprites/icons/lucky-charm.gif",{sliceX:2,sliceY:1,anims:{health2:{from:0,to:0,loop:!1},health1:{from:1,to:1,loop:!1}}}),this.luckyCharm=this.k.add(["lucky-charm",j({shouldBeShown:L.state.persistent.player.hasLuckyCharm}),this.k.sprite("lucky-charm"),this.k.area(),this.k.pos(this.k.width()-10,10),this.k.anchor("topright"),this.k.scale(1)]),this.hide(),L.onUpdate(s=>this.onStateUpdate(s))}isShown=!1;dimOverlay;reloadButton;luckyCharm;show(){this.k.get("hud").forEach(t=>{t.shouldBeShown&&(this.k.tween(0,1,1,s=>{t.opacity=s*(t.targetOpacity??1)}),t.paused=!1)}),this.isShown=!0}hide(){this.k.get("hud").forEach(t=>{t.opacity=0,t.paused=!0}),this.isShown=!1}async slightlyDimTheGame(){return this.k.tween(0,.4,.6,t=>{this.dimOverlay.opacity=t})}async slightlyUndimTheGame(){return this.k.tween(.4,0,.6,t=>{this.dimOverlay.opacity=t})}async onStateUpdate(t){if(t.persistent.player.hasLuckyCharm&&!this.luckyCharm.shouldBeShown){this.luckyCharm.shouldBeShown=!0,this.luckyCharm.paused=!1;const s=this.k.vec2(this.k.width()/2+10,this.k.height()/2-10),n=this.luckyCharm.pos.clone();this.luckyCharm.play("health2"),this.luckyCharm.pos=s.clone(),this.luckyCharm.scale=this.k.vec2(2),await this.slightlyDimTheGame(),await this.k.tween(0,1,1,i=>{this.luckyCharm.opacity=i}),await this.k.wait(1),this.k.play("player-take-key"),this.slightlyUndimTheGame().then(),await this.k.tween(0,1,1.5,i=>{this.luckyCharm.pos=this.k.vec2(this.k.lerp(s.x,n.x,i),this.k.lerp(s.y,n.y,i)),this.luckyCharm.scale=this.k.vec2(this.k.lerp(2,1,i))},this.k.easings.easeOutElastic)}!t.persistent.player.hasLuckyCharm&&this.luckyCharm.shouldBeShown&&(this.luckyCharm.shouldBeShown=!1,this.luckyCharm.paused=!0,this.luckyCharm.opacity=0),t.persistent.player.hasLuckyCharm&&t.temp.player.health&&this.luckyCharm.play("health"+t.temp.player.health)}}function Zt(e,t,s){return async()=>{L.prepareForNewScene(),await t(e),await B.setTimeoutAsync(500),await pe.hideOverlay(2),fe.show()}}const kt={loading:"Loading...",rotateDevice:"Rotate your device",howToInstall:"How to install to the home screen?"},ei={intro1:"Hello, grandson! You finally bought your own hut... Even if it's with a mortgage, you're still doing great!",intro2:"It's a bit empty inside... But I saw some furniture nearby while I was walking here. You can look for it.",introRepeat1:"I saw some furniture nearby while I was walking here. You can look for it.",introRepeat2:"It's a nice day for a walk, don't you think?",introRepeat3:"The house won't furnish itself... Time to get to work!",giveLuckyCharm1:"Oh, I almost forgot! Here, take this for good luck...",giveLuckyCharm2:"It's my lucky charm. May it protect you as it once protected me."},ti={kitchenTableRepeat1:"Hmm, who would throw away such a gorgeous table?..",kitchenTableRepeat2:"Mmm, it smells so good...",kitchenTableRepeat3:"Mmm, it looks so tasty... but I still need it.",kitchenChairRepeat1:"Why is it so small?.. Oh well, I don't have much choice."},ii={common:kt,oldBobr:ei,home:ti},si={loading:"Загрузка...",rotateDevice:"Поверните устройство",howToInstall:"Как установить на домашний экран?"},ni={intro1:"Привет, внучек! Наконец-то ты купил свою хатку... Хоть и в ипотеку, но ты всё равно молодец!",intro2:"Внутри пока пустовато... Но я видел некоторую мебель неподалёку, пока сюда шёл. Ты можешь поискать её.",introRepeat1:"Я видел некоторую мебель неподалёку, пока сюда шёл. Ты можешь поискать её.",introRepeat2:"Неплохой день для прогулки, как ты думаешь?",introRepeat3:"Дом сам себя не обставит... Пора за работу!",giveLuckyCharm1:"О, совсем забыл! Вот, возьми на удачу...",giveLuckyCharm2:"Это мой счастливый талисман. Пусть он защитит тебя как когда-то и меня."},ri={kitchenTableRepeat1:"Хм, кто выбросил такой шикарный стол?..",kitchenTableRepeat2:"Ммм, вкусно пахнет деревом...",kitchenTableRepeat3:"Ммм, выглядит так аппетитно... но он мне ещё нужен.",kitchenChairRepeat1:"Почему он такой маленький?.. Ладно, выбирать не приходится."},ai={common:si,oldBobr:ni,home:ri},oi=e=>{e.loadSprite("button-play","sprites/icons/play.png"),e.add(["button-play",e.layer("menu"),e.sprite("button-play",{width:100}),e.pos(e.width()/2,e.height()/2),e.anchor("center"),e.area(),e.fixed()]).onClick(()=>{de(e,X.id).then()})},li=e=>{e.loadSprite("rotate-device","sprites/icons/rotate-device.gif"),e.add(["rotate-device",e.sprite("rotate-device",{width:100}),e.anchor("bot"),e.pos(e.width()/2,e.height()/2-10),e.scale(e.vec2(-1,1)),e.fixed()]),e.add(["rotate-device-text",e.text(D("common.rotateDevice"),{font:"pixel",size:24,width:e.width()*.8,align:"center",lineSpacing:10}),e.color("white"),e.anchor("top"),e.pos(e.width()/2,e.height()/2+20),e.fixed()]);let t="https://www.cdc.gov/niosh/mining/tools/installpwa.html#cdc_generic_section_2-installing-a-pwa-on-ios";switch(C.language){case"ru":t="https://darkshaurma.com/about/pwa/";break}const s=document.createElement("a");s.href=t,s.target="_blank",s.rel="noopener",s.innerHTML=D("common.howToInstall"),s.style.position="absolute",s.style.width="100%",s.style.boxSizing="border-box",s.style.bottom="10%",s.style.left="0",s.style.display="block",s.style.padding="20px",s.style.color="white",s.style.fontFamily="pixel, monospace",s.style.textAlign="center",s.style.lineHeight="1.5em",document.querySelector("body").appendChild(s),e.onSceneLeave(()=>{document.querySelector("body").removeChild(s)})},L=new Ht,Q=new Bt(w);let fe,pe;(async()=>{await C.use(Ye).init({supportedLngs:["en","ru"],fallbackLng:"ru",detection:{order:["localStorage","navigator"],caches:["localStorage"]},resources:{ru:{translation:ai},en:{translation:ii}}}),w.loadFont("pixel","fonts/Press_Start_2P/PressStart2P-Regular.ttf"),w.setLayers(["bg","game","hud","menu","fade"],"game"),w.add([w.layer("bg"),w.rect(w.width(),w.height()),w.color("#74dcf6"),w.pos(0,0),w.anchor("topleft"),w.fixed(),w.stay()]),w.setVolume(.5),fe=new Qt(w),pe=new Kt(w),w.scene("menu",()=>oi(w)),w.scene("rotate-device",()=>li(w)),w.scene(X.id,Zt(w,X));const e=B.isLandscapeMode();window.addEventListener("resize",()=>{e||B.isLandscapeMode()!==e&&setTimeout(()=>{window.location.reload()},1e3)}),e?w.go("menu"):w.go("rotate-device")})();
