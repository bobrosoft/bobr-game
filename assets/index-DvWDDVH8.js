import{R as qe}from"./kaplay-DTLyooHV.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=s(i);fetch(i.href,n)}})();const y=t=>typeof t=="string",Y=()=>{let t,e;const s=new Promise((r,i)=>{t=r,e=i});return s.resolve=t,s.reject=e,s},me=t=>t==null?"":""+t,Qe=(t,e,s)=>{t.forEach(r=>{e[r]&&(s[r]=e[r])})},Ze=/###/g,ye=t=>t&&t.indexOf("###")>-1?t.replace(Ze,"."):t,be=t=>!t||y(t),G=(t,e,s)=>{const r=y(e)?e.split("."):e;let i=0;for(;i<r.length-1;){if(be(t))return{};const n=ye(r[i]);!t[n]&&s&&(t[n]=new s),Object.prototype.hasOwnProperty.call(t,n)?t=t[n]:t={},++i}return be(t)?{}:{obj:t,k:ye(r[i])}},Se=(t,e,s)=>{const{obj:r,k:i}=G(t,e,Object);if(r!==void 0||e.length===1){r[i]=s;return}let n=e[e.length-1],a=e.slice(0,e.length-1),o=G(t,a,Object);for(;o.obj===void 0&&a.length;)n=`${a[a.length-1]}.${n}`,a=a.slice(0,a.length-1),o=G(t,a,Object),o?.obj&&typeof o.obj[`${o.k}.${n}`]<"u"&&(o.obj=void 0);o.obj[`${o.k}.${n}`]=s},ke=(t,e,s,r)=>{const{obj:i,k:n}=G(t,e,Object);i[n]=i[n]||[],i[n].push(s)},ee=(t,e)=>{const{obj:s,k:r}=G(t,e);if(s&&Object.prototype.hasOwnProperty.call(s,r))return s[r]},et=(t,e,s)=>{const r=ee(t,s);return r!==void 0?r:ee(e,s)},He=(t,e,s)=>{for(const r in e)r!=="__proto__"&&r!=="constructor"&&(r in t?y(t[r])||t[r]instanceof String||y(e[r])||e[r]instanceof String?s&&(t[r]=e[r]):He(t[r],e[r],s):t[r]=e[r]);return t},H=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var tt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const it=t=>y(t)?t.replace(/[&<>"'\/]/g,e=>tt[e]):t;class st{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const s=this.regExpMap.get(e);if(s!==void 0)return s;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}const rt=[" ",",","?","!",";"],nt=new st(20),at=(t,e,s)=>{e=e||"",s=s||"";const r=rt.filter(a=>e.indexOf(a)<0&&s.indexOf(a)<0);if(r.length===0)return!0;const i=nt.getRegExp(`(${r.map(a=>a==="?"?"\\?":a).join("|")})`);let n=!i.test(t);if(!n){const a=t.indexOf(s);a>0&&!i.test(t.substring(0,a))&&(n=!0)}return n},oe=(t,e,s=".")=>{if(!t)return;if(t[e])return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0;const r=e.split(s);let i=t;for(let n=0;n<r.length;){if(!i||typeof i!="object")return;let a,o="";for(let c=n;c<r.length;++c)if(c!==n&&(o+=s),o+=r[c],a=i[o],a!==void 0){if(["string","number","boolean"].indexOf(typeof a)>-1&&c<r.length-1)continue;n+=c-n+1;break}i=a}return i},q=t=>t?.replace("_","-"),ot={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){console?.[t]?.apply?.(console,e)}};class te{constructor(e,s={}){this.init(e,s)}init(e,s={}){this.prefix=s.prefix||"i18next:",this.logger=e||ot,this.options=s,this.debug=s.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,s,r,i){return i&&!this.debug?null:(y(e[0])&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[s](e))}create(e){return new te(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new te(this.logger,e)}}var A=new te;class se{constructor(){this.observers={}}on(e,s){return e.split(" ").forEach(r=>{this.observers[r]||(this.observers[r]=new Map);const i=this.observers[r].get(s)||0;this.observers[r].set(s,i+1)}),this}off(e,s){if(this.observers[e]){if(!s){delete this.observers[e];return}this.observers[e].delete(s)}}emit(e,...s){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([i,n])=>{for(let a=0;a<n;a++)i(...s)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([i,n])=>{for(let a=0;a<n;a++)i.apply(i,[e,...s])})}}class we extends se{constructor(e,s={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=s,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const s=this.options.ns.indexOf(e);s>-1&&this.options.ns.splice(s,1)}getResource(e,s,r,i={}){const n=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,a=i.ignoreJSONStructure!==void 0?i.ignoreJSONStructure:this.options.ignoreJSONStructure;let o;e.indexOf(".")>-1?o=e.split("."):(o=[e,s],r&&(Array.isArray(r)?o.push(...r):y(r)&&n?o.push(...r.split(n)):o.push(r)));const c=ee(this.data,o);return!c&&!s&&!r&&e.indexOf(".")>-1&&(e=o[0],s=o[1],r=o.slice(2).join(".")),c||!a||!y(r)?c:oe(this.data?.[e]?.[s],r,n)}addResource(e,s,r,i,n={silent:!1}){const a=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator;let o=[e,s];r&&(o=o.concat(a?r.split(a):r)),e.indexOf(".")>-1&&(o=e.split("."),i=s,s=o[1]),this.addNamespaces(s),Se(this.data,o,i),n.silent||this.emit("added",e,s,r,i)}addResources(e,s,r,i={silent:!1}){for(const n in r)(y(r[n])||Array.isArray(r[n]))&&this.addResource(e,s,n,r[n],{silent:!0});i.silent||this.emit("added",e,s,r)}addResourceBundle(e,s,r,i,n,a={silent:!1,skipCopy:!1}){let o=[e,s];e.indexOf(".")>-1&&(o=e.split("."),i=r,r=s,s=o[1]),this.addNamespaces(s);let c=ee(this.data,o)||{};a.skipCopy||(r=JSON.parse(JSON.stringify(r))),i?He(c,r,n):c={...c,...r},Se(this.data,o,c),a.silent||this.emit("added",e,s,r)}removeResourceBundle(e,s){this.hasResourceBundle(e,s)&&delete this.data[e][s],this.removeNamespaces(s),this.emit("removed",e,s)}hasResourceBundle(e,s){return this.getResource(e,s)!==void 0}getResourceBundle(e,s){return s||(s=this.options.defaultNS),this.getResource(e,s)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const s=this.getDataByLanguage(e);return!!(s&&Object.keys(s)||[]).find(i=>s[i]&&Object.keys(s[i]).length>0)}toJSON(){return this.data}}var Ve={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,s,r,i){return t.forEach(n=>{e=this.processors[n]?.process(e,s,r,i)??e}),e}};const xe={},ve=t=>!y(t)&&typeof t!="boolean"&&typeof t!="number";class ie extends se{constructor(e,s={}){super(),Qe(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=s,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=A.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,s={interpolation:{}}){const r={...s};return e==null?!1:this.resolve(e,r)?.res!==void 0}extractFromKey(e,s){let r=s.nsSeparator!==void 0?s.nsSeparator:this.options.nsSeparator;r===void 0&&(r=":");const i=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let n=s.ns||this.options.defaultNS||[];const a=r&&e.indexOf(r)>-1,o=!this.options.userDefinedKeySeparator&&!s.keySeparator&&!this.options.userDefinedNsSeparator&&!s.nsSeparator&&!at(e,r,i);if(a&&!o){const c=e.match(this.interpolator.nestingRegexp);if(c&&c.length>0)return{key:e,namespaces:y(n)?[n]:n};const l=e.split(r);(r!==i||r===i&&this.options.ns.indexOf(l[0])>-1)&&(n=l.shift()),e=l.join(i)}return{key:e,namespaces:y(n)?[n]:n}}translate(e,s,r){let i=typeof s=="object"?{...s}:s;if(typeof i!="object"&&this.options.overloadTranslationOptionHandler&&(i=this.options.overloadTranslationOptionHandler(arguments)),typeof options=="object"&&(i={...i}),i||(i={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const n=i.returnDetails!==void 0?i.returnDetails:this.options.returnDetails,a=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,{key:o,namespaces:c}=this.extractFromKey(e[e.length-1],i),l=c[c.length-1];let u=i.nsSeparator!==void 0?i.nsSeparator:this.options.nsSeparator;u===void 0&&(u=":");const d=i.lng||this.language,h=i.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(d?.toLowerCase()==="cimode")return h?n?{res:`${l}${u}${o}`,usedKey:o,exactUsedKey:o,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(i)}:`${l}${u}${o}`:n?{res:o,usedKey:o,exactUsedKey:o,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(i)}:o;const p=this.resolve(e,i);let f=p?.res;const w=p?.usedKey||o,O=p?.exactUsedKey||o,g=["[object Number]","[object Function]","[object RegExp]"],m=i.joinArrays!==void 0?i.joinArrays:this.options.joinArrays,S=!this.i18nFormat||this.i18nFormat.handleAsObject,v=i.count!==void 0&&!y(i.count),x=ie.hasDefaultValue(i),F=v?this.pluralResolver.getSuffix(d,i.count,i):"",K=i.ordinal&&v?this.pluralResolver.getSuffix(d,i.count,{ordinal:!1}):"",he=v&&!i.ordinal&&i.count===0,$=he&&i[`defaultValue${this.options.pluralSeparator}zero`]||i[`defaultValue${F}`]||i[`defaultValue${K}`]||i.defaultValue;let I=f;S&&!f&&x&&(I=$);const Ge=ve(I),Je=Object.prototype.toString.apply(I);if(S&&I&&Ge&&g.indexOf(Je)<0&&!(y(m)&&Array.isArray(I))){if(!i.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const T=this.options.returnedObjectHandler?this.options.returnedObjectHandler(w,I,{...i,ns:c}):`key '${o} (${this.language})' returned an object instead of string.`;return n?(p.res=T,p.usedParams=this.getUsedParamsDetails(i),p):T}if(a){const T=Array.isArray(I),R=T?[]:{},fe=T?O:w;for(const N in I)if(Object.prototype.hasOwnProperty.call(I,N)){const D=`${fe}${a}${N}`;x&&!f?R[N]=this.translate(D,{...i,defaultValue:ve($)?$[N]:void 0,joinArrays:!1,ns:c}):R[N]=this.translate(D,{...i,joinArrays:!1,ns:c}),R[N]===D&&(R[N]=I[N])}f=R}}else if(S&&y(m)&&Array.isArray(f))f=f.join(m),f&&(f=this.extendTranslation(f,e,i,r));else{let T=!1,R=!1;!this.isValidLookup(f)&&x&&(T=!0,f=$),this.isValidLookup(f)||(R=!0,f=o);const N=(i.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&R?void 0:f,D=x&&$!==f&&this.options.updateMissing;if(R||T||D){if(this.logger.log(D?"updateKey":"missingKey",d,l,o,D?$:f),a){const E=this.resolve(o,{...i,keySeparator:!1});E&&E.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let W=[];const Z=this.languageUtils.getFallbackCodes(this.options.fallbackLng,i.lng||this.language);if(this.options.saveMissingTo==="fallback"&&Z&&Z[0])for(let E=0;E<Z.length;E++)W.push(Z[E]);else this.options.saveMissingTo==="all"?W=this.languageUtils.toResolveHierarchy(i.lng||this.language):W.push(i.lng||this.language);const pe=(E,j,X)=>{const ge=x&&X!==f?X:N;this.options.missingKeyHandler?this.options.missingKeyHandler(E,l,j,ge,D,i):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(E,l,j,ge,D,i),this.emit("missingKey",E,l,j,f)};this.options.saveMissing&&(this.options.saveMissingPlurals&&v?W.forEach(E=>{const j=this.pluralResolver.getSuffixes(E,i);he&&i[`defaultValue${this.options.pluralSeparator}zero`]&&j.indexOf(`${this.options.pluralSeparator}zero`)<0&&j.push(`${this.options.pluralSeparator}zero`),j.forEach(X=>{pe([E],o+X,i[`defaultValue${X}`]||$)})}):pe(W,o,$))}f=this.extendTranslation(f,e,i,p,r),R&&f===o&&this.options.appendNamespaceToMissingKey&&(f=`${l}${u}${o}`),(R||T)&&this.options.parseMissingKeyHandler&&(f=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}${u}${o}`:o,T?f:void 0,i))}return n?(p.res=f,p.usedParams=this.getUsedParamsDetails(i),p):f}extendTranslation(e,s,r,i,n){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const c=y(e)&&(r?.interpolation?.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let l;if(c){const d=e.match(this.interpolator.nestingRegexp);l=d&&d.length}let u=r.replace&&!y(r.replace)?r.replace:r;if(this.options.interpolation.defaultVariables&&(u={...this.options.interpolation.defaultVariables,...u}),e=this.interpolator.interpolate(e,u,r.lng||this.language||i.usedLng,r),c){const d=e.match(this.interpolator.nestingRegexp),h=d&&d.length;l<h&&(r.nest=!1)}!r.lng&&i&&i.res&&(r.lng=this.language||i.usedLng),r.nest!==!1&&(e=this.interpolator.nest(e,(...d)=>n?.[0]===d[0]&&!r.context?(this.logger.warn(`It seems you are nesting recursively key: ${d[0]} in key: ${s[0]}`),null):this.translate(...d,s),r)),r.interpolation&&this.interpolator.reset()}const a=r.postProcess||this.options.postProcess,o=y(a)?[a]:a;return e!=null&&o?.length&&r.applyPostProcessor!==!1&&(e=Ve.handle(o,e,s,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...i,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e,s={}){let r,i,n,a,o;return y(e)&&(e=[e]),e.forEach(c=>{if(this.isValidLookup(r))return;const l=this.extractFromKey(c,s),u=l.key;i=u;let d=l.namespaces;this.options.fallbackNS&&(d=d.concat(this.options.fallbackNS));const h=s.count!==void 0&&!y(s.count),p=h&&!s.ordinal&&s.count===0,f=s.context!==void 0&&(y(s.context)||typeof s.context=="number")&&s.context!=="",w=s.lngs?s.lngs:this.languageUtils.toResolveHierarchy(s.lng||this.language,s.fallbackLng);d.forEach(O=>{this.isValidLookup(r)||(o=O,!xe[`${w[0]}-${O}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(o)&&(xe[`${w[0]}-${O}`]=!0,this.logger.warn(`key "${i}" for languages "${w.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),w.forEach(g=>{if(this.isValidLookup(r))return;a=g;const m=[u];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(m,u,g,O,s);else{let v;h&&(v=this.pluralResolver.getSuffix(g,s.count,s));const x=`${this.options.pluralSeparator}zero`,F=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(h&&(m.push(u+v),s.ordinal&&v.indexOf(F)===0&&m.push(u+v.replace(F,this.options.pluralSeparator)),p&&m.push(u+x)),f){const K=`${u}${this.options.contextSeparator}${s.context}`;m.push(K),h&&(m.push(K+v),s.ordinal&&v.indexOf(F)===0&&m.push(K+v.replace(F,this.options.pluralSeparator)),p&&m.push(K+x))}}let S;for(;S=m.pop();)this.isValidLookup(r)||(n=S,r=this.getResource(g,O,S,s))}))})}),{res:r,usedKey:i,exactUsedKey:n,usedLng:a,usedNS:o}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,s,r,i={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,s,r,i):this.resourceStore.getResource(e,s,r,i)}getUsedParamsDetails(e={}){const s=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&!y(e.replace);let i=r?e.replace:e;if(r&&typeof e.count<"u"&&(i.count=e.count),this.options.interpolation.defaultVariables&&(i={...this.options.interpolation.defaultVariables,...i}),!r){i={...i};for(const n of s)delete i[n]}return i}static hasDefaultValue(e){const s="defaultValue";for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&s===r.substring(0,s.length)&&e[r]!==void 0)return!0;return!1}}class Oe{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=A.create("languageUtils")}getScriptPartFromCode(e){if(e=q(e),!e||e.indexOf("-")<0)return null;const s=e.split("-");return s.length===2||(s.pop(),s[s.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(s.join("-"))}getLanguagePartFromCode(e){if(e=q(e),!e||e.indexOf("-")<0)return e;const s=e.split("-");return this.formatLanguageCode(s[0])}formatLanguageCode(e){if(y(e)&&e.indexOf("-")>-1){let s;try{s=Intl.getCanonicalLocales(e)[0]}catch{}return s&&this.options.lowerCaseLng&&(s=s.toLowerCase()),s||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let s;return e.forEach(r=>{if(s)return;const i=this.formatLanguageCode(r);(!this.options.supportedLngs||this.isSupportedCode(i))&&(s=i)}),!s&&this.options.supportedLngs&&e.forEach(r=>{if(s)return;const i=this.getScriptPartFromCode(r);if(this.isSupportedCode(i))return s=i;const n=this.getLanguagePartFromCode(r);if(this.isSupportedCode(n))return s=n;s=this.options.supportedLngs.find(a=>{if(a===n)return a;if(!(a.indexOf("-")<0&&n.indexOf("-")<0)&&(a.indexOf("-")>0&&n.indexOf("-")<0&&a.substring(0,a.indexOf("-"))===n||a.indexOf(n)===0&&n.length>1))return a})}),s||(s=this.getFallbackCodes(this.options.fallbackLng)[0]),s}getFallbackCodes(e,s){if(!e)return[];if(typeof e=="function"&&(e=e(s)),y(e)&&(e=[e]),Array.isArray(e))return e;if(!s)return e.default||[];let r=e[s];return r||(r=e[this.getScriptPartFromCode(s)]),r||(r=e[this.formatLanguageCode(s)]),r||(r=e[this.getLanguagePartFromCode(s)]),r||(r=e.default),r||[]}toResolveHierarchy(e,s){const r=this.getFallbackCodes((s===!1?[]:s)||this.options.fallbackLng||[],e),i=[],n=a=>{a&&(this.isSupportedCode(a)?i.push(a):this.logger.warn(`rejecting language code not found in supportedLngs: ${a}`))};return y(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&n(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&n(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&n(this.getLanguagePartFromCode(e))):y(e)&&n(this.formatLanguageCode(e)),r.forEach(a=>{i.indexOf(a)<0&&n(this.formatLanguageCode(a))}),i}}const Le={zero:0,one:1,two:2,few:3,many:4,other:5},Ce={select:t=>t===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class lt{constructor(e,s={}){this.languageUtils=e,this.options=s,this.logger=A.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,s){this.rules[e]=s}clearCache(){this.pluralRulesCache={}}getRule(e,s={}){const r=q(e==="dev"?"en":e),i=s.ordinal?"ordinal":"cardinal",n=JSON.stringify({cleanedCode:r,type:i});if(n in this.pluralRulesCache)return this.pluralRulesCache[n];let a;try{a=new Intl.PluralRules(r,{type:i})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),Ce;if(!e.match(/-|_/))return Ce;const c=this.languageUtils.getLanguagePartFromCode(e);a=this.getRule(c,s)}return this.pluralRulesCache[n]=a,a}needsPlural(e,s={}){let r=this.getRule(e,s);return r||(r=this.getRule("dev",s)),r?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,s,r={}){return this.getSuffixes(e,r).map(i=>`${s}${i}`)}getSuffixes(e,s={}){let r=this.getRule(e,s);return r||(r=this.getRule("dev",s)),r?r.resolvedOptions().pluralCategories.sort((i,n)=>Le[i]-Le[n]).map(i=>`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${i}`):[]}getSuffix(e,s,r={}){const i=this.getRule(e,r);return i?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${i.select(s)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",s,r))}}const Ee=(t,e,s,r=".",i=!0)=>{let n=et(t,e,s);return!n&&i&&y(s)&&(n=oe(t,s,r),n===void 0&&(n=oe(e,s,r))),n},re=t=>t.replace(/\$/g,"$$$$");class ct{constructor(e={}){this.logger=A.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(s=>s),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:s,escapeValue:r,useRawValueToEscape:i,prefix:n,prefixEscaped:a,suffix:o,suffixEscaped:c,formatSeparator:l,unescapeSuffix:u,unescapePrefix:d,nestingPrefix:h,nestingPrefixEscaped:p,nestingSuffix:f,nestingSuffixEscaped:w,nestingOptionsSeparator:O,maxReplaces:g,alwaysFormat:m}=e.interpolation;this.escape=s!==void 0?s:it,this.escapeValue=r!==void 0?r:!0,this.useRawValueToEscape=i!==void 0?i:!1,this.prefix=n?H(n):a||"{{",this.suffix=o?H(o):c||"}}",this.formatSeparator=l||",",this.unescapePrefix=u?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":u||"",this.nestingPrefix=h?H(h):p||H("$t("),this.nestingSuffix=f?H(f):w||H(")"),this.nestingOptionsSeparator=O||",",this.maxReplaces=g||1e3,this.alwaysFormat=m!==void 0?m:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(s,r)=>s?.source===r?(s.lastIndex=0,s):new RegExp(r,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,s,r,i){let n,a,o;const c=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=p=>{if(p.indexOf(this.formatSeparator)<0){const g=Ee(s,c,p,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(g,void 0,r,{...i,...s,interpolationkey:p}):g}const f=p.split(this.formatSeparator),w=f.shift().trim(),O=f.join(this.formatSeparator).trim();return this.format(Ee(s,c,w,this.options.keySeparator,this.options.ignoreJSONStructure),O,r,{...i,...s,interpolationkey:w})};this.resetRegExp();const u=i?.missingInterpolationHandler||this.options.missingInterpolationHandler,d=i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:p=>re(p)},{regex:this.regexp,safeValue:p=>this.escapeValue?re(this.escape(p)):re(p)}].forEach(p=>{for(o=0;n=p.regex.exec(e);){const f=n[1].trim();if(a=l(f),a===void 0)if(typeof u=="function"){const O=u(e,n,i);a=y(O)?O:""}else if(i&&Object.prototype.hasOwnProperty.call(i,f))a="";else if(d){a=n[0];continue}else this.logger.warn(`missed to pass in variable ${f} for interpolating ${e}`),a="";else!y(a)&&!this.useRawValueToEscape&&(a=me(a));const w=p.safeValue(a);if(e=e.replace(n[0],w),d?(p.regex.lastIndex+=a.length,p.regex.lastIndex-=n[0].length):p.regex.lastIndex=0,o++,o>=this.maxReplaces)break}}),e}nest(e,s,r={}){let i,n,a;const o=(c,l)=>{const u=this.nestingOptionsSeparator;if(c.indexOf(u)<0)return c;const d=c.split(new RegExp(`${u}[ ]*{`));let h=`{${d[1]}`;c=d[0],h=this.interpolate(h,a);const p=h.match(/'/g),f=h.match(/"/g);((p?.length??0)%2===0&&!f||f.length%2!==0)&&(h=h.replace(/'/g,'"'));try{a=JSON.parse(h),l&&(a={...l,...a})}catch(w){return this.logger.warn(`failed parsing options string in nesting for key ${c}`,w),`${c}${u}${h}`}return a.defaultValue&&a.defaultValue.indexOf(this.prefix)>-1&&delete a.defaultValue,c};for(;i=this.nestingRegexp.exec(e);){let c=[];a={...r},a=a.replace&&!y(a.replace)?a.replace:a,a.applyPostProcessor=!1,delete a.defaultValue;const l=/{.*}/.test(i[1])?i[1].lastIndexOf("}")+1:i[1].indexOf(this.formatSeparator);if(l!==-1&&(c=i[1].slice(l).split(this.formatSeparator).map(u=>u.trim()).filter(Boolean),i[1]=i[1].slice(0,l)),n=s(o.call(this,i[1].trim(),a),a),n&&i[0]===e&&!y(n))return n;y(n)||(n=me(n)),n||(this.logger.warn(`missed to resolve ${i[1]} for nesting ${e}`),n=""),c.length&&(n=c.reduce((u,d)=>this.format(u,d,r.lng,{...r,interpolationkey:i[1].trim()}),n.trim())),e=e.replace(i[0],n),this.regexp.lastIndex=0}return e}}const ut=t=>{let e=t.toLowerCase().trim();const s={};if(t.indexOf("(")>-1){const r=t.split("(");e=r[0].toLowerCase().trim();const i=r[1].substring(0,r[1].length-1);e==="currency"&&i.indexOf(":")<0?s.currency||(s.currency=i.trim()):e==="relativetime"&&i.indexOf(":")<0?s.range||(s.range=i.trim()):i.split(";").forEach(a=>{if(a){const[o,...c]=a.split(":"),l=c.join(":").trim().replace(/^'+|'+$/g,""),u=o.trim();s[u]||(s[u]=l),l==="false"&&(s[u]=!1),l==="true"&&(s[u]=!0),isNaN(l)||(s[u]=parseInt(l,10))}})}return{formatName:e,formatOptions:s}},Pe=t=>{const e={};return(s,r,i)=>{let n=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(n={...n,[i.interpolationkey]:void 0});const a=r+JSON.stringify(n);let o=e[a];return o||(o=t(q(r),i),e[a]=o),o(s)}},dt=t=>(e,s,r)=>t(q(s),r)(e);class ht{constructor(e={}){this.logger=A.create("formatter"),this.options=e,this.init(e)}init(e,s={interpolation:{}}){this.formatSeparator=s.interpolation.formatSeparator||",";const r=s.cacheInBuiltFormats?Pe:dt;this.formats={number:r((i,n)=>{const a=new Intl.NumberFormat(i,{...n});return o=>a.format(o)}),currency:r((i,n)=>{const a=new Intl.NumberFormat(i,{...n,style:"currency"});return o=>a.format(o)}),datetime:r((i,n)=>{const a=new Intl.DateTimeFormat(i,{...n});return o=>a.format(o)}),relativetime:r((i,n)=>{const a=new Intl.RelativeTimeFormat(i,{...n});return o=>a.format(o,n.range||"day")}),list:r((i,n)=>{const a=new Intl.ListFormat(i,{...n});return o=>a.format(o)})}}add(e,s){this.formats[e.toLowerCase().trim()]=s}addCached(e,s){this.formats[e.toLowerCase().trim()]=Pe(s)}format(e,s,r,i={}){const n=s.split(this.formatSeparator);if(n.length>1&&n[0].indexOf("(")>1&&n[0].indexOf(")")<0&&n.find(o=>o.indexOf(")")>-1)){const o=n.findIndex(c=>c.indexOf(")")>-1);n[0]=[n[0],...n.splice(1,o)].join(this.formatSeparator)}return n.reduce((o,c)=>{const{formatName:l,formatOptions:u}=ut(c);if(this.formats[l]){let d=o;try{const h=i?.formatParams?.[i.interpolationkey]||{},p=h.locale||h.lng||i.locale||i.lng||r;d=this.formats[l](o,p,{...u,...i,...h})}catch(h){this.logger.warn(h)}return d}else this.logger.warn(`there was no format function for ${l}`);return o},e)}}const ft=(t,e)=>{t.pending[e]!==void 0&&(delete t.pending[e],t.pendingCount--)};class pt extends se{constructor(e,s,r,i={}){super(),this.backend=e,this.store=s,this.services=r,this.languageUtils=r.languageUtils,this.options=i,this.logger=A.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=i.maxParallelReads||10,this.readingCalls=0,this.maxRetries=i.maxRetries>=0?i.maxRetries:5,this.retryTimeout=i.retryTimeout>=1?i.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(r,i.backend,i)}queueLoad(e,s,r,i){const n={},a={},o={},c={};return e.forEach(l=>{let u=!0;s.forEach(d=>{const h=`${l}|${d}`;!r.reload&&this.store.hasResourceBundle(l,d)?this.state[h]=2:this.state[h]<0||(this.state[h]===1?a[h]===void 0&&(a[h]=!0):(this.state[h]=1,u=!1,a[h]===void 0&&(a[h]=!0),n[h]===void 0&&(n[h]=!0),c[d]===void 0&&(c[d]=!0)))}),u||(o[l]=!0)}),(Object.keys(n).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(n),pending:Object.keys(a),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(c)}}loaded(e,s,r){const i=e.split("|"),n=i[0],a=i[1];s&&this.emit("failedLoading",n,a,s),!s&&r&&this.store.addResourceBundle(n,a,r,void 0,void 0,{skipCopy:!0}),this.state[e]=s?-1:2,s&&r&&(this.state[e]=0);const o={};this.queue.forEach(c=>{ke(c.loaded,[n],a),ft(c,e),s&&c.errors.push(s),c.pendingCount===0&&!c.done&&(Object.keys(c.loaded).forEach(l=>{o[l]||(o[l]={});const u=c.loaded[l];u.length&&u.forEach(d=>{o[l][d]===void 0&&(o[l][d]=!0)})}),c.done=!0,c.errors.length?c.callback(c.errors):c.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(c=>!c.done)}read(e,s,r,i=0,n=this.retryTimeout,a){if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:s,fcName:r,tried:i,wait:n,callback:a});return}this.readingCalls++;const o=(l,u)=>{if(this.readingCalls--,this.waitingReads.length>0){const d=this.waitingReads.shift();this.read(d.lng,d.ns,d.fcName,d.tried,d.wait,d.callback)}if(l&&u&&i<this.maxRetries){setTimeout(()=>{this.read.call(this,e,s,r,i+1,n*2,a)},n);return}a(l,u)},c=this.backend[r].bind(this.backend);if(c.length===2){try{const l=c(e,s);l&&typeof l.then=="function"?l.then(u=>o(null,u)).catch(o):o(null,l)}catch(l){o(l)}return}return c(e,s,o)}prepareLoading(e,s,r={},i){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();y(e)&&(e=this.languageUtils.toResolveHierarchy(e)),y(s)&&(s=[s]);const n=this.queueLoad(e,s,r,i);if(!n.toLoad.length)return n.pending.length||i(),null;n.toLoad.forEach(a=>{this.loadOne(a)})}load(e,s,r){this.prepareLoading(e,s,{},r)}reload(e,s,r){this.prepareLoading(e,s,{reload:!0},r)}loadOne(e,s=""){const r=e.split("|"),i=r[0],n=r[1];this.read(i,n,"read",void 0,void 0,(a,o)=>{a&&this.logger.warn(`${s}loading namespace ${n} for language ${i} failed`,a),!a&&o&&this.logger.log(`${s}loaded namespace ${n} for language ${i}`,o),this.loaded(e,a,o)})}saveMissing(e,s,r,i,n,a={},o=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(s)){this.logger.warn(`did not save key "${r}" as the namespace "${s}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(r==null||r==="")){if(this.backend?.create){const c={...a,isUpdate:n},l=this.backend.create.bind(this.backend);if(l.length<6)try{let u;l.length===5?u=l(e,s,r,i,c):u=l(e,s,r,i),u&&typeof u.then=="function"?u.then(d=>o(null,d)).catch(o):o(null,u)}catch(u){o(u)}else l(e,s,r,i,o,c)}!e||!e[0]||this.store.addResource(e[0],s,r,i)}}}const Re=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if(typeof t[1]=="object"&&(e=t[1]),y(t[1])&&(e.defaultValue=t[1]),y(t[2])&&(e.tDescription=t[2]),typeof t[2]=="object"||typeof t[3]=="object"){const s=t[3]||t[2];Object.keys(s).forEach(r=>{e[r]=s[r]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),Ie=t=>(y(t.ns)&&(t.ns=[t.ns]),y(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),y(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs?.indexOf?.("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),typeof t.initImmediate=="boolean"&&(t.initAsync=t.initImmediate),t),k=()=>{},gt=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(s=>{typeof t[s]=="function"&&(t[s]=t[s].bind(t))})};class Q extends se{constructor(e={},s){if(super(),this.options=Ie(e),this.services={},this.logger=A,this.modules={external:[]},gt(this),s&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,s),this;setTimeout(()=>{this.init(e,s)},0)}}init(e={},s){this.isInitializing=!0,typeof e=="function"&&(s=e,e={}),e.defaultNS==null&&e.ns&&(y(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const r=Re();this.options={...r,...this.options,...Ie(e)},this.options.interpolation={...r.interpolation,...this.options.interpolation},e.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=e.keySeparator),e.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=e.nsSeparator);const i=l=>l?typeof l=="function"?new l:l:null;if(!this.options.isClone){this.modules.logger?A.init(i(this.modules.logger),this.options):A.init(null,this.options);let l;this.modules.formatter?l=this.modules.formatter:l=ht;const u=new Oe(this.options);this.store=new we(this.options.resources,this.options);const d=this.services;d.logger=A,d.resourceStore=this.store,d.languageUtils=u,d.pluralResolver=new lt(u,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==r.interpolation.format&&this.logger.warn("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),l&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(d.formatter=i(l),d.formatter.init&&d.formatter.init(d,this.options),this.options.interpolation.format=d.formatter.format.bind(d.formatter)),d.interpolator=new ct(this.options),d.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},d.backendConnector=new pt(i(this.modules.backend),d.resourceStore,d,this.options),d.backendConnector.on("*",(p,...f)=>{this.emit(p,...f)}),this.modules.languageDetector&&(d.languageDetector=i(this.modules.languageDetector),d.languageDetector.init&&d.languageDetector.init(d,this.options.detection,this.options)),this.modules.i18nFormat&&(d.i18nFormat=i(this.modules.i18nFormat),d.i18nFormat.init&&d.i18nFormat.init(this)),this.translator=new ie(this.services,this.options),this.translator.on("*",(p,...f)=>{this.emit(p,...f)}),this.modules.external.forEach(p=>{p.init&&p.init(this)})}if(this.format=this.options.interpolation.format,s||(s=k),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const l=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);l.length>0&&l[0]!=="dev"&&(this.options.lng=l[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(l=>{this[l]=(...u)=>this.store[l](...u)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(l=>{this[l]=(...u)=>(this.store[l](...u),this)});const o=Y(),c=()=>{const l=(u,d)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),o.resolve(d),s(u,d)};if(this.languages&&!this.isInitialized)return l(null,this.t.bind(this));this.changeLanguage(this.options.lng,l)};return this.options.resources||!this.options.initAsync?c():setTimeout(c,0),o}loadResources(e,s=k){let r=s;const i=y(e)?e:this.language;if(typeof e=="function"&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if(i?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return r();const n=[],a=o=>{if(!o||o==="cimode")return;this.services.languageUtils.toResolveHierarchy(o).forEach(l=>{l!=="cimode"&&n.indexOf(l)<0&&n.push(l)})};i?a(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(c=>a(c)),this.options.preload?.forEach?.(o=>a(o)),this.services.backendConnector.load(n,this.options.ns,o=>{!o&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),r(o)})}else r(null)}reloadResources(e,s,r){const i=Y();return typeof e=="function"&&(r=e,e=void 0),typeof s=="function"&&(r=s,s=void 0),e||(e=this.languages),s||(s=this.options.ns),r||(r=k),this.services.backendConnector.reload(e,s,n=>{i.resolve(),r(n)}),i}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&Ve.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1)){for(let s=0;s<this.languages.length;s++){const r=this.languages[s];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,s){this.isLanguageChangingTo=e;const r=Y();this.emit("languageChanging",e);const i=o=>{this.language=o,this.languages=this.services.languageUtils.toResolveHierarchy(o),this.resolvedLanguage=void 0,this.setResolvedLanguage(o)},n=(o,c)=>{c?this.isLanguageChangingTo===e&&(i(c),this.translator.changeLanguage(c),this.isLanguageChangingTo=void 0,this.emit("languageChanged",c),this.logger.log("languageChanged",c)):this.isLanguageChangingTo=void 0,r.resolve((...l)=>this.t(...l)),s&&s(o,(...l)=>this.t(...l))},a=o=>{!e&&!o&&this.services.languageDetector&&(o=[]);const c=y(o)?o:o&&o[0],l=this.store.hasLanguageSomeTranslations(c)?c:this.services.languageUtils.getBestMatchFromCodes(y(o)?[o]:o);l&&(this.language||i(l),this.translator.language||this.translator.changeLanguage(l),this.services.languageDetector?.cacheUserLanguage?.(l)),this.loadResources(l,u=>{n(u,l)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?a(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(a):this.services.languageDetector.detect(a):a(e),r}getFixedT(e,s,r){const i=(n,a,...o)=>{let c;typeof a!="object"?c=this.options.overloadTranslationOptionHandler([n,a].concat(o)):c={...a},c.lng=c.lng||i.lng,c.lngs=c.lngs||i.lngs,c.ns=c.ns||i.ns,c.keyPrefix!==""&&(c.keyPrefix=c.keyPrefix||r||i.keyPrefix);const l=this.options.keySeparator||".";let u;return c.keyPrefix&&Array.isArray(n)?u=n.map(d=>`${c.keyPrefix}${l}${d}`):u=c.keyPrefix?`${c.keyPrefix}${l}${n}`:n,this.t(u,c)};return y(e)?i.lng=e:i.lngs=e,i.ns=s,i.keyPrefix=r,i}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,s={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=s.lng||this.resolvedLanguage||this.languages[0],i=this.options?this.options.fallbackLng:!1,n=this.languages[this.languages.length-1];if(r.toLowerCase()==="cimode")return!0;const a=(o,c)=>{const l=this.services.backendConnector.state[`${o}|${c}`];return l===-1||l===0||l===2};if(s.precheck){const o=s.precheck(this,a);if(o!==void 0)return o}return!!(this.hasResourceBundle(r,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||a(r,e)&&(!i||a(n,e)))}loadNamespaces(e,s){const r=Y();return this.options.ns?(y(e)&&(e=[e]),e.forEach(i=>{this.options.ns.indexOf(i)<0&&this.options.ns.push(i)}),this.loadResources(i=>{r.resolve(),s&&s(i)}),r):(s&&s(),Promise.resolve())}loadLanguages(e,s){const r=Y();y(e)&&(e=[e]);const i=this.options.preload||[],n=e.filter(a=>i.indexOf(a)<0&&this.services.languageUtils.isSupportedCode(a));return n.length?(this.options.preload=i.concat(n),this.loadResources(a=>{r.resolve(),s&&s(a)}),r):(s&&s(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";try{const i=new Intl.Locale(e);if(i&&i.getTextInfo){const n=i.getTextInfo();if(n&&n.direction)return n.direction}}catch{}const s=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],r=this.services?.languageUtils||new Oe(Re());return e.toLowerCase().indexOf("-latn")>1?"ltr":s.indexOf(r.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},s){return new Q(e,s)}cloneInstance(e={},s=k){const r=e.forkResourceStore;r&&delete e.forkResourceStore;const i={...this.options,...e,isClone:!0},n=new Q(i);if((e.debug!==void 0||e.prefix!==void 0)&&(n.logger=n.logger.clone(e)),["store","services","language"].forEach(o=>{n[o]=this[o]}),n.services={...this.services},n.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},r){const o=Object.keys(this.store.data).reduce((c,l)=>(c[l]={...this.store.data[l]},c[l]=Object.keys(c[l]).reduce((u,d)=>(u[d]={...c[l][d]},u),c[l]),c),{});n.store=new we(o,i),n.services.resourceStore=n.store}return n.translator=new ie(n.services,i),n.translator.on("*",(o,...c)=>{n.emit(o,...c)}),n.init(i,s),n.translator.options=i,n.translator.backendConnector.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},n}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const L=Q.createInstance();L.createInstance=Q.createInstance;L.createInstance;L.dir;L.init;L.loadResources;L.reloadResources;L.use;L.changeLanguage;L.getFixedT;const U=L.t;L.exists;L.setDefaultNamespace;L.hasLoadedNamespace;L.loadNamespaces;L.loadLanguages;const{slice:mt,forEach:yt}=[];function bt(t){return yt.call(mt.call(arguments,1),e=>{if(e)for(const s in e)t[s]===void 0&&(t[s]=e[s])}),t}function St(t){return typeof t!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(s=>s.test(t))}const Te=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,wt=function(t,e){const r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},i=encodeURIComponent(e);let n=`${t}=${i}`;if(r.maxAge>0){const a=r.maxAge-0;if(Number.isNaN(a))throw new Error("maxAge should be a Number");n+=`; Max-Age=${Math.floor(a)}`}if(r.domain){if(!Te.test(r.domain))throw new TypeError("option domain is invalid");n+=`; Domain=${r.domain}`}if(r.path){if(!Te.test(r.path))throw new TypeError("option path is invalid");n+=`; Path=${r.path}`}if(r.expires){if(typeof r.expires.toUTCString!="function")throw new TypeError("option expires is invalid");n+=`; Expires=${r.expires.toUTCString()}`}if(r.httpOnly&&(n+="; HttpOnly"),r.secure&&(n+="; Secure"),r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:n+="; SameSite=Strict";break;case"lax":n+="; SameSite=Lax";break;case"strict":n+="; SameSite=Strict";break;case"none":n+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return r.partitioned&&(n+="; Partitioned"),n},Ne={create(t,e,s,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};s&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+s*60*1e3)),r&&(i.domain=r),document.cookie=wt(t,e,i)},read(t){const e=`${t}=`,s=document.cookie.split(";");for(let r=0;r<s.length;r++){let i=s[r];for(;i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return i.substring(e.length,i.length)}return null},remove(t,e){this.create(t,"",-1,e)}};var xt={name:"cookie",lookup(t){let{lookupCookie:e}=t;if(e&&typeof document<"u")return Ne.read(e)||void 0},cacheUserLanguage(t,e){let{lookupCookie:s,cookieMinutes:r,cookieDomain:i,cookieOptions:n}=e;s&&typeof document<"u"&&Ne.create(s,t,r,i,n)}},vt={name:"querystring",lookup(t){let{lookupQuerystring:e}=t,s;if(typeof window<"u"){let{search:r}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(r=window.location.hash.substring(window.location.hash.indexOf("?")));const n=r.substring(1).split("&");for(let a=0;a<n.length;a++){const o=n[a].indexOf("=");o>0&&n[a].substring(0,o)===e&&(s=n[a].substring(o+1))}}return s}},Ot={name:"hash",lookup(t){let{lookupHash:e,lookupFromHashIndex:s}=t,r;if(typeof window<"u"){const{hash:i}=window.location;if(i&&i.length>2){const n=i.substring(1);if(e){const a=n.split("&");for(let o=0;o<a.length;o++){const c=a[o].indexOf("=");c>0&&a[o].substring(0,c)===e&&(r=a[o].substring(c+1))}}if(r)return r;if(!r&&s>-1){const a=i.match(/\/([a-zA-Z-]*)/g);return Array.isArray(a)?a[typeof s=="number"?s:0]?.replace("/",""):void 0}}}return r}};let V=null;const Ae=()=>{if(V!==null)return V;try{if(V=typeof window<"u"&&window.localStorage!==null,!V)return!1;const t="i18next.translate.boo";window.localStorage.setItem(t,"foo"),window.localStorage.removeItem(t)}catch{V=!1}return V};var Lt={name:"localStorage",lookup(t){let{lookupLocalStorage:e}=t;if(e&&Ae())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupLocalStorage:s}=e;s&&Ae()&&window.localStorage.setItem(s,t)}};let _=null;const De=()=>{if(_!==null)return _;try{if(_=typeof window<"u"&&window.sessionStorage!==null,!_)return!1;const t="i18next.translate.boo";window.sessionStorage.setItem(t,"foo"),window.sessionStorage.removeItem(t)}catch{_=!1}return _};var Ct={name:"sessionStorage",lookup(t){let{lookupSessionStorage:e}=t;if(e&&De())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupSessionStorage:s}=e;s&&De()&&window.sessionStorage.setItem(s,t)}},Et={name:"navigator",lookup(t){const e=[];if(typeof navigator<"u"){const{languages:s,userLanguage:r,language:i}=navigator;if(s)for(let n=0;n<s.length;n++)e.push(s[n]);r&&e.push(r),i&&e.push(i)}return e.length>0?e:void 0}},Pt={name:"htmlTag",lookup(t){let{htmlTag:e}=t,s;const r=e||(typeof document<"u"?document.documentElement:null);return r&&typeof r.getAttribute=="function"&&(s=r.getAttribute("lang")),s}},Rt={name:"path",lookup(t){let{lookupFromPathIndex:e}=t;if(typeof window>"u")return;const s=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(s)?s[typeof e=="number"?e:0]?.replace("/",""):void 0}},It={name:"subdomain",lookup(t){let{lookupFromSubdomainIndex:e}=t;const s=typeof e=="number"?e+1:1,r=typeof window<"u"&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(r)return r[s]}};let _e=!1;try{document.cookie,_e=!0}catch{}const ze=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];_e||ze.splice(1,1);const Tt=()=>({order:ze,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:t=>t});class We{constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,s)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e,this.options=bt(s,this.options||{},Tt()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=i=>i.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=r,this.addDetector(xt),this.addDetector(vt),this.addDetector(Lt),this.addDetector(Ct),this.addDetector(Et),this.addDetector(Pt),this.addDetector(Rt),this.addDetector(It),this.addDetector(Ot)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,s=[];return e.forEach(r=>{if(this.detectors[r]){let i=this.detectors[r].lookup(this.options);i&&typeof i=="string"&&(i=[i]),i&&(s=s.concat(i))}}),s=s.filter(r=>r!=null&&!St(r)).map(r=>this.options.convertDetectedLanguage(r)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?s:s.length>0?s[0]:null}cacheUserLanguage(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;s&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||s.forEach(r=>{this.detectors[r]&&this.detectors[r].cacheUserLanguage(e,this.options)}))}}We.type="languageDetector";function Nt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ne,Me;function At(){if(Me)return ne;Me=1;var t=function(m){return e(m)&&!s(m)};function e(g){return!!g&&typeof g=="object"}function s(g){var m=Object.prototype.toString.call(g);return m==="[object RegExp]"||m==="[object Date]"||n(g)}var r=typeof Symbol=="function"&&Symbol.for,i=r?Symbol.for("react.element"):60103;function n(g){return g.$$typeof===i}function a(g){return Array.isArray(g)?[]:{}}function o(g,m){return m.clone!==!1&&m.isMergeableObject(g)?w(a(g),g,m):g}function c(g,m,S){return g.concat(m).map(function(v){return o(v,S)})}function l(g,m){if(!m.customMerge)return w;var S=m.customMerge(g);return typeof S=="function"?S:w}function u(g){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(g).filter(function(m){return Object.propertyIsEnumerable.call(g,m)}):[]}function d(g){return Object.keys(g).concat(u(g))}function h(g,m){try{return m in g}catch{return!1}}function p(g,m){return h(g,m)&&!(Object.hasOwnProperty.call(g,m)&&Object.propertyIsEnumerable.call(g,m))}function f(g,m,S){var v={};return S.isMergeableObject(g)&&d(g).forEach(function(x){v[x]=o(g[x],S)}),d(m).forEach(function(x){p(g,x)||(h(g,x)&&S.isMergeableObject(m[x])?v[x]=l(x,S)(g[x],m[x],S):v[x]=o(m[x],S))}),v}function w(g,m,S){S=S||{},S.arrayMerge=S.arrayMerge||c,S.isMergeableObject=S.isMergeableObject||t,S.cloneUnlessOtherwiseSpecified=o;var v=Array.isArray(m),x=Array.isArray(g),F=v===x;return F?v?S.arrayMerge(g,m,S):f(g,m,S):o(m,S)}w.all=function(m,S){if(!Array.isArray(m))throw new Error("first argument should be an array");return m.reduce(function(v,x){return w(v,x,S)},{})};var O=w;return ne=O,ne}var Dt=At();const Mt=Nt(Dt);class B{static isTouchDevice(e){return e=e||window.navigator.userAgent,"ontouchstart"in window||navigator.maxTouchPoints>0||/ios|iphone|ipad|ipod|android|windows phone/gi.test(e)}static isLandscapeMode(){return window.innerWidth>window.innerHeight}static setTimeoutAsync(e){return new Promise(s=>{setTimeout(()=>{s()},e)})}static mergeDeep(e,...s){return Mt.all([e,...s],{arrayMerge:(r,i)=>i})}}class Ft{constructor(e,s){this.k=e,this.config={volume:1,fadeOutDuration:1.5,...s}}config;currentMusic;currentMusicName;isFirstPlay=!0;loadMusic(e,s){this.k.loadMusic(e,s)}playMusic(e,s){(async()=>this.currentMusic&&!this.currentMusic.paused&&this.currentMusicName===e||(this.isFirstPlay&&(this.isFirstPlay=!1,await B.setTimeoutAsync(100)),await this.fadeOutCurrentMusic(s?.fadeOutDuration),this.currentMusic=this.k.play(e,{loop:!0,volume:this.config.volume,...s}),this.currentMusicName=e))()}setVolume(e){this.config.volume=e,this.currentMusic&&(this.currentMusic.volume=e)}stopMusic(e){this.fadeOutCurrentMusic(e).then(()=>{this.currentMusic=void 0,this.currentMusicName=void 0})}pauseMusic(){this.currentMusic&&(this.currentMusic.paused=!0)}resumeMusic(){this.currentMusic&&(this.currentMusic.paused=!1)}async fadeOutCurrentMusic(e){return e=e??this.config.fadeOutDuration+1e-6,new Promise(s=>{if(this.currentMusic&&!this.currentMusic.paused){const r=this.currentMusic.volume;let i=0;const n=this.k.onUpdate(()=>{i+=this.k.dt(),this.currentMusic.volume=this.k.lerp(r,0,i/e),this.currentMusic.volume===0&&(this.currentMusic.stop(),n.cancel(),s())})}else s()})}}class $t{constructor(e,s="fade",r=.6){this.k=e,this.defaultDuration=r,this.fadeOverlay=e.add(["fade-overlay",e.layer(s),e.rect(e.width(),e.height()),e.color(0,0,0),e.pos(0,0),e.fixed(),e.anchor("topleft"),e.opacity(0),e.stay()])}fadeOverlay;async showOverlay(e=this.defaultDuration){return this.fadeOverlay.opacity=0,this.fadeOverlay.hidden=!1,this.fadeTo(0,1,e)}async hideOverlay(e=this.defaultDuration){await this.fadeTo(1,0,e),this.fadeOverlay.hidden=!1}async fadeTo(e,s,r=1){return new Promise(i=>{let n=0;const a=this.fadeOverlay.onUpdate(()=>{n+=this.k.dt(),this.fadeOverlay.opacity=this.k.lerp(e,s,n/r),n>=r&&(this.fadeOverlay.opacity=s,a.cancel(),i())})})}}class jt{_state;localStorageKey="gameState";isUpdating=!1;subscribersOnUpdate=[];get state(){return this._state}constructor(){const e=localStorage.getItem(this.localStorageKey);try{if(e){const s=JSON.parse(e);this._state={persistent:s,temp:this.getTempStateFromPersistentState(s)}}}catch{}this._state||this.reset()}update(e,s){if(this.isUpdating)throw new Error("Cannot call update() inside another update() call");this.isUpdating=!0,e.temp?.player?.health===0&&(e=B.mergeDeep(e,{persistent:{player:{deaths:this._state.persistent.player.deaths+1}}})),this._state=B.mergeDeep(this._state,e),this.subscribersOnUpdate.forEach(r=>r(this._state)),e.persistent&&!s&&this.save(),this.isUpdating=!1}save(){localStorage.setItem(this.localStorageKey,JSON.stringify(this._state.persistent))}reset(){localStorage.removeItem(this.localStorageKey);const e={currentLevel:void 0,player:{deaths:0,hasLuckyCharm:!1},oldBobr:{isIntroSaid:!1}};this._state={persistent:e,temp:this.getTempStateFromPersistentState(e)},this.update({})}prepareForNewScene(){this._state.temp={...this.getTempStateFromPersistentState(this._state.persistent),player:{health:this._state.temp.player.health?this._state.temp.player.health:this._state.persistent.player.hasLuckyCharm?2:1}}}onUpdate(e){return this.subscribersOnUpdate.push(e),{cancel:()=>{this.subscribersOnUpdate=this.subscribersOnUpdate.filter(s=>s!==e)}}}getTempStateFromPersistentState(e){return{player:{health:e.player.hasLuckyCharm?2:1}}}}async function ce(t,e){ue.hide(),await de.showOverlay(.3),t.go(e)}function Ut(t,e,s,r){const i=t.add([t.sprite(e,{tiled:!0,width:t.width()*10}),t.layer("bg"),t.pos(0,0),t.scale(1.5),t.fixed(),t.anchor("center")]);return i.onUpdate(()=>{i.pos.x=t.width()/2+-t.getCamPos().x/50,i.pos.y=t.height()/2+r?.offsetY-t.getCamPos().y/25}),i}const C={friction:.2},Bt={maxRunSpeed:200,accelGround:200,accelAir:150,decelGround:500,decelAir:300,jumpForce:400,minRunAnimSpeed:1,maxRunAnimSpeed:2,attackPower:1},Fe={async loadResources(t){await t.loadSprite("player","sprites/characters/bobr.gif",{sliceX:5,sliceY:4,anims:{idle:{from:0,to:1,speed:3,loop:!0},walk:{from:5,to:8,speed:10,loop:!0},jump:{from:10,to:10},fall:{from:10,to:10},attack:{from:15,to:19,speed:20,loop:!1}}}),await t.loadSprite("player-hit-wave","sprites/characters/bobr-hit-wave.png"),await t.loadSound("player-attack","sounds/bobr-attack.mp3"),await t.loadSound("player-take-item","sounds/bobr-take-item.ogg"),await t.loadSound("player-take-key","sounds/bobr-take-key.ogg")},spawn(t,e=t.vec2(100,100),s){const r={...Bt,...s},i=t.add(["player",t.sprite("player",{anim:"idle"}),t.pos(e),t.area({shape:new t.Rect(t.vec2(1,0),20,31),...C}),t.body(),t.anchor("bot"),t.opacity(1),t.state("IDLE",["IDLE","WALK","JUMP","FALL","ATTACK","INTERACT"]),t.timer(),{vx:0,config:r,waitForActionButton:u}]);let n,a;function o(){i.jump(r.jumpForce),i.enterState("JUMP")}function c(){return!!a}function l(h,p){i.getCurAnim()?.name!==h&&i.play(h,{onEnd:p})}function u(){return new Promise(h=>{i.onButtonPress("action",()=>{h()})})}i.onButtonPress("jump",()=>{i.state!=="INTERACT"&&i.isGrounded()&&o()}),i.onButtonPress("action",()=>{if(i.state==="ATTACK"||i.state==="INTERACT")return;let h=!0,p=!1;const f=i.add(["player.interaction-hitbox",t.pos(i.flipX?-14:14,0),t.area({shape:new t.Rect(t.vec2(1,0),16,i.height)}),t.rect(20,20,{fill:!1}),t.anchor("bot"),t.opacity(0)]);f.onCollide("interactable",async w=>{p=!0,i.enterState("INTERACT"),await w.interact(i),i.enterState("IDLE")}),f.onUpdate(()=>{h?h=!1:(p||i.enterState("ATTACK"),i.remove(f))})}),i.onFixedUpdate(()=>{const h=t.dt(),p=i.isGrounded();let f=0;if(i.state!=="INTERACT"&&(t.isButtonDown("left")?f=-1:t.isButtonDown("right")&&(f=1)),i.friction=p?C.friction:0,f!==0){let w=p?r.accelGround:r.accelAir;Math.sign(f)!==Math.sign(i.vx)&&(w+=p?r.decelGround:r.decelAir),i.vx=Kt(i.vx,f*r.maxRunSpeed,w*h)}else{const w=p?r.decelGround:r.decelAir,O=Math.max(0,Math.abs(i.vx)-w*h);i.vx=O*Math.sign(i.vx)}i.move(i.vx,0),i.flipX=f<0?!0:f>0?!1:i.flipX,i.area.scale.x=i.flipX?-1:1,i.state==="ATTACK"?i.getCurAnim()?.frameIndex===2&&(n||(n=i.add(["player.hitbox",t.pos(t.vec2(i.flipX?-16:16,0)),t.area(),t.sprite("player-hit-wave",{flipX:i.flipX}),t.anchor("bot"),t.opacity(1),t.lifespan(0,{fade:.15})]),n.onCollide("enemy",w=>{w.registerHit(i),t.play("player-attack")}),n.onDestroy(()=>{n=void 0}))):i.state==="INTERACT"||(p?Math.abs(i.vx)>5?i.enterState("WALK"):i.enterState("IDLE"):i.vel.y<0?i.enterState("JUMP"):i.enterState("FALL")),c()?i.opacity=Math.abs(Math.sin(t.time()*20))*.5+.5:i.opacity=1}),i.onStateEnter("IDLE",()=>{l("idle")}),i.onStateEnter("INTERACT",()=>{l("idle")}),i.onStateUpdate("WALK",()=>{l("walk");const h=t.clamp(Math.abs(i.vx)/r.maxRunSpeed,0,1);i.animSpeed=t.lerp(r.minRunAnimSpeed,r.maxRunAnimSpeed,h)}),i.onStateEnter("JUMP",()=>{l("jump")}),i.onStateEnter("FALL",()=>{l("fall")}),i.onStateEnter("ATTACK",()=>{l("attack",()=>{i.enterState("IDLE")}),i.animSpeed=1}),i.onCollideUpdate("enemy",h=>{!c()&&i.state!=="ATTACK"&&!h.dead&&h.config.attackPower&&(P.update({temp:{player:{health:Math.max(0,P.state.temp.player.health-h.config.attackPower)}}}),i.applyImpulse(t.vec2(Math.sign(i.pos.x-h.pos.x)*150,-230)),t.shake(4),t.play("player-attack"),a?.cancel(),a=i.wait(1),a.onEnd(()=>{a=void 0}))});const d=P.onUpdate(h=>{h.temp.player.health<=0&&ce(t,t.getSceneName()).then()});return i.onDestroy(()=>{a?.cancel(),a=void 0,d.cancel()}),i}};function Kt(t,e,s){const r=e-t;return Math.abs(r)<=s?e:t+Math.sign(e)*s}async function Ht(t,e,s){let r,i=e.split(`
`);await Fe.loadResources(t),await s.preloadResources(t),t.setGravity(0);const n=t.addLevel(i,{pos:t.vec2(0,0),tileWidth:s.tileWidth,tileHeight:s.tileHeight,tiles:{},wildcardTile:(l,u)=>{if(l.trim()){if(l==="P"){r=u.scale(t.vec2(s.tileWidth,s.tileHeight));return}if(s.tiles[l])return s.tiles[l](u,u.scale(t.vec2(s.tileWidth,s.tileHeight)),()=>c(u.x,u.y),o)||void 0}}}),a=Fe.spawn(t,r);t.setGravity(1e3);function o(l,u){return u<0||u>=i.length||l<0||l>=i[u].length?" ":i[u][l]}function c(l,u){return{top:o(l,u-1),bottom:o(l,u+1),left:o(l-1,u),right:o(l+1,u),topLeft:o(l-1,u-1),topRight:o(l+1,u-1),bottomLeft:o(l-1,u+1),bottomRight:o(l+1,u+1)}}return{level:n,player:a}}const $e={async loadResources(t){await t.loadSprite("bumblebee","sprites/enemies/bumblebee.gif",{sliceX:2,sliceY:1,anims:{idle:{from:0,to:1,speed:20,loop:!0},fly:{from:0,to:1,speed:20,loop:!0}}})},spawn(t,e=t.vec2(200,80),s){const r={health:1,attackPower:1,speedX:70,flyDuration:3,...s};let i=-1,n=0,a=!0;const o=t.add(["bumblebee","enemy",t.sprite("bumblebee",{anim:"idle"}),t.state("FLY",["IDLE","FLY"]),t.health(r.health,r.health),t.timer(),t.pos(e),t.area({...C,collisionIgnore:["obstacle"]}),t.body({gravityScale:0}),t.anchor("center"),t.offscreen({pause:!0,unpause:!0,hide:!0}),{registerHit:l=>{o.applyImpulse(t.vec2(Math.sign(o.pos.x-l.pos.x)*180,-120)),o.hp-=l.config.attackPower},config:r}]);function c(l,u){return Math.sin(u*l)*-30}return o.onStateEnter("FLY",async()=>{o.flipX=i<0,o.play("fly"),await o.wait(r.flyDuration*(a?.5:1)),a=!1,o.enterState("IDLE")}),o.onStateUpdate("FLY",()=>{n+=t.dt(),o.move(r.speedX*i,c(6,n))}),o.onStateEnter("IDLE",async()=>{o.play("idle"),await o.wait(1.5),o.dead||(i*=-1,o.enterState("FLY"))}),o.onStateUpdate("IDLE",()=>{n+=t.dt(),o.move(0,c(12,n))}),o.onDeath(()=>{o.paused=!0,o.gravityScale=1,o.collisionIgnore=["*"],o.use(t.rotate(o.flipX?15:-15))}),o.onExitScreen(()=>{o.dead&&o.destroy()}),o}},je={async loadResources(t){await t.loadSprite("gopher","sprites/enemies/gopher.gif",{sliceX:4,sliceY:1,anims:{idle:{from:0,to:0,loop:!1},walk:{from:0,to:3,speed:10,loop:!0}}})},spawn(t,e=t.vec2(100,100),s){const r={health:2,attackPower:1,speedX:50,...s};let i=-1,n=!0;const a=t.add(["gopher","enemy",t.sprite("gopher",{anim:"idle"}),t.state("WALK",["IDLE","WALK"]),t.health(r.health,r.health),t.timer(),t.pos(e),t.area(C),t.body(),t.anchor("bot"),t.offscreen({pause:!0,unpause:!0,hide:!0}),{registerHit:o=>{a.applyImpulse(t.vec2(Math.sign(a.pos.x-o.pos.x)*100,-200)),a.hp-=o.config.attackPower},config:r}]);return a.onStateEnter("WALK",async()=>{a.flipX=i<0,a.play("walk"),await a.wait(4*(n?.5:1)),n=!1,a.enterState("IDLE")}),a.onStateUpdate("WALK",()=>{a.isGrounded()&&a.move(r.speedX*i,0)}),a.onStateEnter("IDLE",async()=>{a.play("idle"),await a.wait(2),a.dead||(i*=-1,a.enterState("WALK"))}),a.onDeath(()=>{a.paused=!0,a.collisionIgnore=["*"],a.use(t.rotate(a.flipX?10:-10))}),a.onExitScreen(()=>{a.dead&&a.destroy()}),a}},Ue={async loadResources(t){await t.loadSprite("home-outside","sprites/home/home-outside.png"),await t.loadSprite("home-inside","sprites/home/home-inside.png"),await t.loadSprite("home-fence","sprites/home/home-fence.png")},spawn(t,e,s){const r={isEveningTime:!1,...s};let i=!0;const n=t.add(["home-container",t.pos(e),t.anchor("botleft"),t.offscreen({hide:!0,pause:!0,unpause:!0,distance:300}),t.state("OUTSIDE",["INSIDE","OUTSIDE"])]);n.add([t.sprite("home-fence"),t.pos(206,0),t.anchor("botleft")]),n.add(["home-outside",t.sprite("home-inside"),t.anchor("botleft")]);const a=n.add(["home-outside",t.sprite("home-outside"),t.anchor("botleft"),t.animate({relative:!0}),t.z(1)]);return Vt(t,n),n.onStateEnter("OUTSIDE",()=>{if(i){i=!1;return}a.unanimateAll(),a.animation.seek(0),a.animate("opacity",[0,1],{duration:1,loops:1}),J.playMusic("start-location")}),n.onStateEnter("INSIDE",()=>{a.unanimateAll(),a.animation.seek(0),a.animate("opacity",[1,0],{duration:1,loops:1}),r.isEveningTime&&J.playMusic("home")}),n.add(["home-entrance",t.rect(20,38,{fill:!1}),t.pos(125,0),t.anchor("botleft"),t.area()]).onCollide("player",()=>{n.state!=="INSIDE"&&n.enterState("INSIDE")}),n.add(["home-exit",t.rect(20,38,{fill:!1}),t.pos(214,0),t.anchor("botleft"),t.area()]).onCollide("player",()=>{n.state!=="OUTSIDE"&&n.enterState("OUTSIDE")}),n}};function Vt(t,e){e.add(["obstacle",t.rect(14,200,{fill:!1}),t.pos(193,-42),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add(["obstacle",t.rect(40,12,{fill:!1}),t.pos(156,-42),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add(["obstacle",t.rect(10,220,{fill:!1}),t.pos(-10,0),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add(["obstacle",t.polygon([t.vec2(178,-54),t.vec2(115,-193),t.vec2(125,-193),t.vec2(188,-54)],{fill:!1}),t.pos(-5,0),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add(["obstacle",t.polygon([t.vec2(115,-193),t.vec2(50,-221),t.vec2(50,-230),t.vec2(125,-193)],{fill:!1}),t.pos(-5,0),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add(["obstacle",t.polygon([t.vec2(50,-221),t.vec2(0,-221),t.vec2(0,-230),t.vec2(50,-230)],{fill:!1}),t.pos(-5,0),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add(["obstacle",t.rect(120,7,{fill:!1}),t.pos(57,-58),t.anchor("botleft"),t.area(C),t.body({isStatic:!0})]),e.add(["obstacle",t.rect(95,7,{fill:!1}),t.pos(0,-122),t.anchor("botleft"),t.area(C),t.body({isStatic:!0})])}const Be=_t(),b=qe({global:!1,width:Be.width,height:Be.height,background:"#000000",letterbox:!0,pixelDensity:2,debug:!0,debugKey:"`",buttons:{left:{keyboard:["left","a"],gamepad:["dpad-left"]},right:{keyboard:["right","d"],gamepad:["dpad-right"]},jump:{keyboard:["space","up","w","k"],gamepad:["south"]},action:{keyboard:["j","z"],gamepad:["east"]}}});function _t(){let t=Math.min(window.innerWidth,400);t%2!==0&&(t-=1);let e=Math.floor(t/(window.innerWidth/window.innerHeight));return e%2!==0&&(e-=1),{width:t,height:e}}const Xe="info-icon-comp";function le(t=0){let e;return{id:Xe,add(){b.loadSprite("info-icon","sprites/icons/info.png"),e=this.add([b.sprite("info-icon"),b.pos(t,-this.height-2),b.anchor("bot"),b.animate({relative:!0})]),e.animate("pos",[b.vec2(0,0),b.vec2(0,-2),b.vec2(0,0),b.vec2(0,-2),b.vec2(0,0),b.vec2(0,0),b.vec2(0,0)],{duration:1,direction:"forward"})},destroy(){e?.destroy(),e=void 0}}}le.id=Xe;function zt(t,e,s,r){r={speed:.05,...r};const i=t.width()/2,n=5;let a="",o=0,c=0,l=!1;const u=t.add([t.rect(i,16,{radius:4}),t.pos(h()),t.color(0,0,0),t.opacity(.6),t.anchor("bot"),t.layer("hud")]),d=u.add([t.pos(t.vec2(0,-n)),t.text("",{size:8,width:i-n*2,font:"pixel",lineSpacing:2}),t.anchor("bot")]);d.onUpdate(()=>{u.height=d.height+n*2,u.pos=h(),l||(c+=t.dt(),c>=r.speed&&(c=0,a+=s[o],d.text=a,o++,o>=s.length&&(l=!0)))});function h(){return e.pos.add(0,-e.height)}return u}function ae(t,e,s,r,i){return new Promise(n=>{let a=0;async function o(){if(a<r.length){const c=zt(t,e,r[a],i);await s.waitForActionButton(),c.destroy(),a++,o().then()}else n()}o().then()})}const Ke={async loadResources(t){await t.loadSprite("old-bobr","sprites/characters/old-bobr.gif",{sliceX:2,sliceY:1,anims:{idle:{from:0,to:1,speed:1.5,loop:!0}}}),await t.loadSound("old-bobr-kurwa-1","sounds/old-bobr-kurwa-1.ogg"),await t.loadSound("old-bobr-kurwa-2","sounds/old-bobr-kurwa-2.ogg")},spawn(t,e=t.vec2(100,100),s){const r={...s},i=t.add(["old-bobr","interactable",t.sprite("old-bobr",{anim:"idle"}),t.state("IDLE",["IDLE","INTERACTING"]),t.timer(),t.pos(e),t.area({...C,collisionIgnore:["player","enemy"]}),t.body(),t.anchor("bot"),t.offscreen({pause:!0,unpause:!0,hide:!0}),{config:r,interact:n,shouldShowInfoIcon:a}]);async function n(u){const d=c();d&&(i.enterState("INTERACTING"),t.play(t.choose(["old-bobr-kurwa-1","old-bobr-kurwa-2"])),i.flipX=i.pos.x>u.pos.x,await l(d,u),i.enterState("IDLE"))}function a(){if(i.state==="INTERACTING")return!1;switch(c()){case"SAY_INTRO_REPEAT":return!1;default:return!0}}function o(){a()?i.use(le(6*(i.flipX?-1:1))):i.unuse(le.id)}function c(){const u=P.state;return u.persistent.oldBobr.isIntroSaid?u.persistent.player.deaths>=1&&!u.persistent.player.hasLuckyCharm?"GIVE_LUCKY_CHARM":"SAY_INTRO_REPEAT":"SAY_INTRO"}async function l(u,d){switch(P.state,u){case"SAY_INTRO":await ae(t,i,d,[U("oldBobr.intro1"),U("oldBobr.intro2")]),P.update({persistent:{oldBobr:{isIntroSaid:!0}}});break;case"SAY_INTRO_REPEAT":await ae(t,i,d,[U(t.choose(["oldBobr.introRepeat1","oldBobr.introRepeat2","oldBobr.introRepeat3"]))]);break;case"GIVE_LUCKY_CHARM":await ae(t,i,d,[U("oldBobr.giveLuckyCharm1"),U("oldBobr.giveLuckyCharm2")]),P.update({persistent:{player:{hasLuckyCharm:!0}},temp:{player:{health:2}}});break}}return i.onStateEnter("IDLE",async()=>{i.play("idle"),o()}),i.onStateEnter("INTERACTING",async()=>{o()}),i.onEnterScreen(()=>{o()}),i}},Wt=`                                                            ,,               ,, ,tG,, ,
                         F ,,                              ---             ---=========
                           ---                                  , ,Gt,,,      .........
                              ,t,F             ,tF,,,r         ---------      .........
          P     ,,,           -----        F ---------          F             .........
H      ,B,  ,,//===\\\\,,t,,,   , G , ,,  t   ,  ,,,G ,, ,,, ,, , ,, ,  ,G,,t //.........
==============.......=======================================================...........
.......................................................................................
.......................................................................................`,z=async t=>{const{player:e,level:s}=await Ht(t,Wt,{preloadResources:async i=>{await Promise.all([i.loadSprite("tile-ground","sprites/tiles/ground.png"),i.loadSprite("tile-grass-ground","sprites/tiles/grass-ground.png"),i.loadSprite("tile-grass-ground-air","sprites/tiles/grass-ground-air.png"),i.loadSprite("tile-grass-ground-air-left","sprites/tiles/grass-ground-air-left.png"),i.loadSprite("tile-grass-ground-air-right","sprites/tiles/grass-ground-air-right.png"),i.loadSprite("tile-grass-ground-inclined-left-1","sprites/tiles/grass-ground-inclined-left-1.png"),i.loadSprite("tile-grass-ground-inclined-left-2","sprites/tiles/grass-ground-inclined-left-2.png"),i.loadSprite("tile-grass-ground-inclined-left-3","sprites/tiles/grass-ground-inclined-left-3.png"),i.loadSprite("tile-grass-1","sprites/tiles/grass-1.png"),i.loadSprite("tile-grass-2","sprites/tiles/grass-2.png"),i.loadSprite("tile-grass-3","sprites/tiles/grass-3.png"),i.loadSprite("tile-tree-1","sprites/tiles/tree-1.png"),i.loadSprite("tile-tree-2","sprites/tiles/tree-2.png"),i.loadSprite("rock","sprites/tiles/rock.png"),je.loadResources(i),$e.loadResources(i),Ue.loadResources(i),Ke.loadResources(i)]),J.loadMusic("home","music/home.mp3"),J.loadMusic("start-location","music/start-location.mp3")},tileWidth:32,tileHeight:32,tiles:{"=":()=>[t.sprite("tile-grass-ground"),t.area(C),t.body({isStatic:!0}),t.anchor("bot"),t.offscreen({hide:!0})],"-":(i,n,a)=>{const o=a();return["obstacle",t.sprite(o.left===" "?"tile-grass-ground-air-left":o.right===" "?"tile-grass-ground-air-right":"tile-grass-ground-air"),t.area({...C,shape:new t.Rect(t.vec2(0,-8),32,24)}),t.body({isStatic:!0}),t.anchor("bot"),t.offscreen({hide:!0})]},".":(i,n,a)=>{const o=a();if(o.topRight==="/")return["obstacle",t.sprite("tile-grass-ground-inclined-left-1"),t.anchor("bot"),t.offscreen({hide:!0})];if(o.topLeft==="\\")return["obstacle",t.sprite("tile-grass-ground-inclined-left-1",{flipX:!0}),t.anchor("bot"),t.offscreen({hide:!0})];const c=o.left===" "||o.right===" "||o.bottom===" "||o.left==="";return["obstacle",t.sprite("tile-ground"),...c?[t.area(C),t.body({isStatic:!0})]:[],t.anchor("bot"),t.offscreen({hide:!0})]},",":()=>[t.sprite(t.choose(["tile-grass-1","tile-grass-2","tile-grass-3"]),{flipX:t.choose([!0,!1])}),t.z(t.choose([1,-1])),t.anchor("bot"),t.offscreen({hide:!0})],"/":(i,n,a)=>a().left==="/"?["obstacle",t.sprite("tile-grass-ground-inclined-left-3"),t.area({...C,shape:new t.Polygon([t.vec2(-16,0),t.vec2(-16,-16),t.vec2(16,-32),t.vec2(16,0)])}),t.body({isStatic:!0}),t.anchor("bot"),t.offscreen({hide:!0})]:["obstacle",t.sprite("tile-grass-ground-inclined-left-2"),t.area({...C,shape:new t.Polygon([t.vec2(-16,0),t.vec2(16,-16),t.vec2(16,0),t.vec2(-16,16)])}),t.body({isStatic:!0}),t.anchor("bot"),t.offscreen({hide:!0})],"\\":(i,n,a)=>a().right==="\\"?["obstacle",t.sprite("tile-grass-ground-inclined-left-3",{flipX:!0}),t.area({...C,shape:new t.Polygon([t.vec2(16,0),t.vec2(16,-16),t.vec2(-16,-32),t.vec2(-16,0)])}),t.body({isStatic:!0}),t.anchor("bot"),t.offscreen({hide:!0})]:["obstacle",t.sprite("tile-grass-ground-inclined-left-2",{flipX:!0}),t.area({...C,shape:new t.Polygon([t.vec2(16,0),t.vec2(-16,-16),t.vec2(-16,0),t.vec2(16,16)])}),t.body({isStatic:!0}),t.anchor("bot"),t.offscreen({hide:!0})],t:()=>[t.sprite(t.choose(["tile-tree-1","tile-tree-2"]),{flipX:t.choose([!0,!1])}),t.z(t.choose([1,-1])),t.anchor("bot"),t.offscreen({hide:!0})],r:()=>["obstacle",t.sprite("rock",{flipX:t.choose([!0,!1])}),t.anchor("bot"),t.area(C),t.body({mass:2}),t.offscreen({hide:!0})],G:(i,n)=>{je.spawn(t,n)},F:(i,n)=>{$e.spawn(t,n)},H:(i,n)=>{Ue.spawn(t,n)},B:(i,n)=>{Ke.spawn(t,n)}}});await t.loadSprite("bg-home-day","sprites/backgrounds/home-day.png"),Ut(t,"bg-home-day",e,{offsetY:40}),J.playMusic("start-location"),P.update({persistent:{currentLevel:z.id}});const r=s.levelWidth()-16;e.onUpdate(()=>{if(!e)return;const i=t.clamp(e.pos.x,t.width()/2,r-t.width()/2),n=e.pos.y-t.height()/4;t.setCamPos(i,n)})};z.id="level-home";const Ye="hud-comp";function M(t){return{id:Ye,shouldBeShown:t.shouldBeShown,targetOpacity:t.targetOpacity||1,add(){this.tag("hud"),this.use(b.layer("hud")),this.use(b.fixed()),this.use(b.stay()),this.use(b.opacity(t.targetOpacity))}}}M.id=Ye;function Xt(t,e){const s=e?.size??100,r=e?.deadZone??.1;t.loadSprite("joystick.jump","sprites/icons/jump.gif"),t.loadSprite("joystick.attack","sprites/icons/attack.gif");let i=!1,n=t.vec2(0,0),a=t.vec2(0,0);const o=t.add(["joystickBase",M({shouldBeShown:!0,targetOpacity:.2}),t.pos(-9999,-9999),t.circle(s/2),t.color(0,0,0),t.anchor("center")]),c=t.add(["joystickKnob",M({shouldBeShown:!0,targetOpacity:.7}),t.pos(-9999,-9999),t.circle(s/4),t.color(255,255,255),t.anchor("center")]),l=t.add(["jumpButton",M({shouldBeShown:!0,targetOpacity:.2}),t.pos(t.width()-s*.5,t.height()-s*.5),t.area(),t.circle(s/3),t.color(0,0,0),t.anchor("center")]);t.add([M({shouldBeShown:!0}),t.sprite("joystick.jump"),t.pos(l.pos),t.anchor("center")]),l.onClick(()=>{t.pressButton("jump"),t.releaseButton("jump")});const u=t.add(["attackButton",M({shouldBeShown:!0,targetOpacity:.2}),t.pos(t.width()-s*1.1,t.height()-s*1.1),t.area(),t.circle(s/2.5),t.color(0,0,0),t.anchor("center")]);t.add([M({shouldBeShown:!0}),t.sprite("joystick.attack"),t.pos(u.pos),t.anchor("center"),t.scale(1.2)]),u.onClick(()=>{t.pressButton("action"),t.releaseButton("action")}),o.onTouchStart(d=>{d.x>t.width()*.6||(n=d,i=!0,o.pos=n,c.pos=n,o.hidden=!1,c.hidden=!1)}),o.onTouchMove(d=>{if(!i||d.x>t.width()*.6)return;a=d.sub(n);const h=s/2,p=t.vec2(t.clamp(a.x,-h,h),t.clamp(a.y,-h,h));c.pos=n.add(p)}),o.onTouchEnd(d=>{d.x>t.width()*.6||(i=!1,a=t.vec2(0,0),o.pos=t.vec2(-9999,-9999),c.pos=t.vec2(-9999,-9999),t.releaseButton("left"),t.releaseButton("right"))}),o.onUpdate(()=>{if(!i)return;const h=a.scale(1/(s/2)).x;h<-r?(t.pressButton("left"),t.releaseButton("right")):h>r?(t.pressButton("right"),t.releaseButton("left")):(t.releaseButton("left"),t.releaseButton("right"))})}class Yt{constructor(e){this.k=e,this.dimOverlay=this.k.add([this.k.layer("hud"),this.k.rect(this.k.width(),this.k.height()),this.k.color(0,0,0),this.k.pos(0,0),this.k.anchor("topleft"),this.k.opacity(0),this.k.fixed(),this.k.stay()]),B.isTouchDevice()&&Xt(this.k,{size:Math.min(window.innerWidth/15,60)}),this.k.loadSprite("reload-button","sprites/icons/reload.png"),this.reloadButton=this.k.add(["reload-button",M({shouldBeShown:!0}),this.k.sprite("reload-button"),this.k.area(),this.k.pos(10,10),this.k.anchor("topleft")]),this.reloadButton.onClick(()=>{P.reset(),ce(this.k,z.id).then()}),this.k.loadSprite("lucky-charm","sprites/icons/lucky-charm.gif",{sliceX:2,sliceY:1,anims:{health2:{from:0,to:0,loop:!1},health1:{from:1,to:1,loop:!1}}}),this.luckyCharm=this.k.add(["lucky-charm",M({shouldBeShown:P.state.persistent.player.hasLuckyCharm}),this.k.sprite("lucky-charm"),this.k.area(),this.k.pos(this.k.width()-10,10),this.k.anchor("topright"),this.k.scale(1)]),this.hide(),P.onUpdate(s=>this.onStateUpdate(s))}isShown=!1;dimOverlay;reloadButton;luckyCharm;show(){this.k.get("hud").forEach(e=>{e.shouldBeShown&&(this.k.tween(0,1,1,s=>{e.opacity=s*(e.targetOpacity??1)}),e.paused=!1)}),this.isShown=!0}hide(){this.k.get("hud").forEach(e=>{e.opacity=0,e.paused=!0}),this.isShown=!1}async showDimOverlay(){return this.k.tween(0,.4,.6,e=>{this.dimOverlay.opacity=e})}async hideDimOverlay(){return this.k.tween(.4,0,.6,e=>{this.dimOverlay.opacity=e})}async onStateUpdate(e){if(e.persistent.player.hasLuckyCharm&&!this.luckyCharm.shouldBeShown){this.luckyCharm.shouldBeShown=!0,this.luckyCharm.paused=!1;const s=this.k.vec2(this.k.width()/2+10,this.k.height()/2-10),r=this.luckyCharm.pos.clone();this.luckyCharm.pos=s.clone(),this.luckyCharm.scale=this.k.vec2(2),await this.showDimOverlay(),await this.k.tween(0,1,1,i=>{this.luckyCharm.opacity=i}),await this.k.wait(1),this.k.play("player-take-key"),this.hideDimOverlay().then(),await this.k.tween(0,1,1.5,i=>{this.luckyCharm.pos=this.k.vec2(this.k.lerp(s.x,r.x,i),this.k.lerp(s.y,r.y,i)),this.luckyCharm.scale=this.k.vec2(this.k.lerp(2,1,i))},this.k.easings.easeOutElastic)}!e.persistent.player.hasLuckyCharm&&this.luckyCharm.shouldBeShown&&(this.luckyCharm.shouldBeShown=!1,this.luckyCharm.paused=!0,this.luckyCharm.opacity=0),e.persistent.player.hasLuckyCharm&&e.temp.player.health&&this.luckyCharm.play("health"+e.temp.player.health)}}function Gt(t,e,s){return async()=>{P.prepareForNewScene(),await e(t),await B.setTimeoutAsync(500),await de.hideOverlay(2),ue.show()}}const Jt={loading:"Loading...",rotateDevice:"Rotate your device",howToInstall:"How to install to the home screen?"},qt={intro1:"Hello, grandson! You finally bought your own hut... Even if it's with a mortgage, you're still doing great!",intro2:"It's a bit empty inside... But I saw some furniture nearby while I was walking here. You can look for it.",introRepeat1:"I saw some furniture nearby while I was walking here. You can look for it.",introRepeat2:"It's a nice day for a walk, don't you think?",introRepeat3:"The house won't furnish itself... Time to get to work!",giveLuckyCharm1:"Oh, I almost forgot! Here, take this for good luck...",giveLuckyCharm2:"It's my lucky charm. May it protect you as it once protected me."},Qt={common:Jt,oldBobr:qt},Zt={loading:"Загрузка...",rotateDevice:"Поверните устройство",howToInstall:"Как установить на домашний экран?"},kt={intro1:"Привет, внучек! Наконец-то ты купил свою хатку... Хоть и в ипотеку, но ты всё равно молодец!",intro2:"Внутри пока пустовато... Но я видел некоторую мебель неподалёку, пока сюда шёл. Ты можешь поискать её.",introRepeat1:"Я видел некоторую мебель неподалёку, пока сюда шёл. Ты можешь поискать её.",introRepeat2:"Неплохой день для прогулки, как ты думаешь?",introRepeat3:"Дом сам себя не обставит... Пора за работу!",giveLuckyCharm1:"О, совсем забыл! Вот, возьми на удачу...",giveLuckyCharm2:"Это мой счастливый талисман. Пусть он защитит тебя как когда-то и меня."},ei={common:Zt,oldBobr:kt},ti=t=>{t.loadSprite("button-play","sprites/icons/play.png"),t.add(["button-play",t.layer("menu"),t.sprite("button-play",{width:100}),t.pos(t.width()/2,t.height()/2),t.anchor("center"),t.area(),t.fixed()]).onClick(()=>{ce(t,z.id).then()})},ii=t=>{t.loadSprite("rotate-device","sprites/icons/rotate-device.gif"),t.add(["rotate-device",t.sprite("rotate-device",{width:100}),t.anchor("bot"),t.pos(t.width()/2,t.height()/2-10),t.scale(t.vec2(-1,1)),t.fixed()]),t.add(["rotate-device-text",t.text(U("common.rotateDevice"),{font:"pixel",size:24,width:t.width()*.8,align:"center",lineSpacing:10}),t.color("white"),t.anchor("top"),t.pos(t.width()/2,t.height()/2+20),t.fixed()]);let e="https://www.cdc.gov/niosh/mining/tools/installpwa.html#cdc_generic_section_2-installing-a-pwa-on-ios";switch(L.language){case"ru":e="https://darkshaurma.com/about/pwa/";break}const s=document.createElement("a");s.href=e,s.target="_blank",s.rel="noopener",s.innerHTML=U("common.howToInstall"),s.style.position="absolute",s.style.width="100%",s.style.boxSizing="border-box",s.style.bottom="10%",s.style.left="0",s.style.display="block",s.style.padding="20px",s.style.color="white",s.style.fontFamily="pixel, monospace",s.style.textAlign="center",s.style.lineHeight="1.5em",document.querySelector("body").appendChild(s),t.onSceneLeave(()=>{document.querySelector("body").removeChild(s)})},P=new jt,J=new Ft(b);let ue,de;(async()=>{await L.use(We).init({supportedLngs:["en","ru"],fallbackLng:"ru",detection:{order:["localStorage","navigator"],caches:["localStorage"]},resources:{ru:{translation:ei},en:{translation:Qt}}}),b.loadFont("pixel","fonts/Press_Start_2P/PressStart2P-Regular.ttf"),b.setLayers(["bg","game","hud","menu","fade"],"game"),b.add([b.layer("bg"),b.rect(b.width(),b.height()),b.color("#74dcf6"),b.pos(0,0),b.anchor("topleft"),b.fixed(),b.stay()]),b.setVolume(.5),ue=new Yt(b),de=new $t(b),b.scene("menu",()=>ti(b)),b.scene("rotate-device",()=>ii(b)),b.scene(z.id,Gt(b,z));const t=B.isLandscapeMode();window.addEventListener("resize",()=>{t||B.isLandscapeMode()!==t&&setTimeout(()=>{window.location.reload()},1e3)}),t?b.go("menu"):b.go("rotate-device")})();
