import{R as y}from"./kaplay-DTLyooHV.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function i(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(t){if(t.ep)return;t.ep=!0;const n=i(t);fetch(t.href,n)}})();function g(e,o){const i=o?.size??100,a=o?.deadZone??.1;e.loadSprite("joystick.jump","sprites/icons/jump.gif"),e.loadSprite("joystick.attack","sprites/icons/attack.gif");let t=!1,n=e.vec2(0,0),r=e.vec2(0,0);const s=e.add(["joystickBase",e.layer("hud"),e.stay(),e.pos(-9999,-9999),e.circle(i/2),e.color(0,0,0),e.opacity(.2),e.fixed(),e.anchor("center")]),c=e.add(["joystickKnob",e.layer("hud"),e.stay(),e.pos(-9999,-9999),e.circle(i/4),e.color(255,255,255),e.opacity(.7),e.fixed(),e.anchor("center")]),l=e.add(["jumpButton",e.layer("hud"),e.stay(),e.pos(e.width()-i*.5,e.height()-i*.5),e.area(),e.circle(i/3),e.color(0,0,0),e.opacity(.2),e.fixed(),e.anchor("center")]);l.add([e.sprite("joystick.jump"),e.anchor("center")]),l.onClick(()=>{e.pressButton("jump"),e.releaseButton("jump")});const p=e.add(["attackButton",e.layer("hud"),e.stay(),e.pos(e.width()-i*1.1,e.height()-i*1.1),e.area(),e.circle(i/2.5),e.color(0,0,0),e.opacity(.2),e.fixed(),e.anchor("center")]);p.add([e.sprite("joystick.attack"),e.anchor("center"),e.scale(1.2)]),p.onClick(()=>{e.pressButton("action"),e.releaseButton("action")}),s.onTouchStart(d=>{d.x>e.width()/2||(n=d,t=!0,s.pos=n,c.pos=n,s.hidden=!1,c.hidden=!1)}),s.onTouchMove(d=>{if(!t)return;r=d.sub(n);const u=i/2,m=e.vec2(e.clamp(r.x,-u,u),e.clamp(r.y,-u,u));c.pos=n.add(m)}),s.onTouchEnd(d=>{d.x>e.width()*.6||(t=!1,r=e.vec2(0,0),s.pos=e.vec2(-9999,-9999),c.pos=e.vec2(-9999,-9999),e.releaseButton("left"),e.releaseButton("right"))}),s.onUpdate(()=>{if(!t)return;const u=r.scale(1/(i/2)).x;u<-a?(e.pressButton("left"),e.releaseButton("right")):u>a?(e.pressButton("right"),e.releaseButton("left")):(e.releaseButton("left"),e.releaseButton("right"))})}const f=v(),h=y({global:!1,width:f.width,height:f.height,background:"#74dcf6",crisp:!0,letterbox:!0,pixelDensity:2,scale:2,debug:!0,debugKey:"`",buttons:{left:{keyboard:["left","a"],gamepad:["dpad-left"]},right:{keyboard:["right","d"],gamepad:["dpad-right"]},jump:{keyboard:["space","up","w","k"],gamepad:["south"]},action:{keyboard:["j","z"],gamepad:["east"]}}});function v(){let e=Math.min(window.innerWidth,400);e%2!==0&&(e-=1);let o=Math.floor(e/(window.innerWidth/window.innerHeight));return o%2!==0&&(o-=1),{width:e,height:o}}class b{static isTouchDevice(o){return o=o||window.navigator.userAgent,"ontouchstart"in window||navigator.maxTouchPoints>0||/ios|iphone|ipad|ipod|android|windows phone/gi.test(o)}}function S(e,o){return{id:"withFriction",require:["pos","body"],update(){const t=this.isGrounded();if(this.vel.x=Math.sign(this.vel.x)*Math.min(Math.abs(this.vel.x),1/0),t&&Math.abs(this.vel.x)>.1){const n=100*e.dt();this.vel.x>0?this.vel.x=Math.max(0,this.vel.x-n):this.vel.x=Math.min(0,this.vel.x+n)}}}}function x(e,o){e.loadSprite("home-outside","sprites/home/home-outside.png"),e.loadSprite("home-inside","sprites/home/home-inside.png"),e.loadSprite("home-fence","sprites/home/home-fence.png");const i=e.add(["home-container",e.pos(o),e.anchor("botleft"),e.offscreen({hide:!0,pause:!0,unpause:!0,distance:300}),e.state("OUTSIDE",["INSIDE","OUTSIDE"])]);i.add([e.sprite("home-fence"),e.pos(206,0),e.anchor("botleft")]),i.add(["home-outside",e.sprite("home-inside"),e.anchor("botleft")]);const a=i.add(["home-outside",e.sprite("home-outside"),e.anchor("botleft"),e.animate({relative:!0})]);return w(e,i),i.onStateEnter("OUTSIDE",()=>{a.unanimateAll(),a.animation.seek(0),a.animate("opacity",[0,1],{duration:1,loops:1})}),i.onStateEnter("INSIDE",()=>{a.unanimateAll(),a.animation.seek(0),a.animate("opacity",[1,0],{duration:1,loops:1})}),i.add(["home-entrance",e.rect(20,38,{fill:!1}),e.pos(165,0),e.anchor("botleft"),e.area()]).onCollide("player",()=>{i.state!=="INSIDE"&&i.enterState("INSIDE")}),i.add(["home-exit",e.rect(20,38,{fill:!1}),e.pos(214,0),e.anchor("botleft"),e.area()]).onCollide("player",()=>{i.state!=="OUTSIDE"&&i.enterState("OUTSIDE")}),i}function w(e,o){o.add([e.rect(14,200,{fill:!1}),e.pos(198,-42),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),o.add([e.rect(40,12,{fill:!1}),e.pos(161,-42),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),o.add([e.rect(10,220,{fill:!1}),e.pos(-10,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),o.add([e.polygon([e.vec2(178,-54),e.vec2(115,-193),e.vec2(125,-193),e.vec2(188,-54)],{fill:!1}),e.pos(0,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),o.add([e.polygon([e.vec2(115,-193),e.vec2(50,-221),e.vec2(50,-230),e.vec2(125,-193)],{fill:!1}),e.pos(0,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),o.add([e.polygon([e.vec2(50,-221),e.vec2(0,-221),e.vec2(0,-230),e.vec2(50,-230)],{fill:!1}),e.pos(0,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})])}const A={maxRunSpeed:200,accelGround:200,accelAir:150,decelGround:500,decelAir:300,jumpForce:400,minRunAnimSpeed:1,maxRunAnimSpeed:2};h.loadSprite("player","sprites/characters/bobr.gif",{sliceX:5,sliceY:4,anims:{idle:{from:0,to:1,speed:3,loop:!0},walk:{from:5,to:8,speed:10,loop:!0},jump:{from:10,to:10},fall:{from:10,to:10},attack:{from:15,to:19,speed:20,loop:!1}}});function E(e,o=e.vec2(100,100),i){const a={...A,...i},t=e.add(["player",e.sprite("player",{anim:"idle"}),e.pos(o),e.area({shape:new e.Rect(e.vec2(1,0),20,31),friction:.2}),e.body(),e.anchor("bot"),e.state("IDLE",["IDLE","WALK","JUMP","FALL","ATTACK"]),{id:"playerCtrl",vx:0,get moveDirection(){return(e.isButtonDown("right")?1:0)+(e.isButtonDown("left")?-1:0)}}]);function n(){t.jump(a.jumpForce),t.enterState("JUMP")}function r(s,c){t.getCurAnim()?.name!==s&&t.play(s,{onEnd:c})}return t.onButtonPress("jump",()=>{t.isGrounded()&&n()}),t.onButtonPress("action",()=>{t.state!=="ATTACK"&&t.enterState("ATTACK")}),t.onUpdate(()=>{const s=e.dt(),c=t.isGrounded(),l=t.moveDirection;if(l!==0){let p=c?a.accelGround:a.accelAir;Math.sign(l)!==Math.sign(t.vx)&&(p+=c?a.decelGround:a.decelAir),t.vx=M(t.vx,l*a.maxRunSpeed,p*s)}else{const p=c?a.decelGround:a.decelAir,d=Math.max(0,Math.abs(t.vx)-p*s);t.vx=d*Math.sign(t.vx)}t.move(t.vx,0),t.flipX=l<0?!0:l>0?!1:t.flipX,t.area.scale.x=t.flipX?-1:1,t.state!=="ATTACK"?c?Math.abs(t.vx)>5?t.enterState("WALK"):t.enterState("IDLE"):t.vel.y<0?t.enterState("JUMP"):t.enterState("FALL"):t.getCurAnim()?.frameIndex===2&&t.add(["player.hitbox",e.pos(e.vec2(t.flipX?-16:16,0)),e.area(),e.rect(20,20),e.opacity(0),e.anchor("bot"),e.lifespan(.1)]).onCollide("enemy",d=>{d.applyImpulse(e.vec2(t.flipX?-20:20,-100))})}),t.onStateEnter("IDLE",()=>{r("idle")}),t.onStateUpdate("WALK",()=>{r("walk");const s=e.clamp(Math.abs(t.vx)/a.maxRunSpeed,0,1);t.animSpeed=e.lerp(a.minRunAnimSpeed,a.maxRunAnimSpeed,s)}),t.onStateEnter("JUMP",()=>{r("jump")}),t.onStateEnter("FALL",()=>{r("fall")}),t.onStateEnter("ATTACK",()=>{r("attack",()=>{t.enterState("IDLE")}),t.animSpeed=1}),t}function M(e,o,i){const a=o-e;return Math.abs(a)<=i?o:e+Math.sign(o)*i}const T={friction:.2},D=e=>{e.setGravity(1e3),e.add([e.rect(1200,20),e.pos(0,e.height()),e.color("#9e9303"),e.area(T),e.anchor("topleft"),e.body({isStatic:!0})]),x(e,e.vec2(0,e.height())),e.add([e.rect(100,20),e.pos(400,e.height()-60),e.color("#9e9303"),e.area(),e.anchor("top"),e.body({isStatic:!0})]),e.add([e.rect(100,20),e.pos(550,e.height()-100),e.color("#9e9303"),e.area(),e.anchor("top"),e.body({isStatic:!0})]),e.add([e.rect(100,20),e.pos(800,e.height()-150),e.color("#9e9303"),e.area(),e.anchor("top"),e.body({isStatic:!0})]),e.add(["enemy",e.pos(430,e.height()-100),e.rect(30,30),e.color("#0000ff"),e.outline(2),e.area(),e.body(),e.anchor("bot"),S(e),e.offscreen({destroy:!0})]);const o=E(e,e.vec2(420,0));e.onUpdate(()=>{e.setCamPos(Math.max(o.pos.x,e.width()/2),o.pos.y-e.height()/4)})};h.setLayers(["game","hud","menu"],"game");h.scene("level-home",()=>D(h));h.go("level-home");b.isTouchDevice()&&g(h,{size:Math.min(window.innerWidth/15,60)});window.addEventListener("resize",()=>{setTimeout(()=>{window.location.reload()},1e3)});
