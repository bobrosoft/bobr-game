import{R as He}from"./kaplay-DTLyooHV.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();const g=e=>typeof e=="string",V=()=>{let e,t;const i=new Promise((n,s)=>{e=n,t=s});return i.resolve=e,i.reject=t,i},ce=e=>e==null?"":""+e,Ve=(e,t,i)=>{e.forEach(n=>{t[n]&&(i[n]=t[n])})},ze=/###/g,de=e=>e&&e.indexOf("###")>-1?e.replace(ze,"."):e,fe=e=>!e||g(e),z=(e,t,i)=>{const n=g(t)?t.split("."):t;let s=0;for(;s<n.length-1;){if(fe(e))return{};const r=de(n[s]);!e[r]&&i&&(e[r]=new i),Object.prototype.hasOwnProperty.call(e,r)?e=e[r]:e={},++s}return fe(e)?{}:{obj:e,k:de(n[s])}},he=(e,t,i)=>{const{obj:n,k:s}=z(e,t,Object);if(n!==void 0||t.length===1){n[s]=i;return}let r=t[t.length-1],o=t.slice(0,t.length-1),a=z(e,o,Object);for(;a.obj===void 0&&o.length;)r=`${o[o.length-1]}.${r}`,o=o.slice(0,o.length-1),a=z(e,o,Object),a?.obj&&typeof a.obj[`${a.k}.${r}`]<"u"&&(a.obj=void 0);a.obj[`${a.k}.${r}`]=i},We=(e,t,i,n)=>{const{obj:s,k:r}=z(e,t,Object);s[r]=s[r]||[],s[r].push(i)},_=(e,t)=>{const{obj:i,k:n}=z(e,t);if(i&&Object.prototype.hasOwnProperty.call(i,n))return i[n]},Xe=(e,t,i)=>{const n=_(e,i);return n!==void 0?n:_(t,i)},Ne=(e,t,i)=>{for(const n in t)n!=="__proto__"&&n!=="constructor"&&(n in e?g(e[n])||e[n]instanceof String||g(t[n])||t[n]instanceof String?i&&(e[n]=t[n]):Ne(e[n],t[n],i):e[n]=t[n]);return e},j=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var Je={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const Ge=e=>g(e)?e.replace(/[&<>"'\/]/g,t=>Je[t]):e;class Ye{constructor(t){this.capacity=t,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(t){const i=this.regExpMap.get(t);if(i!==void 0)return i;const n=new RegExp(t);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(t,n),this.regExpQueue.push(t),n}}const Qe=[" ",",","?","!",";"],_e=new Ye(20),Ze=(e,t,i)=>{t=t||"",i=i||"";const n=Qe.filter(o=>t.indexOf(o)<0&&i.indexOf(o)<0);if(n.length===0)return!0;const s=_e.getRegExp(`(${n.map(o=>o==="?"?"\\?":o).join("|")})`);let r=!s.test(e);if(!r){const o=e.indexOf(i);o>0&&!s.test(e.substring(0,o))&&(r=!0)}return r},te=(e,t,i=".")=>{if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const n=t.split(i);let s=e;for(let r=0;r<n.length;){if(!s||typeof s!="object")return;let o,a="";for(let u=r;u<n.length;++u)if(u!==r&&(a+=i),a+=n[u],o=s[a],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&u<n.length-1)continue;r+=u-r+1;break}s=o}return s},X=e=>e?.replace("_","-"),qe={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){console?.[e]?.apply?.(console,t)}};class Z{constructor(t,i={}){this.init(t,i)}init(t,i={}){this.prefix=i.prefix||"i18next:",this.logger=t||qe,this.options=i,this.debug=i.debug}log(...t){return this.forward(t,"log","",!0)}warn(...t){return this.forward(t,"warn","",!0)}error(...t){return this.forward(t,"error","")}deprecate(...t){return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(t,i,n,s){return s&&!this.debug?null:(g(t[0])&&(t[0]=`${n}${this.prefix} ${t[0]}`),this.logger[i](t))}create(t){return new Z(this.logger,{prefix:`${this.prefix}:${t}:`,...this.options})}clone(t){return t=t||this.options,t.prefix=t.prefix||this.prefix,new Z(this.logger,t)}}var I=new Z;class k{constructor(){this.observers={}}on(t,i){return t.split(" ").forEach(n=>{this.observers[n]||(this.observers[n]=new Map);const s=this.observers[n].get(i)||0;this.observers[n].set(i,s+1)}),this}off(t,i){if(this.observers[t]){if(!i){delete this.observers[t];return}this.observers[t].delete(i)}}emit(t,...i){this.observers[t]&&Array.from(this.observers[t].entries()).forEach(([s,r])=>{for(let o=0;o<r;o++)s(...i)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([s,r])=>{for(let o=0;o<r;o++)s.apply(s,[t,...i])})}}class pe extends k{constructor(t,i={ns:["translation"],defaultNS:"translation"}){super(),this.data=t||{},this.options=i,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}removeNamespaces(t){const i=this.options.ns.indexOf(t);i>-1&&this.options.ns.splice(i,1)}getResource(t,i,n,s={}){const r=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator,o=s.ignoreJSONStructure!==void 0?s.ignoreJSONStructure:this.options.ignoreJSONStructure;let a;t.indexOf(".")>-1?a=t.split("."):(a=[t,i],n&&(Array.isArray(n)?a.push(...n):g(n)&&r?a.push(...n.split(r)):a.push(n)));const u=_(this.data,a);return!u&&!i&&!n&&t.indexOf(".")>-1&&(t=a[0],i=a[1],n=a.slice(2).join(".")),u||!o||!g(n)?u:te(this.data?.[t]?.[i],n,r)}addResource(t,i,n,s,r={silent:!1}){const o=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator;let a=[t,i];n&&(a=a.concat(o?n.split(o):n)),t.indexOf(".")>-1&&(a=t.split("."),s=i,i=a[1]),this.addNamespaces(i),he(this.data,a,s),r.silent||this.emit("added",t,i,n,s)}addResources(t,i,n,s={silent:!1}){for(const r in n)(g(n[r])||Array.isArray(n[r]))&&this.addResource(t,i,r,n[r],{silent:!0});s.silent||this.emit("added",t,i,n)}addResourceBundle(t,i,n,s,r,o={silent:!1,skipCopy:!1}){let a=[t,i];t.indexOf(".")>-1&&(a=t.split("."),s=n,n=i,i=a[1]),this.addNamespaces(i);let u=_(this.data,a)||{};o.skipCopy||(n=JSON.parse(JSON.stringify(n))),s?Ne(u,n,r):u={...u,...n},he(this.data,a,u),o.silent||this.emit("added",t,i,n)}removeResourceBundle(t,i){this.hasResourceBundle(t,i)&&delete this.data[t][i],this.removeNamespaces(i),this.emit("removed",t,i)}hasResourceBundle(t,i){return this.getResource(t,i)!==void 0}getResourceBundle(t,i){return i||(i=this.options.defaultNS),this.getResource(t,i)}getDataByLanguage(t){return this.data[t]}hasLanguageSomeTranslations(t){const i=this.getDataByLanguage(t);return!!(i&&Object.keys(i)||[]).find(s=>i[s]&&Object.keys(i[s]).length>0)}toJSON(){return this.data}}var Ae={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,i,n,s){return e.forEach(r=>{t=this.processors[r]?.process(t,i,n,s)??t}),t}};const ge={},me=e=>!g(e)&&typeof e!="boolean"&&typeof e!="number";class q extends k{constructor(t,i={}){super(),Ve(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,this),this.options=i,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=I.create("translator")}changeLanguage(t){t&&(this.language=t)}exists(t,i={interpolation:{}}){const n={...i};return t==null?!1:this.resolve(t,n)?.res!==void 0}extractFromKey(t,i){let n=i.nsSeparator!==void 0?i.nsSeparator:this.options.nsSeparator;n===void 0&&(n=":");const s=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let r=i.ns||this.options.defaultNS||[];const o=n&&t.indexOf(n)>-1,a=!this.options.userDefinedKeySeparator&&!i.keySeparator&&!this.options.userDefinedNsSeparator&&!i.nsSeparator&&!Ze(t,n,s);if(o&&!a){const u=t.match(this.interpolator.nestingRegexp);if(u&&u.length>0)return{key:t,namespaces:g(r)?[r]:r};const l=t.split(n);(n!==s||n===s&&this.options.ns.indexOf(l[0])>-1)&&(r=l.shift()),t=l.join(s)}return{key:t,namespaces:g(r)?[r]:r}}translate(t,i,n){let s=typeof i=="object"?{...i}:i;if(typeof s!="object"&&this.options.overloadTranslationOptionHandler&&(s=this.options.overloadTranslationOptionHandler(arguments)),typeof options=="object"&&(s={...s}),s||(s={}),t==null)return"";Array.isArray(t)||(t=[String(t)]);const r=s.returnDetails!==void 0?s.returnDetails:this.options.returnDetails,o=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator,{key:a,namespaces:u}=this.extractFromKey(t[t.length-1],s),l=u[u.length-1];let d=s.nsSeparator!==void 0?s.nsSeparator:this.options.nsSeparator;d===void 0&&(d=":");const c=s.lng||this.language,f=s.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(c?.toLowerCase()==="cimode")return f?r?{res:`${l}${d}${a}`,usedKey:a,exactUsedKey:a,usedLng:c,usedNS:l,usedParams:this.getUsedParamsDetails(s)}:`${l}${d}${a}`:r?{res:a,usedKey:a,exactUsedKey:a,usedLng:c,usedNS:l,usedParams:this.getUsedParamsDetails(s)}:a;const h=this.resolve(t,s);let p=h?.res;const y=h?.usedKey||a,w=h?.exactUsedKey||a,O=["[object Number]","[object Function]","[object RegExp]"],b=s.joinArrays!==void 0?s.joinArrays:this.options.joinArrays,F=!this.i18nFormat||this.i18nFormat.handleAsObject,L=s.count!==void 0&&!g(s.count),T=q.hasDefaultValue(s),A=L?this.pluralResolver.getSuffix(c,s.count,s):"",M=s.ordinal&&L?this.pluralResolver.getSuffix(c,s.count,{ordinal:!1}):"",oe=L&&!s.ordinal&&s.count===0,$=oe&&s[`defaultValue${this.options.pluralSeparator}zero`]||s[`defaultValue${A}`]||s[`defaultValue${M}`]||s.defaultValue;let C=p;F&&!p&&T&&(C=$);const Ke=me(C),Be=Object.prototype.toString.apply(C);if(F&&C&&Ke&&O.indexOf(Be)<0&&!(g(b)&&Array.isArray(C))){if(!s.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const R=this.options.returnedObjectHandler?this.options.returnedObjectHandler(y,C,{...s,ns:u}):`key '${a} (${this.language})' returned an object instead of string.`;return r?(h.res=R,h.usedParams=this.getUsedParamsDetails(s),h):R}if(o){const R=Array.isArray(C),P=R?[]:{},ae=R?w:y;for(const E in C)if(Object.prototype.hasOwnProperty.call(C,E)){const D=`${ae}${o}${E}`;T&&!p?P[E]=this.translate(D,{...s,defaultValue:me($)?$[E]:void 0,joinArrays:!1,ns:u}):P[E]=this.translate(D,{...s,joinArrays:!1,ns:u}),P[E]===D&&(P[E]=C[E])}p=P}}else if(F&&g(b)&&Array.isArray(p))p=p.join(b),p&&(p=this.extendTranslation(p,t,s,n));else{let R=!1,P=!1;!this.isValidLookup(p)&&T&&(R=!0,p=$),this.isValidLookup(p)||(P=!0,p=a);const E=(s.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&P?void 0:p,D=T&&$!==p&&this.options.updateMissing;if(P||R||D){if(this.logger.log(D?"updateKey":"missingKey",c,l,a,D?$:p),o){const v=this.resolve(a,{...s,keySeparator:!1});v&&v.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let B=[];const Y=this.languageUtils.getFallbackCodes(this.options.fallbackLng,s.lng||this.language);if(this.options.saveMissingTo==="fallback"&&Y&&Y[0])for(let v=0;v<Y.length;v++)B.push(Y[v]);else this.options.saveMissingTo==="all"?B=this.languageUtils.toResolveHierarchy(s.lng||this.language):B.push(s.lng||this.language);const le=(v,N,H)=>{const ue=T&&H!==p?H:E;this.options.missingKeyHandler?this.options.missingKeyHandler(v,l,N,ue,D,s):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(v,l,N,ue,D,s),this.emit("missingKey",v,l,N,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&L?B.forEach(v=>{const N=this.pluralResolver.getSuffixes(v,s);oe&&s[`defaultValue${this.options.pluralSeparator}zero`]&&N.indexOf(`${this.options.pluralSeparator}zero`)<0&&N.push(`${this.options.pluralSeparator}zero`),N.forEach(H=>{le([v],a+H,s[`defaultValue${H}`]||$)})}):le(B,a,$))}p=this.extendTranslation(p,t,s,h,n),P&&p===a&&this.options.appendNamespaceToMissingKey&&(p=`${l}${d}${a}`),(P||R)&&this.options.parseMissingKeyHandler&&(p=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}${d}${a}`:a,R?p:void 0,s))}return r?(h.res=p,h.usedParams=this.getUsedParamsDetails(s),h):p}extendTranslation(t,i,n,s,r){if(this.i18nFormat?.parse)t=this.i18nFormat.parse(t,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||s.usedLng,s.usedNS,s.usedKey,{resolved:s});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});const u=g(t)&&(n?.interpolation?.skipOnVariables!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let l;if(u){const c=t.match(this.interpolator.nestingRegexp);l=c&&c.length}let d=n.replace&&!g(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(d={...this.options.interpolation.defaultVariables,...d}),t=this.interpolator.interpolate(t,d,n.lng||this.language||s.usedLng,n),u){const c=t.match(this.interpolator.nestingRegexp),f=c&&c.length;l<f&&(n.nest=!1)}!n.lng&&s&&s.res&&(n.lng=this.language||s.usedLng),n.nest!==!1&&(t=this.interpolator.nest(t,(...c)=>r?.[0]===c[0]&&!n.context?(this.logger.warn(`It seems you are nesting recursively key: ${c[0]} in key: ${i[0]}`),null):this.translate(...c,i),n)),n.interpolation&&this.interpolator.reset()}const o=n.postProcess||this.options.postProcess,a=g(o)?[o]:o;return t!=null&&a?.length&&n.applyPostProcessor!==!1&&(t=Ae.handle(a,t,i,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...s,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),t}resolve(t,i={}){let n,s,r,o,a;return g(t)&&(t=[t]),t.forEach(u=>{if(this.isValidLookup(n))return;const l=this.extractFromKey(u,i),d=l.key;s=d;let c=l.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const f=i.count!==void 0&&!g(i.count),h=f&&!i.ordinal&&i.count===0,p=i.context!==void 0&&(g(i.context)||typeof i.context=="number")&&i.context!=="",y=i.lngs?i.lngs:this.languageUtils.toResolveHierarchy(i.lng||this.language,i.fallbackLng);c.forEach(w=>{this.isValidLookup(n)||(a=w,!ge[`${y[0]}-${w}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(a)&&(ge[`${y[0]}-${w}`]=!0,this.logger.warn(`key "${s}" for languages "${y.join(", ")}" won't get resolved as namespace "${a}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),y.forEach(O=>{if(this.isValidLookup(n))return;o=O;const b=[d];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(b,d,O,w,i);else{let L;f&&(L=this.pluralResolver.getSuffix(O,i.count,i));const T=`${this.options.pluralSeparator}zero`,A=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(f&&(b.push(d+L),i.ordinal&&L.indexOf(A)===0&&b.push(d+L.replace(A,this.options.pluralSeparator)),h&&b.push(d+T)),p){const M=`${d}${this.options.contextSeparator}${i.context}`;b.push(M),f&&(b.push(M+L),i.ordinal&&L.indexOf(A)===0&&b.push(M+L.replace(A,this.options.pluralSeparator)),h&&b.push(M+T))}}let F;for(;F=b.pop();)this.isValidLookup(n)||(r=F,n=this.getResource(O,w,F,i))}))})}),{res:n,usedKey:s,exactUsedKey:r,usedLng:o,usedNS:a}}isValidLookup(t){return t!==void 0&&!(!this.options.returnNull&&t===null)&&!(!this.options.returnEmptyString&&t==="")}getResource(t,i,n,s={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(t,i,n,s):this.resourceStore.getResource(t,i,n,s)}getUsedParamsDetails(t={}){const i=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=t.replace&&!g(t.replace);let s=n?t.replace:t;if(n&&typeof t.count<"u"&&(s.count=t.count),this.options.interpolation.defaultVariables&&(s={...this.options.interpolation.defaultVariables,...s}),!n){s={...s};for(const r of i)delete s[r]}return s}static hasDefaultValue(t){const i="defaultValue";for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&i===n.substring(0,i.length)&&t[n]!==void 0)return!0;return!1}}class ye{constructor(t){this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=I.create("languageUtils")}getScriptPartFromCode(t){if(t=X(t),!t||t.indexOf("-")<0)return null;const i=t.split("-");return i.length===2||(i.pop(),i[i.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(i.join("-"))}getLanguagePartFromCode(t){if(t=X(t),!t||t.indexOf("-")<0)return t;const i=t.split("-");return this.formatLanguageCode(i[0])}formatLanguageCode(t){if(g(t)&&t.indexOf("-")>-1){let i;try{i=Intl.getCanonicalLocales(t)[0]}catch{}return i&&this.options.lowerCaseLng&&(i=i.toLowerCase()),i||(this.options.lowerCaseLng?t.toLowerCase():t)}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}isSupportedCode(t){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}getBestMatchFromCodes(t){if(!t)return null;let i;return t.forEach(n=>{if(i)return;const s=this.formatLanguageCode(n);(!this.options.supportedLngs||this.isSupportedCode(s))&&(i=s)}),!i&&this.options.supportedLngs&&t.forEach(n=>{if(i)return;const s=this.getScriptPartFromCode(n);if(this.isSupportedCode(s))return i=s;const r=this.getLanguagePartFromCode(n);if(this.isSupportedCode(r))return i=r;i=this.options.supportedLngs.find(o=>{if(o===r)return o;if(!(o.indexOf("-")<0&&r.indexOf("-")<0)&&(o.indexOf("-")>0&&r.indexOf("-")<0&&o.substring(0,o.indexOf("-"))===r||o.indexOf(r)===0&&r.length>1))return o})}),i||(i=this.getFallbackCodes(this.options.fallbackLng)[0]),i}getFallbackCodes(t,i){if(!t)return[];if(typeof t=="function"&&(t=t(i)),g(t)&&(t=[t]),Array.isArray(t))return t;if(!i)return t.default||[];let n=t[i];return n||(n=t[this.getScriptPartFromCode(i)]),n||(n=t[this.formatLanguageCode(i)]),n||(n=t[this.getLanguagePartFromCode(i)]),n||(n=t.default),n||[]}toResolveHierarchy(t,i){const n=this.getFallbackCodes((i===!1?[]:i)||this.options.fallbackLng||[],t),s=[],r=o=>{o&&(this.isSupportedCode(o)?s.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return g(t)&&(t.indexOf("-")>-1||t.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&r(this.formatLanguageCode(t)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&r(this.getScriptPartFromCode(t)),this.options.load!=="currentOnly"&&r(this.getLanguagePartFromCode(t))):g(t)&&r(this.formatLanguageCode(t)),n.forEach(o=>{s.indexOf(o)<0&&r(this.formatLanguageCode(o))}),s}}const be={zero:0,one:1,two:2,few:3,many:4,other:5},xe={select:e=>e===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class ke{constructor(t,i={}){this.languageUtils=t,this.options=i,this.logger=I.create("pluralResolver"),this.pluralRulesCache={}}addRule(t,i){this.rules[t]=i}clearCache(){this.pluralRulesCache={}}getRule(t,i={}){const n=X(t==="dev"?"en":t),s=i.ordinal?"ordinal":"cardinal",r=JSON.stringify({cleanedCode:n,type:s});if(r in this.pluralRulesCache)return this.pluralRulesCache[r];let o;try{o=new Intl.PluralRules(n,{type:s})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),xe;if(!t.match(/-|_/))return xe;const u=this.languageUtils.getLanguagePartFromCode(t);o=this.getRule(u,i)}return this.pluralRulesCache[r]=o,o}needsPlural(t,i={}){let n=this.getRule(t,i);return n||(n=this.getRule("dev",i)),n?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(t,i,n={}){return this.getSuffixes(t,n).map(s=>`${i}${s}`)}getSuffixes(t,i={}){let n=this.getRule(t,i);return n||(n=this.getRule("dev",i)),n?n.resolvedOptions().pluralCategories.sort((s,r)=>be[s]-be[r]).map(s=>`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${s}`):[]}getSuffix(t,i,n={}){const s=this.getRule(t,n);return s?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${s.select(i)}`:(this.logger.warn(`no plural rule found for: ${t}`),this.getSuffix("dev",i,n))}}const Se=(e,t,i,n=".",s=!0)=>{let r=Xe(e,t,i);return!r&&s&&g(i)&&(r=te(e,i,n),r===void 0&&(r=te(t,i,n))),r},ee=e=>e.replace(/\$/g,"$$$$");class et{constructor(t={}){this.logger=I.create("interpolator"),this.options=t,this.format=t?.interpolation?.format||(i=>i),this.init(t)}init(t={}){t.interpolation||(t.interpolation={escapeValue:!0});const{escape:i,escapeValue:n,useRawValueToEscape:s,prefix:r,prefixEscaped:o,suffix:a,suffixEscaped:u,formatSeparator:l,unescapeSuffix:d,unescapePrefix:c,nestingPrefix:f,nestingPrefixEscaped:h,nestingSuffix:p,nestingSuffixEscaped:y,nestingOptionsSeparator:w,maxReplaces:O,alwaysFormat:b}=t.interpolation;this.escape=i!==void 0?i:Ge,this.escapeValue=n!==void 0?n:!0,this.useRawValueToEscape=s!==void 0?s:!1,this.prefix=r?j(r):o||"{{",this.suffix=a?j(a):u||"}}",this.formatSeparator=l||",",this.unescapePrefix=d?"":c||"-",this.unescapeSuffix=this.unescapePrefix?"":d||"",this.nestingPrefix=f?j(f):h||j("$t("),this.nestingSuffix=p?j(p):y||j(")"),this.nestingOptionsSeparator=w||",",this.maxReplaces=O||1e3,this.alwaysFormat=b!==void 0?b:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const t=(i,n)=>i?.source===n?(i.lastIndex=0,i):new RegExp(n,"g");this.regexp=t(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=t(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=t(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(t,i,n,s){let r,o,a;const u=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=h=>{if(h.indexOf(this.formatSeparator)<0){const O=Se(i,u,h,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(O,void 0,n,{...s,...i,interpolationkey:h}):O}const p=h.split(this.formatSeparator),y=p.shift().trim(),w=p.join(this.formatSeparator).trim();return this.format(Se(i,u,y,this.options.keySeparator,this.options.ignoreJSONStructure),w,n,{...s,...i,interpolationkey:y})};this.resetRegExp();const d=s?.missingInterpolationHandler||this.options.missingInterpolationHandler,c=s?.interpolation?.skipOnVariables!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:h=>ee(h)},{regex:this.regexp,safeValue:h=>this.escapeValue?ee(this.escape(h)):ee(h)}].forEach(h=>{for(a=0;r=h.regex.exec(t);){const p=r[1].trim();if(o=l(p),o===void 0)if(typeof d=="function"){const w=d(t,r,s);o=g(w)?w:""}else if(s&&Object.prototype.hasOwnProperty.call(s,p))o="";else if(c){o=r[0];continue}else this.logger.warn(`missed to pass in variable ${p} for interpolating ${t}`),o="";else!g(o)&&!this.useRawValueToEscape&&(o=ce(o));const y=h.safeValue(o);if(t=t.replace(r[0],y),c?(h.regex.lastIndex+=o.length,h.regex.lastIndex-=r[0].length):h.regex.lastIndex=0,a++,a>=this.maxReplaces)break}}),t}nest(t,i,n={}){let s,r,o;const a=(u,l)=>{const d=this.nestingOptionsSeparator;if(u.indexOf(d)<0)return u;const c=u.split(new RegExp(`${d}[ ]*{`));let f=`{${c[1]}`;u=c[0],f=this.interpolate(f,o);const h=f.match(/'/g),p=f.match(/"/g);((h?.length??0)%2===0&&!p||p.length%2!==0)&&(f=f.replace(/'/g,'"'));try{o=JSON.parse(f),l&&(o={...l,...o})}catch(y){return this.logger.warn(`failed parsing options string in nesting for key ${u}`,y),`${u}${d}${f}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,u};for(;s=this.nestingRegexp.exec(t);){let u=[];o={...n},o=o.replace&&!g(o.replace)?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;const l=/{.*}/.test(s[1])?s[1].lastIndexOf("}")+1:s[1].indexOf(this.formatSeparator);if(l!==-1&&(u=s[1].slice(l).split(this.formatSeparator).map(d=>d.trim()).filter(Boolean),s[1]=s[1].slice(0,l)),r=i(a.call(this,s[1].trim(),o),o),r&&s[0]===t&&!g(r))return r;g(r)||(r=ce(r)),r||(this.logger.warn(`missed to resolve ${s[1]} for nesting ${t}`),r=""),u.length&&(r=u.reduce((d,c)=>this.format(d,c,n.lng,{...n,interpolationkey:s[1].trim()}),r.trim())),t=t.replace(s[0],r),this.regexp.lastIndex=0}return t}}const tt=e=>{let t=e.toLowerCase().trim();const i={};if(e.indexOf("(")>-1){const n=e.split("(");t=n[0].toLowerCase().trim();const s=n[1].substring(0,n[1].length-1);t==="currency"&&s.indexOf(":")<0?i.currency||(i.currency=s.trim()):t==="relativetime"&&s.indexOf(":")<0?i.range||(i.range=s.trim()):s.split(";").forEach(o=>{if(o){const[a,...u]=o.split(":"),l=u.join(":").trim().replace(/^'+|'+$/g,""),d=a.trim();i[d]||(i[d]=l),l==="false"&&(i[d]=!1),l==="true"&&(i[d]=!0),isNaN(l)||(i[d]=parseInt(l,10))}})}return{formatName:t,formatOptions:i}},we=e=>{const t={};return(i,n,s)=>{let r=s;s&&s.interpolationkey&&s.formatParams&&s.formatParams[s.interpolationkey]&&s[s.interpolationkey]&&(r={...r,[s.interpolationkey]:void 0});const o=n+JSON.stringify(r);let a=t[o];return a||(a=e(X(n),s),t[o]=a),a(i)}},it=e=>(t,i,n)=>e(X(i),n)(t);class st{constructor(t={}){this.logger=I.create("formatter"),this.options=t,this.init(t)}init(t,i={interpolation:{}}){this.formatSeparator=i.interpolation.formatSeparator||",";const n=i.cacheInBuiltFormats?we:it;this.formats={number:n((s,r)=>{const o=new Intl.NumberFormat(s,{...r});return a=>o.format(a)}),currency:n((s,r)=>{const o=new Intl.NumberFormat(s,{...r,style:"currency"});return a=>o.format(a)}),datetime:n((s,r)=>{const o=new Intl.DateTimeFormat(s,{...r});return a=>o.format(a)}),relativetime:n((s,r)=>{const o=new Intl.RelativeTimeFormat(s,{...r});return a=>o.format(a,r.range||"day")}),list:n((s,r)=>{const o=new Intl.ListFormat(s,{...r});return a=>o.format(a)})}}add(t,i){this.formats[t.toLowerCase().trim()]=i}addCached(t,i){this.formats[t.toLowerCase().trim()]=we(i)}format(t,i,n,s={}){const r=i.split(this.formatSeparator);if(r.length>1&&r[0].indexOf("(")>1&&r[0].indexOf(")")<0&&r.find(a=>a.indexOf(")")>-1)){const a=r.findIndex(u=>u.indexOf(")")>-1);r[0]=[r[0],...r.splice(1,a)].join(this.formatSeparator)}return r.reduce((a,u)=>{const{formatName:l,formatOptions:d}=tt(u);if(this.formats[l]){let c=a;try{const f=s?.formatParams?.[s.interpolationkey]||{},h=f.locale||f.lng||s.locale||s.lng||n;c=this.formats[l](a,h,{...d,...s,...f})}catch(f){this.logger.warn(f)}return c}else this.logger.warn(`there was no format function for ${l}`);return a},t)}}const nt=(e,t)=>{e.pending[t]!==void 0&&(delete e.pending[t],e.pendingCount--)};class rt extends k{constructor(t,i,n,s={}){super(),this.backend=t,this.store=i,this.services=n,this.languageUtils=n.languageUtils,this.options=s,this.logger=I.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=s.maxParallelReads||10,this.readingCalls=0,this.maxRetries=s.maxRetries>=0?s.maxRetries:5,this.retryTimeout=s.retryTimeout>=1?s.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(n,s.backend,s)}queueLoad(t,i,n,s){const r={},o={},a={},u={};return t.forEach(l=>{let d=!0;i.forEach(c=>{const f=`${l}|${c}`;!n.reload&&this.store.hasResourceBundle(l,c)?this.state[f]=2:this.state[f]<0||(this.state[f]===1?o[f]===void 0&&(o[f]=!0):(this.state[f]=1,d=!1,o[f]===void 0&&(o[f]=!0),r[f]===void 0&&(r[f]=!0),u[c]===void 0&&(u[c]=!0)))}),d||(a[l]=!0)}),(Object.keys(r).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:s}),{toLoad:Object.keys(r),pending:Object.keys(o),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(u)}}loaded(t,i,n){const s=t.split("|"),r=s[0],o=s[1];i&&this.emit("failedLoading",r,o,i),!i&&n&&this.store.addResourceBundle(r,o,n,void 0,void 0,{skipCopy:!0}),this.state[t]=i?-1:2,i&&n&&(this.state[t]=0);const a={};this.queue.forEach(u=>{We(u.loaded,[r],o),nt(u,t),i&&u.errors.push(i),u.pendingCount===0&&!u.done&&(Object.keys(u.loaded).forEach(l=>{a[l]||(a[l]={});const d=u.loaded[l];d.length&&d.forEach(c=>{a[l][c]===void 0&&(a[l][c]=!0)})}),u.done=!0,u.errors.length?u.callback(u.errors):u.callback())}),this.emit("loaded",a),this.queue=this.queue.filter(u=>!u.done)}read(t,i,n,s=0,r=this.retryTimeout,o){if(!t.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:t,ns:i,fcName:n,tried:s,wait:r,callback:o});return}this.readingCalls++;const a=(l,d)=>{if(this.readingCalls--,this.waitingReads.length>0){const c=this.waitingReads.shift();this.read(c.lng,c.ns,c.fcName,c.tried,c.wait,c.callback)}if(l&&d&&s<this.maxRetries){setTimeout(()=>{this.read.call(this,t,i,n,s+1,r*2,o)},r);return}o(l,d)},u=this.backend[n].bind(this.backend);if(u.length===2){try{const l=u(t,i);l&&typeof l.then=="function"?l.then(d=>a(null,d)).catch(a):a(null,l)}catch(l){a(l)}return}return u(t,i,a)}prepareLoading(t,i,n={},s){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),s&&s();g(t)&&(t=this.languageUtils.toResolveHierarchy(t)),g(i)&&(i=[i]);const r=this.queueLoad(t,i,n,s);if(!r.toLoad.length)return r.pending.length||s(),null;r.toLoad.forEach(o=>{this.loadOne(o)})}load(t,i,n){this.prepareLoading(t,i,{},n)}reload(t,i,n){this.prepareLoading(t,i,{reload:!0},n)}loadOne(t,i=""){const n=t.split("|"),s=n[0],r=n[1];this.read(s,r,"read",void 0,void 0,(o,a)=>{o&&this.logger.warn(`${i}loading namespace ${r} for language ${s} failed`,o),!o&&a&&this.logger.log(`${i}loaded namespace ${r} for language ${s}`,a),this.loaded(t,o,a)})}saveMissing(t,i,n,s,r,o={},a=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(i)){this.logger.warn(`did not save key "${n}" as the namespace "${i}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(n==null||n==="")){if(this.backend?.create){const u={...o,isUpdate:r},l=this.backend.create.bind(this.backend);if(l.length<6)try{let d;l.length===5?d=l(t,i,n,s,u):d=l(t,i,n,s),d&&typeof d.then=="function"?d.then(c=>a(null,c)).catch(a):a(null,d)}catch(d){a(d)}else l(t,i,n,s,a,u)}!t||!t[0]||this.store.addResource(t[0],i,n,s)}}}const ve=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if(typeof e[1]=="object"&&(t=e[1]),g(e[1])&&(t.defaultValue=e[1]),g(e[2])&&(t.tDescription=e[2]),typeof e[2]=="object"||typeof e[3]=="object"){const i=e[3]||e[2];Object.keys(i).forEach(n=>{t[n]=i[n]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),Le=e=>(g(e.ns)&&(e.ns=[e.ns]),g(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),g(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs?.indexOf?.("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),typeof e.initImmediate=="boolean"&&(e.initAsync=e.initImmediate),e),Q=()=>{},ot=e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(i=>{typeof e[i]=="function"&&(e[i]=e[i].bind(e))})};class J extends k{constructor(t={},i){if(super(),this.options=Le(t),this.services={},this.logger=I,this.modules={external:[]},ot(this),i&&!this.isInitialized&&!t.isClone){if(!this.options.initAsync)return this.init(t,i),this;setTimeout(()=>{this.init(t,i)},0)}}init(t={},i){this.isInitializing=!0,typeof t=="function"&&(i=t,t={}),t.defaultNS==null&&t.ns&&(g(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const n=ve();this.options={...n,...this.options,...Le(t)},this.options.interpolation={...n.interpolation,...this.options.interpolation},t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const s=l=>l?typeof l=="function"?new l:l:null;if(!this.options.isClone){this.modules.logger?I.init(s(this.modules.logger),this.options):I.init(null,this.options);let l;this.modules.formatter?l=this.modules.formatter:l=st;const d=new ye(this.options);this.store=new pe(this.options.resources,this.options);const c=this.services;c.logger=I,c.resourceStore=this.store,c.languageUtils=d,c.pluralResolver=new ke(d,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==n.interpolation.format&&this.logger.warn("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),l&&(!this.options.interpolation.format||this.options.interpolation.format===n.interpolation.format)&&(c.formatter=s(l),c.formatter.init&&c.formatter.init(c,this.options),this.options.interpolation.format=c.formatter.format.bind(c.formatter)),c.interpolator=new et(this.options),c.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},c.backendConnector=new rt(s(this.modules.backend),c.resourceStore,c,this.options),c.backendConnector.on("*",(h,...p)=>{this.emit(h,...p)}),this.modules.languageDetector&&(c.languageDetector=s(this.modules.languageDetector),c.languageDetector.init&&c.languageDetector.init(c,this.options.detection,this.options)),this.modules.i18nFormat&&(c.i18nFormat=s(this.modules.i18nFormat),c.i18nFormat.init&&c.i18nFormat.init(this)),this.translator=new q(this.services,this.options),this.translator.on("*",(h,...p)=>{this.emit(h,...p)}),this.modules.external.forEach(h=>{h.init&&h.init(this)})}if(this.format=this.options.interpolation.format,i||(i=Q),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const l=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);l.length>0&&l[0]!=="dev"&&(this.options.lng=l[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(l=>{this[l]=(...d)=>this.store[l](...d)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(l=>{this[l]=(...d)=>(this.store[l](...d),this)});const a=V(),u=()=>{const l=(d,c)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),a.resolve(c),i(d,c)};if(this.languages&&!this.isInitialized)return l(null,this.t.bind(this));this.changeLanguage(this.options.lng,l)};return this.options.resources||!this.options.initAsync?u():setTimeout(u,0),a}loadResources(t,i=Q){let n=i;const s=g(t)?t:this.language;if(typeof t=="function"&&(n=t),!this.options.resources||this.options.partialBundledLanguages){if(s?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return n();const r=[],o=a=>{if(!a||a==="cimode")return;this.services.languageUtils.toResolveHierarchy(a).forEach(l=>{l!=="cimode"&&r.indexOf(l)<0&&r.push(l)})};s?o(s):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(u=>o(u)),this.options.preload?.forEach?.(a=>o(a)),this.services.backendConnector.load(r,this.options.ns,a=>{!a&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),n(a)})}else n(null)}reloadResources(t,i,n){const s=V();return typeof t=="function"&&(n=t,t=void 0),typeof i=="function"&&(n=i,i=void 0),t||(t=this.languages),i||(i=this.options.ns),n||(n=Q),this.services.backendConnector.reload(t,i,r=>{s.resolve(),n(r)}),s}use(t){if(!t)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return t.type==="backend"&&(this.modules.backend=t),(t.type==="logger"||t.log&&t.warn&&t.error)&&(this.modules.logger=t),t.type==="languageDetector"&&(this.modules.languageDetector=t),t.type==="i18nFormat"&&(this.modules.i18nFormat=t),t.type==="postProcessor"&&Ae.addPostProcessor(t),t.type==="formatter"&&(this.modules.formatter=t),t.type==="3rdParty"&&this.modules.external.push(t),this}setResolvedLanguage(t){if(!(!t||!this.languages)&&!(["cimode","dev"].indexOf(t)>-1)){for(let i=0;i<this.languages.length;i++){const n=this.languages[i];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}!this.resolvedLanguage&&this.languages.indexOf(t)<0&&this.store.hasLanguageSomeTranslations(t)&&(this.resolvedLanguage=t,this.languages.unshift(t))}}changeLanguage(t,i){this.isLanguageChangingTo=t;const n=V();this.emit("languageChanging",t);const s=a=>{this.language=a,this.languages=this.services.languageUtils.toResolveHierarchy(a),this.resolvedLanguage=void 0,this.setResolvedLanguage(a)},r=(a,u)=>{u?this.isLanguageChangingTo===t&&(s(u),this.translator.changeLanguage(u),this.isLanguageChangingTo=void 0,this.emit("languageChanged",u),this.logger.log("languageChanged",u)):this.isLanguageChangingTo=void 0,n.resolve((...l)=>this.t(...l)),i&&i(a,(...l)=>this.t(...l))},o=a=>{!t&&!a&&this.services.languageDetector&&(a=[]);const u=g(a)?a:a&&a[0],l=this.store.hasLanguageSomeTranslations(u)?u:this.services.languageUtils.getBestMatchFromCodes(g(a)?[a]:a);l&&(this.language||s(l),this.translator.language||this.translator.changeLanguage(l),this.services.languageDetector?.cacheUserLanguage?.(l)),this.loadResources(l,d=>{r(d,l)})};return!t&&this.services.languageDetector&&!this.services.languageDetector.async?o(this.services.languageDetector.detect()):!t&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(t),n}getFixedT(t,i,n){const s=(r,o,...a)=>{let u;typeof o!="object"?u=this.options.overloadTranslationOptionHandler([r,o].concat(a)):u={...o},u.lng=u.lng||s.lng,u.lngs=u.lngs||s.lngs,u.ns=u.ns||s.ns,u.keyPrefix!==""&&(u.keyPrefix=u.keyPrefix||n||s.keyPrefix);const l=this.options.keySeparator||".";let d;return u.keyPrefix&&Array.isArray(r)?d=r.map(c=>`${u.keyPrefix}${l}${c}`):d=u.keyPrefix?`${u.keyPrefix}${l}${r}`:r,this.t(d,u)};return g(t)?s.lng=t:s.lngs=t,s.ns=i,s.keyPrefix=n,s}t(...t){return this.translator?.translate(...t)}exists(...t){return this.translator?.exists(...t)}setDefaultNamespace(t){this.options.defaultNS=t}hasLoadedNamespace(t,i={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=i.lng||this.resolvedLanguage||this.languages[0],s=this.options?this.options.fallbackLng:!1,r=this.languages[this.languages.length-1];if(n.toLowerCase()==="cimode")return!0;const o=(a,u)=>{const l=this.services.backendConnector.state[`${a}|${u}`];return l===-1||l===0||l===2};if(i.precheck){const a=i.precheck(this,o);if(a!==void 0)return a}return!!(this.hasResourceBundle(n,t)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(n,t)&&(!s||o(r,t)))}loadNamespaces(t,i){const n=V();return this.options.ns?(g(t)&&(t=[t]),t.forEach(s=>{this.options.ns.indexOf(s)<0&&this.options.ns.push(s)}),this.loadResources(s=>{n.resolve(),i&&i(s)}),n):(i&&i(),Promise.resolve())}loadLanguages(t,i){const n=V();g(t)&&(t=[t]);const s=this.options.preload||[],r=t.filter(o=>s.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return r.length?(this.options.preload=s.concat(r),this.loadResources(o=>{n.resolve(),i&&i(o)}),n):(i&&i(),Promise.resolve())}dir(t){if(t||(t=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!t)return"rtl";try{const s=new Intl.Locale(t);if(s&&s.getTextInfo){const r=s.getTextInfo();if(r&&r.direction)return r.direction}}catch{}const i=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],n=this.services?.languageUtils||new ye(ve());return t.toLowerCase().indexOf("-latn")>1?"ltr":i.indexOf(n.getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(t={},i){return new J(t,i)}cloneInstance(t={},i=Q){const n=t.forkResourceStore;n&&delete t.forkResourceStore;const s={...this.options,...t,isClone:!0},r=new J(s);if((t.debug!==void 0||t.prefix!==void 0)&&(r.logger=r.logger.clone(t)),["store","services","language"].forEach(a=>{r[a]=this[a]}),r.services={...this.services},r.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},n){const a=Object.keys(this.store.data).reduce((u,l)=>(u[l]={...this.store.data[l]},u[l]=Object.keys(u[l]).reduce((d,c)=>(d[c]={...u[l][c]},d),u[l]),u),{});r.store=new pe(a,s),r.services.resourceStore=r.store}return r.translator=new q(r.services,s),r.translator.on("*",(a,...u)=>{r.emit(a,...u)}),r.init(s,i),r.translator.options=s,r.translator.backendConnector.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},r}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const x=J.createInstance();x.createInstance=J.createInstance;x.createInstance;x.dir;x.init;x.loadResources;x.reloadResources;x.use;x.changeLanguage;x.getFixedT;const ie=x.t;x.exists;x.setDefaultNamespace;x.hasLoadedNamespace;x.loadNamespaces;x.loadLanguages;const{slice:at,forEach:lt}=[];function ut(e){return lt.call(at.call(arguments,1),t=>{if(t)for(const i in t)e[i]===void 0&&(e[i]=t[i])}),e}function ct(e){return typeof e!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(i=>i.test(e))}const Oe=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,dt=function(e,t){const n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},s=encodeURIComponent(t);let r=`${e}=${s}`;if(n.maxAge>0){const o=n.maxAge-0;if(Number.isNaN(o))throw new Error("maxAge should be a Number");r+=`; Max-Age=${Math.floor(o)}`}if(n.domain){if(!Oe.test(n.domain))throw new TypeError("option domain is invalid");r+=`; Domain=${n.domain}`}if(n.path){if(!Oe.test(n.path))throw new TypeError("option path is invalid");r+=`; Path=${n.path}`}if(n.expires){if(typeof n.expires.toUTCString!="function")throw new TypeError("option expires is invalid");r+=`; Expires=${n.expires.toUTCString()}`}if(n.httpOnly&&(r+="; HttpOnly"),n.secure&&(r+="; Secure"),n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:r+="; SameSite=Strict";break;case"lax":r+="; SameSite=Lax";break;case"strict":r+="; SameSite=Strict";break;case"none":r+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return n.partitioned&&(r+="; Partitioned"),r},Pe={create(e,t,i,n){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};i&&(s.expires=new Date,s.expires.setTime(s.expires.getTime()+i*60*1e3)),n&&(s.domain=n),document.cookie=dt(e,t,s)},read(e){const t=`${e}=`,i=document.cookie.split(";");for(let n=0;n<i.length;n++){let s=i[n];for(;s.charAt(0)===" ";)s=s.substring(1,s.length);if(s.indexOf(t)===0)return s.substring(t.length,s.length)}return null},remove(e,t){this.create(e,"",-1,t)}};var ft={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&typeof document<"u")return Pe.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:i,cookieMinutes:n,cookieDomain:s,cookieOptions:r}=t;i&&typeof document<"u"&&Pe.create(i,e,n,s,r)}},ht={name:"querystring",lookup(e){let{lookupQuerystring:t}=e,i;if(typeof window<"u"){let{search:n}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(n=window.location.hash.substring(window.location.hash.indexOf("?")));const r=n.substring(1).split("&");for(let o=0;o<r.length;o++){const a=r[o].indexOf("=");a>0&&r[o].substring(0,a)===t&&(i=r[o].substring(a+1))}}return i}},pt={name:"hash",lookup(e){let{lookupHash:t,lookupFromHashIndex:i}=e,n;if(typeof window<"u"){const{hash:s}=window.location;if(s&&s.length>2){const r=s.substring(1);if(t){const o=r.split("&");for(let a=0;a<o.length;a++){const u=o[a].indexOf("=");u>0&&o[a].substring(0,u)===t&&(n=o[a].substring(u+1))}}if(n)return n;if(!n&&i>-1){const o=s.match(/\/([a-zA-Z-]*)/g);return Array.isArray(o)?o[typeof i=="number"?i:0]?.replace("/",""):void 0}}}return n}};let U=null;const Ce=()=>{if(U!==null)return U;try{if(U=typeof window<"u"&&window.localStorage!==null,!U)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch{U=!1}return U};var gt={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&Ce())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:i}=t;i&&Ce()&&window.localStorage.setItem(i,e)}};let K=null;const Re=()=>{if(K!==null)return K;try{if(K=typeof window<"u"&&window.sessionStorage!==null,!K)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch{K=!1}return K};var mt={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&Re())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:i}=t;i&&Re()&&window.sessionStorage.setItem(i,e)}},yt={name:"navigator",lookup(e){const t=[];if(typeof navigator<"u"){const{languages:i,userLanguage:n,language:s}=navigator;if(i)for(let r=0;r<i.length;r++)t.push(i[r]);n&&t.push(n),s&&t.push(s)}return t.length>0?t:void 0}},bt={name:"htmlTag",lookup(e){let{htmlTag:t}=e,i;const n=t||(typeof document<"u"?document.documentElement:null);return n&&typeof n.getAttribute=="function"&&(i=n.getAttribute("lang")),i}},xt={name:"path",lookup(e){let{lookupFromPathIndex:t}=e;if(typeof window>"u")return;const i=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(i)?i[typeof t=="number"?t:0]?.replace("/",""):void 0}},St={name:"subdomain",lookup(e){let{lookupFromSubdomainIndex:t}=e;const i=typeof t=="number"?t+1:1,n=typeof window<"u"&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(n)return n[i]}};let Me=!1;try{document.cookie,Me=!0}catch{}const je=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];Me||je.splice(1,1);const wt=()=>({order:je,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e});class Ue{constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(t,i)}init(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=t,this.options=ut(i,this.options||{},wt()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=s=>s.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(ft),this.addDetector(ht),this.addDetector(gt),this.addDetector(mt),this.addDetector(yt),this.addDetector(bt),this.addDetector(xt),this.addDetector(St),this.addDetector(pt)}addDetector(t){return this.detectors[t.name]=t,this}detect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,i=[];return t.forEach(n=>{if(this.detectors[n]){let s=this.detectors[n].lookup(this.options);s&&typeof s=="string"&&(s=[s]),s&&(i=i.concat(s))}}),i=i.filter(n=>n!=null&&!ct(n)).map(n=>this.options.convertDetectedLanguage(n)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?i:i.length>0?i[0]:null}cacheUserLanguage(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;i&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(t)>-1||i.forEach(n=>{this.detectors[n]&&this.detectors[n].cacheUserLanguage(t,this.options)}))}}Ue.type="languageDetector";class G{static isTouchDevice(t){return t=t||window.navigator.userAgent,"ontouchstart"in window||navigator.maxTouchPoints>0||/ios|iphone|ipad|ipod|android|windows phone/gi.test(t)}static isLandscapeMode(){return window.innerWidth>window.innerHeight}static setTimeoutAsync(t){return new Promise(i=>{setTimeout(()=>{i()},t)})}}class vt{constructor(t,i){this.k=t,this.config={volume:1,fadeOutDuration:1.5,...i}}config;currentMusic;currentMusicName;isFirstPlay=!0;loadMusic(t,i){this.k.loadMusic(t,i)}playMusic(t,i){(async()=>this.currentMusic&&!this.currentMusic.paused&&this.currentMusicName===t||(this.isFirstPlay&&(this.isFirstPlay=!1,await G.setTimeoutAsync(100)),await this.fadeOutCurrentMusic(i?.fadeOutDuration),this.currentMusic=this.k.play(t,{loop:!0,volume:this.config.volume,...i}),this.currentMusicName=t))()}setVolume(t){this.config.volume=t,this.currentMusic&&(this.currentMusic.volume=t)}stopMusic(t){this.fadeOutCurrentMusic(t).then(()=>{this.currentMusic=void 0,this.currentMusicName=void 0})}pauseMusic(){this.currentMusic&&(this.currentMusic.paused=!0)}resumeMusic(){this.currentMusic&&(this.currentMusic.paused=!1)}async fadeOutCurrentMusic(t){return t=t??this.config.fadeOutDuration+1e-6,new Promise(i=>{if(this.currentMusic&&!this.currentMusic.paused){const n=this.currentMusic.volume;let s=0;const r=this.k.onUpdate(()=>{s+=this.k.dt(),this.currentMusic.volume=this.k.lerp(n,0,s/t),this.currentMusic.volume===0&&(this.currentMusic.stop(),r.cancel(),i())})}else i()})}}class Lt{constructor(t,i="fade",n=.6){this.k=t,this.defaultDuration=n,this.fadeOverlay=t.add(["fade-overlay",t.layer(i),t.rect(t.width(),t.height()),t.color(0,0,0),t.pos(0,0),t.fixed(),t.anchor("topleft"),t.opacity(0),t.stay()])}fadeOverlay;async showOverlay(t=this.defaultDuration){return this.fadeOverlay.opacity=0,this.fadeOverlay.hidden=!1,this.fadeTo(0,1,t)}async hideOverlay(t=this.defaultDuration){await this.fadeTo(1,0,t),this.fadeOverlay.hidden=!1}async fadeTo(t,i,n=1){return new Promise(s=>{let r=0;const o=this.fadeOverlay.onUpdate(()=>{r+=this.k.dt(),this.fadeOverlay.opacity=this.k.lerp(t,i,r/n),r>=n&&(this.fadeOverlay.opacity=i,o.cancel(),s())})})}}function Ot(e,t){const i=t?.size??100,n=t?.deadZone??.1;e.loadSprite("joystick.jump","sprites/icons/jump.gif"),e.loadSprite("joystick.attack","sprites/icons/attack.gif");let s=!1,r=e.vec2(0,0),o=e.vec2(0,0);const a=e.add(["joystickBase","hud",e.layer("hud"),e.fixed(),e.stay(),e.pos(-9999,-9999),e.circle(i/2),e.color(0,0,0),e.opacity(.2),e.anchor("center")]),u=e.add(["joystickKnob","hud",e.layer("hud"),e.fixed(),e.stay(),e.pos(-9999,-9999),e.circle(i/4),e.color(255,255,255),e.opacity(.7),e.anchor("center")]),l=e.add(["jumpButton","hud",e.layer("hud"),e.fixed(),e.stay(),e.pos(e.width()-i*.5,e.height()-i*.5),e.area(),e.circle(i/3),e.color(0,0,0),e.opacity(.2),e.anchor("center")]);l.add([e.sprite("joystick.jump"),e.anchor("center")]),l.onClick(()=>{e.pressButton("jump"),e.releaseButton("jump")});const d=e.add(["attackButton","hud",e.layer("hud"),e.fixed(),e.stay(),e.pos(e.width()-i*1.1,e.height()-i*1.1),e.area(),e.circle(i/2.5),e.color(0,0,0),e.opacity(.2),e.anchor("center")]);d.add([e.sprite("joystick.attack"),e.anchor("center"),e.scale(1.2)]),d.onClick(()=>{e.pressButton("action"),e.releaseButton("action")}),a.onTouchStart(c=>{c.x>e.width()*.6||(r=c,s=!0,a.pos=r,u.pos=r,a.hidden=!1,u.hidden=!1)}),a.onTouchMove(c=>{if(!s||c.x>e.width()*.6)return;o=c.sub(r);const f=i/2,h=e.vec2(e.clamp(o.x,-f,f),e.clamp(o.y,-f,f));u.pos=r.add(h)}),a.onTouchEnd(c=>{c.x>e.width()*.6||(s=!1,o=e.vec2(0,0),a.pos=e.vec2(-9999,-9999),u.pos=e.vec2(-9999,-9999),e.releaseButton("left"),e.releaseButton("right"))}),a.onUpdate(()=>{if(!s)return;const f=o.scale(1/(i/2)).x;f<-n?(e.pressButton("left"),e.releaseButton("right")):f>n?(e.pressButton("right"),e.releaseButton("left")):(e.releaseButton("left"),e.releaseButton("right"))})}async function se(e,t){ne.hide(),await re.showOverlay(.3),e.go(t)}const Pt=e=>{G.isTouchDevice()&&Ot(e,{size:Math.min(window.innerWidth/15,60)}),e.loadSprite("reload-button","sprites/icons/reload.png"),e.add(["reload-button","hud",e.layer("hud"),e.sprite("reload-button"),e.area(),e.pos(e.width()-10,10),e.anchor("topright"),e.fixed(),e.stay()]).onClick(()=>{se(e,"level-home").then()}),n();function i(){e.get("hud").forEach(s=>{s.hidden=!1,s.paused=!1})}function n(){e.get("hud").forEach(s=>{s.hidden=!0,s.paused=!0})}return{show:i,hide:n}};function Ct(e,t,i){return async()=>{await t(e),await G.setTimeoutAsync(500),await re.hideOverlay(2),ne.show()}}const Rt={loading:"Loading...",rotateDevice:"Rotate your device"},Et={intro1:"Hello, grandson! You finally bought your own hut... Even if it's with a mortgage, you're still doing great!",intro2:"It's a bit empty inside... But I saw some furniture nearby while I was walking here. You can look for it."},It={common:Rt,oldBobr:Et},Dt={loading:"Загрузка...",rotateDevice:"Поверните устройство"},Tt={intro1:"Привет, внучек! Наконец-то ты купил свою хатку... Хоть и в ипотеку, но ты всё равно молодец!",intro2:"Внутри пока пустовато... Но я видел некоторую мебель неподалёку, пока сюда шёл. Ты можешь поискать её."},$t={common:Dt,oldBobr:Tt},Ee=Ft(),m=He({global:!1,width:Ee.width,height:Ee.height,background:"#000000",letterbox:!0,pixelDensity:2,debug:!0,debugKey:"`",buttons:{left:{keyboard:["left","a"],gamepad:["dpad-left"]},right:{keyboard:["right","d"],gamepad:["dpad-right"]},jump:{keyboard:["space","up","w","k"],gamepad:["south"]},action:{keyboard:["j","z"],gamepad:["east"]}}});function Ft(){let e=Math.min(window.innerWidth,400);e%2!==0&&(e-=1);let t=Math.floor(e/(window.innerWidth/window.innerHeight));return t%2!==0&&(t-=1),{width:e,height:t}}function Nt(e,t,i,n){const s=e.add([e.sprite(t,{tiled:!0,width:e.width()*10}),e.layer("bg"),e.pos(0,0),e.scale(1.5),e.fixed(),e.anchor("center")]);return s.onUpdate(()=>{s.pos.x=e.width()/2+-e.getCamPos().x/100,s.pos.y=e.height()/2+n?.offsetY-e.getCamPos().y/50}),s}const S={friction:.2},At={maxRunSpeed:200,accelGround:200,accelAir:150,decelGround:500,decelAir:300,jumpForce:400,minRunAnimSpeed:1,maxRunAnimSpeed:2,attackPower:1,maxHealth:2},Ie={async loadResources(e){await e.loadSprite("player","sprites/characters/bobr.gif",{sliceX:5,sliceY:4,anims:{idle:{from:0,to:1,speed:3,loop:!0},walk:{from:5,to:8,speed:10,loop:!0},jump:{from:10,to:10},fall:{from:10,to:10},attack:{from:15,to:19,speed:20,loop:!1}}}),await e.loadSound("player-attack","sounds/bobr-attack.mp3")},spawn(e,t=e.vec2(100,100),i){const n={...At,...i},s=e.add(["player",e.sprite("player",{anim:"idle"}),e.pos(t),e.area({shape:new e.Rect(e.vec2(1,0),20,31),...S}),e.body(),e.anchor("bot"),e.opacity(1),e.state("IDLE",["IDLE","WALK","JUMP","FALL","ATTACK","INTERACT"]),e.health(n.maxHealth,n.maxHealth),e.timer(),{vx:0,config:n,waitForActionButton:d}]);let r,o;function a(){s.jump(n.jumpForce),s.enterState("JUMP")}function u(){return!!o}function l(c,f){s.getCurAnim()?.name!==c&&s.play(c,{onEnd:f})}function d(){return new Promise(c=>{s.onButtonPress("action",()=>{c()})})}return s.onButtonPress("jump",()=>{s.state!=="INTERACT"&&s.isGrounded()&&a()}),s.onButtonPress("action",()=>{if(s.state==="ATTACK"||s.state==="INTERACT")return;let c=!0,f=!1;const h=s.add(["player.interaction-hitbox",e.pos(s.flipX?-14:14,0),e.area({shape:new e.Rect(e.vec2(1,0),16,s.height)}),e.rect(20,20,{fill:!1}),e.anchor("bot"),e.opacity(0)]);h.onCollide("interactable",async p=>{f=!0,s.enterState("INTERACT"),await p.interact(s),s.enterState("IDLE")}),h.onUpdate(()=>{c?c=!1:(f||s.enterState("ATTACK"),s.remove(h))})}),s.onFixedUpdate(()=>{const c=e.dt(),f=s.isGrounded();let h=0;if(s.state!=="INTERACT"&&(e.isButtonDown("left")?h=-1:e.isButtonDown("right")&&(h=1)),s.friction=f?S.friction:0,h!==0){let p=f?n.accelGround:n.accelAir;Math.sign(h)!==Math.sign(s.vx)&&(p+=f?n.decelGround:n.decelAir),s.vx=Mt(s.vx,h*n.maxRunSpeed,p*c)}else{const p=f?n.decelGround:n.decelAir,y=Math.max(0,Math.abs(s.vx)-p*c);s.vx=y*Math.sign(s.vx)}s.move(s.vx,0),s.flipX=h<0?!0:h>0?!1:s.flipX,s.area.scale.x=s.flipX?-1:1,s.state==="ATTACK"?s.getCurAnim()?.frameIndex===2&&(r||(r=s.add(["player.hitbox",e.pos(e.vec2(s.flipX?-16:16,0)),e.area(),e.rect(20,20),e.opacity(0),e.anchor("bot"),e.lifespan(.1)]),r.onCollide("enemy",p=>{p.registerHit(s),e.play("player-attack")}),r.onDestroy(()=>{r=void 0}))):s.state==="INTERACT"||(f?Math.abs(s.vx)>5?s.enterState("WALK"):s.enterState("IDLE"):s.vel.y<0?s.enterState("JUMP"):s.enterState("FALL")),u()?s.opacity=Math.abs(Math.sin(e.time()*20))*.5+.5:s.opacity=1}),s.onStateEnter("IDLE",()=>{l("idle")}),s.onStateEnter("INTERACT",()=>{l("idle")}),s.onStateUpdate("WALK",()=>{l("walk");const c=e.clamp(Math.abs(s.vx)/n.maxRunSpeed,0,1);s.animSpeed=e.lerp(n.minRunAnimSpeed,n.maxRunAnimSpeed,c)}),s.onStateEnter("JUMP",()=>{l("jump")}),s.onStateEnter("FALL",()=>{l("fall")}),s.onStateEnter("ATTACK",()=>{l("attack",()=>{s.enterState("IDLE")}),s.animSpeed=1}),s.onCollideUpdate("enemy",c=>{!u()&&s.state!=="ATTACK"&&!c.dead&&c.config.attackPower&&(s.hp-=c.config.attackPower,s.applyImpulse(e.vec2(Math.sign(s.pos.x-c.pos.x)*150,-230)),o?.cancel(),o=s.wait(1),o.onEnd(()=>{o=void 0}))}),s.onDeath(()=>{se(e,e.getSceneName()).then()}),s}};function Mt(e,t,i){const n=t-e;return Math.abs(n)<=i?t:e+Math.sign(t)*i}async function jt(e,t,i){let n,s=t.split(`
`);await Ie.loadResources(e),await i.preloadResources(e),e.setGravity(0);const r=e.addLevel(s,{pos:e.vec2(0,0),tileWidth:i.tileWidth,tileHeight:i.tileHeight,tiles:{},wildcardTile:(l,d)=>{if(l.trim()){if(l==="P"){n=d.scale(e.vec2(i.tileWidth,i.tileHeight));return}if(i.tiles[l])return i.tiles[l](d,d.scale(e.vec2(i.tileWidth,i.tileHeight)),()=>u(d.x,d.y),a)||void 0}}}),o=Ie.spawn(e,n);e.setGravity(1e3);function a(l,d){return d<0||d>=s.length||l<0||l>=s[d].length?" ":s[d][l]}function u(l,d){return{top:a(l,d-1),bottom:a(l,d+1),left:a(l-1,d),right:a(l+1,d),topLeft:a(l-1,d-1),topRight:a(l+1,d-1),bottomLeft:a(l-1,d+1),bottomRight:a(l+1,d+1)}}return{level:r,player:o}}const De={async loadResources(e){await e.loadSprite("bumblebee","sprites/enemies/bumblebee.gif",{sliceX:2,sliceY:1,anims:{idle:{from:0,to:1,speed:20,loop:!0},fly:{from:0,to:1,speed:20,loop:!0}}})},spawn(e,t=e.vec2(200,80),i){const n={health:1,attackPower:1,speedX:70,flyDuration:3,...i};let s=-1,r=0,o=!0;const a=e.add(["bumblebee","enemy",e.sprite("bumblebee",{anim:"idle"}),e.state("FLY",["IDLE","FLY"]),e.health(n.health,n.health),e.timer(),e.pos(t),e.area({...S,collisionIgnore:["obstacle"]}),e.body({gravityScale:0}),e.anchor("center"),e.offscreen({pause:!0,unpause:!0,hide:!0}),{registerHit:l=>{a.applyImpulse(e.vec2(Math.sign(a.pos.x-l.pos.x)*180,-120)),a.hp-=l.config.attackPower},config:n}]);function u(l,d){return Math.sin(d*l)*-30}return a.onStateEnter("FLY",async()=>{a.flipX=s<0,a.play("fly"),await a.wait(n.flyDuration*(o?.5:1)),o=!1,a.enterState("IDLE")}),a.onStateUpdate("FLY",()=>{r+=e.dt(),a.move(n.speedX*s,u(6,r))}),a.onStateEnter("IDLE",async()=>{a.play("idle"),await a.wait(1.5),a.dead||(s*=-1,a.enterState("FLY"))}),a.onStateUpdate("IDLE",()=>{r+=e.dt(),a.move(0,u(12,r))}),a.onDeath(()=>{a.paused=!0,a.gravityScale=1,a.collisionIgnore=["*"],a.use(e.rotate(a.flipX?15:-15))}),a.onExitScreen(()=>{a.dead&&a.destroy()}),a}},Te={async loadResources(e){await e.loadSprite("gopher","sprites/enemies/gopher.gif",{sliceX:4,sliceY:1,anims:{idle:{from:0,to:0,loop:!1},walk:{from:0,to:3,speed:10,loop:!0}}})},spawn(e,t=e.vec2(100,100),i){const n={health:2,attackPower:1,speedX:50,...i};let s=-1,r=!0;const o=e.add(["gopher","enemy",e.sprite("gopher",{anim:"idle"}),e.state("WALK",["IDLE","WALK"]),e.health(n.health,n.health),e.timer(),e.pos(t),e.area(S),e.body(),e.anchor("bot"),e.offscreen({pause:!0,unpause:!0,hide:!0}),{registerHit:a=>{o.applyImpulse(e.vec2(Math.sign(o.pos.x-a.pos.x)*100,-200)),o.hp-=a.config.attackPower},config:n}]);return o.onStateEnter("WALK",async()=>{o.flipX=s<0,o.play("walk"),await o.wait(4*(r?.5:1)),r=!1,o.enterState("IDLE")}),o.onStateUpdate("WALK",()=>{o.isGrounded()&&o.move(n.speedX*s,0)}),o.onStateEnter("IDLE",async()=>{o.play("idle"),await o.wait(2),o.dead||(s*=-1,o.enterState("WALK"))}),o.onDeath(()=>{o.paused=!0,o.collisionIgnore=["*"],o.use(e.rotate(o.flipX?10:-10))}),o.onExitScreen(()=>{o.dead&&o.destroy()}),o}},$e={async loadResources(e){await e.loadSprite("home-outside","sprites/home/home-outside.png"),await e.loadSprite("home-inside","sprites/home/home-inside.png"),await e.loadSprite("home-fence","sprites/home/home-fence.png")},spawn(e,t,i){const n={isEveningTime:!1,...i};let s=!0;const r=e.add(["home-container",e.pos(t),e.anchor("botleft"),e.offscreen({hide:!0,pause:!0,unpause:!0,distance:300}),e.state("OUTSIDE",["INSIDE","OUTSIDE"])]);r.add([e.sprite("home-fence"),e.pos(206,0),e.anchor("botleft")]),r.add(["home-outside",e.sprite("home-inside"),e.anchor("botleft")]);const o=r.add(["home-outside",e.sprite("home-outside"),e.anchor("botleft"),e.animate({relative:!0}),e.z(1)]);return Ut(e,r),r.onStateEnter("OUTSIDE",()=>{if(s){s=!1;return}o.unanimateAll(),o.animation.seek(0),o.animate("opacity",[0,1],{duration:1,loops:1}),W.playMusic("start-location")}),r.onStateEnter("INSIDE",()=>{o.unanimateAll(),o.animation.seek(0),o.animate("opacity",[1,0],{duration:1,loops:1}),n.isEveningTime&&W.playMusic("home")}),r.add(["home-entrance",e.rect(20,38,{fill:!1}),e.pos(125,0),e.anchor("botleft"),e.area()]).onCollide("player",()=>{r.state!=="INSIDE"&&r.enterState("INSIDE")}),r.add(["home-exit",e.rect(20,38,{fill:!1}),e.pos(214,0),e.anchor("botleft"),e.area()]).onCollide("player",()=>{r.state!=="OUTSIDE"&&r.enterState("OUTSIDE")}),r}};function Ut(e,t){t.add([e.rect(14,200,{fill:!1}),e.pos(193,-42),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),t.add([e.rect(40,12,{fill:!1}),e.pos(156,-42),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),t.add([e.rect(10,220,{fill:!1}),e.pos(-10,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),t.add([e.polygon([e.vec2(178,-54),e.vec2(115,-193),e.vec2(125,-193),e.vec2(188,-54)],{fill:!1}),e.pos(-5,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),t.add([e.polygon([e.vec2(115,-193),e.vec2(50,-221),e.vec2(50,-230),e.vec2(125,-193)],{fill:!1}),e.pos(-5,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),t.add([e.polygon([e.vec2(50,-221),e.vec2(0,-221),e.vec2(0,-230),e.vec2(50,-230)],{fill:!1}),e.pos(-5,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),t.add([e.rect(120,7,{fill:!1}),e.pos(57,-58),e.anchor("botleft"),e.area(S),e.body({isStatic:!0})]),t.add([e.rect(95,7,{fill:!1}),e.pos(0,-122),e.anchor("botleft"),e.area(S),e.body({isStatic:!0})])}function Kt(e,t,i,n){n={speed:.05,...n};const s=e.width()/2,r=5;let o="",a=0,u=0,l=!1;const d=e.add([e.rect(s,16,{radius:4}),e.pos(f()),e.color(0,0,0),e.opacity(.6),e.anchor("bot"),e.layer("hud")]),c=d.add([e.pos(e.vec2(0,-r)),e.text("",{size:8,width:s-r*2,font:"pixel",lineSpacing:2}),e.anchor("bot")]);c.onUpdate(()=>{d.height=c.height+r*2,d.pos=f(),l||(u+=e.dt(),u>=n.speed&&(u=0,o+=i[a],c.text=o,a++,a>=i.length&&(l=!0)))});function f(){return t.pos.add(0,-t.height)}return d}function Bt(e,t,i,n,s){return new Promise(r=>{let o=0;async function a(){if(o<n.length){const u=Kt(e,t,n[o],s);await i.waitForActionButton(),u.destroy(),o++,a().then()}else r()}a().then()})}const Fe={async loadResources(e){await e.loadSprite("old-bobr","sprites/characters/old-bobr.gif",{sliceX:2,sliceY:1,anims:{idle:{from:0,to:1,speed:1.5,loop:!0}}}),await e.loadSound("old-bobr-kurwa-1","sounds/old-bobr-kurwa-1.ogg"),await e.loadSound("old-bobr-kurwa-2","sounds/old-bobr-kurwa-2.ogg")},spawn(e,t=e.vec2(100,100),i){const n={...i},s=e.add(["old-bobr","interactable",e.sprite("old-bobr",{anim:"idle"}),e.state("IDLE",["IDLE"]),e.timer(),e.pos(t),e.area({...S,collisionIgnore:["player","enemy"]}),e.body(),e.anchor("bot"),e.offscreen({pause:!0,unpause:!0,hide:!0}),{config:n,interact:r}]);async function r(o){e.play(e.choose(["old-bobr-kurwa-1","old-bobr-kurwa-2"])),s.flipX=s.pos.x>o.pos.x,await Bt(e,s,o,[ie("oldBobr.intro1"),ie("oldBobr.intro2")])}return s.onStateEnter("IDLE",async()=>{s.play("idle")}),s}},Ht=`                         F ,,                                              =========
                           ---                                , ,Gt,,,     .........
                              ,t,F             ,tF,,,r       ---------     .........
          P     ,,,           -----        F ---------        F            .........
H      ,B,  ,,//===\\\\,,t,,,   , G , ,,  t   ,  ,,,G ,, ,  , , ,, ,  ,G,t,//.........
==============.......====================================================...........
....................................................................................
....................................................................................`,Vt=async e=>{const{player:t}=await jt(e,Ht,{preloadResources:async i=>{await Promise.all([i.loadSprite("tile-ground","sprites/tiles/ground.png"),i.loadSprite("tile-grass-ground","sprites/tiles/grass-ground.png"),i.loadSprite("tile-grass-ground-air","sprites/tiles/grass-ground-air.png"),i.loadSprite("tile-grass-ground-air-left","sprites/tiles/grass-ground-air-left.png"),i.loadSprite("tile-grass-ground-air-right","sprites/tiles/grass-ground-air-right.png"),i.loadSprite("tile-grass-ground-inclined-left-1","sprites/tiles/grass-ground-inclined-left-1.png"),i.loadSprite("tile-grass-ground-inclined-left-2","sprites/tiles/grass-ground-inclined-left-2.png"),i.loadSprite("tile-grass-ground-inclined-left-3","sprites/tiles/grass-ground-inclined-left-3.png"),i.loadSprite("tile-grass-1","sprites/tiles/grass-1.png"),i.loadSprite("tile-grass-2","sprites/tiles/grass-2.png"),i.loadSprite("tile-grass-3","sprites/tiles/grass-3.png"),i.loadSprite("tile-tree-1","sprites/tiles/tree-1.png"),i.loadSprite("tile-tree-2","sprites/tiles/tree-2.png"),i.loadSprite("rock","sprites/tiles/rock.png"),Te.loadResources(i),De.loadResources(i),$e.loadResources(i),Fe.loadResources(i)]),W.loadMusic("home","music/home.mp3"),W.loadMusic("start-location","music/start-location.mp3")},tileWidth:32,tileHeight:32,tiles:{"=":()=>[e.sprite("tile-grass-ground"),e.area(S),e.body({isStatic:!0}),e.anchor("bot"),e.offscreen({hide:!0})],"-":(i,n,s)=>{const r=s();return["obstacle",e.sprite(r.left===" "?"tile-grass-ground-air-left":r.right===" "?"tile-grass-ground-air-right":"tile-grass-ground-air"),e.area({...S,shape:new e.Rect(e.vec2(0,-8),32,24)}),e.body({isStatic:!0}),e.anchor("bot"),e.offscreen({hide:!0})]},".":(i,n,s)=>{const r=s();if(r.topRight==="/")return["obstacle",e.sprite("tile-grass-ground-inclined-left-1"),e.anchor("bot"),e.offscreen({hide:!0})];if(r.topLeft==="\\")return["obstacle",e.sprite("tile-grass-ground-inclined-left-1",{flipX:!0}),e.anchor("bot"),e.offscreen({hide:!0})];const o=r.left===" "||r.right===" "||r.bottom===" "||r.left==="";return["obstacle",e.sprite("tile-ground"),...o?[e.area(S),e.body({isStatic:!0})]:[],e.anchor("bot"),e.offscreen({hide:!0})]},",":()=>[e.sprite(e.choose(["tile-grass-1","tile-grass-2","tile-grass-3"]),{flipX:e.choose([!0,!1])}),e.z(e.choose([1,-1])),e.anchor("bot"),e.offscreen({hide:!0})],"/":(i,n,s)=>s().left==="/"?["obstacle",e.sprite("tile-grass-ground-inclined-left-3"),e.area({...S,shape:new e.Polygon([e.vec2(-16,0),e.vec2(-16,-16),e.vec2(16,-32),e.vec2(16,0)])}),e.body({isStatic:!0}),e.anchor("bot"),e.offscreen({hide:!0})]:["obstacle",e.sprite("tile-grass-ground-inclined-left-2"),e.area({...S,shape:new e.Polygon([e.vec2(-16,0),e.vec2(16,-16),e.vec2(16,0),e.vec2(-16,16)])}),e.body({isStatic:!0}),e.anchor("bot"),e.offscreen({hide:!0})],"\\":(i,n,s)=>s().right==="\\"?["obstacle",e.sprite("tile-grass-ground-inclined-left-3",{flipX:!0}),e.area({...S,shape:new e.Polygon([e.vec2(16,0),e.vec2(16,-16),e.vec2(-16,-32),e.vec2(-16,0)])}),e.body({isStatic:!0}),e.anchor("bot"),e.offscreen({hide:!0})]:["obstacle",e.sprite("tile-grass-ground-inclined-left-2",{flipX:!0}),e.area({...S,shape:new e.Polygon([e.vec2(16,0),e.vec2(-16,-16),e.vec2(-16,0),e.vec2(16,16)])}),e.body({isStatic:!0}),e.anchor("bot"),e.offscreen({hide:!0})],t:()=>[e.sprite(e.choose(["tile-tree-1","tile-tree-2"]),{flipX:e.choose([!0,!1])}),e.z(e.choose([1,-1])),e.anchor("bot"),e.offscreen({hide:!0})],r:()=>["obstacle",e.sprite("rock",{flipX:e.choose([!0,!1])}),e.anchor("bot"),e.area(S),e.body({mass:2}),e.offscreen({hide:!0})],G:(i,n)=>{Te.spawn(e,n)},F:(i,n)=>{De.spawn(e,n)},H:(i,n)=>{$e.spawn(e,n)},B:(i,n)=>{Fe.spawn(e,n)}}});await e.loadSprite("bg-home-day","sprites/backgrounds/home-day.png"),Nt(e,"bg-home-day",t,{offsetY:40}),W.playMusic("start-location"),t.onUpdate(()=>{if(!t)return;const i=Math.max(t.pos.x,e.width()/2),n=t.pos.y-e.height()/4;e.setCamPos(i,n)})},zt=e=>{e.loadSprite("button-play","sprites/icons/play.png"),e.add(["button-play",e.layer("menu"),e.sprite("button-play",{width:100}),e.pos(e.width()/2,e.height()/2),e.anchor("center"),e.area(),e.fixed()]).onClick(()=>{se(e,"level-home").then()})},Wt=e=>{e.loadSprite("rotate-device","sprites/icons/rotate-device.gif"),e.add(["rotate-device",e.sprite("rotate-device",{width:100}),e.anchor("bot"),e.pos(e.width()/2,e.height()/2-10),e.scale(e.vec2(-1,1)),e.fixed(),e.stay()]),e.add(["rotate-device-text",e.text(ie("common.rotateDevice"),{font:"pixel",size:24,width:e.width()*.8,align:"center",lineSpacing:10}),e.color("white"),e.anchor("top"),e.pos(e.width()/2,e.height()/2+20),e.fixed(),e.stay()])},W=new vt(m);let ne,re;(async()=>{await x.use(Ue).init({fallbackLng:"ru",resources:{ru:{translation:$t},en:{translation:It}}}),m.loadFont("pixel","fonts/Press_Start_2P/PressStart2P-Regular.ttf"),m.setLayers(["bg","game","hud","menu","fade"],"game"),m.add([m.layer("bg"),m.rect(m.width(),m.height()),m.color("#74dcf6"),m.pos(0,0),m.anchor("topleft"),m.fixed(),m.stay()]),m.setVolume(.5),ne=Pt(m),re=new Lt(m),m.scene("menu",()=>zt(m)),m.scene("rotate-device",()=>Wt(m)),m.scene("level-home",Ct(m,Vt));const e=G.isLandscapeMode();window.addEventListener("resize",()=>{e||G.isLandscapeMode()!==e&&setTimeout(()=>{window.location.reload()},1e3)}),e?m.go("menu"):m.go("rotate-device")})();
