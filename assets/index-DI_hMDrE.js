import{R as g}from"./kaplay-DTLyooHV.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(t){if(t.ep)return;t.ep=!0;const i=r(t);fetch(t.href,i)}})();const h=y(),f=g({global:!1,width:h.width,height:h.height,background:"#74dcf6",crisp:!0,letterbox:!0,pixelDensity:2,scale:2,debug:!0,debugKey:"`",buttons:{left:{keyboard:["left","a"],gamepad:["dpad-left"]},right:{keyboard:["right","d"],gamepad:["dpad-right"]},jump:{keyboard:["space","up","w","k"],gamepad:["south"]},action:{keyboard:["j","z"],gamepad:["east"]}}});function y(){let e=Math.min(window.innerWidth,400);e%2!==0&&(e-=1);let o=Math.floor(e/(window.innerWidth/window.innerHeight));return o%2!==0&&(o-=1),{width:e,height:o}}function x(e,o){const r=o?.size??100,n=o?.deadZone??.1;let t=!1,i=e.vec2(0,0),a=e.vec2(0,0);const c=e.add(["joystickBase",e.pos(-9999,-9999),e.circle(r/2),e.color(0,0,0),e.opacity(.2),e.fixed(),e.anchor("center")]),s=e.add(["joystickKnob",e.pos(-9999,-9999),e.circle(r/4),e.color(255,255,255),e.opacity(.7),e.fixed(),e.anchor("center")]);e.add(["jumpButton",e.pos(e.width()-r*.5,e.height()-r*.5),e.area(),e.circle(r/3),e.color(0,0,0),e.opacity(.2),e.fixed(),e.anchor("center")]).onClick(()=>{e.pressButton("jump"),e.releaseButton("jump")}),e.add(["attackButton",e.pos(e.width()-r*1.1,e.height()-r*1.1),e.area(),e.circle(r/2.5),e.color(0,0,0),e.opacity(.2),e.fixed(),e.anchor("center")]).onClick(()=>{e.pressButton("action"),e.releaseButton("action")}),e.onTouchStart(d=>{d.x>e.width()/2||(i=d,t=!0,c.pos=i,s.pos=i,c.hidden=!1,s.hidden=!1)}),e.onTouchMove(d=>{if(!t)return;a=d.sub(i);const l=r/2,m=e.vec2(e.clamp(a.x,-l,l),e.clamp(a.y,-l,l));s.pos=i.add(m),console.log(s.pos)}),e.onTouchEnd(d=>{d.x>e.width()/2||(t=!1,a=e.vec2(0,0),c.pos=e.vec2(-9999,-9999),s.pos=e.vec2(-9999,-9999),e.releaseButton("left"),e.releaseButton("right"))}),e.onUpdate(()=>{if(!t)return;const l=a.scale(1/(r/2)).x;l<-n?(e.pressButton("left"),e.releaseButton("right")):l>n?(e.pressButton("right"),e.releaseButton("left")):(e.releaseButton("left"),e.releaseButton("right"))})}function v(e,o){return{id:"withFriction",require:["pos","body"],update(){const t=this.isGrounded();if(this.vel.x=Math.sign(this.vel.x)*Math.min(Math.abs(this.vel.x),1/0),t&&Math.abs(this.vel.x)>.1){const i=100*e.dt();this.vel.x>0?this.vel.x=Math.max(0,this.vel.x-i):this.vel.x=Math.min(0,this.vel.x+i)}}}}const b={maxRunSpeed:200,accelGround:200,accelAir:150,decelGround:500,decelAir:300,jumpForce:400,minRunAnimSpeed:1,maxRunAnimSpeed:2};f.loadSprite("player","sprites/characters/bobr.gif",{sliceX:5,sliceY:4,anims:{idle:{from:0,to:1,speed:3,loop:!0},walk:{from:5,to:8,speed:10,loop:!0},jump:{from:10,to:10},fall:{from:10,to:10},attack:{from:15,to:19,speed:20,loop:!1}}});function w(e,o=e.vec2(100,100),r){const n={...b,...r},t=e.add(["player",e.sprite("player",{anim:"idle"}),e.pos(o),e.area({shape:new e.Rect(e.vec2(1,0),20,31)}),e.body(),e.anchor("bot"),e.state("idle",["idle","walk","jump","fall","attack"]),{id:"playerCtrl",vx:0,get moveDirection(){return(e.isButtonDown("right")?1:0)+(e.isButtonDown("left")?-1:0)}}]);function i(){t.jump(n.jumpForce),t.enterState("jump")}function a(c,s){t.getCurAnim()?.name!==c&&t.play(c,{onEnd:s})}return t.onButtonPress("jump",()=>{t.isGrounded()&&i()}),t.onButtonPress("action",()=>{t.state!=="attack"&&t.enterState("attack")}),t.onUpdate(()=>{const c=e.dt(),s=t.isGrounded(),p=t.moveDirection;if(p!==0){let u=s?n.accelGround:n.accelAir;Math.sign(p)!==Math.sign(t.vx)&&(u+=s?n.decelGround:n.decelAir),t.vx=S(t.vx,p*n.maxRunSpeed,u*c)}else{const u=s?n.decelGround:n.decelAir,d=Math.max(0,Math.abs(t.vx)-u*c);t.vx=d*Math.sign(t.vx)}t.move(t.vx,0),t.flipX=p<0?!0:p>0?!1:t.flipX,t.area.scale.x=t.flipX?-1:1,t.state!=="attack"?s?Math.abs(t.vx)>5?t.enterState("walk"):t.enterState("idle"):t.vel.y<0?t.enterState("jump"):t.enterState("fall"):t.getCurAnim()?.frameIndex===2&&t.add(["player.hitbox",e.pos(e.vec2(t.flipX?-16:16,0)),e.area(),e.rect(20,20),e.opacity(0),e.anchor("bot"),e.lifespan(.1)]).onCollide("enemy",d=>{d.applyImpulse(e.vec2(t.flipX?-20:20,-100))})}),t.onStateEnter("idle",()=>{a("idle")}),t.onStateUpdate("walk",()=>{a("walk");const c=e.clamp(Math.abs(t.vx)/n.maxRunSpeed,0,1);t.animSpeed=e.lerp(n.minRunAnimSpeed,n.maxRunAnimSpeed,c)}),t.onStateEnter("jump",()=>{a("jump")}),t.onStateEnter("fall",()=>{a("fall")}),t.onStateEnter("attack",()=>{a("attack",()=>{t.enterState("idle")}),t.animSpeed=1}),t}function S(e,o,r){const n=o-e;return Math.abs(n)<=r?o:e+Math.sign(o)*r}class B{static isMobilePlatform(o){return o=o||window.navigator.userAgent,/ios|iphone|ipad|ipod|android|windows phone/gi.test(o)}}const M=e=>{e.setGravity(1e3),e.add([e.rect(e.width(),20),e.pos(0,e.height()-20),e.color("#9e9303"),e.area(),e.anchor("top"),e.body({isStatic:!0})]),e.add([e.rect(100,20),e.pos(0,e.height()-60),e.color("#9e9303"),e.area(),e.anchor("top"),e.body({isStatic:!0})]),e.add([e.rect(100,20),e.pos(150,e.height()-100),e.color("#9e9303"),e.area(),e.anchor("top"),e.body({isStatic:!0})]),e.add([e.rect(100,20),e.pos(400,e.height()-150),e.color("#9e9303"),e.area(),e.anchor("top"),e.body({isStatic:!0})]),e.add(["enemy",e.pos(130,e.height()-100),e.rect(30,30),e.color("#0000ff"),e.outline(2),e.area(),e.body(),e.anchor("bot"),v(e),e.offscreen({destroy:!0})]);const o=w(e,e.vec2(120,0));B.isMobilePlatform()&&x(e,{size:Math.min(window.innerWidth/15,60)}),e.onUpdate(()=>{e.setCamPos(o.pos.x,o.pos.y-e.height()/4)})};f.scene("level-1",()=>M(f));f.go("level-1");window.addEventListener("resize",()=>{window.location.reload()});
