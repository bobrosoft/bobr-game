import{R as y}from"./kaplay-DTLyooHV.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(t){if(t.ep)return;t.ep=!0;const i=n(t);fetch(t.href,i)}})();function g(e,o){const n=o?.size??100,a=o?.deadZone??.1;e.loadSprite("joystick.jump","sprites/icons/jump.gif"),e.loadSprite("joystick.attack","sprites/icons/attack.gif");let t=!1,i=e.vec2(0,0),r=e.vec2(0,0);const s=e.add(["joystickBase",e.layer("hud"),e.stay(),e.pos(-9999,-9999),e.circle(n/2),e.color(0,0,0),e.opacity(.2),e.fixed(),e.anchor("center")]),c=e.add(["joystickKnob",e.layer("hud"),e.stay(),e.pos(-9999,-9999),e.circle(n/4),e.color(255,255,255),e.opacity(.7),e.fixed(),e.anchor("center")]),l=e.add(["jumpButton",e.layer("hud"),e.stay(),e.pos(e.width()-n*.5,e.height()-n*.5),e.area(),e.circle(n/3),e.color(0,0,0),e.opacity(.2),e.fixed(),e.anchor("center")]);l.add([e.sprite("joystick.jump"),e.anchor("center")]),l.onClick(()=>{e.pressButton("jump"),e.releaseButton("jump")});const u=e.add(["attackButton",e.layer("hud"),e.stay(),e.pos(e.width()-n*1.1,e.height()-n*1.1),e.area(),e.circle(n/2.5),e.color(0,0,0),e.opacity(.2),e.fixed(),e.anchor("center")]);u.add([e.sprite("joystick.attack"),e.anchor("center"),e.scale(1.2)]),u.onClick(()=>{e.pressButton("action"),e.releaseButton("action")}),s.onTouchStart(d=>{d.x>e.width()/2||(i=d,t=!0,s.pos=i,c.pos=i,s.hidden=!1,c.hidden=!1)}),s.onTouchMove(d=>{if(!t)return;r=d.sub(i);const p=n/2,m=e.vec2(e.clamp(r.x,-p,p),e.clamp(r.y,-p,p));c.pos=i.add(m)}),s.onTouchEnd(d=>{d.x>e.width()*.6||(t=!1,r=e.vec2(0,0),s.pos=e.vec2(-9999,-9999),c.pos=e.vec2(-9999,-9999),e.releaseButton("left"),e.releaseButton("right"))}),s.onUpdate(()=>{if(!t)return;const p=r.scale(1/(n/2)).x;p<-a?(e.pressButton("left"),e.releaseButton("right")):p>a?(e.pressButton("right"),e.releaseButton("left")):(e.releaseButton("left"),e.releaseButton("right"))})}const f=v(),h=y({global:!1,width:f.width,height:f.height,background:"#74dcf6",crisp:!0,letterbox:!0,pixelDensity:2,scale:2,debug:!0,debugKey:"`",buttons:{left:{keyboard:["left","a"],gamepad:["dpad-left"]},right:{keyboard:["right","d"],gamepad:["dpad-right"]},jump:{keyboard:["space","up","w","k"],gamepad:["south"]},action:{keyboard:["j","z"],gamepad:["east"]}}});function v(){let e=Math.min(window.innerWidth,400);e%2!==0&&(e-=1);let o=Math.floor(e/(window.innerWidth/window.innerHeight));return o%2!==0&&(o-=1),{width:e,height:o}}class x{static isTouchDevice(o){return o=o||window.navigator.userAgent,"ontouchstart"in window||navigator.maxTouchPoints>0||/ios|iphone|ipad|ipod|android|windows phone/gi.test(o)}}function w(e,o){return{id:"withFriction",require:["pos","body"],update(){const t=this.isGrounded();if(this.vel.x=Math.sign(this.vel.x)*Math.min(Math.abs(this.vel.x),1/0),t&&Math.abs(this.vel.x)>.1){const i=100*e.dt();this.vel.x>0?this.vel.x=Math.max(0,this.vel.x-i):this.vel.x=Math.min(0,this.vel.x+i)}}}}const b={maxRunSpeed:200,accelGround:200,accelAir:150,decelGround:500,decelAir:300,jumpForce:400,minRunAnimSpeed:1,maxRunAnimSpeed:2};h.loadSprite("player","sprites/characters/bobr.gif",{sliceX:5,sliceY:4,anims:{idle:{from:0,to:1,speed:3,loop:!0},walk:{from:5,to:8,speed:10,loop:!0},jump:{from:10,to:10},fall:{from:10,to:10},attack:{from:15,to:19,speed:20,loop:!1}}});function S(e,o=e.vec2(100,100),n){const a={...b,...n},t=e.add(["player",e.sprite("player",{anim:"idle"}),e.pos(o),e.area({shape:new e.Rect(e.vec2(1,0),20,31)}),e.body(),e.anchor("bot"),e.state("idle",["idle","walk","jump","fall","attack"]),{id:"playerCtrl",vx:0,get moveDirection(){return(e.isButtonDown("right")?1:0)+(e.isButtonDown("left")?-1:0)}}]);function i(){t.jump(a.jumpForce),t.enterState("jump")}function r(s,c){t.getCurAnim()?.name!==s&&t.play(s,{onEnd:c})}return t.onButtonPress("jump",()=>{t.isGrounded()&&i()}),t.onButtonPress("action",()=>{t.state!=="attack"&&t.enterState("attack")}),t.onUpdate(()=>{const s=e.dt(),c=t.isGrounded(),l=t.moveDirection;if(l!==0){let u=c?a.accelGround:a.accelAir;Math.sign(l)!==Math.sign(t.vx)&&(u+=c?a.decelGround:a.decelAir),t.vx=j(t.vx,l*a.maxRunSpeed,u*s)}else{const u=c?a.decelGround:a.decelAir,d=Math.max(0,Math.abs(t.vx)-u*s);t.vx=d*Math.sign(t.vx)}t.move(t.vx,0),t.flipX=l<0?!0:l>0?!1:t.flipX,t.area.scale.x=t.flipX?-1:1,t.state!=="attack"?c?Math.abs(t.vx)>5?t.enterState("walk"):t.enterState("idle"):t.vel.y<0?t.enterState("jump"):t.enterState("fall"):t.getCurAnim()?.frameIndex===2&&t.add(["player.hitbox",e.pos(e.vec2(t.flipX?-16:16,0)),e.area(),e.rect(20,20),e.opacity(0),e.anchor("bot"),e.lifespan(.1)]).onCollide("enemy",d=>{d.applyImpulse(e.vec2(t.flipX?-20:20,-100))})}),t.onStateEnter("idle",()=>{r("idle")}),t.onStateUpdate("walk",()=>{r("walk");const s=e.clamp(Math.abs(t.vx)/a.maxRunSpeed,0,1);t.animSpeed=e.lerp(a.minRunAnimSpeed,a.maxRunAnimSpeed,s)}),t.onStateEnter("jump",()=>{r("jump")}),t.onStateEnter("fall",()=>{r("fall")}),t.onStateEnter("attack",()=>{r("attack",()=>{t.enterState("idle")}),t.animSpeed=1}),t}function j(e,o,n){const a=o-e;return Math.abs(a)<=n?o:e+Math.sign(o)*n}const B=e=>{e.setGravity(1e3),e.add([e.rect(e.width(),20),e.pos(0,e.height()-20),e.color("#9e9303"),e.area(),e.anchor("top"),e.body({isStatic:!0})]),e.add([e.rect(100,20),e.pos(0,e.height()-60),e.color("#9e9303"),e.area(),e.anchor("top"),e.body({isStatic:!0})]),e.add([e.rect(100,20),e.pos(150,e.height()-100),e.color("#9e9303"),e.area(),e.anchor("top"),e.body({isStatic:!0})]),e.add([e.rect(100,20),e.pos(400,e.height()-150),e.color("#9e9303"),e.area(),e.anchor("top"),e.body({isStatic:!0})]),e.add(["enemy",e.pos(130,e.height()-100),e.rect(30,30),e.color("#0000ff"),e.outline(2),e.area(),e.body(),e.anchor("bot"),w(e),e.offscreen({destroy:!0})]);const o=S(e,e.vec2(120,0));e.onUpdate(()=>{e.setCamPos(o.pos.x,o.pos.y-e.height()/4)})};h.setLayers(["game","hud","menu"],"game");h.scene("level-home",()=>B(h));h.go("level-home");x.isTouchDevice()&&g(h,{size:Math.min(window.innerWidth/15,60)});window.addEventListener("resize",()=>{setTimeout(()=>{window.location.reload()},1e3)});
