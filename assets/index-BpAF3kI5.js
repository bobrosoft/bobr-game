import{R as Te}from"./kaplay-DTLyooHV.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}})();const g=t=>typeof t=="string",H=()=>{let t,e;const s=new Promise((n,i)=>{t=n,e=i});return s.resolve=t,s.reject=e,s},re=t=>t==null?"":""+t,Ae=(t,e,s)=>{t.forEach(n=>{e[n]&&(s[n]=e[n])})},Fe=/###/g,ae=t=>t&&t.indexOf("###")>-1?t.replace(Fe,"."):t,le=t=>!t||g(t),z=(t,e,s)=>{const n=g(e)?e.split("."):e;let i=0;for(;i<n.length-1;){if(le(t))return{};const o=ae(n[i]);!t[o]&&s&&(t[o]=new s),Object.prototype.hasOwnProperty.call(t,o)?t=t[o]:t={},++i}return le(t)?{}:{obj:t,k:ae(n[i])}},ue=(t,e,s)=>{const{obj:n,k:i}=z(t,e,Object);if(n!==void 0||e.length===1){n[i]=s;return}let o=e[e.length-1],r=e.slice(0,e.length-1),a=z(t,r,Object);for(;a.obj===void 0&&r.length;)o=`${r[r.length-1]}.${o}`,r=r.slice(0,r.length-1),a=z(t,r,Object),a?.obj&&typeof a.obj[`${a.k}.${o}`]<"u"&&(a.obj=void 0);a.obj[`${a.k}.${o}`]=s},je=(t,e,s,n)=>{const{obj:i,k:o}=z(t,e,Object);i[o]=i[o]||[],i[o].push(s)},Q=(t,e)=>{const{obj:s,k:n}=z(t,e);if(s&&Object.prototype.hasOwnProperty.call(s,n))return s[n]},Ke=(t,e,s)=>{const n=Q(t,s);return n!==void 0?n:Q(e,s)},Pe=(t,e,s)=>{for(const n in e)n!=="__proto__"&&n!=="constructor"&&(n in t?g(t[n])||t[n]instanceof String||g(e[n])||e[n]instanceof String?s&&(t[n]=e[n]):Pe(t[n],e[n],s):t[n]=e[n]);return t},K=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var Ue={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const Me=t=>g(t)?t.replace(/[&<>"'\/]/g,e=>Ue[e]):t;class Be{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const s=this.regExpMap.get(e);if(s!==void 0)return s;const n=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,n),this.regExpQueue.push(e),n}}const Ve=[" ",",","?","!",";"],He=new Be(20),ze=(t,e,s)=>{e=e||"",s=s||"";const n=Ve.filter(r=>e.indexOf(r)<0&&s.indexOf(r)<0);if(n.length===0)return!0;const i=He.getRegExp(`(${n.map(r=>r==="?"?"\\?":r).join("|")})`);let o=!i.test(t);if(!o){const r=t.indexOf(s);r>0&&!i.test(t.substring(0,r))&&(o=!0)}return o},ee=(t,e,s=".")=>{if(!t)return;if(t[e])return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0;const n=e.split(s);let i=t;for(let o=0;o<n.length;){if(!i||typeof i!="object")return;let r,a="";for(let l=o;l<n.length;++l)if(l!==o&&(a+=s),a+=n[l],r=i[a],r!==void 0){if(["string","number","boolean"].indexOf(typeof r)>-1&&l<n.length-1)continue;o+=l-o+1;break}i=r}return i},J=t=>t?.replace("_","-"),Je={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){console?.[t]?.apply?.(console,e)}};class Y{constructor(e,s={}){this.init(e,s)}init(e,s={}){this.prefix=s.prefix||"i18next:",this.logger=e||Je,this.options=s,this.debug=s.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,s,n,i){return i&&!this.debug?null:(g(e[0])&&(e[0]=`${n}${this.prefix} ${e[0]}`),this.logger[s](e))}create(e){return new Y(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new Y(this.logger,e)}}var E=new Y;class Z{constructor(){this.observers={}}on(e,s){return e.split(" ").forEach(n=>{this.observers[n]||(this.observers[n]=new Map);const i=this.observers[n].get(s)||0;this.observers[n].set(s,i+1)}),this}off(e,s){if(this.observers[e]){if(!s){delete this.observers[e];return}this.observers[e].delete(s)}}emit(e,...s){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([i,o])=>{for(let r=0;r<o;r++)i(...s)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([i,o])=>{for(let r=0;r<o;r++)i.apply(i,[e,...s])})}}class ce extends Z{constructor(e,s={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=s,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const s=this.options.ns.indexOf(e);s>-1&&this.options.ns.splice(s,1)}getResource(e,s,n,i={}){const o=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,r=i.ignoreJSONStructure!==void 0?i.ignoreJSONStructure:this.options.ignoreJSONStructure;let a;e.indexOf(".")>-1?a=e.split("."):(a=[e,s],n&&(Array.isArray(n)?a.push(...n):g(n)&&o?a.push(...n.split(o)):a.push(n)));const l=Q(this.data,a);return!l&&!s&&!n&&e.indexOf(".")>-1&&(e=a[0],s=a[1],n=a.slice(2).join(".")),l||!r||!g(n)?l:ee(this.data?.[e]?.[s],n,o)}addResource(e,s,n,i,o={silent:!1}){const r=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator;let a=[e,s];n&&(a=a.concat(r?n.split(r):n)),e.indexOf(".")>-1&&(a=e.split("."),i=s,s=a[1]),this.addNamespaces(s),ue(this.data,a,i),o.silent||this.emit("added",e,s,n,i)}addResources(e,s,n,i={silent:!1}){for(const o in n)(g(n[o])||Array.isArray(n[o]))&&this.addResource(e,s,o,n[o],{silent:!0});i.silent||this.emit("added",e,s,n)}addResourceBundle(e,s,n,i,o,r={silent:!1,skipCopy:!1}){let a=[e,s];e.indexOf(".")>-1&&(a=e.split("."),i=n,n=s,s=a[1]),this.addNamespaces(s);let l=Q(this.data,a)||{};r.skipCopy||(n=JSON.parse(JSON.stringify(n))),i?Pe(l,n,o):l={...l,...n},ue(this.data,a,l),r.silent||this.emit("added",e,s,n)}removeResourceBundle(e,s){this.hasResourceBundle(e,s)&&delete this.data[e][s],this.removeNamespaces(s),this.emit("removed",e,s)}hasResourceBundle(e,s){return this.getResource(e,s)!==void 0}getResourceBundle(e,s){return s||(s=this.options.defaultNS),this.getResource(e,s)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const s=this.getDataByLanguage(e);return!!(s&&Object.keys(s)||[]).find(i=>s[i]&&Object.keys(s[i]).length>0)}toJSON(){return this.data}}var Re={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,s,n,i){return t.forEach(o=>{e=this.processors[o]?.process(e,s,n,i)??e}),e}};const de={},fe=t=>!g(t)&&typeof t!="boolean"&&typeof t!="number";class _ extends Z{constructor(e,s={}){super(),Ae(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=s,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=E.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,s={interpolation:{}}){const n={...s};return e==null?!1:this.resolve(e,n)?.res!==void 0}extractFromKey(e,s){let n=s.nsSeparator!==void 0?s.nsSeparator:this.options.nsSeparator;n===void 0&&(n=":");const i=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let o=s.ns||this.options.defaultNS||[];const r=n&&e.indexOf(n)>-1,a=!this.options.userDefinedKeySeparator&&!s.keySeparator&&!this.options.userDefinedNsSeparator&&!s.nsSeparator&&!ze(e,n,i);if(r&&!a){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:g(o)?[o]:o};const u=e.split(n);(n!==i||n===i&&this.options.ns.indexOf(u[0])>-1)&&(o=u.shift()),e=u.join(i)}return{key:e,namespaces:g(o)?[o]:o}}translate(e,s,n){let i=typeof s=="object"?{...s}:s;if(typeof i!="object"&&this.options.overloadTranslationOptionHandler&&(i=this.options.overloadTranslationOptionHandler(arguments)),typeof options=="object"&&(i={...i}),i||(i={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const o=i.returnDetails!==void 0?i.returnDetails:this.options.returnDetails,r=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,{key:a,namespaces:l}=this.extractFromKey(e[e.length-1],i),u=l[l.length-1];let d=i.nsSeparator!==void 0?i.nsSeparator:this.options.nsSeparator;d===void 0&&(d=":");const c=i.lng||this.language,f=i.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(c?.toLowerCase()==="cimode")return f?o?{res:`${u}${d}${a}`,usedKey:a,exactUsedKey:a,usedLng:c,usedNS:u,usedParams:this.getUsedParamsDetails(i)}:`${u}${d}${a}`:o?{res:a,usedKey:a,exactUsedKey:a,usedLng:c,usedNS:u,usedParams:this.getUsedParamsDetails(i)}:a;const h=this.resolve(e,i);let p=h?.res;const y=h?.usedKey||a,b=h?.exactUsedKey||a,L=["[object Number]","[object Function]","[object RegExp]"],x=i.joinArrays!==void 0?i.joinArrays:this.options.joinArrays,T=!this.i18nFormat||this.i18nFormat.handleAsObject,v=i.count!==void 0&&!g(i.count),I=_.hasDefaultValue(i),F=v?this.pluralResolver.getSuffix(c,i.count,i):"",j=i.ordinal&&v?this.pluralResolver.getSuffix(c,i.count,{ordinal:!1}):"",ie=v&&!i.ordinal&&i.count===0,D=ie&&i[`defaultValue${this.options.pluralSeparator}zero`]||i[`defaultValue${F}`]||i[`defaultValue${j}`]||i.defaultValue;let C=p;T&&!p&&I&&(C=D);const De=fe(C),Ne=Object.prototype.toString.apply(C);if(T&&C&&De&&L.indexOf(Ne)<0&&!(g(x)&&Array.isArray(C))){if(!i.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const P=this.options.returnedObjectHandler?this.options.returnedObjectHandler(y,C,{...i,ns:l}):`key '${a} (${this.language})' returned an object instead of string.`;return o?(h.res=P,h.usedParams=this.getUsedParamsDetails(i),h):P}if(r){const P=Array.isArray(C),O=P?[]:{},se=P?b:y;for(const R in C)if(Object.prototype.hasOwnProperty.call(C,R)){const $=`${se}${r}${R}`;I&&!p?O[R]=this.translate($,{...i,defaultValue:fe(D)?D[R]:void 0,joinArrays:!1,ns:l}):O[R]=this.translate($,{...i,joinArrays:!1,ns:l}),O[R]===$&&(O[R]=C[R])}p=O}}else if(T&&g(x)&&Array.isArray(p))p=p.join(x),p&&(p=this.extendTranslation(p,e,i,n));else{let P=!1,O=!1;!this.isValidLookup(p)&&I&&(P=!0,p=D),this.isValidLookup(p)||(O=!0,p=a);const R=(i.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&O?void 0:p,$=I&&D!==p&&this.options.updateMissing;if(O||P||$){if(this.logger.log($?"updateKey":"missingKey",c,u,a,$?D:p),r){const w=this.resolve(a,{...i,keySeparator:!1});w&&w.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let B=[];const X=this.languageUtils.getFallbackCodes(this.options.fallbackLng,i.lng||this.language);if(this.options.saveMissingTo==="fallback"&&X&&X[0])for(let w=0;w<X.length;w++)B.push(X[w]);else this.options.saveMissingTo==="all"?B=this.languageUtils.toResolveHierarchy(i.lng||this.language):B.push(i.lng||this.language);const ne=(w,A,V)=>{const oe=I&&V!==p?V:R;this.options.missingKeyHandler?this.options.missingKeyHandler(w,u,A,oe,$,i):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(w,u,A,oe,$,i),this.emit("missingKey",w,u,A,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&v?B.forEach(w=>{const A=this.pluralResolver.getSuffixes(w,i);ie&&i[`defaultValue${this.options.pluralSeparator}zero`]&&A.indexOf(`${this.options.pluralSeparator}zero`)<0&&A.push(`${this.options.pluralSeparator}zero`),A.forEach(V=>{ne([w],a+V,i[`defaultValue${V}`]||D)})}):ne(B,a,D))}p=this.extendTranslation(p,e,i,h,n),O&&p===a&&this.options.appendNamespaceToMissingKey&&(p=`${u}${d}${a}`),(O||P)&&this.options.parseMissingKeyHandler&&(p=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${u}${d}${a}`:a,P?p:void 0,i))}return o?(h.res=p,h.usedParams=this.getUsedParamsDetails(i),h):p}extendTranslation(e,s,n,i,o){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});const l=g(e)&&(n?.interpolation?.skipOnVariables!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let u;if(l){const c=e.match(this.interpolator.nestingRegexp);u=c&&c.length}let d=n.replace&&!g(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(d={...this.options.interpolation.defaultVariables,...d}),e=this.interpolator.interpolate(e,d,n.lng||this.language||i.usedLng,n),l){const c=e.match(this.interpolator.nestingRegexp),f=c&&c.length;u<f&&(n.nest=!1)}!n.lng&&i&&i.res&&(n.lng=this.language||i.usedLng),n.nest!==!1&&(e=this.interpolator.nest(e,(...c)=>o?.[0]===c[0]&&!n.context?(this.logger.warn(`It seems you are nesting recursively key: ${c[0]} in key: ${s[0]}`),null):this.translate(...c,s),n)),n.interpolation&&this.interpolator.reset()}const r=n.postProcess||this.options.postProcess,a=g(r)?[r]:r;return e!=null&&a?.length&&n.applyPostProcessor!==!1&&(e=Re.handle(a,e,s,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...i,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),e}resolve(e,s={}){let n,i,o,r,a;return g(e)&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(n))return;const u=this.extractFromKey(l,s),d=u.key;i=d;let c=u.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const f=s.count!==void 0&&!g(s.count),h=f&&!s.ordinal&&s.count===0,p=s.context!==void 0&&(g(s.context)||typeof s.context=="number")&&s.context!=="",y=s.lngs?s.lngs:this.languageUtils.toResolveHierarchy(s.lng||this.language,s.fallbackLng);c.forEach(b=>{this.isValidLookup(n)||(a=b,!de[`${y[0]}-${b}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(a)&&(de[`${y[0]}-${b}`]=!0,this.logger.warn(`key "${i}" for languages "${y.join(", ")}" won't get resolved as namespace "${a}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),y.forEach(L=>{if(this.isValidLookup(n))return;r=L;const x=[d];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(x,d,L,b,s);else{let v;f&&(v=this.pluralResolver.getSuffix(L,s.count,s));const I=`${this.options.pluralSeparator}zero`,F=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(f&&(x.push(d+v),s.ordinal&&v.indexOf(F)===0&&x.push(d+v.replace(F,this.options.pluralSeparator)),h&&x.push(d+I)),p){const j=`${d}${this.options.contextSeparator}${s.context}`;x.push(j),f&&(x.push(j+v),s.ordinal&&v.indexOf(F)===0&&x.push(j+v.replace(F,this.options.pluralSeparator)),h&&x.push(j+I))}}let T;for(;T=x.pop();)this.isValidLookup(n)||(o=T,n=this.getResource(L,b,T,s))}))})}),{res:n,usedKey:i,exactUsedKey:o,usedLng:r,usedNS:a}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,s,n,i={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,s,n,i):this.resourceStore.getResource(e,s,n,i)}getUsedParamsDetails(e={}){const s=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=e.replace&&!g(e.replace);let i=n?e.replace:e;if(n&&typeof e.count<"u"&&(i.count=e.count),this.options.interpolation.defaultVariables&&(i={...this.options.interpolation.defaultVariables,...i}),!n){i={...i};for(const o of s)delete i[o]}return i}static hasDefaultValue(e){const s="defaultValue";for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&s===n.substring(0,s.length)&&e[n]!==void 0)return!0;return!1}}class he{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=E.create("languageUtils")}getScriptPartFromCode(e){if(e=J(e),!e||e.indexOf("-")<0)return null;const s=e.split("-");return s.length===2||(s.pop(),s[s.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(s.join("-"))}getLanguagePartFromCode(e){if(e=J(e),!e||e.indexOf("-")<0)return e;const s=e.split("-");return this.formatLanguageCode(s[0])}formatLanguageCode(e){if(g(e)&&e.indexOf("-")>-1){let s;try{s=Intl.getCanonicalLocales(e)[0]}catch{}return s&&this.options.lowerCaseLng&&(s=s.toLowerCase()),s||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let s;return e.forEach(n=>{if(s)return;const i=this.formatLanguageCode(n);(!this.options.supportedLngs||this.isSupportedCode(i))&&(s=i)}),!s&&this.options.supportedLngs&&e.forEach(n=>{if(s)return;const i=this.getScriptPartFromCode(n);if(this.isSupportedCode(i))return s=i;const o=this.getLanguagePartFromCode(n);if(this.isSupportedCode(o))return s=o;s=this.options.supportedLngs.find(r=>{if(r===o)return r;if(!(r.indexOf("-")<0&&o.indexOf("-")<0)&&(r.indexOf("-")>0&&o.indexOf("-")<0&&r.substring(0,r.indexOf("-"))===o||r.indexOf(o)===0&&o.length>1))return r})}),s||(s=this.getFallbackCodes(this.options.fallbackLng)[0]),s}getFallbackCodes(e,s){if(!e)return[];if(typeof e=="function"&&(e=e(s)),g(e)&&(e=[e]),Array.isArray(e))return e;if(!s)return e.default||[];let n=e[s];return n||(n=e[this.getScriptPartFromCode(s)]),n||(n=e[this.formatLanguageCode(s)]),n||(n=e[this.getLanguagePartFromCode(s)]),n||(n=e.default),n||[]}toResolveHierarchy(e,s){const n=this.getFallbackCodes((s===!1?[]:s)||this.options.fallbackLng||[],e),i=[],o=r=>{r&&(this.isSupportedCode(r)?i.push(r):this.logger.warn(`rejecting language code not found in supportedLngs: ${r}`))};return g(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&o(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&o(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&o(this.getLanguagePartFromCode(e))):g(e)&&o(this.formatLanguageCode(e)),n.forEach(r=>{i.indexOf(r)<0&&o(this.formatLanguageCode(r))}),i}}const pe={zero:0,one:1,two:2,few:3,many:4,other:5},ge={select:t=>t===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class We{constructor(e,s={}){this.languageUtils=e,this.options=s,this.logger=E.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,s){this.rules[e]=s}clearCache(){this.pluralRulesCache={}}getRule(e,s={}){const n=J(e==="dev"?"en":e),i=s.ordinal?"ordinal":"cardinal",o=JSON.stringify({cleanedCode:n,type:i});if(o in this.pluralRulesCache)return this.pluralRulesCache[o];let r;try{r=new Intl.PluralRules(n,{type:i})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),ge;if(!e.match(/-|_/))return ge;const l=this.languageUtils.getLanguagePartFromCode(e);r=this.getRule(l,s)}return this.pluralRulesCache[o]=r,r}needsPlural(e,s={}){let n=this.getRule(e,s);return n||(n=this.getRule("dev",s)),n?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,s,n={}){return this.getSuffixes(e,n).map(i=>`${s}${i}`)}getSuffixes(e,s={}){let n=this.getRule(e,s);return n||(n=this.getRule("dev",s)),n?n.resolvedOptions().pluralCategories.sort((i,o)=>pe[i]-pe[o]).map(i=>`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${i}`):[]}getSuffix(e,s,n={}){const i=this.getRule(e,n);return i?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${i.select(s)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",s,n))}}const me=(t,e,s,n=".",i=!0)=>{let o=Ke(t,e,s);return!o&&i&&g(s)&&(o=ee(t,s,n),o===void 0&&(o=ee(e,s,n))),o},q=t=>t.replace(/\$/g,"$$$$");class Xe{constructor(e={}){this.logger=E.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(s=>s),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:s,escapeValue:n,useRawValueToEscape:i,prefix:o,prefixEscaped:r,suffix:a,suffixEscaped:l,formatSeparator:u,unescapeSuffix:d,unescapePrefix:c,nestingPrefix:f,nestingPrefixEscaped:h,nestingSuffix:p,nestingSuffixEscaped:y,nestingOptionsSeparator:b,maxReplaces:L,alwaysFormat:x}=e.interpolation;this.escape=s!==void 0?s:Me,this.escapeValue=n!==void 0?n:!0,this.useRawValueToEscape=i!==void 0?i:!1,this.prefix=o?K(o):r||"{{",this.suffix=a?K(a):l||"}}",this.formatSeparator=u||",",this.unescapePrefix=d?"":c||"-",this.unescapeSuffix=this.unescapePrefix?"":d||"",this.nestingPrefix=f?K(f):h||K("$t("),this.nestingSuffix=p?K(p):y||K(")"),this.nestingOptionsSeparator=b||",",this.maxReplaces=L||1e3,this.alwaysFormat=x!==void 0?x:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(s,n)=>s?.source===n?(s.lastIndex=0,s):new RegExp(n,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,s,n,i){let o,r,a;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},u=h=>{if(h.indexOf(this.formatSeparator)<0){const L=me(s,l,h,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(L,void 0,n,{...i,...s,interpolationkey:h}):L}const p=h.split(this.formatSeparator),y=p.shift().trim(),b=p.join(this.formatSeparator).trim();return this.format(me(s,l,y,this.options.keySeparator,this.options.ignoreJSONStructure),b,n,{...i,...s,interpolationkey:y})};this.resetRegExp();const d=i?.missingInterpolationHandler||this.options.missingInterpolationHandler,c=i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:h=>q(h)},{regex:this.regexp,safeValue:h=>this.escapeValue?q(this.escape(h)):q(h)}].forEach(h=>{for(a=0;o=h.regex.exec(e);){const p=o[1].trim();if(r=u(p),r===void 0)if(typeof d=="function"){const b=d(e,o,i);r=g(b)?b:""}else if(i&&Object.prototype.hasOwnProperty.call(i,p))r="";else if(c){r=o[0];continue}else this.logger.warn(`missed to pass in variable ${p} for interpolating ${e}`),r="";else!g(r)&&!this.useRawValueToEscape&&(r=re(r));const y=h.safeValue(r);if(e=e.replace(o[0],y),c?(h.regex.lastIndex+=r.length,h.regex.lastIndex-=o[0].length):h.regex.lastIndex=0,a++,a>=this.maxReplaces)break}}),e}nest(e,s,n={}){let i,o,r;const a=(l,u)=>{const d=this.nestingOptionsSeparator;if(l.indexOf(d)<0)return l;const c=l.split(new RegExp(`${d}[ ]*{`));let f=`{${c[1]}`;l=c[0],f=this.interpolate(f,r);const h=f.match(/'/g),p=f.match(/"/g);((h?.length??0)%2===0&&!p||p.length%2!==0)&&(f=f.replace(/'/g,'"'));try{r=JSON.parse(f),u&&(r={...u,...r})}catch(y){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,y),`${l}${d}${f}`}return r.defaultValue&&r.defaultValue.indexOf(this.prefix)>-1&&delete r.defaultValue,l};for(;i=this.nestingRegexp.exec(e);){let l=[];r={...n},r=r.replace&&!g(r.replace)?r.replace:r,r.applyPostProcessor=!1,delete r.defaultValue;const u=/{.*}/.test(i[1])?i[1].lastIndexOf("}")+1:i[1].indexOf(this.formatSeparator);if(u!==-1&&(l=i[1].slice(u).split(this.formatSeparator).map(d=>d.trim()).filter(Boolean),i[1]=i[1].slice(0,u)),o=s(a.call(this,i[1].trim(),r),r),o&&i[0]===e&&!g(o))return o;g(o)||(o=re(o)),o||(this.logger.warn(`missed to resolve ${i[1]} for nesting ${e}`),o=""),l.length&&(o=l.reduce((d,c)=>this.format(d,c,n.lng,{...n,interpolationkey:i[1].trim()}),o.trim())),e=e.replace(i[0],o),this.regexp.lastIndex=0}return e}}const Ge=t=>{let e=t.toLowerCase().trim();const s={};if(t.indexOf("(")>-1){const n=t.split("(");e=n[0].toLowerCase().trim();const i=n[1].substring(0,n[1].length-1);e==="currency"&&i.indexOf(":")<0?s.currency||(s.currency=i.trim()):e==="relativetime"&&i.indexOf(":")<0?s.range||(s.range=i.trim()):i.split(";").forEach(r=>{if(r){const[a,...l]=r.split(":"),u=l.join(":").trim().replace(/^'+|'+$/g,""),d=a.trim();s[d]||(s[d]=u),u==="false"&&(s[d]=!1),u==="true"&&(s[d]=!0),isNaN(u)||(s[d]=parseInt(u,10))}})}return{formatName:e,formatOptions:s}},ye=t=>{const e={};return(s,n,i)=>{let o=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(o={...o,[i.interpolationkey]:void 0});const r=n+JSON.stringify(o);let a=e[r];return a||(a=t(J(n),i),e[r]=a),a(s)}},Qe=t=>(e,s,n)=>t(J(s),n)(e);class Ye{constructor(e={}){this.logger=E.create("formatter"),this.options=e,this.init(e)}init(e,s={interpolation:{}}){this.formatSeparator=s.interpolation.formatSeparator||",";const n=s.cacheInBuiltFormats?ye:Qe;this.formats={number:n((i,o)=>{const r=new Intl.NumberFormat(i,{...o});return a=>r.format(a)}),currency:n((i,o)=>{const r=new Intl.NumberFormat(i,{...o,style:"currency"});return a=>r.format(a)}),datetime:n((i,o)=>{const r=new Intl.DateTimeFormat(i,{...o});return a=>r.format(a)}),relativetime:n((i,o)=>{const r=new Intl.RelativeTimeFormat(i,{...o});return a=>r.format(a,o.range||"day")}),list:n((i,o)=>{const r=new Intl.ListFormat(i,{...o});return a=>r.format(a)})}}add(e,s){this.formats[e.toLowerCase().trim()]=s}addCached(e,s){this.formats[e.toLowerCase().trim()]=ye(s)}format(e,s,n,i={}){const o=s.split(this.formatSeparator);if(o.length>1&&o[0].indexOf("(")>1&&o[0].indexOf(")")<0&&o.find(a=>a.indexOf(")")>-1)){const a=o.findIndex(l=>l.indexOf(")")>-1);o[0]=[o[0],...o.splice(1,a)].join(this.formatSeparator)}return o.reduce((a,l)=>{const{formatName:u,formatOptions:d}=Ge(l);if(this.formats[u]){let c=a;try{const f=i?.formatParams?.[i.interpolationkey]||{},h=f.locale||f.lng||i.locale||i.lng||n;c=this.formats[u](a,h,{...d,...i,...f})}catch(f){this.logger.warn(f)}return c}else this.logger.warn(`there was no format function for ${u}`);return a},e)}}const _e=(t,e)=>{t.pending[e]!==void 0&&(delete t.pending[e],t.pendingCount--)};class Ze extends Z{constructor(e,s,n,i={}){super(),this.backend=e,this.store=s,this.services=n,this.languageUtils=n.languageUtils,this.options=i,this.logger=E.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=i.maxParallelReads||10,this.readingCalls=0,this.maxRetries=i.maxRetries>=0?i.maxRetries:5,this.retryTimeout=i.retryTimeout>=1?i.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(n,i.backend,i)}queueLoad(e,s,n,i){const o={},r={},a={},l={};return e.forEach(u=>{let d=!0;s.forEach(c=>{const f=`${u}|${c}`;!n.reload&&this.store.hasResourceBundle(u,c)?this.state[f]=2:this.state[f]<0||(this.state[f]===1?r[f]===void 0&&(r[f]=!0):(this.state[f]=1,d=!1,r[f]===void 0&&(r[f]=!0),o[f]===void 0&&(o[f]=!0),l[c]===void 0&&(l[c]=!0)))}),d||(a[u]=!0)}),(Object.keys(o).length||Object.keys(r).length)&&this.queue.push({pending:r,pendingCount:Object.keys(r).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(o),pending:Object.keys(r),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(l)}}loaded(e,s,n){const i=e.split("|"),o=i[0],r=i[1];s&&this.emit("failedLoading",o,r,s),!s&&n&&this.store.addResourceBundle(o,r,n,void 0,void 0,{skipCopy:!0}),this.state[e]=s?-1:2,s&&n&&(this.state[e]=0);const a={};this.queue.forEach(l=>{je(l.loaded,[o],r),_e(l,e),s&&l.errors.push(s),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(u=>{a[u]||(a[u]={});const d=l.loaded[u];d.length&&d.forEach(c=>{a[u][c]===void 0&&(a[u][c]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",a),this.queue=this.queue.filter(l=>!l.done)}read(e,s,n,i=0,o=this.retryTimeout,r){if(!e.length)return r(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:s,fcName:n,tried:i,wait:o,callback:r});return}this.readingCalls++;const a=(u,d)=>{if(this.readingCalls--,this.waitingReads.length>0){const c=this.waitingReads.shift();this.read(c.lng,c.ns,c.fcName,c.tried,c.wait,c.callback)}if(u&&d&&i<this.maxRetries){setTimeout(()=>{this.read.call(this,e,s,n,i+1,o*2,r)},o);return}r(u,d)},l=this.backend[n].bind(this.backend);if(l.length===2){try{const u=l(e,s);u&&typeof u.then=="function"?u.then(d=>a(null,d)).catch(a):a(null,u)}catch(u){a(u)}return}return l(e,s,a)}prepareLoading(e,s,n={},i){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();g(e)&&(e=this.languageUtils.toResolveHierarchy(e)),g(s)&&(s=[s]);const o=this.queueLoad(e,s,n,i);if(!o.toLoad.length)return o.pending.length||i(),null;o.toLoad.forEach(r=>{this.loadOne(r)})}load(e,s,n){this.prepareLoading(e,s,{},n)}reload(e,s,n){this.prepareLoading(e,s,{reload:!0},n)}loadOne(e,s=""){const n=e.split("|"),i=n[0],o=n[1];this.read(i,o,"read",void 0,void 0,(r,a)=>{r&&this.logger.warn(`${s}loading namespace ${o} for language ${i} failed`,r),!r&&a&&this.logger.log(`${s}loaded namespace ${o} for language ${i}`,a),this.loaded(e,r,a)})}saveMissing(e,s,n,i,o,r={},a=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(s)){this.logger.warn(`did not save key "${n}" as the namespace "${s}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(n==null||n==="")){if(this.backend?.create){const l={...r,isUpdate:o},u=this.backend.create.bind(this.backend);if(u.length<6)try{let d;u.length===5?d=u(e,s,n,i,l):d=u(e,s,n,i),d&&typeof d.then=="function"?d.then(c=>a(null,c)).catch(a):a(null,d)}catch(d){a(d)}else u(e,s,n,i,a,l)}!e||!e[0]||this.store.addResource(e[0],s,n,i)}}}const xe=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if(typeof t[1]=="object"&&(e=t[1]),g(t[1])&&(e.defaultValue=t[1]),g(t[2])&&(e.tDescription=t[2]),typeof t[2]=="object"||typeof t[3]=="object"){const s=t[3]||t[2];Object.keys(s).forEach(n=>{e[n]=s[n]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),Se=t=>(g(t.ns)&&(t.ns=[t.ns]),g(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),g(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs?.indexOf?.("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),typeof t.initImmediate=="boolean"&&(t.initAsync=t.initImmediate),t),G=()=>{},qe=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(s=>{typeof t[s]=="function"&&(t[s]=t[s].bind(t))})};class W extends Z{constructor(e={},s){if(super(),this.options=Se(e),this.services={},this.logger=E,this.modules={external:[]},qe(this),s&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,s),this;setTimeout(()=>{this.init(e,s)},0)}}init(e={},s){this.isInitializing=!0,typeof e=="function"&&(s=e,e={}),e.defaultNS==null&&e.ns&&(g(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const n=xe();this.options={...n,...this.options,...Se(e)},this.options.interpolation={...n.interpolation,...this.options.interpolation},e.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=e.keySeparator),e.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=e.nsSeparator);const i=u=>u?typeof u=="function"?new u:u:null;if(!this.options.isClone){this.modules.logger?E.init(i(this.modules.logger),this.options):E.init(null,this.options);let u;this.modules.formatter?u=this.modules.formatter:u=Ye;const d=new he(this.options);this.store=new ce(this.options.resources,this.options);const c=this.services;c.logger=E,c.resourceStore=this.store,c.languageUtils=d,c.pluralResolver=new We(d,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==n.interpolation.format&&this.logger.warn("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),u&&(!this.options.interpolation.format||this.options.interpolation.format===n.interpolation.format)&&(c.formatter=i(u),c.formatter.init&&c.formatter.init(c,this.options),this.options.interpolation.format=c.formatter.format.bind(c.formatter)),c.interpolator=new Xe(this.options),c.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},c.backendConnector=new Ze(i(this.modules.backend),c.resourceStore,c,this.options),c.backendConnector.on("*",(h,...p)=>{this.emit(h,...p)}),this.modules.languageDetector&&(c.languageDetector=i(this.modules.languageDetector),c.languageDetector.init&&c.languageDetector.init(c,this.options.detection,this.options)),this.modules.i18nFormat&&(c.i18nFormat=i(this.modules.i18nFormat),c.i18nFormat.init&&c.i18nFormat.init(this)),this.translator=new _(this.services,this.options),this.translator.on("*",(h,...p)=>{this.emit(h,...p)}),this.modules.external.forEach(h=>{h.init&&h.init(this)})}if(this.format=this.options.interpolation.format,s||(s=G),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const u=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);u.length>0&&u[0]!=="dev"&&(this.options.lng=u[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(u=>{this[u]=(...d)=>this.store[u](...d)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(u=>{this[u]=(...d)=>(this.store[u](...d),this)});const a=H(),l=()=>{const u=(d,c)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),a.resolve(c),s(d,c)};if(this.languages&&!this.isInitialized)return u(null,this.t.bind(this));this.changeLanguage(this.options.lng,u)};return this.options.resources||!this.options.initAsync?l():setTimeout(l,0),a}loadResources(e,s=G){let n=s;const i=g(e)?e:this.language;if(typeof e=="function"&&(n=e),!this.options.resources||this.options.partialBundledLanguages){if(i?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return n();const o=[],r=a=>{if(!a||a==="cimode")return;this.services.languageUtils.toResolveHierarchy(a).forEach(u=>{u!=="cimode"&&o.indexOf(u)<0&&o.push(u)})};i?r(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>r(l)),this.options.preload?.forEach?.(a=>r(a)),this.services.backendConnector.load(o,this.options.ns,a=>{!a&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),n(a)})}else n(null)}reloadResources(e,s,n){const i=H();return typeof e=="function"&&(n=e,e=void 0),typeof s=="function"&&(n=s,s=void 0),e||(e=this.languages),s||(s=this.options.ns),n||(n=G),this.services.backendConnector.reload(e,s,o=>{i.resolve(),n(o)}),i}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&Re.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1)){for(let s=0;s<this.languages.length;s++){const n=this.languages[s];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,s){this.isLanguageChangingTo=e;const n=H();this.emit("languageChanging",e);const i=a=>{this.language=a,this.languages=this.services.languageUtils.toResolveHierarchy(a),this.resolvedLanguage=void 0,this.setResolvedLanguage(a)},o=(a,l)=>{l?this.isLanguageChangingTo===e&&(i(l),this.translator.changeLanguage(l),this.isLanguageChangingTo=void 0,this.emit("languageChanged",l),this.logger.log("languageChanged",l)):this.isLanguageChangingTo=void 0,n.resolve((...u)=>this.t(...u)),s&&s(a,(...u)=>this.t(...u))},r=a=>{!e&&!a&&this.services.languageDetector&&(a=[]);const l=g(a)?a:a&&a[0],u=this.store.hasLanguageSomeTranslations(l)?l:this.services.languageUtils.getBestMatchFromCodes(g(a)?[a]:a);u&&(this.language||i(u),this.translator.language||this.translator.changeLanguage(u),this.services.languageDetector?.cacheUserLanguage?.(u)),this.loadResources(u,d=>{o(d,u)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?r(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(r):this.services.languageDetector.detect(r):r(e),n}getFixedT(e,s,n){const i=(o,r,...a)=>{let l;typeof r!="object"?l=this.options.overloadTranslationOptionHandler([o,r].concat(a)):l={...r},l.lng=l.lng||i.lng,l.lngs=l.lngs||i.lngs,l.ns=l.ns||i.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||n||i.keyPrefix);const u=this.options.keySeparator||".";let d;return l.keyPrefix&&Array.isArray(o)?d=o.map(c=>`${l.keyPrefix}${u}${c}`):d=l.keyPrefix?`${l.keyPrefix}${u}${o}`:o,this.t(d,l)};return g(e)?i.lng=e:i.lngs=e,i.ns=s,i.keyPrefix=n,i}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,s={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=s.lng||this.resolvedLanguage||this.languages[0],i=this.options?this.options.fallbackLng:!1,o=this.languages[this.languages.length-1];if(n.toLowerCase()==="cimode")return!0;const r=(a,l)=>{const u=this.services.backendConnector.state[`${a}|${l}`];return u===-1||u===0||u===2};if(s.precheck){const a=s.precheck(this,r);if(a!==void 0)return a}return!!(this.hasResourceBundle(n,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||r(n,e)&&(!i||r(o,e)))}loadNamespaces(e,s){const n=H();return this.options.ns?(g(e)&&(e=[e]),e.forEach(i=>{this.options.ns.indexOf(i)<0&&this.options.ns.push(i)}),this.loadResources(i=>{n.resolve(),s&&s(i)}),n):(s&&s(),Promise.resolve())}loadLanguages(e,s){const n=H();g(e)&&(e=[e]);const i=this.options.preload||[],o=e.filter(r=>i.indexOf(r)<0&&this.services.languageUtils.isSupportedCode(r));return o.length?(this.options.preload=i.concat(o),this.loadResources(r=>{n.resolve(),s&&s(r)}),n):(s&&s(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";try{const i=new Intl.Locale(e);if(i&&i.getTextInfo){const o=i.getTextInfo();if(o&&o.direction)return o.direction}}catch{}const s=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],n=this.services?.languageUtils||new he(xe());return e.toLowerCase().indexOf("-latn")>1?"ltr":s.indexOf(n.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},s){return new W(e,s)}cloneInstance(e={},s=G){const n=e.forkResourceStore;n&&delete e.forkResourceStore;const i={...this.options,...e,isClone:!0},o=new W(i);if((e.debug!==void 0||e.prefix!==void 0)&&(o.logger=o.logger.clone(e)),["store","services","language"].forEach(a=>{o[a]=this[a]}),o.services={...this.services},o.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},n){const a=Object.keys(this.store.data).reduce((l,u)=>(l[u]={...this.store.data[u]},l[u]=Object.keys(l[u]).reduce((d,c)=>(d[c]={...l[u][c]},d),l[u]),l),{});o.store=new ce(a,i),o.services.resourceStore=o.store}return o.translator=new _(o.services,i),o.translator.on("*",(a,...l)=>{o.emit(a,...l)}),o.init(i,s),o.translator.options=i,o.translator.backendConnector.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const S=W.createInstance();S.createInstance=W.createInstance;S.createInstance;S.dir;S.init;S.loadResources;S.reloadResources;S.use;S.changeLanguage;S.getFixedT;const te=S.t;S.exists;S.setDefaultNamespace;S.hasLoadedNamespace;S.loadNamespaces;S.loadLanguages;const{slice:ke,forEach:et}=[];function tt(t){return et.call(ke.call(arguments,1),e=>{if(e)for(const s in e)t[s]===void 0&&(t[s]=e[s])}),t}function it(t){return typeof t!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(s=>s.test(t))}const be=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,st=function(t,e){const n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},i=encodeURIComponent(e);let o=`${t}=${i}`;if(n.maxAge>0){const r=n.maxAge-0;if(Number.isNaN(r))throw new Error("maxAge should be a Number");o+=`; Max-Age=${Math.floor(r)}`}if(n.domain){if(!be.test(n.domain))throw new TypeError("option domain is invalid");o+=`; Domain=${n.domain}`}if(n.path){if(!be.test(n.path))throw new TypeError("option path is invalid");o+=`; Path=${n.path}`}if(n.expires){if(typeof n.expires.toUTCString!="function")throw new TypeError("option expires is invalid");o+=`; Expires=${n.expires.toUTCString()}`}if(n.httpOnly&&(o+="; HttpOnly"),n.secure&&(o+="; Secure"),n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return n.partitioned&&(o+="; Partitioned"),o},we={create(t,e,s,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};s&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+s*60*1e3)),n&&(i.domain=n),document.cookie=st(t,e,i)},read(t){const e=`${t}=`,s=document.cookie.split(";");for(let n=0;n<s.length;n++){let i=s[n];for(;i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return i.substring(e.length,i.length)}return null},remove(t,e){this.create(t,"",-1,e)}};var nt={name:"cookie",lookup(t){let{lookupCookie:e}=t;if(e&&typeof document<"u")return we.read(e)||void 0},cacheUserLanguage(t,e){let{lookupCookie:s,cookieMinutes:n,cookieDomain:i,cookieOptions:o}=e;s&&typeof document<"u"&&we.create(s,t,n,i,o)}},ot={name:"querystring",lookup(t){let{lookupQuerystring:e}=t,s;if(typeof window<"u"){let{search:n}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(n=window.location.hash.substring(window.location.hash.indexOf("?")));const o=n.substring(1).split("&");for(let r=0;r<o.length;r++){const a=o[r].indexOf("=");a>0&&o[r].substring(0,a)===e&&(s=o[r].substring(a+1))}}return s}},rt={name:"hash",lookup(t){let{lookupHash:e,lookupFromHashIndex:s}=t,n;if(typeof window<"u"){const{hash:i}=window.location;if(i&&i.length>2){const o=i.substring(1);if(e){const r=o.split("&");for(let a=0;a<r.length;a++){const l=r[a].indexOf("=");l>0&&r[a].substring(0,l)===e&&(n=r[a].substring(l+1))}}if(n)return n;if(!n&&s>-1){const r=i.match(/\/([a-zA-Z-]*)/g);return Array.isArray(r)?r[typeof s=="number"?s:0]?.replace("/",""):void 0}}}return n}};let U=null;const ve=()=>{if(U!==null)return U;try{if(U=typeof window<"u"&&window.localStorage!==null,!U)return!1;const t="i18next.translate.boo";window.localStorage.setItem(t,"foo"),window.localStorage.removeItem(t)}catch{U=!1}return U};var at={name:"localStorage",lookup(t){let{lookupLocalStorage:e}=t;if(e&&ve())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupLocalStorage:s}=e;s&&ve()&&window.localStorage.setItem(s,t)}};let M=null;const Le=()=>{if(M!==null)return M;try{if(M=typeof window<"u"&&window.sessionStorage!==null,!M)return!1;const t="i18next.translate.boo";window.sessionStorage.setItem(t,"foo"),window.sessionStorage.removeItem(t)}catch{M=!1}return M};var lt={name:"sessionStorage",lookup(t){let{lookupSessionStorage:e}=t;if(e&&Le())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupSessionStorage:s}=e;s&&Le()&&window.sessionStorage.setItem(s,t)}},ut={name:"navigator",lookup(t){const e=[];if(typeof navigator<"u"){const{languages:s,userLanguage:n,language:i}=navigator;if(s)for(let o=0;o<s.length;o++)e.push(s[o]);n&&e.push(n),i&&e.push(i)}return e.length>0?e:void 0}},ct={name:"htmlTag",lookup(t){let{htmlTag:e}=t,s;const n=e||(typeof document<"u"?document.documentElement:null);return n&&typeof n.getAttribute=="function"&&(s=n.getAttribute("lang")),s}},dt={name:"path",lookup(t){let{lookupFromPathIndex:e}=t;if(typeof window>"u")return;const s=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(s)?s[typeof e=="number"?e:0]?.replace("/",""):void 0}},ft={name:"subdomain",lookup(t){let{lookupFromSubdomainIndex:e}=t;const s=typeof e=="number"?e+1:1,n=typeof window<"u"&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(n)return n[s]}};let Ee=!1;try{document.cookie,Ee=!0}catch{}const $e=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];Ee||$e.splice(1,1);const ht=()=>({order:$e,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:t=>t});class Ie{constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,s)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e,this.options=tt(s,this.options||{},ht()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=i=>i.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(nt),this.addDetector(ot),this.addDetector(at),this.addDetector(lt),this.addDetector(ut),this.addDetector(ct),this.addDetector(dt),this.addDetector(ft),this.addDetector(rt)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,s=[];return e.forEach(n=>{if(this.detectors[n]){let i=this.detectors[n].lookup(this.options);i&&typeof i=="string"&&(i=[i]),i&&(s=s.concat(i))}}),s=s.filter(n=>n!=null&&!it(n)).map(n=>this.options.convertDetectedLanguage(n)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?s:s.length>0?s[0]:null}cacheUserLanguage(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;s&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||s.forEach(n=>{this.detectors[n]&&this.detectors[n].cacheUserLanguage(e,this.options)}))}}Ie.type="languageDetector";function pt(t,e){const s=e?.size??100,n=e?.deadZone??.1;t.loadSprite("joystick.jump","sprites/icons/jump.gif"),t.loadSprite("joystick.attack","sprites/icons/attack.gif");let i=!1,o=t.vec2(0,0),r=t.vec2(0,0);const a=t.add(["joystickBase",t.layer("hud"),t.stay(),t.pos(-9999,-9999),t.circle(s/2),t.color(0,0,0),t.opacity(.2),t.fixed(),t.anchor("center")]),l=t.add(["joystickKnob",t.layer("hud"),t.stay(),t.pos(-9999,-9999),t.circle(s/4),t.color(255,255,255),t.opacity(.7),t.fixed(),t.anchor("center")]),u=t.add(["jumpButton",t.layer("hud"),t.stay(),t.pos(t.width()-s*.5,t.height()-s*.5),t.area(),t.circle(s/3),t.color(0,0,0),t.opacity(.2),t.fixed(),t.anchor("center")]);u.add([t.sprite("joystick.jump"),t.anchor("center")]),u.onClick(()=>{t.pressButton("jump"),t.releaseButton("jump")});const d=t.add(["attackButton",t.layer("hud"),t.stay(),t.pos(t.width()-s*1.1,t.height()-s*1.1),t.area(),t.circle(s/2.5),t.color(0,0,0),t.opacity(.2),t.fixed(),t.anchor("center")]);d.add([t.sprite("joystick.attack"),t.anchor("center"),t.scale(1.2)]),d.onClick(()=>{t.pressButton("action"),t.releaseButton("action")}),a.onTouchStart(c=>{c.x>t.width()*.6||(o=c,i=!0,a.pos=o,l.pos=o,a.hidden=!1,l.hidden=!1)}),a.onTouchMove(c=>{if(!i||c.x>t.width()*.6)return;r=c.sub(o);const f=s/2,h=t.vec2(t.clamp(r.x,-f,f),t.clamp(r.y,-f,f));l.pos=o.add(h)}),a.onTouchEnd(c=>{c.x>t.width()*.6||(i=!1,r=t.vec2(0,0),a.pos=t.vec2(-9999,-9999),l.pos=t.vec2(-9999,-9999),t.releaseButton("left"),t.releaseButton("right"))}),a.onUpdate(()=>{if(!i)return;const f=r.scale(1/(s/2)).x;f<-n?(t.pressButton("left"),t.releaseButton("right")):f>n?(t.pressButton("right"),t.releaseButton("left")):(t.releaseButton("left"),t.releaseButton("right"))})}const gt={loading:"Загрузка...",rotateDevice:"Поверните устройство"},mt={intro1:"Привет внучек! Наконец-то ты купил свою хатку... Хоть и в ипотеку, но ты всё равно молодец!",intro2:"Внутри пока пустовато... Но я видел некоторую мебель неподолеку, пока сюда шел. Ты можешь поискать её."},yt={common:gt,oldBobr:mt},xt={loading:"Loading...",rotateDevice:"Rotate your device"},St={intro1:"Hello grandson! Finally, you bought your own hut... Even if it's on a mortgage, you're still doing great!",intro2:"It's a bit empty inside... But I saw some furniture nearby while walking here. You can look for it."},bt={common:xt,oldBobr:St},Oe=wt(),m=Te({global:!1,width:Oe.width,height:Oe.height,background:"#74dcf6",letterbox:!0,pixelDensity:2,debug:!0,debugKey:"`",buttons:{left:{keyboard:["left","a"],gamepad:["dpad-left"]},right:{keyboard:["right","d"],gamepad:["dpad-right"]},jump:{keyboard:["space","up","w","k"],gamepad:["south"]},action:{keyboard:["j","z"],gamepad:["east"]}}});function wt(){let t=Math.min(window.innerWidth,400);t%2!==0&&(t-=1);let e=Math.floor(t/(window.innerWidth/window.innerHeight));return e%2!==0&&(e-=1),{width:t,height:e}}class k{static isTouchDevice(e){return e=e||window.navigator.userAgent,"ontouchstart"in window||navigator.maxTouchPoints>0||/ios|iphone|ipad|ipod|android|windows phone/gi.test(e)}static isLandscapeMode(){return window.innerWidth>window.innerHeight}}const N={friction:.2};function Ce(t,e=t.vec2(100,100),s){const n={health:2,attackPower:1,speedX:50,...s};let i=-1;t.loadSprite("gopher","sprites/enemies/gopher.gif",{sliceX:4,sliceY:1,anims:{idle:{from:0,to:0,loop:!1},walk:{from:0,to:3,speed:10,loop:!0}}});const o=t.add(["gopher","enemy",t.sprite("gopher",{anim:"idle"}),t.state("WALK",["IDLE","WALK"]),t.health(n.health,n.health),t.timer(),t.pos(e),t.area(N),t.body(),t.anchor("bot"),t.offscreen({pause:!0,unpause:!0,hide:!0}),{registerHit:r=>{o.applyImpulse(t.vec2(Math.sign(o.pos.x-r.pos.x)*100,-200)),o.hp-=r.config.attackPower},config:n}]);return o.onStateEnter("WALK",async()=>{o.flipX=i<0,o.play("walk"),await o.wait(4),o.enterState("IDLE")}),o.onStateUpdate("WALK",()=>{o.isGrounded()&&o.move(n.speedX*i,0)}),o.onStateEnter("IDLE",async()=>{o.play("idle"),await o.wait(2),o.dead||(i*=-1,o.enterState("WALK"))}),o.onDeath(()=>{o.paused=!0,o.collisionIgnore=["*"],o.use(t.rotate(o.flipX?10:-10))}),o.onExitScreen(()=>{o.dead&&o.destroy()}),o}function vt(t,e){t.loadSprite("home-outside","sprites/home/home-outside.png"),t.loadSprite("home-inside","sprites/home/home-inside.png"),t.loadSprite("home-fence","sprites/home/home-fence.png");const s=t.add(["home-container",t.pos(e),t.anchor("botleft"),t.offscreen({hide:!0,pause:!0,unpause:!0,distance:300}),t.state("OUTSIDE",["INSIDE","OUTSIDE"])]);s.add([t.sprite("home-fence"),t.pos(206,0),t.anchor("botleft")]),s.add(["home-outside",t.sprite("home-inside"),t.anchor("botleft")]);const n=s.add(["home-outside",t.sprite("home-outside"),t.anchor("botleft"),t.animate({relative:!0}),t.z(1)]);return Lt(t,s),s.onStateEnter("OUTSIDE",()=>{n.unanimateAll(),n.animation.seek(0),n.animate("opacity",[0,1],{duration:1,loops:1})}),s.onStateEnter("INSIDE",()=>{n.unanimateAll(),n.animation.seek(0),n.animate("opacity",[1,0],{duration:1,loops:1})}),s.add(["home-entrance",t.rect(20,38,{fill:!1}),t.pos(165,0),t.anchor("botleft"),t.area()]).onCollide("player",()=>{s.state!=="INSIDE"&&s.enterState("INSIDE")}),s.add(["home-exit",t.rect(20,38,{fill:!1}),t.pos(214,0),t.anchor("botleft"),t.area()]).onCollide("player",()=>{s.state!=="OUTSIDE"&&s.enterState("OUTSIDE")}),s}function Lt(t,e){e.add([t.rect(14,200,{fill:!1}),t.pos(198,-42),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add([t.rect(40,12,{fill:!1}),t.pos(161,-42),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add([t.rect(10,220,{fill:!1}),t.pos(-10,0),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add([t.polygon([t.vec2(178,-54),t.vec2(115,-193),t.vec2(125,-193),t.vec2(188,-54)],{fill:!1}),t.pos(0,0),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add([t.polygon([t.vec2(115,-193),t.vec2(50,-221),t.vec2(50,-230),t.vec2(125,-193)],{fill:!1}),t.pos(0,0),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add([t.polygon([t.vec2(50,-221),t.vec2(0,-221),t.vec2(0,-230),t.vec2(50,-230)],{fill:!1}),t.pos(0,0),t.anchor("botleft"),t.area(),t.body({isStatic:!0})]),e.add([t.rect(120,7,{fill:!1}),t.pos(57,-58),t.anchor("botleft"),t.area(N),t.body({isStatic:!0})]),e.add([t.rect(95,7,{fill:!1}),t.pos(0,-122),t.anchor("botleft"),t.area(N),t.body({isStatic:!0})])}function Ot(t,e,s,n){n={speed:.05,...n};const i=t.width()/2,o=5;let r="",a=0,l=0,u=!1;const d=t.add([t.rect(i,16,{radius:4}),t.pos(f()),t.color(0,0,0),t.opacity(.6),t.anchor("bot"),t.layer("hud")]),c=d.add([t.pos(t.vec2(0,-o)),t.text("",{size:8,width:i-o*2,font:"pixel",lineSpacing:2}),t.anchor("bot")]);c.onUpdate(()=>{d.height=c.height+o*2,d.pos=f(),u||(l+=t.dt(),l>=n.speed&&(l=0,r+=s[a],c.text=r,a++,a>=s.length&&(u=!0)))});function f(){return e.pos.add(0,-e.height)}return d}function Ct(t,e,s,n,i){return new Promise(o=>{let r=0;async function a(){if(r<n.length){const l=Ot(t,e,n[r],i);await s.waitForActionButton(),l.destroy(),r++,a().then()}else o()}a().then()})}function Pt(t,e=t.vec2(100,100),s){const n={...s};t.loadSprite("old-bobr","sprites/characters/old-bobr.gif",{sliceX:2,sliceY:1,anims:{idle:{from:0,to:1,speed:1.5,loop:!0}}});const i=t.add(["old-bobr","interactable",t.sprite("old-bobr",{anim:"idle"}),t.state("IDLE",["IDLE"]),t.timer(),t.pos(e),t.area({...N}),t.area({...N,collisionIgnore:["player","enemy"]}),t.body(),t.anchor("bot"),t.offscreen({pause:!0,unpause:!0,hide:!0}),{config:n,interact:o}]);async function o(r){i.flipX=i.pos.x>r.pos.x,await Ct(t,i,r,[te("oldBobr.intro1"),te("oldBobr.intro2")])}return i.onStateEnter("IDLE",async()=>{i.play("idle")}),i}const Rt={maxRunSpeed:200,accelGround:200,accelAir:150,decelGround:500,decelAir:300,jumpForce:400,minRunAnimSpeed:1,maxRunAnimSpeed:2,attackPower:1,maxHealth:2};m.loadSprite("player","sprites/characters/bobr.gif",{sliceX:5,sliceY:4,anims:{idle:{from:0,to:1,speed:3,loop:!0},walk:{from:5,to:8,speed:10,loop:!0},jump:{from:10,to:10},fall:{from:10,to:10},attack:{from:15,to:19,speed:20,loop:!1}}});function Et(t,e=t.vec2(100,100),s){const n={...Rt,...s},i=t.add(["player",t.sprite("player",{anim:"idle"}),t.pos(e),t.area({shape:new t.Rect(t.vec2(1,0),20,31),...N}),t.body(),t.anchor("bot"),t.opacity(1),t.state("IDLE",["IDLE","WALK","JUMP","FALL","ATTACK","INTERACT"]),t.health(n.maxHealth,n.maxHealth),t.timer(),{vx:0,config:n,waitForActionButton:d}]);let o,r;function a(){i.jump(n.jumpForce),i.enterState("JUMP")}function l(){return!!r}function u(c,f){i.getCurAnim()?.name!==c&&i.play(c,{onEnd:f})}function d(){return new Promise(c=>{i.onButtonPress("action",()=>{c()})})}return i.onButtonPress("jump",()=>{i.state!=="INTERACT"&&i.isGrounded()&&a()}),i.onButtonPress("action",()=>{if(i.state==="ATTACK"||i.state==="INTERACT")return;let c=!0,f=!1;const h=i.add(["player.interaction-hitbox",t.pos(i.flipX?-14:14,0),t.area({shape:new t.Rect(t.vec2(1,0),16,i.height)}),t.rect(20,20,{fill:!1}),t.anchor("bot"),t.opacity(0)]);h.onCollide("interactable",async p=>{f=!0,i.enterState("INTERACT"),await p.interact(i),i.enterState("IDLE")}),h.onUpdate(()=>{c?c=!1:(f||i.enterState("ATTACK"),i.remove(h))})}),i.onFixedUpdate(()=>{const c=t.dt(),f=i.isGrounded();let h=0;if(i.state!=="INTERACT"&&(t.isButtonDown("left")?h=-1:t.isButtonDown("right")&&(h=1)),i.friction=f?N.friction:0,h!==0){let p=f?n.accelGround:n.accelAir;Math.sign(h)!==Math.sign(i.vx)&&(p+=f?n.decelGround:n.decelAir),i.vx=$t(i.vx,h*n.maxRunSpeed,p*c)}else{const p=f?n.decelGround:n.decelAir,y=Math.max(0,Math.abs(i.vx)-p*c);i.vx=y*Math.sign(i.vx)}i.move(i.vx,0),i.flipX=h<0?!0:h>0?!1:i.flipX,i.area.scale.x=i.flipX?-1:1,i.state==="ATTACK"?i.getCurAnim()?.frameIndex===2&&(o||(o=i.add(["player.hitbox",t.pos(t.vec2(i.flipX?-16:16,0)),t.area(),t.rect(20,20),t.opacity(0),t.anchor("bot"),t.lifespan(.1)]),o.onCollide("enemy",p=>{p.registerHit(i)}),o.onDestroy(()=>{o=void 0}))):i.state==="INTERACT"||(f?Math.abs(i.vx)>5?i.enterState("WALK"):i.enterState("IDLE"):i.vel.y<0?i.enterState("JUMP"):i.enterState("FALL")),l()?i.opacity=Math.abs(Math.sin(t.time()*20))*.5+.5:i.opacity=1}),i.onStateEnter("IDLE",()=>{u("idle")}),i.onStateEnter("INTERACT",()=>{u("idle")}),i.onStateUpdate("WALK",()=>{u("walk");const c=t.clamp(Math.abs(i.vx)/n.maxRunSpeed,0,1);i.animSpeed=t.lerp(n.minRunAnimSpeed,n.maxRunAnimSpeed,c)}),i.onStateEnter("JUMP",()=>{u("jump")}),i.onStateEnter("FALL",()=>{u("fall")}),i.onStateEnter("ATTACK",()=>{u("attack",()=>{i.enterState("IDLE")}),i.animSpeed=1}),i.onCollideUpdate("enemy",c=>{!l()&&i.state!=="ATTACK"&&!c.dead&&c.config.attackPower&&(i.hp-=c.config.attackPower,i.applyImpulse(t.vec2(Math.sign(i.pos.x-c.pos.x)*150,-230)),r?.cancel(),r=i.wait(1),r.onEnd(()=>{r=void 0}))}),i.onDeath(()=>{window.location.reload()}),i}function $t(t,e,s){const n=e-t;return Math.abs(n)<=s?e:t+Math.sign(e)*s}const It=t=>{t.setGravity(1e3),t.add([t.rect(1200,20),t.pos(0,t.height()),t.color("#9e9303"),t.area(N),t.anchor("topleft"),t.body({isStatic:!0})]),vt(t,t.vec2(0,t.height())),t.add([t.rect(100,20),t.pos(400,t.height()-60),t.color("#9e9303"),t.area(),t.anchor("top"),t.body({isStatic:!0})]),t.add([t.rect(100,20),t.pos(550,t.height()-100),t.color("#9e9303"),t.area(),t.anchor("top"),t.body({isStatic:!0})]),t.add([t.rect(100,20),t.pos(800,t.height()-150),t.color("#9e9303"),t.area(),t.anchor("top"),t.body({isStatic:!0})]),Pt(t,t.vec2(280,220));const e=Et(t,t.vec2(420,0));Ce(t,t.vec2(600,t.height()-100)),Ce(t,t.vec2(800,t.height()-100)),t.onUpdate(()=>{t.setCamPos(Math.max(e.pos.x,t.width()/2),e.pos.y-t.height()/4)})};(async()=>{await S.use(Ie).init({fallbackLng:"ru",resources:{ru:{translation:yt},en:{translation:bt}}}),m.loadFont("pixel","fonts/Press_Start_2P/PressStart2P-Regular.ttf"),m.setLayers(["game","hud","menu"],"game");const t=k.isLandscapeMode();if(window.addEventListener("resize",()=>{k.isLandscapeMode()!==t&&setTimeout(()=>{window.location.reload()},1e3)}),!t){m.loadSprite("rotate-device","sprites/icons/rotate-device.gif"),m.add(["rotate-device",m.sprite("rotate-device",{width:100}),m.anchor("bot"),m.pos(m.width()/2,m.height()/2-10),m.scale(m.vec2(-1,1)),m.fixed(),m.stay()]),m.add(["rotate-warning-text",m.text(te("common.rotateDevice"),{font:"pixel",size:24,width:m.width()*.8,align:"center",lineSpacing:10}),m.color("white"),m.anchor("top"),m.pos(m.width()/2,m.height()/2+20),m.fixed(),m.stay()]);return}m.scene("level-home",()=>It(m)),m.go("level-home"),k.isTouchDevice()&&pt(m,{size:Math.min(window.innerWidth/15,60)}),m.loadSprite("reload-button","sprites/icons/reload.png"),m.add(["reload-button",m.layer("hud"),m.sprite("reload-button"),m.area(),m.pos(m.width()-10,10),m.anchor("topright"),m.fixed(),m.stay()]).onClick(()=>{window.location.reload()})})();
