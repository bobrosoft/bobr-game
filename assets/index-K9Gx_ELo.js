import{R as S}from"./kaplay-DTLyooHV.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(t){if(t.ep)return;t.ep=!0;const o=i(t);fetch(t.href,o)}})();function v(e,a){const i=a?.size??100,r=a?.deadZone??.1;e.loadSprite("joystick.jump","sprites/icons/jump.gif"),e.loadSprite("joystick.attack","sprites/icons/attack.gif");let t=!1,o=e.vec2(0,0),s=e.vec2(0,0);const d=e.add(["joystickBase",e.layer("hud"),e.stay(),e.pos(-9999,-9999),e.circle(i/2),e.color(0,0,0),e.opacity(.2),e.fixed(),e.anchor("center")]),l=e.add(["joystickKnob",e.layer("hud"),e.stay(),e.pos(-9999,-9999),e.circle(i/4),e.color(255,255,255),e.opacity(.7),e.fixed(),e.anchor("center")]),p=e.add(["jumpButton",e.layer("hud"),e.stay(),e.pos(e.width()-i*.5,e.height()-i*.5),e.area(),e.circle(i/3),e.color(0,0,0),e.opacity(.2),e.fixed(),e.anchor("center")]);p.add([e.sprite("joystick.jump"),e.anchor("center")]),p.onClick(()=>{e.pressButton("jump"),e.releaseButton("jump")});const h=e.add(["attackButton",e.layer("hud"),e.stay(),e.pos(e.width()-i*1.1,e.height()-i*1.1),e.area(),e.circle(i/2.5),e.color(0,0,0),e.opacity(.2),e.fixed(),e.anchor("center")]);h.add([e.sprite("joystick.attack"),e.anchor("center"),e.scale(1.2)]),h.onClick(()=>{e.pressButton("action"),e.releaseButton("action")}),d.onTouchStart(c=>{c.x>e.width()/2||(o=c,t=!0,d.pos=o,l.pos=o,d.hidden=!1,l.hidden=!1)}),d.onTouchMove(c=>{if(!t)return;s=c.sub(o);const u=i/2,g=e.vec2(e.clamp(s.x,-u,u),e.clamp(s.y,-u,u));l.pos=o.add(g)}),d.onTouchEnd(c=>{c.x>e.width()*.6||(t=!1,s=e.vec2(0,0),d.pos=e.vec2(-9999,-9999),l.pos=e.vec2(-9999,-9999),e.releaseButton("left"),e.releaseButton("right"))}),d.onUpdate(()=>{if(!t)return;const u=s.scale(1/(i/2)).x;u<-r?(e.pressButton("left"),e.releaseButton("right")):u>r?(e.pressButton("right"),e.releaseButton("left")):(e.releaseButton("left"),e.releaseButton("right"))})}const m=b(),n=S({global:!1,width:m.width,height:m.height,background:"#74dcf6",crisp:!0,letterbox:!0,pixelDensity:2,scale:2,debug:!0,debugKey:"`",buttons:{left:{keyboard:["left","a"],gamepad:["dpad-left"]},right:{keyboard:["right","d"],gamepad:["dpad-right"]},jump:{keyboard:["space","up","w","k"],gamepad:["south"]},action:{keyboard:["j","z"],gamepad:["east"]}}});function b(){let e=Math.min(window.innerWidth,400);e%2!==0&&(e-=1);let a=Math.floor(e/(window.innerWidth/window.innerHeight));return a%2!==0&&(a-=1),{width:e,height:a}}class w{static isTouchDevice(a){return a=a||window.navigator.userAgent,"ontouchstart"in window||navigator.maxTouchPoints>0||/ios|iphone|ipad|ipod|android|windows phone/gi.test(a)}}const f={friction:.2};function y(e,a=e.vec2(100,100),i){const r={health:2,speedX:50,...i};let t=-1;e.loadSprite("gopher","sprites/enemies/gopher.gif",{sliceX:4,sliceY:1,anims:{idle:{from:0,to:0,loop:!1},walk:{from:0,to:3,speed:10,loop:!0}}});const o=e.add(["gopher","enemy",e.sprite("gopher",{anim:"idle"}),e.state("WALK",["IDLE","WALK"]),e.health(r.health,r.health),e.timer(),e.pos(a),e.area(f),e.body(),e.anchor("bot"),e.offscreen({pause:!0,unpause:!0,hide:!0}),{registerHit:s=>{o.applyImpulse(e.vec2(Math.sign(o.pos.x-s.pos.x)*100,-200)),o.hp-=s.attackPower}}]);return o.onStateEnter("WALK",async()=>{o.flipX=t<0,o.play("walk"),await o.wait(4),o.enterState("IDLE")}),o.onStateUpdate("WALK",()=>{o.isGrounded()&&o.move(r.speedX*t,0)}),o.onStateEnter("IDLE",async()=>{o.play("idle"),await o.wait(2),t*=-1,o.enterState("WALK")}),o.onDeath(()=>{o.collisionIgnore=["*"],o.use(e.rotate(o.flipX?10:-10))}),o.onExitScreen(()=>{o.dead&&o.destroy()}),o}function x(e,a){e.loadSprite("home-outside","sprites/home/home-outside.png"),e.loadSprite("home-inside","sprites/home/home-inside.png"),e.loadSprite("home-fence","sprites/home/home-fence.png");const i=e.add(["home-container",e.pos(a),e.anchor("botleft"),e.offscreen({hide:!0,pause:!0,unpause:!0,distance:300}),e.state("OUTSIDE",["INSIDE","OUTSIDE"])]);i.add([e.sprite("home-fence"),e.pos(206,0),e.anchor("botleft")]),i.add(["home-outside",e.sprite("home-inside"),e.anchor("botleft")]);const r=i.add(["home-outside",e.sprite("home-outside"),e.anchor("botleft"),e.animate({relative:!0})]);return A(e,i),i.onStateEnter("OUTSIDE",()=>{r.unanimateAll(),r.animation.seek(0),r.animate("opacity",[0,1],{duration:1,loops:1})}),i.onStateEnter("INSIDE",()=>{r.unanimateAll(),r.animation.seek(0),r.animate("opacity",[1,0],{duration:1,loops:1})}),i.add(["home-entrance",e.rect(20,38,{fill:!1}),e.pos(165,0),e.anchor("botleft"),e.area()]).onCollide("player",()=>{i.state!=="INSIDE"&&i.enterState("INSIDE")}),i.add(["home-exit",e.rect(20,38,{fill:!1}),e.pos(214,0),e.anchor("botleft"),e.area()]).onCollide("player",()=>{i.state!=="OUTSIDE"&&i.enterState("OUTSIDE")}),i}function A(e,a){a.add([e.rect(14,200,{fill:!1}),e.pos(198,-42),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),a.add([e.rect(40,12,{fill:!1}),e.pos(161,-42),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),a.add([e.rect(10,220,{fill:!1}),e.pos(-10,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),a.add([e.polygon([e.vec2(178,-54),e.vec2(115,-193),e.vec2(125,-193),e.vec2(188,-54)],{fill:!1}),e.pos(0,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),a.add([e.polygon([e.vec2(115,-193),e.vec2(50,-221),e.vec2(50,-230),e.vec2(125,-193)],{fill:!1}),e.pos(0,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})]),a.add([e.polygon([e.vec2(50,-221),e.vec2(0,-221),e.vec2(0,-230),e.vec2(50,-230)],{fill:!1}),e.pos(0,0),e.anchor("botleft"),e.area(),e.body({isStatic:!0})])}const E={maxRunSpeed:200,accelGround:200,accelAir:150,decelGround:500,decelAir:300,jumpForce:400,minRunAnimSpeed:1,maxRunAnimSpeed:2,attackPower:1};n.loadSprite("player","sprites/characters/bobr.gif",{sliceX:5,sliceY:4,anims:{idle:{from:0,to:1,speed:3,loop:!0},walk:{from:5,to:8,speed:10,loop:!0},jump:{from:10,to:10},fall:{from:10,to:10},attack:{from:15,to:19,speed:20,loop:!1}}});function L(e,a=e.vec2(100,100),i){const r={...E,...i},t=e.add(["player",e.sprite("player",{anim:"idle"}),e.pos(a),e.area({shape:new e.Rect(e.vec2(1,0),20,31),...f}),e.body(),e.anchor("bot"),e.state("IDLE",["IDLE","WALK","JUMP","FALL","ATTACK"]),{vx:0,get moveDirection(){return(e.isButtonDown("right")?1:0)+(e.isButtonDown("left")?-1:0)},get attackPower(){return r.attackPower}}]);let o;function s(){t.jump(r.jumpForce),t.enterState("JUMP")}function d(l,p){t.getCurAnim()?.name!==l&&t.play(l,{onEnd:p})}return t.onButtonPress("jump",()=>{t.isGrounded()&&s()}),t.onButtonPress("action",()=>{t.state!=="ATTACK"&&t.enterState("ATTACK")}),t.onFixedUpdate(()=>{const l=e.dt(),p=t.isGrounded(),h=t.moveDirection;if(h!==0){let c=p?r.accelGround:r.accelAir;Math.sign(h)!==Math.sign(t.vx)&&(c+=p?r.decelGround:r.decelAir),t.vx=D(t.vx,h*r.maxRunSpeed,c*l)}else{const c=p?r.decelGround:r.decelAir,u=Math.max(0,Math.abs(t.vx)-c*l);t.vx=u*Math.sign(t.vx)}t.move(t.vx,0),t.flipX=h<0?!0:h>0?!1:t.flipX,t.area.scale.x=t.flipX?-1:1,t.state!=="ATTACK"?p?Math.abs(t.vx)>5?t.enterState("WALK"):t.enterState("IDLE"):t.vel.y<0?t.enterState("JUMP"):t.enterState("FALL"):t.getCurAnim()?.frameIndex===2&&(o||(o=t.add(["player.hitbox",e.pos(e.vec2(t.flipX?-16:16,0)),e.area(),e.rect(20,20),e.opacity(0),e.anchor("bot"),e.lifespan(.1)]),o.onCollide("enemy",c=>{c.registerHit(t)}),o.onDestroy(()=>{o=void 0})))}),t.onStateEnter("IDLE",()=>{d("idle")}),t.onStateUpdate("WALK",()=>{d("walk");const l=e.clamp(Math.abs(t.vx)/r.maxRunSpeed,0,1);t.animSpeed=e.lerp(r.minRunAnimSpeed,r.maxRunAnimSpeed,l)}),t.onStateEnter("JUMP",()=>{d("jump")}),t.onStateEnter("FALL",()=>{d("fall")}),t.onStateEnter("ATTACK",()=>{d("attack",()=>{t.enterState("IDLE")}),t.animSpeed=1}),t}function D(e,a,i){const r=a-e;return Math.abs(r)<=i?a:e+Math.sign(a)*i}const I=e=>{e.setGravity(1e3),e.add([e.rect(1200,20),e.pos(0,e.height()),e.color("#9e9303"),e.area(f),e.anchor("topleft"),e.body({isStatic:!0})]),x(e,e.vec2(0,e.height())),e.add([e.rect(100,20),e.pos(400,e.height()-60),e.color("#9e9303"),e.area(),e.anchor("top"),e.body({isStatic:!0})]),e.add([e.rect(100,20),e.pos(550,e.height()-100),e.color("#9e9303"),e.area(),e.anchor("top"),e.body({isStatic:!0})]),e.add([e.rect(100,20),e.pos(800,e.height()-150),e.color("#9e9303"),e.area(),e.anchor("top"),e.body({isStatic:!0})]),y(e,e.vec2(600,e.height()-100)),y(e,e.vec2(800,e.height()-100));const a=L(e,e.vec2(420,0));e.onUpdate(()=>{e.setCamPos(Math.max(a.pos.x,e.width()/2),a.pos.y-e.height()/4)})};n.setLayers(["game","hud","menu"],"game");n.scene("level-home",()=>I(n));n.go("level-home");w.isTouchDevice()&&v(n,{size:Math.min(window.innerWidth/15,60)});n.loadSprite("reload-button","sprites/icons/reload.png");const T=n.add(["reload-button",n.sprite("reload-button"),n.area(),n.pos(n.width()-10,10),n.anchor("topright"),n.fixed(),n.stay()]);T.onClick(()=>{window.location.reload()});window.addEventListener("resize",()=>{setTimeout(()=>{window.location.reload()},1e3)});
